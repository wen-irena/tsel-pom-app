define(["ojs/ojcore","knockout","common/commonUtils","common/restService","common/userInfo","common/constants","common/configService","ojs/ojmodule-element-utils","ojs/ojmodule-element","ojs/ojrouter","ojs/ojknockout","ojs/ojarraytabledatasource","ojs/ojnavigationlist","ojs/ojjsontreedatasource","ojs/ojoffcanvas","serviceUtils","common/xhrUtils"],function(e,o,n,t,r,a,c,i){return new function(){var l=this;l.userInfo=r,l.hideAdminDashboardMenu=o.observable();var s=e.ResponsiveUtils.getFrameworkQuery(e.ResponsiveUtils.FRAMEWORK_QUERY_KEY.SM_ONLY);l.smScreen=e.ResponsiveKnockoutUtils.createMediaQueryObservable(s);var u,d=e.ResponsiveUtils.getFrameworkQuery(e.ResponsiveUtils.FRAMEWORK_QUERY_KEY.MD_UP);function m(){return!!(l.userInfo&&l.userInfo.userAccess()&&l.userInfo.userAccess().length>0)}function h(e){var o;if((o=e||n.getParameterByName("root"))||(o=l.router.defaultStateId),"401-unauthorized"!==o)return!!l.userInfo.hasAccess(o)||(n.restErrorHandler("401"),!1)}function f(e){return new Promise(function(e,o){getRestData(t.userInfo,null,null,function(n,t){"ERROR"!==n?(l.userInfo.setUserInfo(n),l.userLogin(l.userInfo.userLogin()),e()):o(t)})}).then(function(o){!0===m()&&h(e),l.hideAdminDashboardMenu(r.isRoleReadOnly()),!0===l.hideAdminDashboardMenu()&&document.getElementById("adminDashboard").setAttribute("style","display:none")}).catch(function(e){n.restErrorHandler(e)})}l.mdScreen=e.ResponsiveKnockoutUtils.createMediaQueryObservable(d),l.checkToken=new Promise(async function(e,o){!0===n.isTokenExist()?!0===m()?h()?e():o("401"):f().then(function(){e()}):o("403")}).catch(function(e){n.restErrorHandler(e)}),l.router=e.Router.rootInstance,l.router.configure({dashboard:{label:"Dashboard Scheduler",value:"dashboardscheduler",isDefault:!0,canEnter:l.checkToken},tasks:{label:"Tasks",canEnter:l.checkToken},orders:{label:"Orders",canEnter:l.checkToken},fallout:{label:"Fallout",canEnter:l.checkToken},collectionmonitoring:{label:"Collection Monitoring",canEnter:l.checkToken},viewpayload:{label:"View Payload",canEnter:l.checkToken},massorder:{label:"Mass Order Action",canEnter:l.checkToken},falloutdetails:{label:"Fallout Details",canEnter:l.checkToken},servicemonitoring:{label:"Service Monitoring",canEnter:l.checkToken},"401-unauthorized":{label:"401 Unauthorized",value:(u="401-unauthorized","errorPages/"+u.substr(u.lastIndexOf("/")+1))},navigation:{label:"Navigation"},collectiondetail:{label:"Collection Detail",canEnter:l.checkToken},servicedetail:{label:"Service Detail",canEnter:l.checkToken},cachemonitoring:{label:"Cache Monitoring",canEnter:l.checkToken},openrestriction:{label:"Open Restriction",canEnter:l.checkToken},collectiondashboard:{label:"Collection Dashboard",canEnter:l.checkToken}}),e.Router.defaults.urlAdapter=new e.Router.urlParamAdapter,l.moduleConfig=o.observable({view:[],viewModel:null}),l.loadModule=function(){o.computed(function(){var e=l.router.moduleConfig.name(),o="views/"+e+".html",n="viewModels/"+e;Promise.all([i.createView({viewPath:o}),i.createViewModel({viewModelPath:n})]).then(function(e){l.moduleConfig({view:e[0],viewModel:e[1]})},function(e){})})},this.itemOnly=function(e){return e.leaf},l.redirect=function(o,t){null!==o&&""!==o&&new Promise(function(e,o){!0===n.isTokenExist()?e(!0):o("403")}).then(function(e){!0===m()?h(o):f(o)}).catch(function(e){n.restErrorHandler(e)})&&(e.Router.rootInstance.store(t),e.Router.rootInstance.go(o))},l.mdScreen.subscribe(function(){e.OffcanvasUtils.close(l.drawerParams)}),l.drawerParams={displayMode:"push",selector:"#navDrawer",content:"#pageContent"},l.toggleDrawer=function(){return e.OffcanvasUtils.toggle(l.drawerParams)},l.appName=o.observable(a.appName),l.userLogin=o.observable(),l.encodes=function(){localStorage.getItem("xauth")&&localStorage.removeItem("xauth"),l.auth=btoa(l.name+":"+l.cred),localStorage.setItem("xauth",l.auth),document.cookie="xinit=true; path=/;"},l.getAuth=function(){return localStorage.getItem("xauth")},l.sanitizeUrl=function(e){return e=(e=(e=(e=e.replace("<","&lt;").replace(">","&gt;")).replace("eval\\((.*)\\)","")).replace("[\\\"\\'][\\s]*((?i)javascript):(.*)[\\\"\\']",'""')).replace("((?i)script)","")},l.menuItemAction=function(e){if("out"!==e.target.value)"adminDashboard"!==e.target.value||(window.location.href=c.portalAdmServiceUrl+"/index.html");else{localStorage.clear();const e=encodeURIComponent(l.sanitizeUrl(window.location.origin+window.location.pathname));window.location.href=c.portalAdmServiceUrl+"/login.html?url="+e+"&appId="+encodeURIComponent(a.appId)}}}});