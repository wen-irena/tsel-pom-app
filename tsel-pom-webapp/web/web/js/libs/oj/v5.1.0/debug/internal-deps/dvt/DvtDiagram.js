"use strict";define(["jquery","./DvtToolkit","./DvtPanZoomCanvas"],function(t,e){return function(t){var e=function(){this.Init()};t.Obj.createSubclass(e,t.Obj,"DvtDiagramLayoutContext"),e.prototype.Init=function(){this._nodeCount=0,this._linkCount=0,this._bLocaleR2L=!1,this._nodes={},this._links={},this._arNodes=[],this._arLinks=[],this._dirtyContext={}},e.prototype.setLayout=function(t){this._layout=t},e.prototype.getLayout=function(){return this._layout},e.prototype.setLayoutAttributes=function(t){this._layoutAttrs=t},e.prototype.getLayoutAttributes=function(){return this._layoutAttrs},e.prototype.addNode=function(t){this.getNodeById(t.getId())||(this._nodeCount++,this._arNodes.push(t)),this._nodes[t.getId()]=t},e.prototype.addNodeToMap=function(t){this._nodes[t.getId()]=t},e.prototype.removeNode=function(e,o){o&&(e?t.ArrayUtils.removeItem(e.getChildNodes(),o):(t.ArrayUtils.removeItem(this._arNodes,o),this._nodeCount--),delete this._nodes[o.getId()])},e.prototype.getNodeById=function(t){return this._nodes[t]},e.prototype.getNodeByIndex=function(t){return this._arNodes[t]},e.prototype.getNodeCount=function(){return this._nodeCount},e.prototype.addLink=function(t){this.getLinkById(t.getId())||(this._linkCount++,this._arLinks.push(t)),this._links[t.getId()]=t},e.prototype.removeLink=function(e){e&&(this.getLinkById(e.getId())&&(t.ArrayUtils.removeItem(this._arLinks,e),this._linkCount--),delete this._links[e.getId()])},e.prototype.getLinkById=function(t){return this._links[t]},e.prototype.getLinkByIndex=function(t){return this._arLinks[t]},e.prototype.getLinkCount=function(){return this._linkCount},e.prototype.localToGlobal=function(e,o){var i=this.GetGlobalOffset(o);return new t.DiagramPoint(e.x+i.x,e.y+i.y)},e.prototype.GetGlobalOffset=function(e){for(var o=new t.DiagramPoint(0,0);e;){o.x+=e.ContentOffset.x+e.getPosition().x,o.y+=e.ContentOffset.y+e.getPosition().y;var i=e.getContainerId();if(i){if((e=this.getNodeById(i))&&e.isDisclosed()){var n=e.getContainerPadding();n&&(o.x+=n.left,o.y+=n.top)}}else e=null}return o},e.prototype.setLocaleR2L=function(t){this._bLocaleR2L=t},e.prototype.isLocaleR2L=function(){return this._bLocaleR2L},e.prototype.setComponentSize=function(t){this._componentSize=t},e.prototype.getComponentSize=function(){return this._componentSize},e.prototype.setViewport=function(t){this._viewport=t},e.prototype.getViewport=function(){return this._viewport},e.prototype.setContainerId=function(t){this._containerId=t},e.prototype.getContainerId=function(){return this._containerId},e.prototype.setContainerPadding=function(t,e,o,i){this.getContainerId()&&(this._containerPadding={},"number"!=typeof t&&"string"!=typeof t&&(i=t.left,e=t.right,o=t.bottom,t=t.top),this._containerPadding.top=t,this._containerPadding.right=e,this._containerPadding.bottom=o,this._containerPadding.left=i)},e.prototype.getContainerPadding=function(){return this._containerPadding},e.prototype.setCurrentViewport=function(t){this._currentViewport=t},e.prototype.getCurrentViewport=function(){return this._currentViewport},e.prototype.getCommonContainer=function(t,e){for(var o=function(t,e){for(var o=[],i=e.getNodeById(t)?e.getNodeById(t).getContainerId():null;i;)o.push(i),i=e.getNodeById(i)?e.getNodeById(i).getContainerId():null;return o.reverse(),o},i=o(t,this),n=o(e,this),a=null,r=0;r<i.length&&r<n.length&&i[r]==n[r];r++)a=i[r];return a},e.prototype.getEventData=function(){return this._eventData},e.prototype.setEventData=function(t){this._eventData=t},e.prototype.setDirtyContext=function(t){this._dirtyContext=t},e.prototype.getDirtyContext=function(){return this._dirtyContext};var o=function(){this.Init()};t.Obj.createSubclass(o,t.Obj,"DvtDiagramLayoutContextLink"),o.prototype.Init=function(){this._startConnectorOffset=0,this._endConnectorOffset=0,this._linkWidth=1,this._selected=!1,this._bPromoted=!1},o.prototype.setId=function(t){this._id=t},o.prototype.getId=function(){return this._id},o.prototype.setStartId=function(t){this._startId=t},o.prototype.getStartId=function(){return this._startId},o.prototype.setEndId=function(t){this._endId=t},o.prototype.getEndId=function(){return this._endId},o.prototype.setPoints=function(e){this._points="string"==typeof e?t.PathUtils.createPathArray(e):e,this.setDirty()},o.prototype.getPoints=function(){return this._points},o.prototype.setLabelPosition=function(t){this._labelPosition=t,this.setDirty()},o.prototype.getLabelPosition=function(){return this._labelPosition},o.prototype.setLabelBounds=function(t){this._labelBounds=t},o.prototype.getLabelBounds=function(){return this._labelBounds},o.prototype.setStartConnectorOffset=function(t){this._startConnectorOffset=t},o.prototype.getStartConnectorOffset=function(){return this._startConnectorOffset},o.prototype.setEndConnectorOffset=function(t){this._endConnectorOffset=t},o.prototype.getEndConnectorOffset=function(){return this._endConnectorOffset},o.prototype.setLinkWidth=function(t){this._linkWidth=t},o.prototype.getLinkWidth=function(){return this._linkWidth},o.prototype.setLayoutAttributes=function(t){this._layoutAttrs=t},o.prototype.getLayoutAttributes=function(){return this._layoutAttrs},o.prototype.setSelected=function(t){this._selected=t},o.prototype.getSelected=function(){return this._selected},o.prototype.setLabelRotationAngle=function(t){this._labelRotAngle=t,this.setDirty()},o.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},o.prototype.setLabelRotationPoint=function(t){this._labelRotPoint=t,this.setDirty()},o.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},o.prototype.setPromoted=function(t){this._bPromoted=t},o.prototype.isPromoted=function(){return this._bPromoted},o.prototype.setLabelValign=function(t){this._labelValign=t,this.setDirty()},o.prototype.setLabelHalign=function(t){this._labelHalign=t,this.setDirty()},o.prototype.getLabelValign=function(){return this._labelValign},o.prototype.getLabelHalign=function(){return this._labelHalign},o.prototype.setCoordinateSpace=function(t){this._coordinateContainerId=t,this.setDirty()},o.prototype.getCoordinateSpace=function(){return this._coordinateContainerId},o.prototype.setData=function(t){this._data=t},o.prototype.getData=function(){return this._data},o.prototype.setDirty=function(){this.LayoutContext&&(this.LayoutContext.getDirtyContext()[this.getId()]=!0)},o.prototype.copyFrom=function(t){t&&(this.setPoints(t.getPoints()),this.setLabelPosition(t.getLabelPosition()),this.setLabelRotationAngle(t.getLabelRotationAngle()),this.setLabelRotationPoint(t.getLabelRotationPoint()),this.setLabelValign(t.getLabelValign()),this.setLabelHalign(t.getLabelHalign()),this.setCoordinateSpace(t.getCoordinateSpace()))};var i=function(){this.Init()};t.Obj.createSubclass(i,t.Obj,"DvtDiagramLayoutContextNode"),i.prototype.Init=function(){this._bReadOnly=!1,this._selected=!1,this._bDisclosed=!1,this.IsRendered=!0,this.ContentOffset=new t.DiagramPoint(0,0)},i.prototype.setId=function(t){this._id=t},i.prototype.getId=function(){return this._id},i.prototype.setBounds=function(t){this._bounds=t,this._origBounds=t},i.prototype.getBounds=function(){return!this._bounds&&this.Component&&this.Component.updateNodeDims(this),this._bounds},i.prototype.setContentBounds=function(t){this._contentBounds=t,this._origContentBounds=t},i.prototype.getContentBounds=function(){return!this._contentBounds&&this.Component&&this.Component.updateNodeDims(this),this._contentBounds},i.prototype.setPosition=function(t){this._position=t,this.UpdateParentNodes(),this.setDirty()},i.prototype.getPosition=function(){return this._position},i.prototype.getRelativePosition=function(e){var o=this.LayoutContext;if(o){for(var i=new t.DiagramPoint(0,0),n=this,a=!1;n;){var r=n.getContainerId();if(r){var s=o.getNodeById(r);s&&this.Component&&!s.IsRendered&&this.Component.renderNodeFromContext(s,!0)}if(i.x+=n.ContentOffset.x+n.getPosition().x,i.y+=n.ContentOffset.y+n.getPosition().y,r!=e)if((n=o.getNodeById(r))&&n.isDisclosed()){var d=n.getContainerPadding();d&&(i.x+=d.left,i.y+=d.top)}else n=null;else a=!0,n=null}return a||(i=null),i}},i.prototype.setLabelPosition=function(t){this._labelPosition=t,this.setDirty()},i.prototype.getLabelPosition=function(){return this._labelPosition},i.prototype.setLabelBounds=function(t){this._labelBounds=t},i.prototype.getLabelBounds=function(){return!this._labelBounds&&this.Component&&this.Component.updateNodeDims(this),this._labelBounds},i.prototype.setLayoutAttributes=function(t){this._layoutAttrs=t},i.prototype.getLayoutAttributes=function(){return this._layoutAttrs},i.prototype.setReadOnly=function(t){this._bReadOnly=t},i.prototype.isReadOnly=function(){return this._bReadOnly},i.prototype.setContainerId=function(t){this._containerId=t},i.prototype.getContainerId=function(){return this._containerId},i.prototype.setSelected=function(t){this._selected=t},i.prototype.getSelected=function(){return this._selected},i.prototype.setLabelRotationAngle=function(t){this._labelRotAngle=t,this.setDirty()},i.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},i.prototype.setLabelRotationPoint=function(t){this._labelRotPoint=t,this.setDirty()},i.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},i.prototype.SetContainerPaddingObj=function(e){this.isDisclosed()&&(this._containerPadding=e,e&&(this._origBounds&&(this._origBounds=new t.DiagramRectangle(this._origBounds.x,this._origBounds.y,this._origBounds.w-(e.left+e.right),this._origBounds.h-(e.top+e.bottom))),this._origContentBounds&&(this._origContentBounds=new t.DiagramRectangle(this._origContentBounds.x,this._origContentBounds.y,this._origContentBounds.w-(e.left+e.right),this._origContentBounds.h-(e.top+e.bottom)))))},i.prototype.setContainerPadding=function(e,o,i,n){this.isDisclosed()&&(this._containerPadding={},"number"!=typeof e&&"string"!=typeof e&&(n=e.left,o=e.right,i=e.bottom,e=e.top),this._containerPadding.top=e,this._containerPadding.right=o,this._containerPadding.bottom=i,this._containerPadding.left=n,this._origBounds&&(this._bounds=new t.DiagramRectangle(this._origBounds.x,this._origBounds.y,this._origBounds.w+n+o,this._origBounds.h+e+i)),this._origContentBounds&&(this._contentBounds=new t.DiagramRectangle(this._origContentBounds.x,this._origContentBounds.y,this._origContentBounds.w+n+o,this._origContentBounds.h+e+i)),this.setDirty())},i.prototype.getContainerPadding=function(){return this._containerPadding},i.prototype.setDisclosed=function(t){this._bDisclosed=t},i.prototype.isDisclosed=function(){return this._bDisclosed},i.prototype.setChildNodes=function(t){this._childNodes=t},i.prototype.getChildNodes=function(){return this._childNodes},i.prototype.setParentNode=function(t){this._parentNode=t},i.prototype.getParentNode=function(){return this._parentNode},i.prototype.UpdateParentNodes=function(){var t=this.getParentNode();t&&t.IsRendered&&(t.Reset(),t.UpdateParentNodes())},i.prototype.Reset=function(){this.IsRendered=!1,this.setBounds(null),this.setContentBounds(null),this.setLabelBounds(null),this.setDirty()},i.prototype.setLabelValign=function(t){this._labelValign=t,this.setDirty()},i.prototype.setLabelHalign=function(t){this._labelHalign=t,this.setDirty()},i.prototype.getLabelValign=function(){return this._labelValign},i.prototype.getLabelHalign=function(){return this._labelHalign},i.prototype.setData=function(t){this._data=t},i.prototype.getData=function(){return this._data},i.prototype.setDirty=function(){this.LayoutContext&&(this.LayoutContext.getDirtyContext()[this.getId()]=!0)},i.prototype.copyFrom=function(t){t&&(this.setPosition(t.getPosition()),this.setLabelPosition(t.getLabelPosition()),this.setLabelRotationAngle(t.getLabelRotationAngle()),this.setLabelRotationPoint(t.getLabelRotationPoint()),this.setLabelValign(t.getLabelValign()),this.setLabelHalign(t.getLabelHalign()),t.getContainerPadding()&&this.setContainerPadding(t.getContainerPadding()))};var n=function(t,e){this.Init(t,e)};t.Obj.createSubclass(n,t.Obj,"DvtDiagramPoint"),n.prototype.Init=function(t,e){this.x=null===t||isNaN(t)?0:t,this.y=null===e||isNaN(e)?0:e};var a=function(t,e,o,i){this.Init(t,e,o,i)};t.Obj.createSubclass(a,t.Obj,"DvtDiagramRectangle"),a.prototype.Init=function(t,e,o,i){this.x=null===t||isNaN(t)?0:t,this.y=null===e||isNaN(e)?0:e,this.w=null===o||isNaN(o)?0:o,this.h=null===i||isNaN(i)?0:i},t.DiagramPoint=n,t.DiagramRectangle=a,t.BaseDiagram=function(t,e,o){this.Init(t,e,o)},t.Obj.createSubclass(t.BaseDiagram,t.PanZoomComponent,"dvt.BaseDiagram"),t.BaseDiagram.prototype.Init=function(e,o,i){t.BaseDiagram.superclass.Init.call(this,e,o,i),this.getCtx().getStage().getElem().setAttributeNS(null,"text-rendering","geometricPrecision"),this._linksPane=new t.Container(e),this._nodesPane=new t.Container(e),this._topPane=new t.Container(e),this.InitializeZoomLimits()},t.BaseDiagram.prototype.InitComponentInternal=function(){var t=this.getPanZoomCanvas();t.setMinZoom(this.getMinZoom()),t.setMaxZoom(this.getMaxZoom()),t.setAnimationDuration(this.getAnimationDuration()),t.getContentPane().addChild(this._linksPane),t.getContentPane().addChild(this._nodesPane),t.getContentPane().addChild(this._topPane)},t.BaseDiagram.prototype.getAnimationDuration=function(){return t.PanZoomCanvas.DEFAULT_ANIMATION_DURATION},t.BaseDiagram.prototype.setMaxZoom=function(t){this._maxZoom=t,this.getPanZoomCanvas()&&this.getPanZoomCanvas().setMaxZoom(t)},t.BaseDiagram.prototype.getMaxZoom=function(){return this._maxZoom},t.BaseDiagram.prototype.setMinZoom=function(t){this._minZoom=t,this.getPanZoomCanvas()&&this.getPanZoomCanvas().setMinZoom(t)},t.BaseDiagram.prototype.getMinZoom=function(){return this._minZoom},t.BaseDiagram.prototype.InitializeZoomLimits=function(){this.setMaxZoom(2),this.setMinZoom(0)},t.BaseDiagram.prototype.getNodeById=function(t){return null},t.BaseDiagram.prototype.getLinkById=function(t){return null},t.BaseDiagram.prototype.GetAllLinks=function(){return[]},t.BaseDiagram.prototype.GetAllNodes=function(){return[]},t.BaseDiagram.prototype.GetAllRoots=function(){return[]},t.BaseDiagram.prototype.RefreshEmptyText=function(e){if(e&&this.getEmptyText())this._emptyTextDisplay?(this._emptyTextDisplay.setX(this.Width/2),this._emptyTextDisplay.setY(this.Height/2),t.TextUtils.fitText(this._emptyTextDisplay,this.getWidth()-2*t.TextUtils.EMPTY_TEXT_BUFFER,1/0,this)):this._emptyTextDisplay=this.CreateEmptyText(this.getEmptyText());else if(this._emptyTextDisplay){var o=this._emptyTextDisplay.getParent();o&&o.removeChild(this._emptyTextDisplay),this._emptyTextDisplay=null}},t.BaseDiagram.prototype.CreateEmptyText=function(e){var o=this.getOptions();return t.TextUtils.renderEmptyText(this,e,new t.Rectangle(0,0,this.getWidth(),this.getHeight()),this.getEventManager(),o._statusMessageStyle)},t.BaseDiagram.prototype.setEmptyText=function(t){this._emptyText=t},t.BaseDiagram.prototype.getEmptyText=function(){return this._emptyText},t.BaseDiagram.prototype.SetPanningEnabled=function(t){this._panningEnabled=t},t.BaseDiagram.prototype.IsPanningEnabled=function(){return this._panningEnabled},t.BaseDiagram.prototype.setPanDirection=function(t){this._panDirection=t,this.getPanZoomCanvas()&&this.getPanZoomCanvas().setPanDirection(t)},t.BaseDiagram.prototype.getPanDirection=function(){return this._panDirection},t.BaseDiagram.prototype.SetZoomingEnabled=function(t){this._zoomingEnabled=t},t.BaseDiagram.prototype.IsZoomingEnabled=function(){return this._zoomingEnabled},t.BaseDiagram.prototype.getSelectionHandler=function(){return this._selectionHandler},t.BaseDiagram.prototype.setSelectionMode=function(e){this._selectionHandler="single"==e?new t.SelectionHandler(this.getCtx(),t.SelectionHandler.TYPE_SINGLE):"multiple"==e?new t.SelectionHandler(this.getCtx(),t.SelectionHandler.TYPE_MULTIPLE):null,this.getEventManager().setSelectionHandler(this._selectionHandler)},t.BaseDiagram.prototype.getSelectionMode=function(){return this._selectionHandler?this._selectionHandler.getType():null},t.BaseDiagram.prototype.isSelectionSupported=function(){return!!this._selectionHandler},t.BaseDiagram.prototype.getNodesPane=function(){return this._nodesPane},t.BaseDiagram.prototype.setNodesPane=function(t){this._nodesPane=t},t.BaseDiagram.prototype.getLinksPane=function(){return this._linksPane},t.BaseDiagram.prototype.setLinksPane=function(t){this._linksPane=t},t.BaseDiagram.prototype.getTopPane=function(){return this._topPane},t.BaseDiagram.prototype.setTopPane=function(t){this._topPane=t},t.BaseDiagram.prototype.CreateEmptyLayoutContext=function(){var o=new e;return o.setLocaleR2L(t.Agent.isRightToLeft(this.getCtx())),o.setComponentSize(new t.DiagramRectangle(0,0,this.getWidth(),this.getHeight())),o},t.BaseDiagram.prototype.CreateLayoutContextNode=function(e,o,n,a){var r=new i;r.setId(e.getId?e.getId():e.getData().getId()),r.setBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(e.getLayoutBounds())),r.setContentBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(e.getContentBounds()));var s=e.getLayoutAttributes?e.getLayoutAttributes(o):e.getData()._origData;return r.setLayoutAttributes(s),r.setData(s),r.setLabelBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(e.getLabelBounds())),r.setLabelPosition(t.DiagramLayoutUtils.convertPointToDiagramPoint(e.getLabelPosition())),r.setSelected(1==e.isSelected()),e.isDisclosed()&&(r.setDisclosed(!0),r.SetContainerPaddingObj(t.BaseDiagram.getLayoutContainerPadding(e.getContainerPadding()))),r.setContainerId(e.getGroupId()),r.Component=this,r.IsRendered=!n,r.LayoutContext=a,r},t.BaseDiagram.prototype.CreateLayoutContextLink=function(e,i,n,a,r){var s=new o;s.setId(e.getId?e.getId():e.getData().getId()),s.setStartId(i||e.getData().getStartId()),s.setEndId(n||e.getData().getEndId());var d=e.getLayoutAttributes?e.getLayoutAttributes(a):e.isPromoted()?e.getData()._links:e.getData()._origData;return s.setLayoutAttributes(d),s.setData(d),s.setLabelBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(e.getLabelBounds())),s.setLabelPosition(t.DiagramLayoutUtils.convertPointToDiagramPoint(e.getLabelPosition())),s.setStartConnectorOffset(e.getStartConnectorOffset()),s.setEndConnectorOffset(e.getEndConnectorOffset()),s.setLinkWidth(e.getLinkWidth()),s.setSelected(1==e.isSelected()),s.setPromoted(1==e.isPromoted()),s.LayoutContext=r,s},t.BaseDiagram.prototype.ApplyLayoutContext=function(e,o){var i=e.getContainerPadding();if(i){var n=e.getContainerId();if(n){var a=this.getNodeById(n);a&&a.setContainerPadding(t.BaseDiagram.getContainerPadding(i))}}for(var r=Number.MAX_VALUE,s=Number.MAX_VALUE,d=0;d<e.getNodeCount();d++){(D=(C=e.getNodeByIndex(d)).getPosition())&&(r=Math.min(r,D.x),s=Math.min(s,D.y));var l=C.getLabelBounds(),h=C.getLabelPosition();l&&h&&(r=Math.min(r,h.x+l.x),s=Math.min(s,h.y+l.y))}for(var g=0;g<e.getLinkCount();g++){if(b=(L=e.getLinkByIndex(g)).getPoints())for(var p=t.DiagramLinkUtils.GetControlPoints(b),u=0;u<p.length;u++){var c=p[u];r=Math.min(r,c.x),s=Math.min(s,c.y)}l=L.getLabelBounds(),h=L.getLabelPosition();l&&h&&(r=Math.min(r,h.x+l.x),s=Math.min(s,h.y+l.y))}var y=new t.Point(-r,-s),_=y.x,m=y.y,f=e.getDirtyContext();for(d=0;d<e.getNodeCount();d++){var C;if((C=e.getNodeByIndex(d)).getContainerId()&&(C.ContentOffset=new t.DiagramPoint(y.x,y.y)),f[C.getId()]){var D,v=this.getNodeById(C.getId());if((D=C.getPosition())&&v.SetPosition(D.x+_,D.y+m),this.ApplyLabelPosition(C,v,t.DiagramLayoutUtils.convertDiagramPointToPoint(D)),v.isDisclosed()){var S=C.getContainerPadding();S&&v.setContainerPadding(t.BaseDiagram.getContainerPadding(S))}}}for(g=0;g<e.getLinkCount();g++){var L;if(f[(L=e.getLinkByIndex(g)).getId()]){var b,k=this.getLinkById(L.getId()),P=this.GetLinkTranslationOffset(k,L,y),N=P.x,I=P.y;if(b=L.getPoints()){b.length>0&&!isNaN(b[0])&&(b=t.DiagramLinkUtils.ConvertToPath(b));var E=[];for(u=0;u<b.length;)isNaN(b[u])?(E.push(b[u]),u++):(E.push(b[u]+N),E.push(b[u+1]+I),u+=2);k.setPoints(E)}this.ApplyLabelPosition(L,k,new t.Point(-N,-I))}}var x=e.getViewport();x&&(this._layoutViewport=new t.Rectangle(x.x+_,x.y+m,x.w,x.h)),o&&(this._layoutOffset=new t.Point(_,m))},t.BaseDiagram.prototype.GetLinkTranslationOffset=function(e,o,i){var n=new t.Point(0,0);if(e.getGroupId()){if(e.getGroupId()!=o.getCoordinateSpace()){for(var a=o.getCoordinateSpace(),r=this.getNodeById(e.getGroupId());r;){var s=r.getContainerPadding();n.x-=s.left-r.GetPosition().x,n.y-=s.top-r.GetPosition().y;var d=r.getGroupId();r=d!=a?this.getNodeById(d):null}a||(n.x+=i.x,n.y+=i.y)}}else n=i;return n},t.BaseDiagram.prototype.GetLayoutViewport=function(){return this._layoutViewport},t.BaseDiagram.prototype.IsLayoutViewport=function(){return!!this._layoutViewport},t.BaseDiagram.prototype.ClearLayoutViewport=function(){this._layoutViewport=null},t.BaseDiagram.prototype.AdjustMinZoom=function(t){if(0==this.getMinZoom()){var e=this.getPanZoomCanvas(),o=t||this.GetViewBounds(),i=this.CalculateMinimumScale(o);return e.setMinZoom(this.GetMinZoomFactor()*Math.min(i,e.getMaxZoom())),o}return null},t.BaseDiagram.prototype.GetMinZoomFactor=function(){return 1},t.BaseDiagram.prototype.CalculateMinimumScale=function(t){if(!t)return 0;var e=this.getPanZoomCanvas(),o=(this.Width-2*e.getZoomToFitPadding())/t.w,i=(this.Height-2*e.getZoomToFitPadding())/t.h;return Math.min(o,i)},t.BaseDiagram.prototype.GetViewBounds=function(){for(var t,e,o,i,n,a,r,s,d,l=null,h=this.GetAllRoots(),g=0;g<h.length;g++)n=h[g],(i=this.getNodeById(n))&&i.getVisible()&&(t=i.GetNodeBounds(),e=i.getTranslateX(),o=i.getTranslateY(),t.x+=e,t.y+=o,l?(s=l.x,d=l.y,l.x=Math.min(l.x,t.x),l.y=Math.min(l.y,t.y),l.w=Math.max(s+l.w,t.x+t.w)-l.x,l.h=Math.max(d+l.h,t.y+t.h)-l.y):l=t);var p=this.GetAllLinks();for(g=0;g<p.length;g++)if(r=p[g],(a=this.getLinkById(r))&&a.getVisible()){if(t=a.GetLinkBounds(),a.getGroupId())continue;l?(s=l.x,d=l.y,l.x=Math.min(l.x,t.x),l.y=Math.min(l.y,t.y),l.w=Math.max(s+l.w,t.x+t.w)-l.x,l.h=Math.max(d+l.h,t.y+t.h)-l.y):l=t}return l},t.BaseDiagram.RotateBounds=function(e,o,i){if(null==o&&!i)return e;var n=new t.Point(e.x,e.y),a=new t.Point(e.x+e.w,e.y),r=new t.Point(e.x,e.y+e.h),s=new t.Point(e.x+e.w,e.y+e.h),d=new t.Matrix;null!=o&&(i&&d.translate(-i.x,-i.y),d.rotate(o),i&&d.translate(i.x,i.y));var l=d.transformPoint(n),h=d.transformPoint(a),g=d.transformPoint(r),p=d.transformPoint(s),u=Math.min(Math.min(l.x,h.x),Math.min(g.x,p.x)),c=Math.max(Math.max(l.x,h.x),Math.max(g.x,p.x)),y=Math.min(Math.min(l.y,h.y),Math.min(g.y,p.y)),_=Math.max(Math.max(l.y,h.y),Math.max(g.y,p.y));return new t.Rectangle(u,y,c-u,_-y)},t.BaseDiagram.prototype.ConstrainPanning=function(t,e,o,i,n){var a=this.getPanZoomCanvas(),r=a.getSize().w/2,s=a.getSize().h/2,d=r-(o+t)*n,l=s-(i+e)*n,h=r-t*n,g=s-e*n;if(this.IsLayoutViewport()){var p,u,c=this.GetLayoutViewport();-c.x*n<d?(d-=p=d+c.x*n,h+=p):-c.x*n>h&&(d-=p=-c.x*n-h,h+=p),-c.y*n<l?(l-=u=l+c.y*n,g+=u):-c.y*n>g&&(l-=u=-c.y*n-g,g+=u)}a.setMinPanX(d),a.setMinPanY(l),a.setMaxPanX(h),a.setMaxPanY(g)},t.BaseDiagram.prototype.moveToDiagramFront=function(t){this._topPane.addChild(t)},t.BaseDiagram.prototype.moveToLinks=function(t){this._linksPane.addChild(t)},t.BaseDiagram.prototype.moveToNodes=function(t){this._nodesPane.addChild(t)},t.BaseDiagram.getContainerPadding=function(t){var e=new Object;return e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.left=t.left,e},t.BaseDiagram.getLayoutContainerPadding=function(t){var e=new Object;return e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.left=t.left,e},t.BaseDiagram.prototype.ApplyLabelPosition=function(e,o,i){var n=e.getLabelBounds();n=t.DiagramLayoutUtils.convertDiagramRectToRect(n);var a=e.getLabelPosition();if(n&&a){var r=new t.Point(a.x-i.x,a.y-i.y),s=e.getLabelRotationAngle(),d=t.DiagramLayoutUtils.convertDiagramPointToPoint(e.getLabelRotationPoint());o.setLabelBounds(n),o.setLabelPosition(r),o.setLabelAlignments(e.getLabelHalign(),e.getLabelValign()),null!=s&&o.setLabelRotationAngle(s),d&&o.setLabelRotationPoint(d)}},t.BaseDiagram.prototype.getLayoutOffset=function(){return this._layoutOffset?this._layoutOffset:new t.Point(0,0)},t.BaseDiagram.prototype.getCustomObjKeyboardBoundingBox=function(e){var o=e.getElem().getBoundingClientRect(),i=this.getPanZoomCanvas().getContentPane().getElem().getBoundingClientRect(),n=this.getPanZoomCanvas().getContentPane().getMatrix();return new t.Rectangle(o.left-i.left+n.getTx(),o.top-i.top+n.getTy(),o.width,o.height)},t.BaseDiagramKeyboardHandler=function(t,e){this.Init(t,e)},t.Obj.createSubclass(t.BaseDiagramKeyboardHandler,t.PanZoomCanvasKeyboardHandler,"dvt.BaseDiagramKeyboardHandler"),t.BaseDiagramKeyboardHandler._OUTGOING=0,t.BaseDiagramKeyboardHandler._INGOING=1,t.BaseDiagramKeyboardHandler.prototype.Init=function(e,o){t.BaseDiagramKeyboardHandler.superclass.Init.call(this,e,o),this._diagram=e},t.BaseDiagramKeyboardHandler.prototype.GetDiagram=function(){return this._diagram},t.BaseDiagramKeyboardHandler.prototype.isSelectionEvent=function(e){return e.keyCode!=t.KeyboardEvent.TAB&&(this.isNavigationEvent(e)&&!e.ctrlKey)},t.BaseDiagramKeyboardHandler.prototype.isMultiSelectEvent=function(e){return e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey},t.BaseDiagramKeyboardHandler.prototype.getFirstNavigableLink=function(e,o,i){var n=o.keyCode;if(!i||i.length<1||!e)return null;for(var a=i[0],r=e.getKeyboardBoundingBox(),s=r.x+r.w/2,d=0;d<i.length;d++){var l=i[d],h=l.getKeyboardBoundingBox(),g=h.x+h.w/2;if(n==t.KeyboardEvent.OPEN_ANGLED_BRACKET&&g<=s||n==t.KeyboardEvent.CLOSE_ANGLED_BRACKET&&g>=s){a=l;break}}return a},t.BaseDiagramKeyboardHandler.prototype.getNextNavigableLink=function(e,o,i,n){if(!n)return null;if(!o)return n[0];if(!e)return o;this._addSortingAttributes(e,n),n.sort(this._getLinkComparator()),this._removeSortingAttributes(n);for(var a=i.keyCode==t.KeyboardEvent.DOWN_ARROW,r=0,s=0;s<n.length;s++){if(n[s]===o){r=a?s==n.length-1?0:s+1:0==s?n.length-1:s-1;break}}return n[r]},t.BaseDiagramKeyboardHandler.prototype.GetVisibleNode=function(t){return null},t.BaseDiagramKeyboardHandler.prototype._getClockwiseAngle=function(t,e){var o=this.GetVisibleNode(e.getStartId?e.getStartId():e.getData().getStartId()),i=this.GetVisibleNode(e.getEndId?e.getEndId():e.getData().getEndId()),n=t==o?i:o,a=this._getNodeCenter(t),r=this._getNodeCenter(n),s=Math.atan2(r.y-a.y,r.x-a.x);return s=s<0?s+2*Math.PI:s},t.BaseDiagramKeyboardHandler.prototype._getNodeCenter=function(e){var o=e.getKeyboardBoundingBox();return new t.Point(o.x+o.w/2,o.y+o.h/2)},t.BaseDiagramKeyboardHandler.prototype._getNodesDistance=function(t){var e=this.GetVisibleNode(t.getStartId?t.getStartId():t.getData().getStartId()),o=this.GetVisibleNode(t.getEndId?t.getEndId():t.getData().getEndId()),i=this._getNodeCenter(e),n=this._getNodeCenter(o);return Math.sqrt(Math.pow(n.x-i.x,2)+Math.pow(n.y-i.y,2))},t.BaseDiagramKeyboardHandler.prototype._getLinkDirection=function(e,o){return e==this.GetVisibleNode(o.getEndId?o.getEndId():o.getData().getEndId())?t.BaseDiagramKeyboardHandler._INGOING:t.BaseDiagramKeyboardHandler._OUTGOING},t.BaseDiagramKeyboardHandler.prototype._getLinkComparator=function(){return function(e,o){var i=e.__angle,n=o.__angle,a=-1;return!t.BaseDiagramKeyboardHandler._anglesAreEqualWithinTolerance(i,n)&&i>n?a=1:t.BaseDiagramKeyboardHandler._anglesAreEqualWithinTolerance(i,n)&&(e.__distance>o.__distance?a=1:o.__distance==e.__distance&&e.__direction>o.__direction?a=1:o.__distance==e.__distance&&e.__direction==o.__direction&&(a=0)),a}},t.BaseDiagramKeyboardHandler.prototype._removeSortingAttributes=function(t){for(var e=0;e<t.length;e++){var o=t[e];o.__angle=void 0,o.__distance=void 0,o.__direction=void 0}},t.BaseDiagramKeyboardHandler.prototype._addSortingAttributes=function(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.__angle=this._getClockwiseAngle(t,i),i.__distance=this._getNodesDistance(i),i.__direction=this._getLinkDirection(t,i)}},t.BaseDiagramKeyboardHandler._anglesAreEqualWithinTolerance=function(t,e){var o=Math.abs(t-e)<=1e-7;return o||(o=Math.abs(2*Math.PI+Math.min(t,e)-Math.max(t,e))<=1e-7),o},t.BaseDiagramNode=function(t,e,o){this.Init(t,e,o)},t.Obj.createSubclass(t.BaseDiagramNode,t.Container,"dvt.BaseDiagramNode"),t.BaseDiagramNode.prototype.Init=function(e,o,i){t.BaseDiagramNode.superclass.Init.call(this,e,null,o),this._diagram=i,this._bDisclosed=!1,this._selected=!1,this._selectable=!0},t.BaseDiagramNode.prototype.GetDiagram=function(){return this._diagram},t.BaseDiagramNode.prototype.getData=function(){return null},t.BaseDiagramNode.prototype.getLayoutBounds=function(t){return this.getContentBounds(t)},t.BaseDiagramNode.prototype.getContentBounds=function(t){return null},t.BaseDiagramNode.prototype.setLabelPosition=function(e){e&&(this._labelPos=e,t.BaseDiagramNode.PositionLabel(this._labelObj,e,this.getLabelBounds(!0),this.getLabelRotationAngle(),this.getLabelRotationPoint()))},t.BaseDiagramNode.prototype.getLabelPosition=function(){return this._labelPos},t.BaseDiagramNode.prototype.getLabelBounds=function(t){return null},t.BaseDiagramNode.prototype.setLabelBounds=function(t){},t.BaseDiagramNode.prototype.getContainerPadding=function(){return null},t.BaseDiagramNode.prototype.setContainerPadding=function(t,e,o,i){},t.BaseDiagramNode.prototype.isDisclosed=function(){return this._bDisclosed},t.BaseDiagramNode.prototype.setDisclosed=function(t){this._bDisclosed=t},t.BaseDiagramNode.prototype.isSelected=function(){return this._selected},t.BaseDiagramNode.prototype.setSelected=function(t){this._selected=t},t.BaseDiagramNode.prototype.setSelectable=function(t){this._selectable=t},t.BaseDiagramNode.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&this._selectable},t.BaseDiagramNode.prototype.setLabelRotationAngle=function(e){this._labelRotAngle=e,t.BaseDiagramNode.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(!0),e,this.getLabelRotationPoint())},t.BaseDiagramNode.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},t.BaseDiagramNode.prototype.setLabelRotationPoint=function(e){this._labelRotPoint=e,t.BaseDiagramNode.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(!0),this.getLabelRotationAngle(),e)},t.BaseDiagramNode.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},t.BaseDiagramNode.prototype.GetNodeBounds=function(){var e=this.getLayoutBounds(!0),o=new t.Rectangle(e.x,e.y,e.w,e.h),i=i=this.getLabelPosition(),n=this.getLabelRotationAngle(),a=this.getLabelRotationPoint(),r=this.getLabelBounds(!0);return i&&r&&(null!=n&&(r=t.BaseDiagram.RotateBounds(r,n,a)),o.x=Math.min(e.x,r.x+i.x),o.y=Math.min(e.y,r.y+i.y),o.w=Math.max(e.x+e.w,r.x+i.x+r.w)-o.x,o.h=Math.max(e.y+e.h,r.y+i.y+r.h)-o.y),o},t.BaseDiagramNode.CalcLabelMatrix=function(e,o,i,n){var a=new t.Matrix;return null!=i&&(n&&a.translate(-n.x,-n.y),a.rotate(i),n&&a.translate(n.x,n.y)),e&&a.translate(e.x,e.y),a},t.BaseDiagramNode.PositionLabel=function(e,o,i,n,a){if(e){var r=t.BaseDiagramNode.CalcLabelMatrix(o,i,n,a);e.setMatrix(r)}},t.BaseDiagramNode.prototype.SetPosition=function(t,e){this.setTranslate(t,e)},t.BaseDiagramNode.prototype.GetPosition=function(){return new t.Point(this.getTranslateX(),this.getTranslateY())},t.BaseDiagramNode.prototype.getNextNavigable=function(t){return null},t.BaseDiagramNode.prototype.getKeyboardBoundingBox=function(e){if(this._customNodeContent)return this._diagram.getCustomObjKeyboardBoundingBox(this);var o=this.getContentBounds(e),i=this.localToStage(new t.Point(o.x,o.y)),n=this.localToStage(new t.Point(o.x+o.w,o.y+o.h));return new t.Rectangle(i.x,i.y,n.x-i.x,n.y-i.y)},t.BaseDiagramNode.prototype.getTargetElem=function(){return this.getElem()},t.BaseDiagramNode.prototype.showKeyboardFocusEffect=function(){},t.BaseDiagramNode.prototype.hideKeyboardFocusEffect=function(){},t.BaseDiagramNode.prototype.isShowingKeyboardFocusEffect=function(){},t.BaseDiagramNode.prototype.getCategories=function(){return null},t.BaseDiagramNode.prototype.addOutLinkId=function(t){this._outLinkIds||(this._outLinkIds=[]),this._outLinkIds.push(t)},
t.BaseDiagramNode.prototype.removeOutLinkId=function(e){if(this._outLinkIds){var o=t.ArrayUtils.getIndex(this._outLinkIds,e);-1!=o&&this._outLinkIds.splice(o,1)}},t.BaseDiagramNode.prototype.getOutLinkIds=function(){return this._outLinkIds},t.BaseDiagramNode.prototype.addInLinkId=function(t){this._inLinkIds||(this._inLinkIds=[]),this._inLinkIds.push(t)},t.BaseDiagramNode.prototype.removeInLinkId=function(e){if(this._inLinkIds){var o=t.ArrayUtils.getIndex(this._inLinkIds,e);-1!=o&&this._inLinkIds.splice(o,1)}},t.BaseDiagramNode.prototype.getInLinkIds=function(){return this._inLinkIds},t.BaseDiagramNode.prototype.setLabelAlignments=function(t,e){},t.BaseDiagramNode.prototype.getGroupId=function(){return null},t.BaseDiagramLink=function(t,e,o){this.Init(t,e,o)},t.Obj.createSubclass(t.BaseDiagramLink,t.Container,"dvt.BaseDiagramLink"),t.BaseDiagramLink.prototype.Init=function(e,o,i){t.BaseDiagramLink.superclass.Init.call(this,e,null,o),this._diagram=i,this._selected=!1,this._selectable=!0},t.BaseDiagramLink.prototype.GetDiagram=function(){return this._diagram},t.BaseDiagramLink.prototype.setEndConnectorType=function(t){},t.BaseDiagramLink.prototype.getEndConnectorType=function(){return null},t.BaseDiagramLink.prototype.setStartConnectorType=function(t){},t.BaseDiagramLink.prototype.setStartConnector=function(t){this._startConnector=t},t.BaseDiagramLink.prototype.getStartConnector=function(){return this._startConnector},t.BaseDiagramLink.prototype.setEndConnector=function(t){this._endConnector=t},t.BaseDiagramLink.prototype.getEndConnector=function(){return this._endConnector},t.BaseDiagramLink.prototype.setShape=function(t){this._shape=t},t.BaseDiagramLink.prototype.getShape=function(){return this._shape},t.BaseDiagramLink.prototype.setLabelRotationAngle=function(e){this._labelRotAngle=e,t.BaseDiagramLink.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(),e,this.getLabelRotationPoint())},t.BaseDiagramLink.prototype.getLabelRotationAngle=function(){return this._labelRotAngle},t.BaseDiagramLink.prototype.setLabelRotationPoint=function(e){this._labelRotPoint=e,t.BaseDiagramLink.PositionLabel(this._labelObj,this.getLabelPosition(),this.getLabelBounds(),this.getLabelRotationAngle(),e)},t.BaseDiagramLink.prototype.getLabelRotationPoint=function(){return this._labelRotPoint},t.BaseDiagramLink.prototype.getLabelPosition=function(){return this._labelPos},t.BaseDiagramLink.prototype.setLabelPosition=function(e){e&&(this._labelPos=e,t.BaseDiagramLink.PositionLabel(this._labelObj,e,this.getLabelBounds(),this.getLabelRotationAngle(),this.getLabelRotationPoint()))},t.BaseDiagramLink.prototype.getLabelBounds=function(){return null},t.BaseDiagramLink.prototype.setLabelBounds=function(t){},t.BaseDiagramLink.prototype.getStartConnectorOffset=function(){return 0},t.BaseDiagramLink.prototype.getEndConnectorOffset=function(){return 0},t.BaseDiagramLink.prototype.setSelectable=function(t){this._selectable=t},t.BaseDiagramLink.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&this._selectable},t.BaseDiagramLink.prototype.isSelected=function(){return this._selected},t.BaseDiagramLink.prototype.setSelected=function(t){this._selected=t},t.BaseDiagramLink.prototype.setPromoted=function(t){this._bPromoted=t},t.BaseDiagramLink.prototype.isPromoted=function(){return this._bPromoted},t.BaseDiagramLink.prototype.setLinkWidth=function(t){},t.BaseDiagramLink.prototype.getLinkWidth=function(){return 1},t.BaseDiagramLink.prototype.setLinkStyle=function(t){},t.BaseDiagramLink.prototype.getLinkStyle=function(){return"solid"},t.BaseDiagramLink.prototype.setLinkColor=function(t){},t.BaseDiagramLink.prototype.getLinkColor=function(){return null},t.BaseDiagramLink.prototype.getConnectorTemplate=function(t){return null},t.BaseDiagramLink.prototype.GetAppliedLinkStyle=function(){return this.getLinkStyle()},t.BaseDiagramLink.prototype.GetAppliedLinkWidth=function(){return this.getLinkWidth()},t.BaseDiagramLink.prototype.GetAppliedLinkColor=function(){return this.getLinkColor()},t.BaseDiagramLink.prototype.CreateConnector=function(e,o,i,n){if(o||n){var a;n||((a=this._shape.getStroke().clone()).setType(t.Stroke.SOLID),a.setFixedWidth(!1));var r=t.DiagramLinkConnectorUtils.CreateConnectorShape(this.getCtx(),o,n,a,this);return r&&(this._shape.addChild(r),t.DiagramLinkConnectorUtils.TransformConnector(r,o,n,e,i)),r}},t.BaseDiagramLink.prototype.GetLinkBounds=function(){var e=new t.Rectangle(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=this.getPoints();if(o)for(var i,n,a,r,s,d=t.DiagramLinkUtils.GetControlPoints(o),l=0;l<d.length;l++)i=d[l],n=Math.max(e.x+e.w,i.x),a=Math.max(e.y+e.h,i.y),r=Math.min(e.x,i.x),s=Math.min(e.y,i.y),e.x=r,e.y=s,e.w=n-r,e.h=a-s;var h=new t.Rectangle(e.x,e.y,e.w,e.h),g=this.getLabelPosition(),p=this.getLabelRotationAngle(),u=this.getLabelRotationPoint(),c=this.getLabelBounds();return g&&c&&(null!=p&&(c=t.BaseDiagram.RotateBounds(c,p,u)),h.x=Math.min(e.x,c.x+g.x),h.y=Math.min(e.y,c.y+g.y),h.w=Math.max(e.x+e.w,c.x+g.x+c.w)-h.x,h.h=Math.max(e.y+e.h,c.y+g.y+c.h)-h.y),h},t.BaseDiagramLink.prototype.setPoints=function(e){this._arPoints=e,t.DiagramLinkUtils.IsPath(e)?(this._pathCmds=e,this._points=t.DiagramLinkUtils.ConvertToPoints(e)):(this._points=e,this._pathCmds=t.DiagramLinkUtils.ConvertToPath(e)),this._shape&&this._shape instanceof t.Path&&(this._shape.setCommandsArray(this._pathCmds),this._endConnector?t.DiagramLinkConnectorUtils.TransformConnector(this._endConnector,this.getEndConnectorType(),this.getConnectorTemplate(t.DiagramLinkConnectorUtils.END_CONNECTOR),this._points,1):this._endConnector=this.CreateConnector(this._points,this.getEndConnectorType(),1,this.getConnectorTemplate(t.DiagramLinkConnectorUtils.END_CONNECTOR)),this._startConnector?t.DiagramLinkConnectorUtils.TransformConnector(this._startConnector,this.getStartConnectorType(),this.getConnectorTemplate(t.DiagramLinkConnectorUtils.START_CONNECTOR),this._points,0):this._startConnector=this.CreateConnector(this._points,this.getStartConnectorType(),0,this.getConnectorTemplate(t.DiagramLinkConnectorUtils.START_CONNECTOR)));var o=null,i=null;this._linkUnderlay&&this._linkUnderlay.getUnderlay()instanceof t.Path&&this._linkUnderlay.getUnderlay().setCommandsArray(this._pathCmds),this._linkUnderlay&&(o=this._linkUnderlay.getUnderlayStart())&&t.DiagramLinkConnectorUtils.TransformConnector(o,this.getStartConnectorType(),this.getConnectorTemplate(t.DiagramLinkConnectorUtils.START_CONNECTOR),this._points,0),this._linkUnderlay&&(i=this._linkUnderlay.getUnderlayEnd())&&t.DiagramLinkConnectorUtils.TransformConnector(i,this.getEndConnectorType(),this.getConnectorTemplate(t.DiagramLinkConnectorUtils.END_CONNECTOR),this._points,1),this._hitDetectionUnderlay&&this._hitDetectionUnderlay.getUnderlay()instanceof t.Path&&this._hitDetectionUnderlay.getUnderlay().setCommandsArray(this._pathCmds),this._startHandle&&this._startHandle.setPosition(this.getLinkStart()),this._endHandle&&this._endHandle.setPosition(this.getLinkEnd())},t.BaseDiagramLink.prototype.getPoints=function(){return this._arPoints},t.BaseDiagramLink.prototype.getLinkStart=function(){if(!this._points)return null;var e=this._points[0],o=this._points[1];return new t.Point(e,o)},t.BaseDiagramLink.prototype.getLinkEnd=function(){if(!this._points)return null;var e=this._points.length,o=this._points[e-2],i=this._points[e-1];return new t.Point(o,i)},t.BaseDiagramLink.CalcLabelMatrix=function(e,o,i,n){var a=new t.Matrix;return null!=i&&(n&&a.translate(-n.x,-n.y),a.rotate(i),n&&a.translate(n.x,n.y)),e&&a.translate(e.x,e.y),a},t.BaseDiagramLink.PositionLabel=function(e,o,i,n,a){if(e){var r=t.BaseDiagramLink.CalcLabelMatrix(o,i,n,a);e.setMatrix(r)}},t.BaseDiagramLink.prototype.CreateUnderlay=function(e,o,i,n,a){o||0==o||(o=1),i||0==i||(i=0);var s=this.GetAppliedLinkWidth()+i,d=new t.SolidStroke(e,o,s);return new r(this.getCtx(),this._pathCmds,d,n,a)},t.BaseDiagramLink.prototype.CreateFeedbackUnderlay=function(e,o,i,n,a){var r=this.CreateUnderlay(e,o,i,n,a);return this._startConnector&&this.getStartConnectorType()&&r.addUnderlayStart(this._points,this.getStartConnectorType(),this.getConnectorTemplate(t.DiagramLinkConnectorUtils.START_CONNECTOR),this),this._endConnector&&this.getEndConnectorType()&&r.addUnderlayEnd(this._points,this.getEndConnectorType(),this.getConnectorTemplate(t.DiagramLinkConnectorUtils.END_CONNECTOR),this),r},t.BaseDiagramLink.prototype.ApplyLinkStyle=function(e,o){var i=this.GetAppliedLinkStyle(),n=t.DiagramLinkUtils.ConvertLinkStyleToStrokeType(i);e.setType(n,t.DiagramLinkUtils.GetStrokeDash(n,o),t.DiagramLinkUtils.GetStrokeDashOffset(n,o))},t.BaseDiagramLink.prototype.ReplaceConnectorColor=function(t,e){if(t){var o=null;if(e.getColor&&(o=e.getColor()),o){var i=t.getStroke()?t.getStroke().clone():null,n=t.getFill()?t.getFill().clone():null;i&&i.setColor&&(i.setColor(o),t.setStroke(i)),n&&n.setColor&&(n.setColor(o),t.setFill(n))}}},t.BaseDiagramLink.prototype.getNextNavigable=function(t){return null},t.BaseDiagramLink.prototype.getKeyboardBoundingBox=function(t){return this.getGroupId()&&this._diagram.getOptions().renderer?this._diagram.getCustomObjKeyboardBoundingBox(this):this.getDimensions(t)},t.BaseDiagramLink.prototype.getTargetElem=function(){return this.getElem()},t.BaseDiagramLink.prototype.showKeyboardFocusEffect=function(){},t.BaseDiagramLink.prototype.hideKeyboardFocusEffect=function(){},t.BaseDiagramLink.prototype.isShowingKeyboardFocusEffect=function(){},t.BaseDiagramLink.prototype.setKeyboardFocusNode=function(t){this._keyboardNavNode=t},t.BaseDiagramLink.prototype.getKeyboardFocusNode=function(){return this._keyboardNavNode},t.BaseDiagramLink.prototype.getCategories=function(){return null},t.BaseDiagramLink.prototype.setLabelAlignments=function(t,e){},t.BaseDiagramLink.prototype.getGroupId=function(){return null},t.DiagramLayoutUtils={},t.Obj.createSubclass(t.DiagramLayoutUtils,t.Obj,"dvt.DiagramLayoutUtils"),t.DiagramLayoutUtils.convertRectToDiagramRect=function(e){return void 0===e||null==e?null:new t.DiagramRectangle(e.x,e.y,e.w,e.h)},t.DiagramLayoutUtils.convertPointToDiagramPoint=function(e){return void 0===e||null==e?null:new t.DiagramPoint(e.x,e.y)},t.DiagramLayoutUtils.convertDiagramRectToRect=function(e){return e?new t.Rectangle(e.x,e.y,e.w,e.h):null},t.DiagramLayoutUtils.convertDiagramPointToPoint=function(e){return e?new t.Point(e.x,e.y):null};var r=function(t,e,o,i,n){r.superclass.Init.call(this,t),this.Init(t,e,o,i,n)};t.Obj.createSubclass(r,t.Container,"DvtDiagramLinkUnderlay"),r.prototype.Init=function(e,o,i,n,a){o||(o=["M",0,0,"L",1,0]),this._stroke=i,this._stroke||(this._stroke=new t.SolidStroke("#ffffff",1,1)),i.setFixedWidth(!0),this._underlay=new t.Path(e,o),this._underlay.setStroke(i),this._underlay.setFill(null),this._underlay.setStyle(n).setClassName(a),this.addChild(this._underlay),this._underlayStart=null,this._underlayStartType=null,this._underlayEnd=null,this._underlayEndType=null},r.prototype.addUnderlayStart=function(t,e,o,i){var n=this.CreateConnectorUnderlay(t,e,o,i,0);this._underlayStart&&this.removeChild(this._underlayStart),this._underlayStart=n,this._underlayStartType=e,this.addChild(this._underlayStart)},r.prototype.addUnderlayEnd=function(t,e,o,i){var n=this.CreateConnectorUnderlay(t,e,o,i,1);this._underlayEnd&&this.removeChild(this._underlayEnd),this._underlayEnd=n,this._underlayEndType=e,this.addChild(this._underlayEnd)},r.prototype.CreateConnectorUnderlay=function(e,o,i,n,a){var r=this._stroke.clone();r.setFixedWidth(!1);var s=t.DiagramLinkConnectorUtils.CreateConnectorShape(this.getCtx(),o,i,r,n);return t.DiagramLinkConnectorUtils.TransformConnector(s,o,i,e,a),s},r.prototype.getUnderlay=function(){return this._underlay},r.prototype.getUnderlayStart=function(){return this._underlayStart},r.prototype.getUnderlayEnd=function(){return this._underlayEnd},r.prototype.setStroke=function(e,o){if(this._stroke=e,e.setFixedWidth(!0),this._underlay.setStroke(e),this._underlayStart){var i=e.clone();i.setType(t.Stroke.SOLID),i.setFixedWidth(!1),this._underlayStartType!=t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW&&this._underlayStartType!=t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_CONCAVE||(i.setWidth(o),this._underlayStart.setSolidFill(e.getColor())),this._underlayStart.setStroke(i)}if(this._underlayEnd){var n=e.clone();n.setType(t.Stroke.SOLID),n.setFixedWidth(!1),this._underlayEndType!=t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW&&this._underlayEndType!=t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_CONCAVE||(n.setWidth(o),this._underlayEnd.setSolidFill(e.getColor())),this._underlayEnd.setStroke(n)}},r.prototype.getStroke=function(){return this._stroke},r.prototype.hideUnderlayStart=function(){this._underlayStart&&this.removeChild(this._underlayStart)},r.prototype.hideUnderlayEnd=function(){this._underlayEnd&&this.removeChild(this._underlayEnd)},r.prototype.showUnderlayStart=function(){this._underlayStart&&this.addChild(this._underlayStart)},r.prototype.showUnderlayEnd=function(){this._underlayEnd&&this.addChild(this._underlayEnd)},t.DiagramLinkUtils={},t.Obj.createSubclass(t.DiagramLinkUtils,t.Obj,"dvt.DiagramLinkUtils"),t.DiagramLinkUtils.ConvertLinkStyleToStrokeType=function(e){var o=t.Stroke.SOLID;switch(e){case"dash":o=t.Stroke.DASHED;break;case"dot":o=t.Stroke.DOTTED;break;case"dashDot":o=t.Stroke.DASHED_DOTTED}return o},t.DiagramLinkUtils.GetStrokeDash=function(e,o){return t.Stroke.SOLID==e?null:t.Stroke.DASHED==e?o?"8,2":"6,4":t.Stroke.DOTTED==e?o?"4,1":"2,3":t.Stroke.DASHED_DOTTED==e?o?"10,1,4,1":"8,3,2,3":void 0},t.DiagramLinkUtils.GetStrokeDashOffset=function(e,o){return o&&t.Stroke.SOLID!=e?1:null},t.DiagramLinkUtils.getStrokeObject=function(e,o){var i=t.DiagramLinkUtils.ConvertLinkStyleToStrokeType(e);return{_type:e,strokeDasharray:t.DiagramLinkUtils.GetStrokeDash(i,o),strokeDashoffset:t.DiagramLinkUtils.GetStrokeDashOffset(i,o)}},t.DiagramLinkUtils.processStrokeDashArray=function(t){if(t){var e=t.split(/[\s,]+/);return e.length%2>0&&(e=e.concat(e)),e.toString()}return t},t.DiagramLinkUtils.getCustomUnderlay=function(e){if(e){for(var o=e.split(/[\s,]+/),i="",n=0;n<o.length;n++){var a=t.CSSStyle.toNumber(t.StringUtils.trim(o[n]));i+=n%2==0?a+2:a>=2?a-2:0,n<o.length-1&&(i+=", ")}return i}return null},t.DiagramLinkUtils.ConvertToPath=function(t){var e=[];if(t)for(var o=0;o<t.length;o+=2)0==o?e.push("M"):e.push("L"),e.push(t[o]),e.push(t[o+1]);return e},t.DiagramLinkUtils.ConvertToPoints=function(t){var e=[];if(t)for(var o=0;o<t.length;o++)isNaN(t[o])||e.push(t[o]);return e},t.DiagramLinkUtils.IsPath=function(t){return!!(t&&t.length>0)&&isNaN(t[0])},t.DiagramLinkUtils.GetControlPoints=function(e){var o,i=[];o=t.DiagramLinkUtils.IsPath(e)?t.DiagramLinkUtils.ConvertToPoints(e):e;for(var n=0;n<o.length;n+=2)i.push(new t.Point(o[n],o[n+1]));return i},t.DiagramLinkConnectorUtils={},t.Obj.createSubclass(t.DiagramLinkConnectorUtils,t.Obj,"dvt.DiagramLinkConnectorUtils"),t.DiagramLinkConnectorUtils.END_CONNECTOR="endConnector",t.DiagramLinkConnectorUtils.START_CONNECTOR="startConnector",t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_OPEN="arrowOpen",t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW="arrow",t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_CONCAVE="arrowConcave",t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_RECTANGLE="rectangle",t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_RECTANGLE_ROUNDED="rectangleRounded",t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_CIRCLE="circle",t.DiagramLinkConnectorUtils.CreateConnectorShape=function(e,o,i,n,a){if(i)return t.DiagramLinkConnectorUtils.CreateCustomConnector(e,i,a);var r=a.GetAppliedLinkWidth();switch(o){case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW:return t.DiagramLinkConnectorUtils.CreateFilledArrowConnector(e,r,a.getLinkColor());case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_CONCAVE:return t.DiagramLinkConnectorUtils.CreateFilledConcaveArrowConnector(e,r,a.getLinkColor());case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_OPEN:return t.DiagramLinkConnectorUtils.CreateOpenArrowConnector(e,r,n);case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_CIRCLE:return t.DiagramLinkConnectorUtils.CreateCircleConnector(e,r,n);case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_RECTANGLE:return t.DiagramLinkConnectorUtils.CreateRectangleConnector(e,r,n);case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_RECTANGLE_ROUNDED:return t.DiagramLinkConnectorUtils.CreateRoundedRectangleConnector(e,r,n)}return null},t.DiagramLinkConnectorUtils.TransformConnector=function(e,o,i,n,a){var r=t.DiagramLinkConnectorUtils.CalcConnectorTransform(e,o,i,n,a);e.setMatrix(r)},t.DiagramLinkConnectorUtils.CalcConnectorTransform=function(e,o,i,n,a){var r=-1,s=0,d=0,l=0;if(n){var h=n.length;1===a?(h>=2&&(d=n[h-2],l=n[h-1]),h>=4?(r=n[h-4],s=n[h-3]):(r=d-1e-4,s=l)):(h>=2&&(d=n[0],l=n[1]),h>=4?(r=n[2],s=n[3]):(r=d+1e-4,s=l))}else;var g=d,p=l,u=t.DiagramLinkConnectorUtils.CalcConnectorRotation(r,s,d,l),c=e._connectorOrigMat;c||(c=e.getMatrix().clone(),e._connectorOrigMat=c);var y=new t.Matrix;if(i){var _=t.DiagramLinkConnectorUtils._getCachedDims(e),m=e.getScaleX(),f=e.getScaleY(),C=_.w*m*-.5,D=_.h*f*-.5;y.translate(C,D)}return y.rotate(u),y.translate(g,p),y.concat(c),y},t.DiagramLinkConnectorUtils._getCachedDims=function(t){var e=t._cachedDims;return e||(e=t.getDimensions(),t._cachedDims=e),e},t.DiagramLinkConnectorUtils.CalcConnectorRotation=function(t,e,o,i){var n=i-e,a=o-t;return Math.atan2(n,a)},t.DiagramLinkConnectorUtils.CreateFilledConcaveArrowConnector=function(e,o,i){var n=6*t.DiagramLinkConnectorUtils._getReduce(o,.5),a=.8*n,r=[-.22*n,-.5*a,.78*n,0,-.22*n,.5*a,0,0],s=new t.Polygon(e,r);return s.setSolidFill(i),s},t.DiagramLinkConnectorUtils.CreateFilledArrowConnector=function(e,o,i){var n=5*t.DiagramLinkConnectorUtils._getReduce(o,.5),a=.8*n,r=[0,-.5*a,n,0,0,.5*a],s=new t.Polygon(e,r);return s.setSolidFill(i),s},t.DiagramLinkConnectorUtils._getReduce=function(t,e){if(t<=1)return t;var o=t-1;return 1+(o*=e)},t.DiagramLinkConnectorUtils.CreateOpenArrowConnector=function(e,o,i){var n=3*o,a=i.getWidth(),r=[-n+a*Math.sqrt(2)/2,-n,a*Math.sqrt(2)/2,0,-n+a*Math.sqrt(2)/2,n],s=new t.Polyline(e,r);return s.setStroke(i),s.setFill(null),s},t.DiagramLinkConnectorUtils.getCircleRadius=function(t){return 2*t},t.DiagramLinkConnectorUtils.getRectangleLength=function(t){return 3*t},t.DiagramLinkConnectorUtils.CreateCircleConnector=function(e,o,i){var n=t.DiagramLinkConnectorUtils.getCircleRadius(o),a=new t.Circle(e,n,0,n);return a.setStroke(i),a.setFill(null),a},t.DiagramLinkConnectorUtils.CreateRectangleConnector=function(e,o,i){var n=t.DiagramLinkConnectorUtils.getRectangleLength(o),a=new t.Rect(e,0,-n/2,n,n);return a.setStroke(i),a.setFill(null),a},t.DiagramLinkConnectorUtils.CreateRoundedRectangleConnector=function(e,o,i){var n=t.DiagramLinkConnectorUtils.CreateRectangleConnector(e,o,i);return n.setCornerRadius(o),n},t.DiagramLinkConnectorUtils.CreateCustomConnector=function(e,o,i){var n=i.GetDiagram().createAfContext();return n.setELContext(i.getData().getElAttributes()),n.setContextCallback(i,i.eventContextCallback),n.setTabStopsArray(i.getTabStopsArray()),t.AfComponentFactory.parseAndLayout(n,o,i)},t.DiagramLinkConnectorUtils.GetConnectorOffset=function(e,o,i,n,a){if(i){var r=t.DiagramLinkConnectorUtils._getCachedDims(e),s=e.getScaleX();return r.w*s*.5}return t.DiagramLinkConnectorUtils.getStandardConnectorOffset(o,a.GetAppliedLinkWidth(),n.getWidth())},t.DiagramLinkConnectorUtils.getStandardConnectorOffset=function(e,o,i){switch(e){case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_OPEN:return i*Math.sqrt(2);case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW:return 5*t.DiagramLinkConnectorUtils._getReduce(o,.5);case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_ARROW_CONCAVE:return.78*(6*t.DiagramLinkConnectorUtils._getReduce(o,.5));case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_CIRCLE:return 2*t.DiagramLinkConnectorUtils.getCircleRadius(i)+i/2;case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_RECTANGLE:case t.DiagramLinkConnectorUtils.CONNECTOR_TYPE_RECTANGLE_ROUNDED:return t.DiagramLinkConnectorUtils.getRectangleLength(i)+i/2;default:return 0}},t.exportProperty(e.prototype,"getLayout",e.prototype.getLayout),t.exportProperty(e.prototype,"getLayoutAttributes",e.prototype.getLayoutAttributes),t.exportProperty(e.prototype,"getNodeById",e.prototype.getNodeById),t.exportProperty(e.prototype,"getNodeByIndex",e.prototype.getNodeByIndex),t.exportProperty(e.prototype,"getNodeCount",e.prototype.getNodeCount),t.exportProperty(e.prototype,"getLinkById",e.prototype.getLinkById),t.exportProperty(e.prototype,"getLinkByIndex",e.prototype.getLinkByIndex),t.exportProperty(e.prototype,"getLinkCount",e.prototype.getLinkCount),t.exportProperty(e.prototype,"localToGlobal",e.prototype.localToGlobal),t.exportProperty(e.prototype,"isLocaleR2L",e.prototype.isLocaleR2L),t.exportProperty(e.prototype,"getComponentSize",e.prototype.getComponentSize),t.exportProperty(e.prototype,"setViewport",e.prototype.setViewport),t.exportProperty(e.prototype,"getViewport",e.prototype.getViewport),t.exportProperty(e.prototype,"getContainerId",e.prototype.getContainerId),t.exportProperty(e.prototype,"setContainerPadding",e.prototype.setContainerPadding),t.exportProperty(e.prototype,"getContainerPadding",e.prototype.getContainerPadding),t.exportProperty(e.prototype,"getCurrentViewport",e.prototype.getCurrentViewport),t.exportProperty(e.prototype,"getCommonContainer",e.prototype.getCommonContainer),t.exportProperty(e.prototype,"getEventData",e.prototype.getEventData),t.exportProperty(i.prototype,"getId",i.prototype.getId),t.exportProperty(i.prototype,"getBounds",i.prototype.getBounds),t.exportProperty(i.prototype,"getContentBounds",i.prototype.getContentBounds),t.exportProperty(i.prototype,"setPosition",i.prototype.setPosition),t.exportProperty(i.prototype,"getPosition",i.prototype.getPosition),t.exportProperty(i.prototype,"getRelativePosition",i.prototype.getRelativePosition),t.exportProperty(i.prototype,"setLabelPosition",i.prototype.setLabelPosition),t.exportProperty(i.prototype,"getLabelPosition",i.prototype.getLabelPosition),t.exportProperty(i.prototype,"getLabelBounds",i.prototype.getLabelBounds),t.exportProperty(i.prototype,"getLayoutAttributes",i.prototype.getLayoutAttributes),t.exportProperty(i.prototype,"isReadOnly",i.prototype.isReadOnly),t.exportProperty(i.prototype,"getContainerId",i.prototype.getContainerId),t.exportProperty(i.prototype,"getSelected",i.prototype.getSelected),t.exportProperty(i.prototype,"setLabelRotationAngle",i.prototype.setLabelRotationAngle),t.exportProperty(i.prototype,"getLabelRotationAngle",i.prototype.getLabelRotationAngle),t.exportProperty(i.prototype,"setLabelRotationPoint",i.prototype.setLabelRotationPoint),t.exportProperty(i.prototype,"getLabelRotationPoint",i.prototype.getLabelRotationPoint),t.exportProperty(i.prototype,"setContainerPadding",i.prototype.setContainerPadding),t.exportProperty(i.prototype,"getContainerPadding",i.prototype.getContainerPadding),t.exportProperty(i.prototype,"setDisclosed",i.prototype.setDisclosed),t.exportProperty(i.prototype,"isDisclosed",i.prototype.isDisclosed),t.exportProperty(i.prototype,"setChildNodes",i.prototype.setChildNodes),t.exportProperty(i.prototype,"getChildNodes",i.prototype.getChildNodes),t.exportProperty(i.prototype,"getParentNode",i.prototype.getParentNode),t.exportProperty(i.prototype,"setLabelValign",i.prototype.setLabelValign),t.exportProperty(i.prototype,"setLabelHalign",i.prototype.setLabelHalign),t.exportProperty(i.prototype,"getLabelValign",i.prototype.getLabelValign),t.exportProperty(i.prototype,"getLabelHalign",i.prototype.getLabelHalign),t.exportProperty(i.prototype,"getData",i.prototype.getData),t.exportProperty(o.prototype,"getId",o.prototype.getId),t.exportProperty(o.prototype,"getStartId",o.prototype.getStartId),t.exportProperty(o.prototype,"getEndId",o.prototype.getEndId),t.exportProperty(o.prototype,"setPoints",o.prototype.setPoints),t.exportProperty(o.prototype,"getPoints",o.prototype.getPoints),t.exportProperty(o.prototype,"setLabelPosition",o.prototype.setLabelPosition),t.exportProperty(o.prototype,"getLabelPosition",o.prototype.getLabelPosition),t.exportProperty(o.prototype,"getLabelBounds",o.prototype.getLabelBounds),t.exportProperty(o.prototype,"getStartConnectorOffset",o.prototype.getStartConnectorOffset),t.exportProperty(o.prototype,"getEndConnectorOffset",o.prototype.getEndConnectorOffset),t.exportProperty(o.prototype,"getLinkWidth",o.prototype.getLinkWidth),t.exportProperty(o.prototype,"getLayoutAttributes",o.prototype.getLayoutAttributes),t.exportProperty(o.prototype,"getSelected",o.prototype.getSelected),t.exportProperty(o.prototype,"setLabelRotationAngle",o.prototype.setLabelRotationAngle),t.exportProperty(o.prototype,"setLabelRotationAngle",o.prototype.getLabelRotationAngle),t.exportProperty(o.prototype,"setLabelRotationPoint",o.prototype.setLabelRotationPoint),t.exportProperty(o.prototype,"getLabelRotationPoint",o.prototype.getLabelRotationPoint),t.exportProperty(o.prototype,"isPromoted",o.prototype.isPromoted),t.exportProperty(o.prototype,"setLabelValign",o.prototype.setLabelValign),t.exportProperty(o.prototype,"setLabelHalign",o.prototype.setLabelHalign),t.exportProperty(o.prototype,"getLabelValign",o.prototype.getLabelValign),t.exportProperty(o.prototype,"getLabelHalign",o.prototype.getLabelHalign),t.exportProperty(o.prototype,"setCoordinateSpace",o.prototype.setCoordinateSpace),t.exportProperty(o.prototype,"getCoordinateSpace",o.prototype.getCoordinateSpace),t.exportProperty(o.prototype,"getData",o.prototype.getData),t.exportProperty(t,"DiagramPoint",t.DiagramPoint),t.exportProperty(t,"DiagramRectangle",t.DiagramRectangle)}(e),function(t){var e=new Object;t.Obj.createSubclass(e,t.Obj),e.prepareNodeStyle=function(e,o){!e||null==e[o]||e[o]instanceof Object||(e[o]=t.CSSStyle.cssStringToObject(e[o]))},e.prepareLinkStyle=function(e,o){e&&null!=e[o]&&(e[o]instanceof Object?null==e[o]._type&&(e[o]._type=d.CUSTOM_STYLE):e[o]=t.DiagramLinkUtils.getStrokeObject(e[o]))},e.getNodeDefaultStyles=function(t){var o=t.getOptions().styleDefaults.nodeDefaults;return e.prepareNodeStyle(o,"backgroundStyle"),e.prepareNodeStyle(o,"containerStyle"),o},e.getNodeStyles=function(o,i,n){var a=l.ConvertNodeData(i);if(o.getOptions().nodeProperties){var r=t.JsonUtils.clone(o.getOptions().nodeProperties(i));e.prepareNodeStyle(r,"backgroundStyle"),e.prepareNodeStyle(r,"containerStyle"),a=t.JsonUtils.merge(a,r,{_origData:!0})}return t.JsonUtils.merge(a,n,{_origData:!0})},e.getLinkDefaultStyles=function(o,i){var n=o.getOptions().styleDefaults[i];e.prepareLinkStyle(n,"style");var a=o.getCtx().isCustomElement()?"svgStyle":"style";return n[a]=t.JsonUtils.merge(n[a],n._style),o.getCtx().isCustomElement()&&t.ArrayUtils.forEach(["_type"],function(t){delete n[a][t]}),n},e.getLinkStyles=function(o,i,n){var a=d.ConvertLinkData(i);if(o.getOptions().linkProperties){var r=t.JsonUtils.clone(o.getOptions().linkProperties(i));e.prepareLinkStyle(r,"style"),a=t.JsonUtils.merge(a,r,{_origData:!0})}return t.JsonUtils.merge(a,n,{_origData:!0})},e.getAnimationDuration=function(e){return t.StyleUtils.getTimeMilliseconds(e.getOptions().styleDefaults.animationDuration)/1e3},e.getAnimationOnDisplay=function(t){return t.getOptions().animationOnDisplay},e.getAnimationOnDataChange=function(t){return t.getOptions().animationOnDataChange},t.Diagram=function(t,e,o){this.Init(t,e,o)},t.Obj.createSubclass(t.Diagram,t.BaseDiagram),t.Diagram.prototype.Init=function(e,o,n){t.Diagram.superclass.Init.call(this,e,o,n),this.Defaults=new i,this.EventManager=new r(e,this.processEvent,this),this.EventManager.addListeners(this),t.Agent.isTouchDevice()||this.EventManager.setKeyboardHandler(new s(this,this.EventManager)),this._nodes={},this._arNodeIds=[],this._arRootIds=[],this._links={},this._arLinkIds=[],this._renderCount=0,this._deferredObjCount=0,this._allNodeIdsMap={},this._unresolvedNodeIds=[],this._nodesToResolve=[]},t.Diagram.newInstance=function(e,o,i){return new t.Diagram(e,o,i)},t.Diagram.prototype.PreRender=function(){!this.IsResize()&&this._bRendered&&("none"!=e.getAnimationOnDataChange(this)&&(this._oldDataAnimState=new n(this)),this._currentViewport=this.getPanZoomCanvas().getViewport(),this._bRendered=!1,this._oldPanZoomCanvas=this.getPanZoomCanvas(),this._setDataSourceListeners(this.getOptions().data,!1)),this.IsResize()?this._layoutContext&&(this._layoutContext.setEventData(null),this._layoutContext.setComponentSize(new t.DiagramRectangle(0,0,this.getWidth(),this.getHeight())),this._layoutContext.setCurrentViewport(null)):(this.ResetNodesAndLinks(),this._oldLayoutContext=this._layoutContext,this._layoutContext=null)},t.Diagram.prototype.ResetNodesAndLinks=function(){this.setLinksPane(new t.Container(this.getCtx())),this.setNodesPane(new t.Container(this.getCtx())),this.setTopPane(new t.Container(this.getCtx())),this._nodes={},this._arNodeIds=[],this._arRootIds=[],this._links={},this._arLinkIds=[],this._highlightedObjects=null,this._promotedLinksMap=null,this._linkToPromotedMap=null,this._collapsedNodes=null,this.getOptions().nodes=[],this.getOptions().links=[],this._allNodeIdsMap={},this._unresolvedNodeIds=[]},t.Diagram.prototype._onAnimationEnd=function(){this._deleteContainer&&(this.removeChild(this._deleteContainer),this._deleteContainer.destroy()),this._deleteContainer=null,this.Animation&&this.getEventManager().addListeners(this),this.AnimationStopped||this.RenderComplete(),this.Animation=null,this.AnimationStopped=!1,this._bRendered&&(this._oldDataAnimState=null)},t.Diagram.prototype.animateUpdate=function(e,o){var i=new t.CustomAnimation(this.getCtx(),null,e.getAnimationDuration()),n=o.PanZoomMatrix,r=this.getPanZoomCanvas().getContentPane().getMatrix();n.equals(r)||(this.getPanZoomCanvas().getContentPane().setMatrix(n),i.getAnimator().addProp(t.Animator.TYPE_MATRIX,this.getPanZoomCanvas().getContentPane(),this.getPanZoomCanvas().getContentPane().getMatrix,this.getPanZoomCanvas().getContentPane().setMatrix,r));var s=o.IsPartialUpdate?o.getNewNodes():this.GetRootNodeObjects(),d=o.IsPartialUpdate?o.getNewLinks():this.GetAllLinkObjects();e.constructAnimation(o.getNodes(),s),e.constructAnimation(o.getLinks(),d),e.add(i,a.UPDATE)},t.Diagram.prototype._resolveDeferredData=function(t,e){if(null==e||this._isNodeDisclosed(e.id)||this._discoverLinks(t,e)){var o=t.getData(e);this._deferredObjCount++;var i=this,n=this._renderCount;o.then(function(o){i._renderDeferredData(n,t,e||i.getOptions(),o)},function(o){i._renderDeferredData(n,t,e||i.getOptions(),null)})}},t.Diagram.prototype._renderDeferredData=function(t,e,o,i){if(t===this._renderCount&&this.getCtx().isReadyToRender()){if(null!=i){if(o.nodes=i.nodes,Array.isArray(i.links)&&(this.getOptions().links=this.getOptions().links.concat(i.links)),this._findUnresolvedLinks(i),Array.isArray(o.nodes))for(this._nodesToResolve=this._nodesToResolve.concat(o.nodes);this._nodesToResolve.length>0;)this._resolveDeferredData(e,this._nodesToResolve.shift())}else o.nodes=null;this._deferredObjCount--,0===this._deferredObjCount&&this.RenderComponentInternal()}},t.Diagram.prototype._findUnresolvedLinks=function(t){if("none"!==this.getOptions().promotedLinkBehavior){if(Array.isArray(t.nodes))for(var e=0;e<t.nodes.length;e++)this._allNodeIdsMap[t.nodes[e].id]=!0;for(e=this._unresolvedNodeIds.length-1;e>=0;e--)this._allNodeIdsMap[this._unresolvedNodeIds[e]]&&this._unresolvedNodeIds.splice(e,1);if(Array.isArray(t.links))for(e=0;e<t.links.length;e++){var o=t.links[e];this._allNodeIdsMap[o.startNode]||this._unresolvedNodeIds.push(o.startNode),this._allNodeIdsMap[o.endNode]||this._unresolvedNodeIds.push(o.endNode)}}},t.Diagram.prototype._discoverLinks=function(t,e){var o=this.getOptions().promotedLinkBehavior;return!("none"===o||0==this._unresolvedNodeIds.length||"lazy"==o&&t.getChildCount(e)<=0)&&"disjoint"!=t.getDescendantsConnectivity(e)},
t.Diagram.prototype._setDataSourceListeners=function(t,e){t&&(this._dataSourceAddEventHandler||(this._dataSourceAddEventHandler=this.handleDataSourceChangeEvent.bind(this,"add")),this._dataSourceRemoveEventHandler||(this._dataSourceRemoveEventHandler=this.handleDataSourceChangeEvent.bind(this,"remove")),this._dataSourceChangeEventHandler||(this._dataSourceChangeEventHandler=this.handleDataSourceChangeEvent.bind(this,"change")),e?(t.on("add",this._dataSourceAddEventHandler),t.on("remove",this._dataSourceRemoveEventHandler),t.on("change",this._dataSourceChangeEventHandler)):(t.off("add",this._dataSourceAddEventHandler),t.off("remove",this._dataSourceRemoveEventHandler),t.off("change",this._dataSourceChangeEventHandler)))},t.Diagram.prototype.Render=function(){if(t.Diagram.superclass.Render.call(this),this.InitComponentInternal(),this._deferredObjCount=0,this._nodesToResolve=[],this._bRendered||this.IsResize())0===this._deferredObjCount&&this.RenderComponentInternal();else{this._renderCount++;var e=this.getOptions().data;e?(this._setDataSourceListeners(e,!1),this._resolveDeferredData(e,null)):this.RenderComponentInternal()}},t.Diagram.prototype.RenderComponentInternal=function(){var t;if(this._bRendered||this.IsResize()||(this._setDataSourceListeners(this.getOptions().data,!0),this.prepareNodes(this.getOptions().nodes),this.renderLinks(this.getOptions().links),this.getCtx().setKeyboardFocusArray([this])),t=0===Object.keys(this._nodes).length)this._processContent(t);else{this.contains(this._oldPanZoomCanvas)||this.addChild(this._oldPanZoomCanvas);var e=this.layout(),o=this,i=this._renderCount;e.then(function(){i===o._renderCount&&o._processContent(t)},function(){i===o._renderCount&&(o.removeChild(o._oldPanZoomCanvas),o._oldPanZoomCanvas=null,o._bRendered=!0,this._currentViewport=null)})}},t.Diagram.prototype._processContent=function(o){var i;if(o||(this.removeChild(this._oldPanZoomCanvas),this._processHighlighting(),this._processInitialSelections(),this._updateKeyboardFocusEffect(),(i=null==this._cachedViewBounds)&&(this._cachedViewBounds=this.GetViewBounds()),this._fitContent()),!this._bRendered){var n=this.getPanZoomCanvas();n.setPanningEnabled(this.IsPanningEnabled()),n.setPanDirection(this.getPanDirection()),n.setZoomingEnabled(this.IsZoomingEnabled()),n.setZoomToFitEnabled(this.IsZoomingEnabled())}this._oldPanZoomCanvas=null,this.StopAnimation(!0);var r=e.getAnimationOnDisplay(this),s=e.getAnimationOnDataChange(this);if(this._bRendered||"none"===r||this._oldDataAnimState){if("none"!==s&&this._oldDataAnimState){this._deleteContainer=new t.Container(this.getCtx(),"Delete Container"),this.addChild(this._deleteContainer);var d=new a(this.getCtx(),this._deleteContainer,this._oldDataAnimState,this);d.constructAnimation([this._oldDataAnimState],[this]),this.Animation=d.getAnimation()}}else this.Animation=t.BlackBoxAnimationHandler.getInAnimation(this.getCtx(),t.BlackBoxAnimationHandler.ALPHA_FADE,this,null,e.getAnimationDuration(this));if(this.Animation?(this.getEventManager().hideTooltip(),this.getEventManager().removeListeners(this),this.Animation.setOnEnd(this._onAnimationEnd,this),this.Animation.play()):this._onAnimationEnd(),this._bRendered=!0,this._currentViewport=null,this.RefreshEmptyText(o),this.IsPanningEnabled()){var l=this._cachedViewBounds;if(null!=l){var h=this.getPanZoomCanvas().getZoom();this.ConstrainPanning(l.x,l.y,l.w,l.h,h)}}this.ClearLayoutViewport(),i&&(this._cachedViewBounds=null)},t.Diagram.prototype._fitContent=function(){var e=this.getPanZoomCanvas();if(this._bRendered){if(this.IsResize()||this._partialUpdate){var o=this.AdjustMinZoom(this._cachedViewBounds);n=(i=this.IsLayoutViewport())?this.GetLayoutViewport():o||this._cachedViewBounds;e.setZoomToFitPadding(i?0:t.PanZoomCanvas.DEFAULT_PADDING),e.setZoomToFitEnabled(!0),e.zoomToFit(null,n),e.setZoomToFitEnabled(this.IsZoomingEnabled())}}else{this.AdjustMinZoom(this._cachedViewBounds);var i,n=(i=this.IsLayoutViewport())?this.GetLayoutViewport():this._cachedViewBounds;i&&e.setZoomToFitPadding(0),e.zoomToFit(null,n)}},t.Diagram.prototype.SetOptions=function(e){t.Diagram.superclass.SetOptions.call(this,e),this.Options.nodes=[],this.Options.links=[],this.parseComponentJson(this.Options),this.SetPanningEnabled("none"!=this.Options.panning),this.SetZoomingEnabled("none"!=this.Options.zooming),this.setControlPanelBehavior("hidden"),this.setSelectionMode(this.Options.selectionMode),this.setEmptyText(this.Options.emptyText?this.Options.emptyText:t.Bundle.getTranslation(this.Options,"labelNoData",t.Bundle.UTIL_PREFIX,"NO_DATA"))},t.Diagram.getDefaults=function(t){return(new i).getDefaults(t)},t.Diagram.prototype.getMaxZoom=function(){var t=this.getOptions().maxZoom,e=parseFloat(t);return e>0?e:1},t.Diagram.prototype.getMinZoom=function(){var t=this.getOptions().minZoom;if(t){var e=parseFloat(t);return e>0&&(t=Math.min(e,this.getMaxZoom())),t}return 0},t.Diagram.prototype.getPanDirection=function(){return this.getOptions().panDirection},t.Diagram.prototype.getAnimationDuration=function(){return e.getAnimationDuration(this)},t.Diagram.prototype.processEvent=function(t,e){var o=t.type;"categoryHighlight"==o?this._processHighlighting(!0):"selection"==o&&(this.getOptions().selection=t.selection),t&&this.dispatchEvent(t)},t.Diagram.prototype.prepareNodes=function(t){if(t){this._prepareNodes(null,t);var e=this.getOptions().expanded;e&&(e.has||this.DisclosedNodes)||(this.DisclosedNodes=e?"all"===e?this._arNodeIds.slice(0):e:[])}},t.Diagram.prototype.renderLinks=function(o){if(o){for(var i=e.getLinkDefaultStyles(this,"linkDefaults"),n=0;n<o.length;n++){var a=o[n];if(!this._isLinkPromoted(a)){a=e.getLinkStyles(this,a,i);var r=(p=d.newInstance(this,a,!1)).getId();if(this._arLinkIds.push(r),!p.isHidden()){var s=this.getNodeById(p.getStartId()),l=this.getNodeById(p.getEndId());s.addOutLinkId(r),l.addInLinkId(r),p.render(),this._links[r]=p}}}if(this._promotedLinksMap){var h=e.getLinkDefaultStyles(this,"promotedLink");for(var g in this._promotedLinksMap)if(!this._links[g]){a=this._promotedLinksMap[g];a=t.JsonUtils.merge(a,h);var p;r=(p=d.newInstance(this,a,!0)).getId(),s=this.getNodeById(p.getStartId()),l=this.getNodeById(p.getEndId());s.addOutLinkId(r),l.addInLinkId(r),p.render(),this._arLinkIds.push(r),this._links[r]=p}}}},t.Diagram.prototype.layout=function(){var e=this.getOptions().layout,o=this._getLayoutContext();if(o.setDirtyContext({}),this._currentViewport){var i=this._currentViewport,n=this.getLayoutOffset(),a=new t.DiagramRectangle(i.x-n.x,i.y-n.y,i.w,i.h);o.setCurrentViewport(a)}if(e&&"function"==typeof e){for(var r=o.getNodeCount(),s=0;s<r;s++){var d=o.getNodeByIndex(s);this.renderLeafNodeFromContext(d)}var l=this,h=e(o);h||(h={then:function(t,e){t()}}),this.setAlphas(0);var g=this._renderCount;return h.then(function(t){if(l._renderCount===g||l.IsResize()){l.setAlphas(1),l._oldDataAnimState&&l._oldDataAnimState.updateStateFromLayoutContext(o);for(var e=o.getNodeCount(),i=0;i<e;i++){var n=o.getNodeByIndex(i);l.renderNodeFromContext(n,!0)}l.ApplyLayoutContext(o,!0)}},function(t){}),h}this.Log("dvt.Diagram: Layout function is not defined",1)},t.Diagram.prototype.setAlphas=function(t){this._bRendered||(this.getLinksPane().setAlpha(t),this.getNodesPane().setAlpha(t))},t.Diagram.prototype.getNodeById=function(t){return this._nodes[t]},t.Diagram.prototype.getLinkById=function(t){return this._links[t]},t.Diagram.prototype.GetAllLinks=function(){return this._arLinkIds},t.Diagram.prototype.GetAllLinksMap=function(){var t={};if(this._links)for(var e in this._links)t[e]=this._links[e];return t},t.Diagram.prototype.GetAllLinkObjects=function(){var t=[];if(this._links)for(var e in this._links)t.push(this._links[e]);return t},t.Diagram.prototype.GetAllNodes=function(){return this._arNodeIds},t.Diagram.prototype.GetAllNodesMap=function(){var t={};if(this._nodes)for(var e in this._nodes)t[e]=this._nodes[e];return t},t.Diagram.prototype.GetAllNodeObjects=function(){var t=[];if(this._nodes)for(var e in this._nodes)t.push(this._nodes[e]);return t},t.Diagram.prototype.GetAllRoots=function(){return this._arRootIds},t.Diagram.prototype.GetRootNodeObjects=function(){for(var t=[],e=0;this._arRootIds&&e<this._arRootIds.length;e++){var o=this._nodes[this._arRootIds[e]];o&&t.push(o)}return t},t.Diagram.prototype.HandleZoomEvent=function(e){switch(t.Diagram.superclass.HandleZoomEvent.call(this,e),e.getSubType()){case t.ZoomEvent.SUBTYPE_ADJUST_PAN_CONSTRAINTS:if(this.IsPanningEnabled()){var o=e.getNewZoom(),i=this._cachedViewBounds?this._cachedViewBounds:this.GetViewBounds();this.ConstrainPanning(i.x,i.y,i.w,i.h,o)}break;case t.ZoomEvent.SUBTYPE_ZOOM_TO_FIT_CALC_BOUNDS:if(!this.IsLayoutViewport()){i=this._cachedViewBounds?this._cachedViewBounds:this.GetViewBounds();e.setZoomToFitBounds(i)}break;case t.ZoomEvent.SUBTYPE_ZOOMED:if(!t.Agent.isTouchDevice()&&this.getOptions().zoomRenderer&&e.getOldZoom()!==e.getNewZoom())for(var n in this._nodes){this.getNodeById(n).rerenderOnZoom(e)}break;case t.ZoomEvent.SUBTYPE_ZOOM_TO_FIT_END:case t.ZoomEvent.SUBTYPE_ZOOM_END:if(t.Agent.isTouchDevice()&&this.getOptions().zoomRenderer&&e.getOldZoom()!==e.getNewZoom())for(var n in this._nodes){this.getNodeById(n).rerenderOnZoom(e)}}},t.Diagram.prototype.prepareForDataChange=function(){},t.Diagram.prototype.getNavigableLinksForNodeId=function(t){var e=[];for(var o in this._links){var i=this.getLinkById(o),n=i.getStartId(),a=i.getEndId();n!=t&&a!=t||!i.getVisible()||e.push(i)}return e},t.Diagram.prototype.GetComponentDescription=function(){return t.Bundle.getTranslatedString(t.Bundle.UTIL_PREFIX,"DIAGRAM")},t.Diagram.prototype._processInitialSelections=function(){if(this.Options.selection&&this.isSelectionSupported()){var t=[];for(var e in this._nodes)t.push(this.getNodeById(e));for(var o in this._links)t.push(this.getLinkById(o));this.getSelectionHandler().processInitialSelections(this.Options.selection,t)}},t.Diagram.prototype._processHighlighting=function(e){e&&this.EventManager.removeListeners(this,!0),this._highlightedObjects&&(this._updateAlphas(!1,this._highlightedObjects),this._highlightedObjects=null);var o=this.Options.highlightedCategories;if(o&&0!==o.length){var i="any"==this.Options.highlightMatch;this._highlightedObjects={};var n=[];for(var a in this._nodes){var r=this.getNodeById(a);(i?t.ArrayUtils.hasAnyItem(r.getCategories(),o):t.ArrayUtils.hasAllItems(r.getCategories(),o))&&(this._highlightedObjects[r.getId()]=r,n.push(r))}this._processNodeConnections(n);var s=[];for(var d in this._links){var l=this.getLinkById(d);(i?t.ArrayUtils.hasAnyItem(l.getCategories(),o):t.ArrayUtils.hasAllItems(l.getCategories(),o))&&(this._highlightedObjects[l.getId()]=l,s.push(l))}if("linkAndNodes"==this.Options.linkHighlightMode&&this._processLinkConnections(s),this._updateAlphas(!0,this._highlightedObjects),e){var h=this;setTimeout(function(){h.getEventManager().addListeners(h)},0)}}else e&&this.EventManager.addListeners(this)},t.Diagram.prototype._processNodeConnections=function(t){var e=this.Options.nodeHighlightMode;if("node"!=e){for(var o="nodeAndIncomingLinks"==e||"nodeAndLinks"==e,i="nodeAndOutgoingLinks"==e||"nodeAndLinks"==e,n=[],a=0;a<t.length;a++){var r=t[a],s=o&&r.getInLinkIds()?r.getInLinkIds():[];s=i&&r.getOutLinkIds()?s.concat(r.getOutLinkIds()):s;for(var d=0;d<s.length;d++){var l=s[d];this._highlightedObjects[l]=this.getLinkById(l),n.push(this.getLinkById(l))}}this._processLinkConnections(n)}},t.Diagram.prototype._processLinkConnections=function(t){for(var e=0;e<t.length;e++){var o=t[e],i=o.getStartId(),n=o.getEndId();this._highlightedObjects[i]=this.getNodeById(i),this._highlightedObjects[n]=this.getNodeById(n)}},t.Diagram.prototype._updateAlphas=function(t,e){var o;if(this._arNodeIds.length==this._arRootIds.length)for(var i in o=t?this.Options.styleDefaults._highlightAlpha:1,this.getLinksPane().setAlpha(o),this.getNodesPane().setAlpha(o),e)t?this.moveToDiagramFront(e[i]):e[i]instanceof d?this.moveToLinks(e[i]):e[i]instanceof l&&this.moveToNodes(e[i]);else if(t){o=this.Options.styleDefaults._highlightAlpha;var n={};for(var i in e)e[i].setAlpha(1),n[i]=!0;for(var a in this._nodes)n[a]||this.getNodeById(a).setAlpha(o);for(var r in this._links)n[r]||this.getLinkById(r).setAlpha(o)}else{for(var a in this._nodes)this.getNodeById(a).setAlpha(1);for(var r in this._links)this.getLinkById(r).setAlpha(1)}},t.Diagram.prototype.highlight=function(e){this.Options.highlightedCategories=t.JsonUtils.clone(e),this._processHighlighting()},t.Diagram.prototype.select=function(e){this.Options.selection=t.JsonUtils.clone(e),this._processInitialSelections()},t.Diagram.prototype.getAutomation=function(){return this.Automation||(this.Automation=new h(this)),this.Automation},t.Diagram.prototype.Log=function(t,e){var o=this.getOptions()._logger;if(o)switch(e){case 1:o.error&&o.error(t);break;case 2:o.warn&&o.warn(t);break;case 3:o.info&&o.info(t);break;default:o.log&&o.log(t)}},t.Diagram.prototype.processDefaultHoverEffect=function(t,e){var o=this.getNodeById(t);o&&o.processDefaultHoverEffect(e)},t.Diagram.prototype.processDefaultSelectionEffect=function(t,e){var o=this.getNodeById(t);o&&o.processDefaultSelectionEffect(e)},t.Diagram.prototype.processDefaultFocusEffect=function(t,e){var o=this.getNodeById(t);o&&o.processDefaultFocusEffect(e)},t.Diagram.prototype.updateNodeDims=function(e){if(e.IsRendered){var o=this.getNodeById(e.getId());e.setBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(o.getLayoutBounds(!0))),e.setContentBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(o.getContentBounds(!0))),e.setLabelBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(o.getLabelBounds(!0)))}else this.renderNodeFromContext(e,!0)},t.Diagram.prototype.renderLeafNodeFromContext=function(t){if(this.getNodeById(t.getId()).isDisclosed())for(var e=t.getChildNodes(),o=0;o<e.length;o++){var i=e[o];this.renderLeafNodeFromContext(i)}else this.renderNodeFromContext(t,!1)},t.Diagram.prototype.renderNodeFromContext=function(e,o){if(!e.IsRendered){var i=this.getNodeById(e.getId());if(i.isDisclosed()){var n=this.CreateEmptyLayoutContext();n.setDirtyContext(e.LayoutContext?e.LayoutContext.getDirtyContext():null),this._oldDataAnimState&&this._oldDataAnimState.updateStateFromLayoutContext(n);for(var a=e.getChildNodes(),r=0;r<a.length;r++){var s=a[r];this.renderNodeFromContext(s,!1),n.addNode(s)}for(r=0;r<a.length;r++)this.updateNodeDims(a[r]);this.ApplyLayoutContext(n)}i.render();var d=i.isDisclosed()?i.getContainerPadding():null;d&&e.setContainerPadding(d.top,d.right,d.bottom,d.left),e.setBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(i.getLayoutBounds(o))),e.setContentBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(i.getContentBounds(o))),e.setLabelBounds(t.DiagramLayoutUtils.convertRectToDiagramRect(i.getLabelBounds(o))),e.IsRendered=!0}},t.Diagram.prototype._prepareNodes=function(t,o){if(o)for(var i=e.getNodeDefaultStyles(this),n=0;n<o.length;n++){var a=e.getNodeStyles(this,o[n],i),r=l.newInstance(this,a),s=r.getId();t?(t.addChildNodeId(s),r.setGroupId(t.getId())):this._arRootIds.push(s),this._arNodeIds.push(s),a.nodes&&a.nodes.length>0&&(this._isNodeDisclosed(s)?(r.setDisclosed(!0),this._prepareNodes(r,a.nodes)):this._addToCollapsedArray(r)),r.isHidden()||(t&&t.GetChildNodePane()?t.GetChildNodePane().addChild(r):this.getNodesPane().addChild(r),this._nodes[s]=r)}},t.Diagram.prototype.setNodeDisclosed=function(e,o){o!=this._isNodeDisclosed(e)&&this.dispatchEvent(new t.EventFactory.newEvent(o?"beforeExpand":"beforeCollapse",e))},t.Diagram.prototype.expand=function(e){var o=!1,i=this.getOptions().expanded;i&&i.has&&!i.has(e)?(o=!0,i=i.add([e]),this.applyOptions({expanded:i},this.Defaults.getNoCloneObject())):(this.DisclosedNodes||(this.DisclosedNodes=[]),t.ArrayUtils.getIndex(this.DisclosedNodes,e)<0&&(this.DisclosedNodes.push(e),o=!0));o&&(this.render(this.getOptions(),this.Width,this.Height),this.dispatchEvent(new t.EventFactory.newEvent("expand",e)))},t.Diagram.prototype.collapse=function(e){var o=!1,i=this.getOptions().expanded;if(i&&i.has&&i.has(e))o=!0,i=i.delete([e]),this.applyOptions({expanded:i},this.Defaults.getNoCloneObject());else{var n=-1;this.DisclosedNodes&&(n=t.ArrayUtils.getIndex(this.DisclosedNodes,e)),n>-1&&(this.DisclosedNodes.splice(n,1),o=!0)}o&&(this.render(this.getOptions(),this.Width,this.Height),this.dispatchEvent(new t.EventFactory.newEvent("collapse",e)))},t.Diagram.prototype._addLayoutContextForChildNodes=function(t,e,o,i){if(t.isDisclosed()){var n=t.getChildNodeIds(),a=this._createLayoutContextForChildNodes(e,o,n,i);e.setChildNodes(a)}},t.Diagram.prototype._appendLayoutContextForChildNodes=function(e,o,i,n,a){if(e.isDisclosed()){var r=n.reduce(function(t,e){return t.push(e.id),t},[]),s=this._createLayoutContextForChildNodes(o,i,r,!0),d=o.getChildNodes()||[];s=t.ArrayUtils.insert(d,s,a),o.setChildNodes(s),o.setDisclosed(!0),o.SetContainerPaddingObj(t.BaseDiagram.getLayoutContainerPadding(e.getContainerPadding())),o.UpdateParentNodes()}},t.Diagram.prototype._createLayoutContextForChildNodes=function(t,e,o,i){for(var n=[],a=0;a<o.length;a++){var r=this.getNodeById(o[a]);if(r.getVisible()){var s=this.CreateLayoutContextNode(r,null,i,e);s.copyFrom(this._oldLayoutContext?this._oldLayoutContext.getNodeById(o[a]):null),e.addNodeToMap(s),s.setParentNode(t),n.push(s),this._addLayoutContextForChildNodes(r,s,e,i)}}return n},t.Diagram.prototype._isNodeDisclosed=function(e){var o=this.getOptions().expanded;if(o&&o.has)return o.has(e);var i=this.DisclosedNodes?this.DisclosedNodes:o;return i&&t.ArrayUtils.getIndex(i,e)>-1||i&&t.ArrayUtils.getIndex(i,"all")>-1},t.Diagram.prototype._isLinkPromoted=function(t){var e=this.getNodeById(t.startNode),o=this.getNodeById(t.endNode);if(e&&o||!this._collapsedNodes)return!1;if("none"===this.getOptions().promotedLinkBehavior)return!0;var i=e?e.getId():this._findFirstVisibleAncestor(t.startNode),n=o?o.getId():this._findFirstVisibleAncestor(t.endNode);if(!i||!n)return!1;if(i===n)return!1;var a=d.GetPromotedLinkId(i,n);return this._promotedLinksMap||(this._promotedLinksMap={}),this._promotedLinksMap[a]?this._promotedLinksMap[a]._links.push(t):this._promotedLinksMap[a]={id:a,startNode:i,endNode:n,_links:[t]},this._linkToPromotedMap||(this._linkToPromotedMap={}),this._linkToPromotedMap[t.id]=a,!0},t.Diagram.prototype._addToCollapsedArray=function(t){this._collapsedNodes||(this._collapsedNodes=[]),this._collapsedNodes.push(t)},t.Diagram.prototype._findFirstVisibleAncestor=function(t){for(var e=function(t,o){if(t)for(var i=0;i<t.length;i++)if(t[i].id===o||e(t[i].nodes,o))return!0;return!1},o=0;o<this._collapsedNodes.length;o++){var i=this._collapsedNodes[o];if(e(i.getData().nodes,t))return i.getId()}return null},t.Diagram.prototype._updateKeyboardFocusEffect=function(){var t,e=this.getEventManager().getFocus(),o=!1;e&&(e instanceof l?t=this.getNodeById(e.getId()):e instanceof d&&(t=this.getLinkById(e.getId())),o=e.isShowingKeyboardFocusEffect(),t&&o&&t.showKeyboardFocusEffect(),this.getEventManager().setFocus(t))},t.Diagram.prototype.clearDisclosedState=function(){this.DisclosedNodes=null},t.Diagram.prototype.ShowLinkCreationFeedback=function(o){if(this.getEventManager().LinkCreationStarted){var i=this._context.pageToStageCoords(o.pageX,o.pageY),n=this.getPanZoomCanvas().getContentPane().stageToLocal({x:i.x,y:i.y});if(this._linkCreationFeedBack){var a=this._linkCreationFeedBack.getPoints();this._linkCreationFeedBack.setPoints([a[0],a[1],n.x,n.y])}else{var r=this.getEventManager().DragSource.getDragObject();if(r instanceof l){var s=this.getEventManager().DragSource.getDragCoords(),h=this.getPanZoomCanvas().getContentPane().stageToLocal({x:s.x,y:s.y}),g=this.getOptions().styleDefaults.linkDefaults;e.prepareLinkStyle(g,"style");var p=this.getOptions().dnd.drag.ports.linkStyle;if(p&&"function"==typeof p){var u=p({dataContext:r.getDataContext(),portElement:r.__dragPort});u&&(g.style=t.JsonUtils.merge(u.svgStyle,g.style),g.svgClassName=u.svgClassName||g.className)}var c={id:"linkFeedback",startNode:r.getId(),endNode:r.getId()};c=t.JsonUtils.merge(c,g);var y=d.newInstance(this,c,!1);this.getNodesPane().addChild(y),y.setMouseEnabled(!1),y.setPoints([h.x,h.y,n.x,n.y]),this._linkCreationFeedBack=y}}}},t.Diagram.prototype.HideLinkCreationFeedback=function(){this.getNodesPane().removeChild(this._linkCreationFeedBack),this._linkCreationFeedBack=null},t.Diagram.prototype.handleDataSourceChangeEvent=function(t,o){if("none"!==e.getAnimationOnDataChange(this)&&(this._oldDataAnimState=new n(this,t,o)),this._currentViewport=this.getPanZoomCanvas().getViewport(),this.IsPanningEnabled()){var i=this.getPanZoomCanvas();i.setMinPanY(null),i.setMaxPanY(null),i.setMinPanX(null),i.setMaxPanX(null)}var a,r,s=o.data.nodes,d=o.data.links;if("add"==t){if(r=(a=o.parentId)?this.getNodeById(a):null,"all"===this.getOptions().expanded&&s){var l=this.DisclosedNodes,h=function(t){for(var e=0;e<t.length;e++)l.push(t[e].id),t[e].nodes&&h(t[e].nodes)};h(s)}r?(r.appendChildNodesData(s,o.index),this._isNodeDisclosed(a)&&(r.setDisclosed(!0),this._prepareNodes(r,s))):this._prepareNodes(null,s),this.renderLinks(d)}else if("change"==t){if(s)for(var g=e.getNodeDefaultStyles(this),p=0;p<s.length;p++){var u=this.getNodeById(s[p].id);if(u){var c=e.getNodeStyles(this,s[p],g);u.setData(c)}}d&&(this._removeLinks(d),this.renderLinks(d))}else"remove"==t&&((r=(a=o.parentId)?this.getNodeById(a):null)?(this._removeNodes(r,s),r.removeChildNodesData(s),r.getData().nodes&&0!==r.getData().nodes.length||r.setDisclosed(!1)):this._removeNodes(null,s),this._removeLinks(d));this._oldDataAnimState&&this._oldDataAnimState.updateStateFromEvent(t,o),this._updateLayoutContext(t,o);var y=0===this.GetAllNodes().length;if(y)this._processContent(y);else{this._renderCount++;var _=this.layout(),m=this,f=this._renderCount;_.then(function(){f===m._renderCount&&(m._partialUpdate=!0,m._processContent(!1),m._partialUpdate=!1)},function(){f===m._renderCount&&(m.removeChild(m._oldPanZoomCanvas),m._oldPanZoomCanvas=null,m._bRendered=!0,this._currentViewport=null)})}},t.Diagram.prototype._updateLayoutContext=function(t,e){this._layoutContext||(this._layoutContext=this.CreateEmptyLayoutContext());var o=this._layoutContext;o.setEventData({type:t,data:e});var i,n,a,r,s,d,l=e.data.nodes,h=e.data.links;if(e.parentId&&(r=o.getNodeById(e.parentId),s=this.getNodeById(e.parentId)),"add"==t){if(l)if(r&&s)r.Reset(),this._appendLayoutContextForChildNodes(s,r,o,l,e.index);else for(i=0;i<l.length;i++)a=l[i].id,this.getNodeById(a)&&(n=this.CreateLayoutContextNode(this.getNodeById(a),null,!0,o),this._addLayoutContextForChildNodes(this.getNodeById(a),n,o,!0),o.addNode(n));if(h)for(i=0;i<h.length;i++){if(d=h[i].id,c=this.getLinkById(d)||this.getLinkById(this._linkToPromotedMap[d])){if(o.getLinkById(c.getId()))continue;var g=c.getData().startNode,p=c.getData().endNode;o.getNodeById(g)&&o.getNodeById(p)&&o.addLink(this.CreateLayoutContextLink(c,g,p,null,o))}}}else if("change"==t){if(l)for(i=0;i<l.length;i++)a=l[i].id,(n=o.getNodeById(a)).Reset(),n.UpdateParentNodes();if(h){for(i=o.getLinkCount()-1;i>=0;i--){var u=o.getLinkByIndex(i);this._links[u.getId()]||o.removeLink(u)}for(i=0;i<h.length;i++){var c;if(d=h[i].id,c=this.getLinkById(d)||this.getLinkById(this._linkToPromotedMap[d])){o.removeLink(o.getLinkById(c.getId()));g=c.getData().startNode,p=c.getData().endNode;o.getNodeById(g)&&o.getNodeById(p)&&o.addLink(this.CreateLayoutContextLink(c,g,p,null,o))}}}}else if("remove"==t){if(l){for(i=0;i<l.length;i++)a=l[i].id,n=o.getNodeById(a),o.removeNode(r,n);r&&s&&(r.Reset(),r.UpdateParentNodes(),r.setDisclosed(s.isDisclosed()))}for(i=o.getLinkCount()-1;i>=0;i--){u=o.getLinkByIndex(i);this._links[u.getId()]||o.removeLink(u)}}},t.Diagram.prototype._getLayoutContext=function(){if(!this._layoutContext){for(var t=this.CreateEmptyLayoutContext(),e=0;e<this._arRootIds.length;e++){var o=this._arRootIds[e];if(this.getNodeById(o)){var i=!this._bRendered,n=this.getNodeById(o),a=this.CreateLayoutContextNode(n,null,i,t);a.copyFrom(this._oldLayoutContext?this._oldLayoutContext.getNodeById(o):null),this._addLayoutContextForChildNodes(n,a,t,i),t.addNode(a)}}for(var r in this._links){var s=this.getLinkById(r);if(s){var d=s.getData().startNode,l=s.getData().endNode;if(t.getNodeById(d)&&t.getNodeById(l)){var h=this.CreateLayoutContextLink(s,d,l,null,t);h.copyFrom(this._oldLayoutContext?this._oldLayoutContext.getLinkById(r):null),t.addLink(h)}}}this._layoutContext=t,this._oldLayoutContext=null}return this._layoutContext},t.Diagram.prototype._removeNodes=function(e,o){if(o&&(!e||e.isDisclosed())){for(var i=[],n=0;n<o.length;n++){var a=o[n].id,r=this.getNodeById(a);for(var s in this._removeNodes(r,r.getData().nodes),this._links){var d=this.getLinkById(s);d&&(d.getStartId()!=a&&d.getEndId()!=a||i.push(d.getData()))}e?e.removeChildNode(r):(t.ArrayUtils.removeItem(this._arRootIds,a),this.getNodesPane().removeChild(r)),t.ArrayUtils.removeItem(this._arNodeIds,a),delete this._nodes[a]}this._removeLinks(i)}},t.Diagram.prototype._removeLinks=function(e){if(e&&0!=e.length)for(var o=0;o<e.length;o++){var i=e[o].id,n=this.getLinkById(i);if(n){n.getParent().removeChild(n);var a=this.getNodeById(n.getStartId()),r=this.getNodeById(n.getEndId());a&&a.removeOutLinkId(i),r&&r.removeInLinkId(i),t.ArrayUtils.removeItem(this._arLinkIds,i),delete this._links[i]}else if(this._linkToPromotedMap&&this._linkToPromotedMap[i]){var s=this._linkToPromotedMap[i],d=this._links[s],l=d?d.getData()._links:null;if(l&&1==l.length&&l[0].id==i){d.getParent().removeChild(d);a=this.getNodeById(d.getStartId()),r=this.getNodeById(d.getEndId());a&&a.removeOutLinkId(s),r&&r.removeInLinkId(s),t.ArrayUtils.removeItem(this._arLinkIds,d.getId()),delete this._links[d.getId()],delete this._promotedLinksMap[d.getId()],delete this._linkToPromotedMap[i]}else if(l){for(o=0;o<l.length;o++)l[o].id==i&&l.splice(o,1);delete this._linkToPromotedMap[i]}}}},t.Bundle.addDefaultStrings(t.Bundle.DIAGRAM_PREFIX,{PROMOTED_LINK:"{0} link",PROMOTED_LINKS:"{0} links",PROMOTED_LINK_ARIA_DESC:"Indirect"});var o=function(t,e){o.superclass.constructor.call(this,t,e),this.setHoverDelay(o._HOVER_DELAY),this._diagram=e};t.Obj.createSubclass(o,t.CategoryRolloverHandler,"DvtDiagramCategoryRolloverHandler"),o._HOVER_DELAY=100,o.prototype.GetRolloverCallback=function(e,o,i,n){return t.Obj.createCallback(this,function(){this.SetHighlightMode(!0),this._diagram.processEvent(e)})},o.prototype.GetRolloutCallback=function(e,o,i,n){return t.Obj.createCallback(this,function(){this.SetHighlightModeTimeout(),this._diagram.processEvent(e)})};var i=function(){this.Init({skyros:i.VERSION_1,alta:i.SKIN_ALTA})};t.Obj.createSubclass(i,t.BaseComponentDefaults,"DvtDiagramDefaults"),i.VERSION_1={skin:t.CSSStyle.SKIN_ALTA,emptyText:null,selectionMode:"none",animationOnDataChange:"none",animationOnDisplay:"none",maxZoom:1,highlightMatch:"all",nodeHighlightMode:"node",linkHighlightMode:"link",panning:"none",touchResponse:"auto",zooming:"none",promotedLinkBehavior:"lazy",_statusMessageStyle:new t.CSSStyle(t.BaseComponentDefaults.FONT_FAMILY_ALTA),dnd:{drag:{nodes:{},ports:{}},drop:{background:{},nodes:{},links:{},ports:{}}},styleDefaults:{animationDuration:500,hoverBehaviorDelay:200,_highlightAlpha:.1,nodeDefaults:{_containerStyle:new t.CSSStyle("border-color:#abb3ba;background-color:#f9f9f9;border-width:.5px;border-radius:1px;padding-top:20px;padding-left:20px;padding-bottom:20px;padding-right:20px;"),labelStyle:new t.CSSStyle(t.BaseComponentDefaults.FONT_FAMILY_ALTA_BOLD_12+"color:#383A47"),hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",icon:{width:10,height:10,fillPattern:"none",shape:"circle"}},linkDefaults:{startConnectorType:"none",endConnectorType:"none",width:1,_style:{_type:"solid"},hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",labelStyle:new t.CSSStyle(t.BaseComponentDefaults.FONT_FAMILY_ALTA_BOLD_12+"color:#383A47"),_hitDetectionOffset:10},promotedLink:{startConnectorType:"none",endConnectorType:"none",width:1,_style:{_type:"dot",strokeDasharray:"2,3"},color:"#778999",hoverInnerColor:"rgb(255,255,255)",hoverOuterColor:"rgba(0,0,0, .3)",selectionColor:"rgb(0,0,0)",_hitDetectionOffset:10}}},i.prototype.getNoCloneObject=function(){return{data:!0}},i.SKIN_ALTA={};var n=function(t,e,o){this.Init(t,e,o)};t.Obj.createSubclass(n,t.Obj,"DvtDiagramDataAnimationState"),n.prototype.Init=function(t,e,o){this._diagram=t,this._nodes=[],this._newNodes=[],this._links=[],this._newLinks=[],this._processedObjMap={},this.PanZoomMatrix=this._diagram.getPanZoomCanvas().getContentPane().getMatrix(),this.IsPartialUpdate=!(!e||!o),this.NodesMap=this._diagram.GetAllNodesMap(),this.LinksMap=this._diagram.GetAllLinksMap(),this._setNodes(e,o),this._setLinks(e,o)},n.prototype.getId=function(){return this._diagram.getId()},n.prototype.getOptions=function(){return this._diagram.getOptions()},n.prototype.getNodes=function(){return this._nodes},n.prototype.getLinks=function(){return this._links},n.prototype.getNewNodes=function(){return this._newNodes},n.prototype.getNewLinks=function(){return this._newLinks},n.prototype.updateStateFromEvent=function(t,e){if(e){var o,i,n,a=e.data.nodes,r=e.data.links;if("add"==t){for(o=0;a&&o<a.length;o++){var s=this._diagram.getNodeById(a[o].id);s&&(!0===this._wasParentDisclosed&&this._newNodes.push(s),this._processedObjMap[s.getId()]=!0)}for(o=0;r&&o<r.length;o++)n=r[o].id,(i=this._diagram.getLinkById(n)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[n]))&&(this._newLinks.push(i),this._processedObjMap[i.getId()]=!0)}else if("change"==t)for(o=0;r&&o<r.length;o++)n=r[o].id,(i=this._diagram.getLinkById(n)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[n]))&&(this._newLinks.push(i),this._processedObjMap[i.getId()]=!0)}},n.prototype.updateStateFromLayoutContext=function(t){if(this.IsPartialUpdate){var e=t.getDirtyContext();for(var o in e)if(!this._processedObjMap[o]&&!this._processedObjMap[o]){var i=this._diagram.getNodeById(o)||this._diagram.getLinkById(o);i instanceof l?(this._nodes.push(i.getAnimationState()),this._newNodes.push(i),this._processedObjMap[o]=!0):i instanceof d&&(this._links.push(i.getAnimationState()),this._newLinks.push(i),this._processedObjMap[o]=!0)}}},n.prototype._setNodes=function(t,e){if(this.IsPartialUpdate){var o=e.data.nodes,i=e.parentId;if("add"==t)this._addAncestorStates(i);else if("change"==t)for(var n=0;o&&n<o.length;n++){(a=this._diagram.getNodeById(o[n].id))&&(this._addAncestorStates(a.getGroupId()),this._nodes.push(a.getAnimationState()),this._newNodes.push(a),this._processedObjMap[a.getId()]=!0)}else if("remove"==t&&(this._addAncestorStates(i),o&&!i))for(n=0;n<o.length;n++){var a;(a=this._diagram.getNodeById(o[n].id))&&(this._nodes.push(a),this._processedObjMap[a.getId()]=!0)}}else this._nodes=this._diagram.GetRootNodeObjects()},n.prototype._setLinks=function(t,e){if(this.IsPartialUpdate){var o,i,n,a=e.data.links;if(!a)return;if("change"==t)for(o=0;o<a.length;o++)n=a[o].id,(i=this._diagram.getLinkById(n)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[n]))&&(this._links.push(i.getAnimationState()),this._processedObjMap[i.getId()]=!0);else if("remove"==t)for(o=0;o<a.length;o++)n=a[o].id,(i=this._diagram.getLinkById(n)||this._diagram._linkToPromotedMap&&this._diagram.getLinkById(this._diagram._linkToPromotedMap[n]))&&(this._links.push(i),this._processedObjMap[i.getId()]=!0)}else this._links=this._diagram.GetAllLinkObjects()},n.prototype._addAncestorStates=function(t){var e=t?this._diagram.getNodeById(t):null;for(this._wasParentDisclosed=!e||e.isDisclosed();e;){var o=e.getId()===t||e.isDisclosed()&&this._diagram.getOptions().renderer,i=e.getAnimationState(o);this._nodes.push(i),this._newNodes.push(e),this._processedObjMap[e.getId()]=!0,e=e.getGroupId()?this._diagram.getNodeById(e.getGroupId()):null}}
;var a=function(t,e,o,i){this.Init(t,e,o,i)};t.Obj.createSubclass(a,t.DataAnimationHandler,"DvtDiagramDataAnimationHandler"),a.DELETE=0,a.UPDATE=1,a.INSERT=2,a.prototype.Init=function(t,e,o,i){a.superclass.Init.call(this,t,e),this._oldDiagram=o,this._newDiagram=i},a.prototype.getOldDiagram=function(){return this._oldDiagram},a.prototype.getNewDiagram=function(){return this._newDiagram},a.prototype.getAnimationDuration=function(){return e.getAnimationDuration(this._oldDiagram)},a.prototype.constructAnimation=function(e,o){var i=!1;if(o&&o.length>0&&(i=o[0]instanceof d),i&&!this.getCtx().isOffscreen()){var n,r,s=a._expandLinksArrayToMap(e),l=a._expandLinksArrayToMap(o),h={};for(var g in s)if(n=s[g],r=l[g])if(!n.isPromoted()&&!r.isPromoted()||n.isPromoted()&&r.isPromoted()&&n.getId()==r.getId())r.animateUpdate(this,n);else{var p=n.isPromoted()?n.getData()._links.length:1,u=r.isPromoted()?r.getData()._links.length:1;p>u&&!h[n.getId()]?this._constructExpandCollapseAnimation(n,l,h,!0):p<u&&!h[r.getId()]?this._constructExpandCollapseAnimation(r,s,h,!1):p==u&&r.animateUpdate(this,n)}else-1==t.ArrayUtils.getIndex(this.getNewDiagram().GetAllLinks(),n.getId())&&n.animateDelete(this);for(var g in l)n=s[g],r=l[g],n||this.getOldDiagram().LinksMap[r.getId()]||r.animateInsert(this)}else a.superclass.constructAnimation.call(this,e,o)},a.prototype._constructExpandCollapseAnimation=function(e,o,i,n){for(var a=[],r=e.getData()._links,s=0;s<r.length;s++){var d=o[r[s].id];d&&-1===t.ArrayUtils.getIndex(a,d)&&a.push(d)}a.length>0&&(n?e.animateExpand(this,a):e.animateCollapse(this,a),i[e.getId()]=!0)},a._expandLinksArrayToMap=function(t){for(var e={},o=0;o<t.length;o++){var i=t[o];if(i)if(i.isPromoted())for(var n=i.getData()._links,a=0;a<n.length;a++)e[n[a].id]=i;else e[i.getId()]=i}return e};var r=function(t,e,o){this.Init(t,e,o),this._diagram=o,this._linkDragSelector=null,this._linkDropSelector=null};t.Obj.createSubclass(r,t.EventManager,"DvtDiagramEventManager"),r.prototype.showFocusEffect=function(t,e){this.ShowFocusEffect(t,e)},r.prototype.ShowFocusEffect=function(t,e){this._diagram.isPanning()||r.superclass.ShowFocusEffect.call(this,t,e)},r.prototype.ProcessRolloverEvent=function(e,o,i){var n=this._diagram.getOptions();if("dim"==n.hoverBehavior){var a=o.getCategories?o.getCategories():[];n.highlightedCategories=i?a.slice():null;var r=t.EventFactory.newCategoryHighlightEvent(n.highlightedCategories,i),s=t.StyleUtils.getTimeMilliseconds(n.styleDefaults.hoverBehaviorDelay);this.RolloverHandler.processEvent(r,this._diagram.GetAllNodeObjects(),s,"any"==n.highlightMatch)}},r.prototype.CreateCategoryRolloverHandler=function(t,e){return new o(t,e)},r.prototype.ProcessKeyboardEvent=function(e){var o=!0,i=e.keyCode,n=this.getFocus(),a=n instanceof l?n._customNodeContent:null;return i!=t.KeyboardEvent.TAB&&this._bPassOnEvent?(a.fireKeyboardListener(e),e.preventDefault()):i==t.KeyboardEvent.TAB&&a instanceof t.BaseComponent?!e.shiftKey&&n.isShowingKeyboardFocusEffect()?(n.hideKeyboardFocusEffect(),a.fireKeyboardListener(e),e.preventDefault(),this._bPassOnEvent=!0):e.shiftKey&&this._bPassOnEvent?(this.ShowFocusEffect(e,n),e.preventDefault(),this._bPassOnEvent=!1):(this._bPassOnEvent&&n.showKeyboardFocusEffect(),o=r.superclass.ProcessKeyboardEvent.call(this,e),this._bPassOnEvent=!1):i==t.KeyboardEvent.SPACE&&e.ctrlKey&&e.shiftKey?n&&n.HandleKeyboardEvent&&n.HandleKeyboardEvent(e):(i==t.KeyboardEvent.TAB&&n&&this._diagram.ensureObjInViewport(e,n),o=r.superclass.ProcessKeyboardEvent.call(this,e)),o},r.prototype.GetTouchResponse=function(){var e=this._diagram.getOptions();return"none"!==e.panning||"none"!==e.zooming?t.EventManager.TOUCH_RESPONSE_TOUCH_HOLD:e.touchResponse===t.EventManager.TOUCH_RESPONSE_TOUCH_START?t.EventManager.TOUCH_RESPONSE_TOUCH_START:t.EventManager.TOUCH_RESPONSE_AUTO},r.prototype.HandleTouchClickInternal=function(e){return this.GetEventInfo(e,t.PanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY)},r.prototype.StoreInfoByEventType=function(e){return e!=t.PanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY&&r.superclass.StoreInfoByEventType.call(this,e)},r.prototype.getComponent=function(){return this._diagram},r.prototype.isDndSupported=function(){return!0},r.prototype.GetDragSourceType=function(t){var e,o=this.DragSource.getDragObject();return o&&o.__dragType?o.__dragType:o instanceof l?(null===this._linkDragSelector&&(this._linkDragSelector=this._diagram.getOptions().dnd.drag.ports.selector),this._linkDragSelector&&(e=this._getPortElement(document.elementFromPoint(t.getNativeEvent().clientX,t.getNativeEvent().clientY),this._linkDragSelector))&&(this.LinkCreationStarted=!0,o.__dragPort=e),o.__dragType=e?"ports":"nodes",o.__dragType):null},r.prototype.GetDragDataContexts=function(){var e=this.DragSource.getDragObject();if(this._diagram.isSelectionSupported()&&this._diagram.getSelectionHandler().getSelectedCount()>1){for(var o=this._diagram.getSelectionHandler().getSelection(),i=this._getTopLeftContentCorner(o),n=this._diagram.getPanZoomCanvas().getZoom(),a=[],r=0;r<o.length;r++)if(o[r]instanceof l){var s=o[r].getDataContext(),d=o[r].getDimensions(this._context.getStage());s.nodeOffset=new t.Point((d.x-i.x)/n,(d.y-i.y)/n),a.push(s)}return a}return e instanceof l?"ports"===e.__dragType&&e.__dragPort?{dataContext:e.getDataContext(),portElement:e.__dragPort}:((s=e.getDataContext()).nodeOffset=new t.Point(0,0),[s]):[]},r.prototype.GetDropOffset=function(e){var o;if(this._diagram.isSelectionSupported()&&this._diagram.getSelectionHandler().getSelectedCount()>1)o=this._getTopLeftContentCorner(this._diagram.getSelectionHandler().getSelection());else{var i=this.DragSource.getDragObject();i instanceof l&&(o=i.getDimensions(this._context.getStage()))}if(o){var n=this._context.pageToStageCoords(e.pageX,e.pageY),a=this._diagram.getPanZoomCanvas().getZoom();return new t.Point((o.x-n.x)/a,(o.y-n.y)/a)}return null},r.prototype._getTopLeftContentCorner=function(e){if(!e)return null;for(var o=Number.MAX_VALUE,i=Number.MAX_VALUE,n=0;n<e.length;n++)if(e[n]instanceof l){var a=e[n].getDimensions(this._context.getStage());o=a?Math.min(a.x,o):o,i=a?Math.min(a.y,i):i}return new t.Point(o,i)},r.prototype.OnDndDragStart=function(t){var e=this.DragSource.getDragObject();e&&e.__dragType&&(e.__dragType=null,e.__dragPort=null),this.LinkCreationStarted=!1,r.superclass.OnDndDragStart.call(this,t)},r.prototype.OnDndDragOver=function(t){r.superclass.OnDndDragOver.call(this,t),this.LinkCreationStarted&&this._diagram.ShowLinkCreationFeedback(t)},r.prototype.OnDndDragEnd=function(t){r.superclass.OnDndDragEnd.call(this,t),this.LinkCreationStarted&&(this._diagram.HideLinkCreationFeedback(),this.LinkCreationStarted=!1),this._diagram.getPanZoomCanvas().panZoomEnd(),this._setPanningEnabled(!0)},r.prototype._setPanningEnabled=function(t){this._diagram.IsPanningEnabled()&&this._diagram.getPanZoomCanvas().setPanningEnabled(t)},r.prototype.IsDragSupported=function(){if(!this._isDragSupported){var t=this._diagram.getOptions();this._isDragSupported=this.isDndSupported()&&(t.dnd.drag.nodes.dataTypes||t.dnd.drag.ports.dataTypes)}return this._isDragSupported},r.prototype.OnMouseDown=function(t){var e=this.GetLogicalObject(this.GetCurrentTargetForEvent(t));this.IsDragSupported()&&e instanceof l&&this._setPanningEnabled(!1),r.superclass.OnMouseDown.call(this,t)},r.prototype.OnMouseUp=function(t){r.superclass.OnMouseUp.call(this,t),this._setPanningEnabled(!0)},r.prototype.HandleImmediateTouchStartInternal=function(t){this.IsDragSupported()&&1==t.targetTouches.length&&(this.GetLogicalObject(this.GetCurrentTargetForEvent(t))instanceof l&&this._setPanningEnabled(!1))},r.prototype.HandleImmediateTouchEndInternal=function(t){this.IsDragSupported()&&this._setPanningEnabled(!0)},r.prototype.GetDropTargetType=function(t){var e,o=this.GetLogicalObject(this.GetCurrentTargetForEvent(t));return this._diagram.getCache().putToCache("dropTarget",o),null===o?"background":o instanceof l?(null===this._linkDropSelector&&(this._linkDropSelector=this._diagram.getOptions().dnd.drop.ports.selector),this._linkDropSelector&&(e=this._getPortElement(t.getNativeEvent().target,this._linkDropSelector)),o.__dropPort=e,e?"ports":"nodes"):o instanceof d?"links":null},r.prototype.GetDropEventPayload=function(e){var o=e.getNativeEvent().dataTransfer,i=Number(o.getData(t.EventManager.DROP_OFFSET_X_DATA_TYPE))||0,n=Number(o.getData(t.EventManager.DROP_OFFSET_Y_DATA_TYPE))||0,a=this._diagram.getPanZoomCanvas().getContentPane().stageToLocal(this.getCtx().pageToStageCoords(e.pageX,e.pageY)),r=this._diagram.getLayoutOffset(),s={x:a.x-r.x+i,y:a.y-r.y+n},h=this.GetLogicalObject(this.GetCurrentTargetForEvent(e));if(h instanceof l){h.__dropPort?(s.dataContext=h.getDataContext(),s.portElement=h.__dropPort):s.nodeContext=h.getDataContext();var g=h.getDimensions(this._context.getStage()),p=g?this._diagram.getPanZoomCanvas().getContentPane().stageToLocal({x:g.x,y:g.y}):null;s.nodeX=p?a.x-p.x+i:null,s.nodeY=p?a.y-p.y+n:null}else h instanceof d&&(s.linkContext=h.getDataContext());return s},r.prototype.ShowDropEffect=function(e){var o=this.GetDropTargetType(e),i=this._diagram.getCache().getFromCache("dropTarget");"background"===o?this._diagram.getPanZoomCanvas().getBackgroundPane().setClassName("oj-active-drop"):"nodes"===o||"links"===o?i&&i.ShowDropEffect&&i.ShowDropEffect():i&&"ports"===o&&i.__dropPort&&t.ToolkitUtils.addClassName(i.__dropPort,"oj-active-drop")},r.prototype.ShowRejectedDropEffect=function(e){var o=this.GetDropTargetType(e),i=this._diagram.getCache().getFromCache("dropTarget");"background"===o?this._diagram.getPanZoomCanvas().getBackgroundPane().setClassName("oj-invalid-drop"):"nodes"===o||"links"===o?i&&i.ShowRejectedDropEffect&&i.ShowRejectedDropEffect():i&&"ports"===o&&i.__dropPort&&t.ToolkitUtils.addClassName(i.__dropPort,"oj-invalid-drop")},r.prototype.ClearDropEffect=function(){this._diagram.getPanZoomCanvas().getBackgroundPane().setClassName(null);var e=this._diagram.getCache().getFromCache("dropTarget");e&&e.ClearDropEffect&&e.ClearDropEffect(),e&&e.__dropPort&&(t.ToolkitUtils.removeClassName(e.__dropPort,"oj-active-drop"),t.ToolkitUtils.removeClassName(e.__dropPort,"oj-invalid-drop")),this._diagram.getCache().putToCache("dropTarget",null)},r.prototype._getPortElement=function(t,e){return t&&t.closest?t.closest(e):null};var s=function(t,e){this.Init(t,e)};t.Obj.createSubclass(s,t.BaseDiagramKeyboardHandler,"DvtDiagramKeyboardHandler"),s.prototype.isNavigationEvent=function(e){var o=!1;switch(e.keyCode){case t.KeyboardEvent.OPEN_BRACKET:case t.KeyboardEvent.CLOSE_BRACKET:o=!0;break;case t.KeyboardEvent.OPEN_ANGLED_BRACKET:case t.KeyboardEvent.CLOSE_ANGLED_BRACKET:o=!!e.altKey;break;default:o=s.superclass.isNavigationEvent.call(this,e)}return o},s.prototype.processKeyDown=function(e){if(e.keyCode==t.KeyboardEvent.TAB){var o=this._eventManager.getFocus();if(o)return t.EventManager.consumeEvent(e),o;var i=this.GetDiagram().GetRootNodeObjects();if(i.length>0){t.EventManager.consumeEvent(e);var n=this.getDefaultNavigable(i);return this.GetDiagram().ensureObjInViewport(e,n),n}}return s.superclass.processKeyDown.call(this,e)},s.prototype.GetVisibleNode=function(t){return this.GetDiagram().getNodeById(t)};var d=function(t,e,o,i){this.Init(t,e,o,i)};t.Obj.createSubclass(d,t.BaseDiagramLink,"DvtDiagramLink"),d.CUSTOM_STYLE="customStyle",d.newInstance=function(t,e,o){return new d(t.getCtx(),t,e,o)},d.prototype.Init=function(e,o,i,n){d.superclass.Init.call(this,e,i.id,o),this._data=i,this.setPromoted(n),this.isSelectable()&&this.setCursor(t.SelectionEffectUtils.getSelectingCursor()),this.setGroupId(d._getCommonAncestorId(this,o))},d.prototype.getData=function(){return this._data},d.prototype.setData=function(t){this._data=t},d.prototype.getId=function(){return this.getData().id},d.prototype.getActiveElementId=function(){return this._activeElementId||(this._activeElementId=this.getId()+Math.floor(1e9*Math.random())),this._activeElementId},d.prototype.getStartId=function(){return this.getData().startNode},d.prototype.getEndId=function(){return this.getData().endNode},d.prototype.getLabelBounds=function(){var t=null;return this._labelObj&&(t=this._labelObj.getDimensions()),t},d.prototype.getLinkStyle=function(){return this.getData().svgStyle||this.getData().style},d.prototype.getLinkWidth=function(){return this.getData().width},d.prototype.getLinkColor=function(){return this.getData().color},d.prototype.getStartConnectorType=function(){return this.getData().startConnectorType},d.prototype.getEndConnectorType=function(){return this.getData().endConnectorType},d.prototype.getStartConnectorOffset=function(){return this.getStartConnectorType()?t.DiagramLinkConnectorUtils.getStandardConnectorOffset(this.getStartConnectorType(),this.GetAppliedLinkWidth(),this.GetAppliedLinkWidth()):0},d.prototype.getEndConnectorOffset=function(){return this.getEndConnectorType()?t.DiagramLinkConnectorUtils.getStandardConnectorOffset(this.getEndConnectorType(),this.GetAppliedLinkWidth(),this.GetAppliedLinkWidth()):0},d.prototype.render=function(){var t=this.GetDiagram(),e=this.getGroupId(),o=t.getNodeById(this.getStartId()).getGroupId(),i=t.getNodeById(this.getEndId()).getGroupId();if(e){var n=t.getNodeById(e).GetChildNodePane();e==o&&e==i?n.addChildAt(this,0):n.addChild(this)}else o||i?t.getNodesPane().addChild(this):t.getLinksPane().addChild(this);d._renderLinkLabels(t,this.getData(),this),this.setAriaRole("img"),this.UpdateAriaLabel(),this._diagram.getEventManager().associate(this,this)},d.prototype.setPoints=function(t){!this._pathCmds&&t&&d._renderLinkShape(this.GetDiagram(),this.getData(),this),d.superclass.setPoints.call(this,t)},d._renderLinkShape=function(e,o,i){var n=i._pathCmds;n||(n=["M",0,0,"L",0,0]);var a=o.id,r=o.color,s=o.width,l=o.svgStyle||o.style,h=o._hitDetectionOffset;i._hitDetectionUnderlay=i.CreateUnderlay("#000000",0,h),i.addChildAt(i._hitDetectionUnderlay,0);var g=new t.SolidStroke(r,1,s);g.setFixedWidth(!0);var p=new t.Path(i.getCtx(),n,a),u=o.svgClassName||o.className;if(p.setFill(null),p.setClassName(u),i.getCtx().isCustomElement())p.setStyle(l);else if(l&&l instanceof Object){var c=t.Stroke.SOLID;l._type==d.CUSTOM_STYLE?l.strokeDasharray&&(c=t.Stroke.DASHED,l.strokeDasharray=t.DiagramLinkUtils.processStrokeDashArray(l.strokeDasharray)):c=t.DiagramLinkUtils.ConvertLinkStyleToStrokeType(l._type),g.setType(c,l.strokeDasharray,l.strokeDashoffset);var y=t.JsonUtils.clone(l);t.ArrayUtils.forEach(["_type","strokeDasharray","strokeDashoffset"],function(t){delete y[t]}),p.setStyle(y)}else{c=t.DiagramLinkUtils.ConvertLinkStyleToStrokeType(l);g.setType(c,t.DiagramLinkUtils.GetStrokeDash(c),t.DiagramLinkUtils.GetStrokeDashOffset(c))}p.setStroke(g),i.setShape(p),i.addChildAt(p,1)},d._renderLinkLabels=function(e,o,i){var n=o.label;if(n){var a=t.Agent.isRightToLeft(e.getCtx()),r=n.indexOf("\n")>0,s=r?a?t.MultilineText.H_ALIGN_RIGHT:t.MultilineText.H_ALIGN_LEFT:a?t.OutputText.H_ALIGN_RIGHT:t.OutputText.H_ALIGN_LEFT,l=r?t.MultilineText.V_ALIGN_TOP:t.OutputText.V_ALIGN_TOP,h=d.createText(e.getCtx(),n,o.labelStyle,s,l,r),g=o.labelStyle.getMaxWidth()||o.labelStyle.getWidth(),p=t.CSSStyle.toNumber(g);g?p>0&&t.TextUtils.fitText(h,p,1/0,i)&&(i._labelObj=h):(i.addChild(h),i._labelObj=h)}},d.createText=function(e,o,i,n,a,r){var s;return i.hasBackgroundStyles()?s=r?new t.BackgroundMultilineText(e,o,0,0,i,null,!0):new t.BackgroundOutputText(e,o,0,0,i):(s=r?new t.MultilineText(e,o,0,0,null,!0):new t.OutputText(e,o,0,0)).setCSSStyle(i),s.setHorizAlignment(n),s.setVertAlignment(a),s},d.prototype.setSelected=function(t){d.superclass.setSelected.call(this,t),t?this._showFeedback(this._isShowingHoverEffect,!0):this._hideFeedback(),this.UpdateAriaLabel()},d.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&"off"!=this.getData().selectable},d.prototype._showFeedback=function(t,e){if(t){this._savedStroke||(this._savedStroke=this.getShape().getStroke());var o=this.getShape().getStroke().clone();o.setColor&&o.setColor(this.getData().hoverInnerColor),this.getShape().setStroke(o),this.ReplaceConnectorColor(this.getStartConnector(),o),this.ReplaceConnectorColor(this.getEndConnector(),o)}else this._savedStroke&&(this.getShape().setStroke(this._savedStroke),this.ReplaceConnectorColor(this.getStartConnector(),this._savedStroke),this.ReplaceConnectorColor(this.getEndConnector(),this._savedStroke),this._savedStroke=null);this._linkUnderlay||(this._linkUnderlay=this.CreateFeedbackUnderlay("#000000",1,0,this.getData().svgStyle,this.getData().svgClassName),this.addChildAt(this._linkUnderlay,0));var i=e?this.getData().selectionColor:this.getData().hoverOuterColor,n=this._linkUnderlay.getStroke().clone();n.setColor(i),n.setWidth(2+this.GetAppliedLinkWidth()),this.ApplyLinkStyle(n,!0),this._linkUnderlay.setStroke(n,2)},d.prototype._hideFeedback=function(){this._savedStroke&&(this.getShape().setStroke(this._savedStroke),this.ReplaceConnectorColor(this.getStartConnector(),this._savedStroke),this.ReplaceConnectorColor(this.getEndConnector(),this._savedStroke),this._savedStroke=null),this._linkUnderlay&&(this.removeChild(this._linkUnderlay),this._linkUnderlay.destroy&&this._linkUnderlay.destroy(),this._linkUnderlay=null)},d.prototype.ApplyLinkStyle=function(e,o){if(!this.getCtx().isCustomElement()){var i=this.GetAppliedLinkStyle();if(i&&i instanceof Object)if(i._type==d.CUSTOM_STYLE){var n=null!=i.strokeDashoffset?t.CSSStyle.toNumber(i.strokeDashoffset)+1:1;e.setType(t.Stroke.DASHED,t.DiagramLinkUtils.getCustomUnderlay(i.strokeDasharray),n)}else{var a=t.DiagramLinkUtils.ConvertLinkStyleToStrokeType(i._type);e.setType(a,t.DiagramLinkUtils.GetStrokeDash(a,o),t.DiagramLinkUtils.GetStrokeDashOffset(a,o))}else d.superclass.ApplyLinkStyle.call(this,e,o)}},d.prototype.showHoverEffect=function(){this._isShowingHoverEffect||(this._isShowingHoverEffect=!0,this._showFeedback(!0,this.isSelected()))},d.prototype.hideHoverEffect=function(){this.isSelected()?this._showFeedback(!1,!0):this._hideFeedback(),this._isShowingHoverEffect=!1},d.prototype.getDatatip=function(t,e,o){var i=this.GetDiagram().getOptions().tooltip,n=i?i.renderer:null;return n?this.GetDiagram().getCtx().getTooltipManager().getCustomTooltip(n,this.getDataContext()):this.getShortDesc()},d.prototype.getShortDesc=function(){return this.isPromoted()?this.getData()._links.length>1?t.Bundle.getTranslation(this.GetDiagram().getOptions(),"promotedLinks",t.Bundle.DIAGRAM_PREFIX,"PROMOTED_LINKS",this.getData()._links.length):t.Bundle.getTranslation(this.GetDiagram().getOptions(),"promotedLink",t.Bundle.DIAGRAM_PREFIX,"PROMOTED_LINK",this.getData()._links.length):this.getData().shortDesc},d.prototype.getDataContext=function(){return{id:this.getId(),type:this.isPromoted()?"promotedLink":"link",label:this.getData().label,data:this.isPromoted()?this.getData()._links:this.getData()._origData,component:this.GetDiagram().getOptions()._widgetConstructor}},d.prototype.getAriaLabel=function(){var e=[];return this.isSelectable()&&e.push(t.Bundle.getTranslatedString(t.Bundle.UTIL_PREFIX,this.isSelected()?"STATE_SELECTED":"STATE_UNSELECTED")),this.isPromoted()&&e.push(t.Bundle.getTranslatedString(t.Bundle.DIAGRAM_PREFIX,"PROMOTED_LINK_ARIA_DESC")),t.Displayable.generateAriaLabel(this.getShortDesc(),e)},d.prototype.UpdateAriaLabel=function(){if(!t.Agent.deferAriaCreation()){var e=this.getAriaLabel();e&&this.setAriaProperty("label",e)}},d.prototype.getNextNavigable=function(e){if(e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey)return this;if(e.keyCode==t.KeyboardEvent.UP_ARROW||e.keyCode==t.KeyboardEvent.DOWN_ARROW){(r=this.getKeyboardFocusNode())||(r=this.GetDiagram().getNodeById(this.getStartId()));var o=this,i=this.GetDiagram().getNavigableLinksForNodeId(r.getId()),n=this.GetDiagram().getEventManager().getKeyboardHandler();return n&&n.getNextNavigableLink&&(o=n.getNextNavigableLink(r,this,e,i)),o.setKeyboardFocusNode(r),this._diagram.ensureObjInViewport(e,o),o}if(e.keyCode==t.KeyboardEvent.RIGHT_ARROW||e.keyCode==t.KeyboardEvent.LEFT_ARROW){var a;a=this._movingToStart(e.keyCode)?this.getStartId():this.getEndId();var r=this.GetDiagram().getNodeById(a);return this._diagram.ensureObjInViewport(e,r),r}return e.type==t.MouseEvent.CLICK?this:null},d.prototype._movingToStart=function(e){var o=this.getLinkStart(),i=this.getLinkEnd(),n=o.x<i.x;return!(e==t.KeyboardEvent.RIGHT_ARROW&&n||e==t.KeyboardEvent.LEFT_ARROW&&!n)},d.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0,this.showHoverEffect()},d.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1,this.hideHoverEffect()},d.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},d.prototype.getCategories=function(){return this.getData().categories?this.getData().categories:[this.getId()]},d.prototype.isHidden=function(){var e=this.GetDiagram().getOptions().hiddenCategories;return!(!e||!t.ArrayUtils.hasAnyItem(e,this.getCategories()))||(!this.GetDiagram().getNodeById(this.getStartId())||!this.GetDiagram().getNodeById(this.getEndId()))},d.prototype.animateUpdate=function(e,o,i){var n=o.getPoints(),r=this.getPoints(),s=new t.CustomAnimation(this.getCtx(),null,e.getAnimationDuration());if(!t.ArrayUtils.equals(n,r)){this.setPoints(n);var d=t.Animator.TYPE_POLYLINE;r.length>0&&isNaN(r[0])&&(d=t.Animator.TYPE_PATH),s.getAnimator().addProp(d,this,this.getPoints,this.setPoints,r)}if(o._labelObj&&this._labelObj){var l=o._labelObj.getMatrix(),h=this._labelObj.getMatrix();l.equals(h)||(this._labelObj.setMatrix(l),s.getAnimator().addProp(t.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,h))}if(o.getShape()&&this.getShape()){var g=o.getShape().getStroke(),p=this.getShape().getStroke();g&&p&&g instanceof t.SolidStroke&&p instanceof t.SolidStroke&&(g.getColor()!=p.getColor()||g.getWidth()!=p.getWidth())&&(this.getShape().setStroke(g),s.getAnimator().addProp(t.Animator.TYPE_STROKE,this.getShape(),this.getShape().getStroke,this.getShape().setStroke,p))}if(i){var u=this;t.Playable.appendOnEnd(s,function(){u.getParent().removeChild(u)})}e.add(s,a.UPDATE)},d.prototype.animateDelete=function(e,o){this.GetDiagram().getLinksPane().addChild(this);var i=this,n=new t.AnimFadeOut(this.getCtx(),this,e.getAnimationDuration());t.Playable.appendOnEnd(n,function(){i.getParent().removeChild(i),i.destroy()}),e.add(n,a.DELETE)},d.prototype.animateInsert=function(e){this.setAlpha(0),e.add(new t.AnimFadeIn(this.getCtx(),this,e.getAnimationDuration()),a.INSERT)},d.prototype.animateCollapse=function(e,o){if(o&&0!=o.length){var i=t.ArrayUtils.copy(this.getPoints());this.animateUpdate(e,o[0]);for(var n=1;n<o.length;n++){var a={id:"_fakeLink"+n+this.getId()};a=t.JsonUtils.merge(a,this.getData());var r=new d(this.GetDiagram().getCtx(),this.GetDiagram(),a,!0);r.render(),r.setPoints(i),r.animateUpdate(e,o[n],!0)}}},d.prototype.animateExpand=function(t,e){if(e&&0!=e.length)for(var o=0;o<e.length;o++)e[o].animateUpdate(t,this)},d.prototype.setLabelAlignments=function(e,o){var i=this._labelObj instanceof t.MultilineText||this._labelObj instanceof t.BackgroundMultilineText;"baseline"==o&&(o=i?t.MultilineText.V_ALIGN_TOP:t.OutputText.V_ALIGN_AUTO),this._labelObj.setHorizAlignment(e),this._labelObj.setVertAlignment(o)},d.prototype.setGroupId=function(t){this._groupId=t},d.prototype.getGroupId=function(){return this._groupId},d._getCommonAncestorId=function(e,o){for(var i=function(t,e){for(var o=[],i=e.getNodeById(t)?e.getNodeById(t).getGroupId():null;i;)o.push(i),i=e.getNodeById(i)?e.getNodeById(i).getGroupId():null;return o},n=i(e.getStartId(),o),a=i(e.getEndId(),o),r=0;r<n.length;r++)if(t.ArrayUtils.getIndex(a,n[r])>-1)return n[r];return null},d.GetPromotedLinkId=function(t,e){return"_plL"+t+"_L"+e},d.prototype.ShowDropEffect=function(){this._dropEffect||this._createDropEffect("oj-diagram-link oj-active-drop")},d.prototype.ShowRejectedDropEffect=function(){this._dropEffect||this._createDropEffect("oj-diagram-link oj-invalid-drop")},d.prototype.ClearDropEffect=function(){this._dropEffect&&(this.removeChild(this._dropEffect),this._dropEffect=null)},d.prototype._createDropEffect=function(t){var e=this.getData()._hitDetectionOffset;this._dropEffect=this.CreateFeedbackUnderlay("#000000",0,e,null,t),this._dropEffect.setMouseEnabled(!1),this.addChild(this._dropEffect)},d.ConvertLinkData=function(t){return{id:t.id,startNode:t.startNode,endNode:t.endNode,label:t.label,selectable:t.selectable,shortDesc:t.shortDesc,categories:t.categories,_origData:t}},d.prototype.getAnimationState=function(){var t,e,o;this._labelObj&&((t={matrix:this._labelObj.getMatrix()}).getMatrix=function(){return t.matrix}),this.getShape()&&((e={stroke:this.getShape().getStroke().clone()}).getStroke=function(){return e.stroke});var i=this.isPromoted()?this.getData()._links:null;return(o={partialUpdate:!0,id:this.getId(),promoted:this.isPromoted(),includedLinks:i,points:this.getPoints(),shape:e,_labelObj:t}).getId=function(){return o.id},o.isPromoted=function(){return o.promoted},o.getData=function(){return{_links:o.includedLinks}},o.getPoints=function(){return o.points},o.getShape=function(){return o.shape},o};var l=function(t,e,o){this.Init(t,e,o)};t.Obj.createSubclass(l,t.BaseDiagramNode,"DvtDiagramNode"),l.newInstance=function(t,e){return new l(t.getCtx(),t,e)},l.prototype.Init=function(e,o,i){l.superclass.Init.call(this,e,i.id,o),this._data=i,this.isSelectable()&&this.setCursor(t.SelectionEffectUtils.getSelectingCursor())},l.prototype.getData=function(){return this._data},l.prototype.setData=function(t){this._data=t},l.prototype.getId=function(){return this._data.id},l.prototype.getActiveElementId=function(){return this._activeElementId||(this._activeElementId=this.getId()+Math.floor(1e9*Math.random())),this._activeElementId},l.prototype.getContentBounds=function(t){return!this._contentDims&&t&&(this._contentDims=this._calcContentDims()),this._contentDims},l.prototype.getLabelBounds=function(t){var e=null;return this._labelObj&&t&&(e=this._labelObj.getDimensions()),e},l.prototype.setSelected=function(t){var e=this._getState();l.superclass.setSelected.call(this,t),this._diagram.getOptions().selectionRenderer?this._applyCustomNodeContent(this._diagram.getOptions().selectionRenderer,this._getState(),e):this.processDefaultSelectionEffect(t),this.UpdateAriaLabel()},l.prototype.processDefaultSelectionEffect=function(t){this.getSelectionShape()&&this.getSelectionShape().setSelected(t)},l.prototype.isSelectable=function(){return this.GetDiagram().isSelectionSupported()&&"off"!=this.getData().selectable},l.prototype.GetIcon=function(){return this._shape},l.prototype.render=function(){this._cleanUp();var t=this.getData();if(this._diagram.getOptions().renderer){if(this._applyCustomNodeContent(this._diagram.getOptions().renderer,this._getState(),null),this.isDisclosed()){var e=this.GetDiagram().getPanZoomCanvas().getZoom(),o=this.getElem().getBoundingClientRect(),i=this._childNodePane?this._childNodePane.getElem().getBoundingClientRect():null;this._containerPadding={left:(i.left-o.left)/e,right:(o.right-i.right)/e,top:(i.top-o.top)/e,bottom:(o.bottom-i.bottom)/e}}this._selectionShape&&(this.removeChild(this._selectionShape),this._selectionShape=null)}else this.isDisclosed()?l._renderContainer(this._diagram,t,this):(l._renderNodeBackground(this._diagram,t,this),l._renderNodeIcon(this._diagram,t,this)),l._addHoverSelectionDefaultStrokes(this.getSelectionShape(),t);l._renderNodeLabels(this._diagram,t,this),this._setDraggableStyleClass(),l._renderContainerButton(this._diagram,t,this),this.setAriaRole("img"),this.UpdateAriaLabel(),this._diagram.getEventManager().associate(this,this)},l.prototype._applyCustomNodeContent=function(e,o,i){var n=this._diagram.getOptions()._contextHandler;if(n){var a=this.getData()._origData,r=null;if(this.isDisclosed()){var s=this.GetChildNodePane(),d=s.getDimensions();r={element:s.getElem(),w:d?d.w-d.x:null,h:d?d.h-d.y:null}}var l=e(n(this.getElem(),this._customNodeContent,r,a,o,i));!l&&this._customNodeContent&&this.getCtx().isCustomElement()||(this._customNodeContent&&l!=this._customNodeContent&&(this._customNodeContent.namespaceURI===t.ToolkitUtils.SVG_NS?this.getContainerElem().removeChild(this._customNodeContent):this.removeChild(l),this._customNodeContent=null),l&&l.namespaceURI===t.ToolkitUtils.SVG_NS?this._customNodeContent||(t.ToolkitUtils.appendChildElem(this.getContainerElem(),l),this._customNodeContent=l):l instanceof t.BaseComponent?this._customNodeContent||(this.addChild(l),this._customNodeContent=l):l&&this._diagram.Log("dvt.Diagram: could not add custom node content for the node "+this.getId()+l,1))}else this._diagram.Log("dvt.Diagram: could not add custom node content - context handler is undefined",1)},l._renderNodeBackground=function(e,o,i){if(!e.getCtx().isCustomElement()){var n=o.backgroundSvgStyle||o.backgroundStyle,a=t.JsonUtils.clone(n),r=[t.CSSStyle.WIDTH,t.CSSStyle.HEIGHT,t.CSSStyle.BACKGROUND_COLOR,t.CSSStyle.BORDER_COLOR,t.CSSStyle.BORDER_WIDTH,t.CSSStyle.BORDER_RADIUS];if(!(n=l._getNodeCSSStyle(a,o._backgroundStyle,r)).isEmpty()){var s=t.CSSStyle.toNumber(n.getStyle(t.CSSStyle.WIDTH)),d=t.CSSStyle.toNumber(n.getStyle(t.CSSStyle.HEIGHT)),h=n.getStyle(t.CSSStyle.BACKGROUND_COLOR),g=n.getStyle(t.CSSStyle.BORDER_COLOR),p=t.CSSStyle.toNumber(n.getStyle(t.CSSStyle.BORDER_WIDTH)),u=t.CSSStyle.toNumber(n.getStyle(t.CSSStyle.BORDER_RADIUS)),c=new t.Rect(e.getCtx(),0,0,s,d);c.setSolidFill(h),u&&(c.setRx(u),c.setRy(u)),g&&c.setStroke(new t.SolidStroke(g,1,p)),a&&t.ArrayUtils.forEach(r,function(e){delete a[t.CSSStyle.cssStringToObjectProperty(e)]});var y=o.backgroundSvgClassName||o.backgroundClassName;c.setStyle(a).setClassName(y),i.addChild(c),i.setSelectionShape(c),i._background=c}}},l._renderNodeIcon=function(e,o,i){var n=o.icon;if(n){var a,r=n.width,s=n.height,d=n.color,h=n.borderRadius;a=n.source?new t.ImageMarker(e.getCtx(),r/2,s/2,r,s,h,n.source,n.sourceSelected,n.sourceHover,n.sourceHoverSelected):new t.SimpleMarker(e.getCtx(),n.shape,t.CSSStyle.SKIN_ALTA,r/2,s/2,r,s,h),"none"!=n.fillPattern?a.setFill(new t.PatternFill(n.fillPattern,d,d)):a.setSolidFill(d),null!=n.opacity&&a.setAlpha(n.opacity),n.borderColor&&a.setStroke(new t.SolidStroke(n.borderColor,1,n.borderWidth));var g=n.svgStyle||n.style,p=n.svgClassName||n.className;a.setStyle(g).setClassName(p),i.addChild(a),i._shape=a,l._setIconPosition(e,o,i),i._background||i.setSelectionShape(a)}},l._setIconPosition=function(e,o,i){if(i._background){var n=o.icon,a=i._background.getWidth(),r=i._background.getHeight(),s=n.width,d=n.height,l=.5*(a-s),h=.5*(r-d);if(void 0!==n.positionX)l=parseFloat(n.positionX),t.Agent.isRightToLeft(i.getCtx())&&(l=a-l-s);else{var g=n.halign;"start"==g?g=t.Agent.isRightToLeft(i.getCtx())?"right":"left":"end"==g&&(g=t.Agent.isRightToLeft(i.getCtx())?"left":"right"),l="left"==g?0:"right"==g?a-s:l}void 0!==n.positionY?h=parseFloat(n.positionY):"top"==n.valign?h=0:"bottom"==n.valign&&(h=r-d),i._shape.setTranslate(l,h)}},l._renderNodeLabels=function(e,o,i){var n=o.label;if(n){var a=t.Agent.isRightToLeft(e.getCtx()),r=n.indexOf("\n")>0,s=r?a?t.MultilineText.H_ALIGN_RIGHT:t.MultilineText.H_ALIGN_LEFT:a?t.OutputText.H_ALIGN_RIGHT:t.OutputText.H_ALIGN_LEFT,d=r?t.MultilineText.V_ALIGN_TOP:t.OutputText.V_ALIGN_TOP,h=l.createText(e.getCtx(),n,o.labelStyle,s,d,r),g=o.labelStyle.getMaxWidth()||o.labelStyle.getWidth(),p=t.CSSStyle.toNumber(g);g?p>0&&t.TextUtils.fitText(h,p,1/0,i)&&(i._labelObj=h):(i.addChild(h),i._labelObj=h)}},l.createText=function(e,o,i,n,a,r){var s;return i.hasBackgroundStyles()?s=r?new t.BackgroundMultilineText(e,o,0,0,i,null,!0):new t.BackgroundOutputText(e,o,0,0,i):(s=r?new t.MultilineText(e,o,0,0,null,!0):new t.OutputText(e,o,0,0)).setCSSStyle(i),s.setHorizAlignment(n),s.setVertAlignment(a),s},l._addHoverSelectionDefaultStrokes=function(e,o){var i=o.hoverInnerColor,n=o.hoverOuterColor,a=o.selectionColor,r=new t.SolidStroke(i,1,4);r.setFixedWidth(!0)
;var s=new t.SolidStroke(n,1,8);s.setFixedWidth(!0);var d=new t.SolidStroke(i,1,2);d.setFixedWidth(!0);var l=new t.SolidStroke(a,1,6);l.setFixedWidth(!0);var h=new t.SolidStroke(i,1,4);h.setFixedWidth(!0);var g=new t.SolidStroke(a,1,8);g.setFixedWidth(!0),e.setHoverStroke(r,s).setSelectedStroke(d,l).setSelectedHoverStroke(h,g)},l._addHoverSelectionOuterStrokes=function(e,o){var i=o.hoverInnerColor,n=o.hoverOuterColor,a=o.selectionColor,r=new t.SolidStroke(i,1,2);r.setFixedWidth(!0);var s=new t.SolidStroke(n,1,2);s.setFixedWidth(!0);var d=new t.SolidStroke(i,1,1);d.setFixedWidth(!0);var l=new t.SolidStroke(a,1,2);l.setFixedWidth(!0);var h=new t.SolidStroke(i,1,2);h.setFixedWidth(!0);var g=new t.SolidStroke(a,1,2);g.setFixedWidth(!0),e.setHoverStroke(r,s).setSelectedStroke(d,l).setSelectedHoverStroke(h,g)},l.prototype.setSelectionShape=function(t){this._selectionShape=t},l.prototype.getSelectionShape=function(){if(!this._selectionShape){var e=this.getContentBounds(!0);if(e){var o=new t.Rect(this._diagram.getCtx(),e.x,e.y,e.w,e.h);o.setInvisibleFill(),o.setStrokeAlignment(t.Stroke.OUTER),this.setSelectionShape(o),this.addChildAt(o,0),l._addHoverSelectionOuterStrokes(o,this.getData()),this._selectionShape=o}}return this._selectionShape},l.prototype.showHoverEffect=function(){if(!this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!0,this._diagram.getOptions().hoverRenderer?this._applyCustomNodeContent(this._diagram.getOptions().hoverRenderer,this._getState(),t):this.processDefaultHoverEffect(!0)}},l.prototype.hideHoverEffect=function(){if(this._isShowingHoverEffect){var t=this._getState();this._isShowingHoverEffect=!1,this._diagram.getOptions().hoverRenderer?this._applyCustomNodeContent(this._diagram.getOptions().hoverRenderer,this._getState(),t):this.processDefaultHoverEffect(!1)}},l.prototype.processDefaultHoverEffect=function(t){this.getSelectionShape()&&(t?this.getSelectionShape().showHoverEffect():this.getSelectionShape().hideHoverEffect())},l.prototype.getDatatip=function(t,e,o){var i=this.GetDiagram().getOptions().tooltip,n=i?i.renderer:null;return n?this.GetDiagram().getCtx().getTooltipManager().getCustomTooltip(n,this.getDataContext()):this.getShortDesc()},l.prototype.getShortDesc=function(){return this.getData().shortDesc},l.prototype.getDataContext=function(){return{id:this.getId(),type:"node",label:this.getData().label,data:this.getData()._origData,component:this.GetDiagram().getOptions()._widgetConstructor}},l.prototype.getAriaLabel=function(){var e=[];return this.isSelectable()&&e.push(t.Bundle.getTranslatedString(t.Bundle.UTIL_PREFIX,this.isSelected()?"STATE_SELECTED":"STATE_UNSELECTED")),this.isContainer()&&e.push(this.isDisclosed()?t.Bundle.getTranslatedString(t.Bundle.UTIL_PREFIX,"STATE_EXPANDED"):t.Bundle.getTranslatedString(t.Bundle.UTIL_PREFIX,"STATE_COLLAPSED")),t.Displayable.generateAriaLabel(this.getShortDesc(),e)},l.prototype.UpdateAriaLabel=function(){if(!t.Agent.deferAriaCreation()){var e=this.getAriaLabel();e&&this.setAriaProperty("label",e)}},l.prototype.getNextNavigable=function(e){var o=null;if(e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey)o=this;else if((e.keyCode==t.KeyboardEvent.OPEN_ANGLED_BRACKET||t.KeyboardEvent.CLOSE_ANGLED_BRACKET)&&e.altKey){var i=this.GetDiagram().getNavigableLinksForNodeId(this.getId()),n=this.GetDiagram().getEventManager().getKeyboardHandler();n&&n.getFirstNavigableLink&&(o=n.getFirstNavigableLink(this,e,i)),o?o.setKeyboardFocusNode(this):o=this}else if(e.keyCode==t.KeyboardEvent.OPEN_BRACKET){if(this.isDisclosed())o=this.getChildNodes()[0];else o=this}else if(e.keyCode==t.KeyboardEvent.CLOSE_BRACKET){o=(a=this.getGroupId()?this.GetDiagram().getNodeById(this.getGroupId()):null)||this}else if(e.type==t.MouseEvent.CLICK)o=this;else{var a,r=(a=this.getGroupId()?this.GetDiagram().getNodeById(this.getGroupId()):null)?a.getChildNodes():this.GetDiagram().GetRootNodeObjects();o=t.KeyboardHandler.getNextAdjacentNavigable(this,e,r)}return e instanceof t.KeyboardEvent&&this._diagram.ensureObjInViewport(e,o),o},l.prototype.HandleKeyboardEvent=function(e){e.keyCode==t.KeyboardEvent.SPACE&&e.ctrlKey&&e.shiftKey&&this.isContainer()&&this.GetDiagram().setNodeDisclosed(this.getId(),!this.isDisclosed())},l.prototype.isContainer=function(){return 0!=this.GetDiagram().getOptions().data.getChildCount(this.getData())},l.prototype.showKeyboardFocusEffect=function(){if(!this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!0,this._diagram.getOptions().focusRenderer?this._applyCustomNodeContent(this._diagram.getOptions().focusRenderer,this._getState(),t):this.processDefaultFocusEffect(!0)}},l.prototype.hideKeyboardFocusEffect=function(){if(this.isShowingKeyboardFocusEffect()){var t=this._getState();this._isShowingKeyboardFocusEffect=!1,this._diagram.getOptions().focusRenderer?this._applyCustomNodeContent(this._diagram.getOptions().focusRenderer,this._getState(),t):this.processDefaultFocusEffect(!1)}},l.prototype.processDefaultFocusEffect=function(t){this.processDefaultHoverEffect(t)},l.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect},l.prototype.getCategories=function(){return this.getData().categories?this.getData().categories:[this.getId()]},l.prototype.isHidden=function(){var e=this.GetDiagram().getOptions().hiddenCategories;return!(!e||!t.ArrayUtils.hasAnyItem(e,this.getCategories()))},l.prototype._calcContentDims=function(){var e,o=null;this._customNodeContent?this._customNodeContent instanceof t.BaseComponent?(e=this._customNodeContent.getDimensions())&&(o=new t.Rectangle(e.x,e.y,e.w,e.h)):(e=this._customNodeContent.getBBox())&&(o=new t.Rectangle(e.x,e.y,e.width,e.height)):this.isDisclosed()?o=this._containerShape.GetDimensionsWithStroke(this):(o=this._background?this._background.GetDimensionsWithStroke(this):null)&&this._shape?o=o.getUnion(this._shape.GetDimensionsWithStroke(this)):!o&&this._shape&&(o=this._shape.GetDimensionsWithStroke(this));return o},l.prototype.animateUpdate=function(e,o){var i=new t.CustomAnimation(this.getCtx(),null,e.getAnimationDuration());if(this.isDisclosed()||o.isDisclosed())if(this.isDisclosed()&&o.isDisclosed()){if(o._labelObj&&this._labelObj){c=o._labelObj.getMatrix(),y=this._labelObj.getMatrix();c.equals(y)||(this._labelObj.setMatrix(c),i.getAnimator().addProp(t.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,y))}if(this._diagram.getOptions().renderer)this._animateCustomUpdate(e,o);else{if(l._animatePosition(i,o,this),l._animateContainer(i,o._containerShape,this._containerShape),t.Agent.isRightToLeft(this.getCtx())&&o._containerButton&&this._containerButton){var n=o._containerButton.getTranslateX(),r=this._containerButton.getTranslateX();n!=r&&(this._containerButton.setTranslateX(n),i.getAnimator().addProp(t.Animator.TYPE_NUMBER,this._containerButton,this._containerButton.getTranslateX,this._containerButton.setTranslateX,r))}if(!o.partialUpdate){for(var s=[],d=[],h=this.getChildNodeIds(),g=0;g<h.length;g++)s.push(this.GetDiagram().getNodeById(h[g]));var p=o.getChildNodeIds(),u=e.getOldDiagram().NodesMap;for(g=0;g<p.length;g++)d.push(u[p[g]]);e.constructAnimation(d,s)}}}else this._animateCustomUpdate(e,o);else{if(l._animatePosition(i,o,this),o._shape&&this._shape&&(i.getAnimator().addProp(t.Animator.TYPE_RECTANGLE,this._shape,this._shape.getCenterDimensions,this._shape.setCenterDimensions,this._shape.getCenterDimensions()),this._shape.setCenterDimensions(o._shape.getCenterDimensions())),o._labelObj&&this._labelObj){var c=o._labelObj.getMatrix(),y=this._labelObj.getMatrix();c.equals(y)||(this._labelObj.setMatrix(c),i.getAnimator().addProp(t.Animator.TYPE_MATRIX,this._labelObj,this._labelObj.getMatrix,this._labelObj.setMatrix,y))}l._animateFill(i,o._background,this._background),l._animateFill(i,o._shape,this._shape)}e.add(i,a.UPDATE)},l.prototype._animateCustomUpdate=function(e,o){var i=o.getContentBounds(),n=this.getContentBounds();if(i.equals(n)){var r=new t.CustomAnimation(this.getCtx(),null,e.getAnimationDuration());return l._animatePosition(r,o,this),void e.add(r,a.UPDATE)}var s=n.w/i.w,d=i.w/n.w,h=(r=new t.CustomAnimation(this.getCtx(),null,e.getAnimationDuration()),new t.Point(o.getTranslateX()+.5*i.w,o.getTranslateY()+.5*i.h)),g=this.getTranslateX(),p=this.getTranslateY();this.setTranslateX(h.x-n.w*d*.5),this.setTranslateY(h.y-n.w*d*.5),r.getAnimator().addProp(t.Animator.TYPE_NUMBER,this,this.getTranslateX,this.setTranslateX,g),r.getAnimator().addProp(t.Animator.TYPE_NUMBER,this,this.getTranslateY,this.setTranslateY,p),e.add(r,a.UPDATE),this.setScaleX(d),this.setScaleY(d);var u=new t.AnimScaleTo(this.getCtx(),this,new t.Point(1,1),e.getAnimationDuration());e.add(u,a.UPDATE);var c=o.partialUpdate?o.origContent:o;if(c){this.getParent().addChild(c);var y=new t.Point(this.getTranslateX()+.5*n.w,this.getTranslateY()+.5*n.h);r.getAnimator().addProp(t.Animator.TYPE_NUMBER,c,o.getTranslateX,c.setTranslateX,y.x-i.w*s*.5),r.getAnimator().addProp(t.Animator.TYPE_NUMBER,c,o.getTranslateY,c.setTranslateY,y.y-i.h*s*.5);var _=new t.AnimScaleTo(this.getCtx(),c,new t.Point(s,s),e.getAnimationDuration());e.add(_,a.UPDATE);var m=new t.AnimFadeOut(this.getCtx(),c,e.getAnimationDuration());e.add(m,a.UPDATE);var f=this;t.Playable.appendOnEnd(m,function(){f.getParent().removeChild(c)}),this.setAlpha(0);var C=new t.AnimFadeIn(this.getCtx(),this,e.getAnimationDuration());e.add(C,a.UPDATE)}},l._animatePosition=function(e,o,i){if(i&&o){var n=o.getTranslateX(),a=o.getTranslateY(),r=i.getTranslateX(),s=i.getTranslateY();n!=r&&(i.setTranslateX(n),e.getAnimator().addProp(t.Animator.TYPE_NUMBER,i,i.getTranslateX,i.setTranslateX,r)),a!=s&&(i.setTranslateY(a),e.getAnimator().addProp(t.Animator.TYPE_NUMBER,i,i.getTranslateY,i.setTranslateY,s))}},l._animateContainer=function(e,o,i){i&&o&&(l._animateFill(e,o,i),e.getAnimator().addProp(t.Animator.TYPE_NUMBER,i,i.getWidth,i.setWidth,i.getWidth()),i.setWidth(o.getWidth()),e.getAnimator().addProp(t.Animator.TYPE_NUMBER,i,i.getHeight,i.setHeight,i.getHeight()),i.setHeight(o.getHeight()))},l._animateFill=function(e,o,i){o&&i&&i.getFill()instanceof t.SolidFill&&!i.getFill().equals(o.getFill())&&(e.getAnimator().addProp(t.Animator.TYPE_FILL,i,i.getFill,i.setFill,i.getFill()),i.setFill(o.getFill()))},l.prototype.animateDelete=function(e,o){this.GetDiagram().getNodesPane().addChild(this);var i=this,n=new t.AnimFadeOut(this.getCtx(),this,e.getAnimationDuration());t.Playable.appendOnEnd(n,function(){i.getParent().removeChild(i),i.destroy()}),e.add(n,a.DELETE)},l.prototype.animateInsert=function(e){this.setAlpha(0),e.add(new t.AnimFadeIn(this.getCtx(),this,e.getAnimationDuration()),a.INSERT)},l.prototype._getState=function(t){return{hovered:this._isShowingHoverEffect,selected:this.isSelected(),focused:this._isShowingKeyboardFocusEffect,zoom:t||this.GetDiagram().getPanZoomCanvas().getZoom(),expanded:this.isDisclosed()}},l.prototype.rerenderOnZoom=function(t){if(this._diagram.getOptions().zoomRenderer){var e=this._getState(t.getOldZoom()),o=this._getState(t.getNewZoom());this._applyCustomNodeContent(this._diagram.getOptions().zoomRenderer,o,e)}},l.prototype.setLabelAlignments=function(e,o){var i=this._labelObj instanceof t.MultilineText||this._labelObj instanceof t.BackgroundMultilineText;"baseline"==o&&(o=i?t.MultilineText.V_ALIGN_TOP:t.OutputText.V_ALIGN_AUTO),this._labelObj.setHorizAlignment(e),this._labelObj.setVertAlignment(o)},l.prototype.getContainerPadding=function(){if(!this._containerPadding&&this._diagram.getOptions().renderer){var t=this.GetDiagram().getPanZoomCanvas().getZoom(),e=this.getElem().getBoundingClientRect(),o=this._childNodePane?this._childNodePane.getElem().getBoundingClientRect():null;this._containerPadding={left:(o.left-e.left)/t,right:(e.right-o.right)/t,top:(o.top-e.top)/t,bottom:(e.bottom-o.bottom)/t}}else if(!this._containerPadding){var i=this._data.containerSvgStyle||this._data.containerStyle,n=l._getNodeCSSStyle(i,this._data._containerStyle,["padding-left","padding-right","padding-top","padding-bottom"]);this._containerPadding={left:n.getPadding("padding-left"),right:n.getPadding("padding-right"),top:n.getPadding("padding-top"),bottom:n.getPadding("padding-bottom")}}return this._containerPadding},l.prototype.getChildNodeIds=function(){return this._childNodeIds},l.prototype.addChildNodeId=function(t){this._childNodeIds||(this._childNodeIds=[]),this._childNodeIds.push(t)},l.prototype.removeChildNodeId=function(e){this._childNodeIds&&t.ArrayUtils.removeItem(this._childNodeIds,e)},l.prototype.removeChildNode=function(t){t&&(this.removeChildNodeId(t.getId()),this._childNodePane.removeChild(t))},l.prototype.getChildNodes=function(){for(var t=[],e=this._childNodeIds?this._childNodeIds.length:-1,o=0;o<e;o++){var i=this.GetDiagram().getNodeById(this._childNodeIds[o]);i&&t.push(i)}return t},l.prototype.setGroupId=function(t){this._groupId=t},l.prototype.getGroupId=function(){return this._groupId},l.prototype.GetChildNodePane=function(){return this._childNodePane||(this._childNodePane=new t.Container(this.getCtx()),this.addChild(this._childNodePane)),this._childNodePane},l.prototype.handleDisclosure=function(e){t.EventManager.consumeEvent(e),this._diagram.setNodeDisclosed(this.getId(),!this.isDisclosed())},l._renderContainer=function(e,o,i){var n=e.getCtx().isCustomElement()?null:o.containerSvgStyle||o.containerStyle,a=t.JsonUtils.clone(n),r=[t.CSSStyle.BACKGROUND_COLOR,t.CSSStyle.BORDER_COLOR,t.CSSStyle.BORDER_WIDTH,t.CSSStyle.BORDER_RADIUS],s=l._getNodeCSSStyle(a,o._containerStyle,r),d=s.getStyle(t.CSSStyle.BACKGROUND_COLOR),h=s.getStyle(t.CSSStyle.BORDER_COLOR),g=t.CSSStyle.toNumber(s.getStyle(t.CSSStyle.BORDER_WIDTH)),p=t.CSSStyle.toNumber(s.getStyle(t.CSSStyle.BORDER_RADIUS)),u=i.GetChildNodePane(),c=i.getContainerPadding();u.setTranslate(c.left,c.top);var y=u.getDimensionsWithStroke(),_=new t.Rect(e.getCtx(),0,0,y.w+c.left+c.right,y.h+c.top+c.bottom);_.setSolidFill(d),p&&(_.setRx(p),_.setRy(p)),h&&_.setStroke(new t.SolidStroke(h,1,g)),a&&t.ArrayUtils.forEach(r,function(e){delete a[t.CSSStyle.cssStringToObjectProperty(e)]});var m=e.getCtx().isCustomElement()?null:o.containerSvgClassName||o.containerClassName;_.setStyle(a).setClassName(m),i.addChildAt(_,0),i.setSelectionShape(_),i._containerShape=_},l._getNodeCSSStyle=function(e,o,i){var n=new t.CSSStyle;return t.ArrayUtils.forEach(i,function(i){var a=null,r=t.CSSStyle.cssStringToObjectProperty(i);e&&null!=e[r]?a=e[r]:o&&(a=o.getStyle(i)),n.setStyle(i,a)}),n},l._renderContainerButton=function(e,o,i){if(i.isContainer()&&"off"!=o.showDisclosure){var n,a,r,s=e.getOptions();i.isDisclosed()?(n=s._resources.collapse_ena,a=s._resources.collapse_ovr,r=s._resources.collapse_dwn):(n=s._resources.expand_ena,a=s._resources.expand_ovr,r=s._resources.expand_dwn);var d=new t.Image(e.getCtx(),n.src,0,0,n.width,n.height),l=new t.Image(e.getCtx(),a.src,0,0,a.width,a.height),h=new t.Image(e.getCtx(),r.src,0,0,r.width,r.height),g=new t.Button(e.getCtx(),d,l,h,null,null,i.handleDisclosure,i);i.addChild(g);var p=i.getContentBounds(!0);if(p){var u=t.Agent.isRightToLeft(e.getCtx())?p.x+p.w-n.width:p.x,c=p.y;g.setTranslate(u,c)}i._containerButton=g}},l.prototype.isDragAvailable=function(t){return!0},l.prototype.getDragTransferable=function(t,e){return"off"===this.getData().draggable?null:[this.getId()]},l.prototype.getDragFeedback=function(t,e){if(this._diagram.getEventManager().LinkCreationStarted)return null;if(this._diagram.isSelectionSupported()&&this._diagram.getSelectionHandler().getSelectedCount()>1){for(var o=this._diagram.getSelectionHandler().getSelection(),i=[],n=0;n<o.length;n++)i.push(o[n]);return i}return this},l.prototype.ShowDropEffect=function(){this._dropEffect||this._createDropEffect("oj-diagram-node oj-active-drop")},l.prototype.ShowRejectedDropEffect=function(){this._dropEffect||this._createDropEffect("oj-diagram-node oj-invalid-drop")},l.prototype.ClearDropEffect=function(){this._dropEffect&&(this.removeChild(this._dropEffect),this._dropEffect=null)},l.prototype._createDropEffect=function(e){var o;if(this._customNodeContent||this.isDisclosed()||this._background||this._shape&&this._shape instanceof t.ImageMarker){var i=this.getContentBounds(!0);if(i){o=new t.Rect(this._diagram.getCtx(),i.x,i.y,i.w,i.h);var n=this._customNodeContent?null:this.isDisclosed()?this._containerShape.getRx():this._background?this._background.getRx():null;n&&(o.setRx(n),o.setRy(n))}}else this._shape&&this._shape instanceof t.SimpleMarker&&(o=this._shape.copyShape());o.setInvisibleFill(),o.setClassName(e),o.setMouseEnabled(!1),this.addChild(o),this._dropEffect=o},l.prototype._setDraggableStyleClass=function(){if(this._diagram.getEventManager().IsDragSupported()&&"off"!=this.getData().draggable){var e=this._customNodeContent?this:this.isDisclosed()?this._containerShape:this._background?this._background:this._shape,o=e.getElem()?e.getElem():e;t.ToolkitUtils.addClassName(o,"oj-diagram-node"),t.ToolkitUtils.addClassName(o,"oj-draggable")}},l.ConvertNodeData=function(t){return{id:t.id,label:t.label,selectable:t.selectable,shortDesc:t.shortDesc,categories:t.categories,nodes:t.nodes,_origData:t}},l.prototype._cleanUp=function(e){this._containerShape&&(this.removeChild(this._containerShape),e&&e.addChild(this._containerShape),this._containerShape=null),this._background&&(this.removeChild(this._background),e&&e.addChild(this._background),this._background=null),this._shape&&(this.removeChild(this._shape),e&&e.addChild(this._shape),this._shape=null),this._labelObj&&(this.removeChild(this._labelObj),e&&e.addChild(this._labelObj),this._labelObj=null),this._containerButton&&(this.removeChild(this._containerButton),e&&e.addChild(this._containerButton),this._containerButton=null),this._customNodeContent&&(this._childNodePane&&(this._childNodePane.setParent(null),this.addChild(this._childNodePane)),this._customNodeContent.namespaceURI===t.ToolkitUtils.SVG_NS?(this.getContainerElem().removeChild(this._customNodeContent),e&&t.ToolkitUtils.appendChildElem(e.getContainerElem(),this._customNodeContent)):this._customNodeContent instanceof t.BaseComponent&&(this.removeChild(this._customNodeContent),e&&e.addChild(this._customNodeContent)),this._customNodeContent=null),this._contentDims=null},l.prototype.getAnimationState=function(e){var o,i,n,a,r,s=this.getContentBounds();return this._shape&&((o={centerDimensions:this._shape.getCenterDimensions(),fill:this._shape.getFill()}).getCenterDimensions=function(){return o.centerDimensions},o.getFill=function(){return o.fill}),this._labelObj&&((i={matrix:this._labelObj.getMatrix()}).getMatrix=function(){return i.matrix}),this.isDisclosed()&&this._containerShape&&((n={fill:this._containerShape.getFill(),width:this._containerShape.getWidth(),height:this._containerShape.getHeight()}).getFill=function(){return n.fill},n.getWidth=function(){return n.width},n.getHeight=function(){return n.height}),e&&(r=new t.Container(this.getCtx()),this._cleanUp(r),r.setTranslate(this.getTranslateX(),this.getTranslateY())),(a={partialUpdate:!0,id:this.getId(),disclosed:this.isDisclosed(),tx:this.getTranslateX(),ty:this.getTranslateY(),contentBounds:s,origContent:r,_shape:o,_labelObj:i,_containerShape:n}).getId=function(){return a.id},a.isDisclosed=function(){return a.disclosed},a.getTranslateX=function(){return a.tx},a.getTranslateY=function(){return a.ty},a.getContentBounds=function(){return a.contentBounds},a},l.prototype.appendChildNodesData=function(e,o){this._data.nodes instanceof Array||(this._data.nodes=[]),this._data.nodes=t.ArrayUtils.insert(this._data.nodes,e,o)},l.prototype.removeChildNodesData=function(t){if(this._data.nodes instanceof Array)for(var e=0;e<t.length;e++)for(var o=t[e].id,i=0;i<this._data.nodes.length;i++)if(this._data.nodes[i].id===o){this._data.nodes.splice(i,1);break}};var h=function(t){this.Init(t)};t.Obj.createSubclass(h,t.Automation,"DvtDiagramAutomation"),h.prototype.Init=function(t){this._diagram=t},h.prototype.GetSubIdForDomElement=function(t){var e=this._diagram.getEventManager().GetLogicalObject(t);return e&&e instanceof l?"node["+this._diagram.GetAllNodes().indexOf(e.getId())+"]":e&&e instanceof d?"link["+this._diagram.GetAllLinks().indexOf(e.getId())+"]":null},h.prototype.getDomElementForSubId=function(e){if(e==t.Automation.TOOLTIP_SUBID)return this.GetTooltipElement(this._diagram);var o=this._parseSubId(e),i=o.component,n=o.index,a=null;return"node"==i?a=this._getNode(n):"link"==i&&(a=this._getLink(n)),a?a.getElem():null},h.prototype._parseSubId=function(t){var e=t,o=-1,i=t.substring(0,t.indexOf("["));return i&&(e="node"==i||"link"==i?i:null,o=parseInt(t.substring(t.indexOf("[")+1,t.indexOf("]")))),{component:e,index:o}},h.prototype.getNodeCount=function(){return this._diagram.GetAllNodes().length},h.prototype.getLinkCount=function(){return this._diagram.GetAllLinks().length},h.prototype.getNode=function(e){var o=this._getNode(e);if(o){var i={};i.id=o.getId(),i.selected=o.isSelected(),i.tooltip=o.getShortDesc(),i.label=o.getData().label;var n=o.getData().backgroundStyle;return n&&n instanceof Object&&(n=t.CSSStyle.cssObjectToString(n)),i.background=n,i.icon=this._getMarkerData(o.GetIcon()),i.expanded=o.isDisclosed(),i}return null},h.prototype.getLink=function(e){var o=this._getLink(e);if(o){var i={};return i.id=o.getId(),i.selected=o.isSelected(),i.tooltip=o.getShortDesc(),i.label=o.getData().label,i.color=o.getLinkColor(),i.width=o.getLinkWidth(),i.style=this._getLinkStyleFromObject(o.getLinkStyle()),i.startNode=o.getStartId(),i.endNode=o.getEndId(),i.startConnectorType=o.getStartConnectorType(),i.endConnectorType=o.getEndConnectorType(),i.promoted=o.isPromoted(),o.isPromoted()&&(i.links=t.JsonUtils.clone(o.getData()._links)),i}return null},h.prototype.getPromotedLink=function(t,e){var o=this._getNode(t),i=this._getNode(e);if(!o||!i)return null;var n=d.GetPromotedLinkId(o.getId(),i.getId()),a=this._diagram.getLinkById(n);if(a){var r={};return r.id=a.getId(),r.selected=a.isSelected(),r.tooltip=a.getShortDesc(),r.color=a.getLinkColor(),r.width=a.getLinkWidth(),r.style=this._getLinkStyleFromObject(a.getLinkStyle()),r.startNode=a.getStartId(),r.endNode=a.getEndId(),r.startConnectorType=a.getStartConnectorType(),r.endConnectorType=a.getEndConnectorType(),r.count=a.getData()._links.length,r}return null},h.prototype._getLinkStyleFromObject=function(e){if(this._diagram.getCtx().isCustomElement())return t.CSSStyle.cssObjectToString(e);if(e&&e instanceof Object){if(e._type==d.CUSTOM_STYLE){var o=t.JsonUtils.clone(e);return delete o._type,t.CSSStyle.cssObjectToString(o)}return e._type}return e},h.prototype.getExpanded=function(){return this._diagram.DisclosedNodes},h.prototype._getMarkerData=function(e){if(e){var o={};return o.shape=e instanceof t.SimpleMarker?e.getType():"none",e.getFill()&&(o.color=e.getFill().getColor()),o}return null},h.prototype._getNode=function(t){var e=this._diagram.GetAllNodes();return t>=0&&t<e.length?this._diagram.getNodeById(e[t]):null},h.prototype._getLink=function(t){var e=this._diagram.GetAllLinks();return t>=0&&t<e.length?this._diagram.getLinkById(e[t]):null},t.exportProperty(t,"Diagram",t.Diagram),t.exportProperty(t.Diagram,"newInstance",t.Diagram.newInstance),t.exportProperty(t.Diagram.prototype,"highlight",t.Diagram.prototype.highlight),t.exportProperty(t.Diagram.prototype,"select",t.Diagram.prototype.select),t.exportProperty(t.Diagram.prototype,"getAutomation",t.Diagram.prototype.getAutomation),t.exportProperty(t.Diagram.prototype,"processDefaultHoverEffect",t.Diagram.prototype.processDefaultHoverEffect),t.exportProperty(t.Diagram.prototype,"processDefaultSelectionEffect",t.Diagram.prototype.processDefaultSelectionEffect),t.exportProperty(t.Diagram.prototype,"processDefaultFocusEffect",t.Diagram.prototype.processDefaultFocusEffect),t.exportProperty(t.Diagram.prototype,"clearDisclosedState",t.Diagram.prototype.clearDisclosedState),t.exportProperty(t.Diagram.prototype,"expand",t.Diagram.prototype.expand),t.exportProperty(t.Diagram.prototype,"collapse",t.Diagram.prototype.collapse),t.exportProperty(h.prototype,"getDomElementForSubId",h.prototype.getDomElementForSubId),t.exportProperty(h.prototype,"getNodeCount",h.prototype.getNodeCount),t.exportProperty(h.prototype,"getLinkCount",h.prototype.getLinkCount),t.exportProperty(h.prototype,"getNode",h.prototype.getNode),t.exportProperty(h.prototype,"getLink",h.prototype.getLink),t.exportProperty(h.prototype,"getPromotedLink",h.prototype.getPromotedLink),t.exportProperty(h.prototype,"getExpanded",h.prototype.getExpanded)}(e),e});