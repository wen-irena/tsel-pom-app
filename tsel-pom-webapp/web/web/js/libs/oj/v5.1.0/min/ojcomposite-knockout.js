"use strict";define(["ojs/ojcore","knockout","ojs/ojtemplateengine","ojs/ojkoshared"],function(e,o,t){!function(){function o(o){if(null!=o){var t=e.__AttributeUtils.getExpressionInfo(o).expr;return null==t&&(t="'"+o+"'"),t}return null}e.__KO_CUSTOM_BINDING_PROVIDER_INSTANCE.addPostprocessor({preprocessNode:function(e,t){var n;if(1===e.nodeType){var i,r=["name","slot"],l=e.nodeName.toLowerCase(),s=!1;if("oj-slot"===l||"oj-bind-slot"===l?(s=!0,r.push("index"),i="ko _ojBindSlot_:{"):"oj-bind-template-slot"===l&&(s=!0,r.push("data"),r.push("as"),i="ko _ojBindTemplateSlot_:{"),s){for(var d=[],a=0;a<r.length;a++){var u=r[a],p=o(e.getAttribute(u));p&&d.push(u+":"+p)}i+=d.join(","),i+="}";var m=document.createComment(i),c=document.createComment("/ko");n=[m];var _=e.parentNode;for(_.insertBefore(m,e);e.childNodes.length>0;){var C=e.childNodes[0];_.insertBefore(C,e),n.push(C)}n.push(c),_.replaceChild(c,e)}}return n||t}})}(),e.CompositeTemplateRenderer={},e.CompositeTemplateRenderer.renderTemplate=function(t,n,i){var r=e.CompositeTemplateRenderer._storeNodes(n,i);o.virtualElements.setDomNodeChildren(n,i),e.CompositeTemplateRenderer.invokeViewModelMethod(t.viewModel,"attached",[t.viewModelContext]),e.CompositeTemplateRenderer.invokeViewModelMethod(t.viewModel,"connected",[t.viewModelContext]);var l=e.CompositeTemplateRenderer._createKoBindingContext(n).createChildContext(t.viewModel,void 0,function(o){o[e.Composite.__COMPOSITE_PROP]=n,o.__oj_slots=t.slotMap,o.__oj_nodestorage=r,o.$slotNodeCounts=t.slotNodeCounts,o.$slotCounts=t.slotNodeCounts,o.$props=t.props,o.$properties=t.props,o.$unique=t.unique,o.$uniqueId=t.uniqueId,o.$parent=null,o.$parentContext=null,o.$parents=null});o.applyBindingsToDescendants(l,n),e.CompositeTemplateRenderer.invokeViewModelMethod(t.viewModel,"bindingsApplied",[t.viewModelContext])},e.CompositeTemplateRenderer.getEnclosingComposite=function(t){for(var n=null,i=o.contextFor(t);i&&!n;i=i.$parentContext)n=i[e.Composite.__COMPOSITE_PROP];return n},e.CompositeTemplateRenderer.createTracker=function(){return o.observable()},e.CompositeTemplateRenderer.invokeViewModelMethod=function(e,t,n){if(null!=e){var i=e[t];return"function"==typeof i?o.ignoreDependencies(i,e,n):void 0}},e.CompositeTemplateRenderer._storeNodes=function(o,t){var n,i=o.childNodes;if(i){(n=document.createElement("div")).setAttribute("data-bind","_ojNodeStorage_"),n.style.display="none",t.push(n);for(var r=[],l=0;l<i.length;l++){var s=i[l];e.BaseCustomElementBridge.isSlotAssignable(s)&&r.push(s)}r.forEach(function(e){n.appendChild(e)}),e.Components&&e.Components.subtreeHidden(n)}return n},e.CompositeTemplateRenderer._createKoBindingContext=function(e){var t=document.createElement("div");o.applyBindings(null,t);var n=o.contextFor(t);return o.cleanNode(t),n},o.bindingHandlers._ojNodeStorage_={init:function(){return{controlsDescendantBindings:!0}}},o.bindingHandlers._ojBindSlot_={init:function(t,i,r,l,s){o.utils.domNodeDisposal.addDisposeCallback(t,n.cleanup.bind(null,t,s));var d=s.__oj_slots,a=i(),u=o.utils.unwrapObservable,p=u(a.name)||"",m=u(a.index),c=null!=m?[d[p][m]]:d[p];if(c){for(var _=0;_<c.length;_++)c[_].__oj_slots=u(a.slot)||"";if(o.virtualElements.setDomNodeChildren(t,c),e.Components)for(_=0;_<c.length;_++)e.Components.subtreeShown(c[_]);return{controlsDescendantBindings:!0}}}},o.virtualElements.allowedBindings._ojBindSlot_=!0;var n={cleanup:function(t,n){var i=n.__oj_nodestorage;if(i)for(var r=o.virtualElements.firstChild(t);r;){var l=o.virtualElements.nextSibling(r);null!=r.__oj_slots&&(i.appendChild(r),e.Components&&e.Components.subtreeHidden(r)),r=l}}};o.bindingHandlers._ojBindTemplateSlot_={init:function(i,r,l,s,d){o.utils.domNodeDisposal.addDisposeCallback(i,n.cleanup.bind(null,i,d));var a=d.__oj_slots,u=r(),p=o.utils.unwrapObservable,m=p(u.name)||"",c=a[m],_=c&&c[c.length-1],C=!1;if(!_)for(var v=o.virtualElements.childNodes(i),f=0;f<v.length;f++)if("TEMPLATE"===v[f].tagName){C=!0,_=v[f];break}if(_){var g=d[e.Composite.__COMPOSITE_PROP];"TEMPLATE"!==_.tagName&&e.Logger.error("Slot content for slot '"+m+"' under "+g.tagName.toLowerCase()+" with id '"+g.id+"' should be wrapped inside a <template> node."),_.__oj_slots=p(u.slot)||"",o.computed(function(){var e=p(u.data),n=p(u.as),r=t.execute(C?i:g,_,e,C?n:null);o.virtualElements.setDomNodeChildren(i,r)})}else o.virtualElements.setDomNodeChildren(i,[]);return{controlsDescendantBindings:!0}}},o.virtualElements.allowedBindings._ojBindTemplateSlot_=!0});