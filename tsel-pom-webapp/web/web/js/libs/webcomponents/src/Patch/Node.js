import Native from"./Native.js";import CustomElementInternals from"../CustomElementInternals.js";import*as Utilities from"../Utilities.js";export default function(e){function t(t,i){Object.defineProperty(t,"textContent",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(t){if(this.nodeType===Node.TEXT_NODE)return void i.set.call(this,t);let n=void 0;if(this.firstChild){const e=this.childNodes,t=e.length;if(t>0&&Utilities.isConnected(this)){n=new Array(t);for(let i=0;i<t;i++)n[i]=e[i]}}if(i.set.call(this,t),n)for(let t=0;t<n.length;t++)e.disconnectTree(n[t])}})}Utilities.setPropertyUnchecked(Node.prototype,"insertBefore",function(t,i){if(t instanceof DocumentFragment){const n=Array.prototype.slice.apply(t.childNodes),o=Native.Node_insertBefore.call(this,t,i);if(Utilities.isConnected(this))for(let t=0;t<n.length;t++)e.connectTree(n[t]);return o}const n=Utilities.isConnected(t),o=Native.Node_insertBefore.call(this,t,i);return n&&e.disconnectTree(t),Utilities.isConnected(this)&&e.connectTree(t),o}),Utilities.setPropertyUnchecked(Node.prototype,"appendChild",function(t){if(t instanceof DocumentFragment){const i=Array.prototype.slice.apply(t.childNodes),n=Native.Node_appendChild.call(this,t);if(Utilities.isConnected(this))for(let t=0;t<i.length;t++)e.connectTree(i[t]);return n}const i=Utilities.isConnected(t),n=Native.Node_appendChild.call(this,t);return i&&e.disconnectTree(t),Utilities.isConnected(this)&&e.connectTree(t),n}),Utilities.setPropertyUnchecked(Node.prototype,"cloneNode",function(t){const i=Native.Node_cloneNode.call(this,t);return this.ownerDocument.__CE_hasRegistry?e.patchAndUpgradeTree(i):e.patchTree(i),i}),Utilities.setPropertyUnchecked(Node.prototype,"removeChild",function(t){const i=Utilities.isConnected(t),n=Native.Node_removeChild.call(this,t);return i&&e.disconnectTree(t),n}),Utilities.setPropertyUnchecked(Node.prototype,"replaceChild",function(t,i){if(t instanceof DocumentFragment){const n=Array.prototype.slice.apply(t.childNodes),o=Native.Node_replaceChild.call(this,t,i);if(Utilities.isConnected(this)){e.disconnectTree(i);for(let t=0;t<n.length;t++)e.connectTree(n[t])}return o}const n=Utilities.isConnected(t),o=Native.Node_replaceChild.call(this,t,i),s=Utilities.isConnected(this);return s&&e.disconnectTree(i),n&&e.disconnectTree(t),s&&e.connectTree(t),o}),Native.Node_textContent&&Native.Node_textContent.get?t(Node.prototype,Native.Node_textContent):e.addPatch(function(e){t(e,{enumerable:!0,configurable:!0,get:function(){const e=[];for(let t=0;t<this.childNodes.length;t++)e.push(this.childNodes[t].textContent);return e.join("")},set:function(e){for(;this.firstChild;)Native.Node_removeChild.call(this,this.firstChild);Native.Node_appendChild.call(this,document.createTextNode(e))}})})};