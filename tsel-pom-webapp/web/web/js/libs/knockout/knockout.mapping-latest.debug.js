!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.mapping={})}(function(e,r){var t,n,a=!0,i="__ko_mapping__",o=e.dependentObservable,u=0,s=["create","update","key","arrayChanged"],p={},f={include:["_destroy"],ignore:[],copy:[],observe:[]},l=f;function v(e,r){for(var t={},n=e.length-1;n>=0;--n)t[e[n]]=e[n];for(n=r.length-1;n>=0;--n)t[r[n]]=r[n];var a=[];for(var i in t)a.push(t[i]);return a}function c(e,t){var n;for(var a in t)if(t.hasOwnProperty(a)&&t[a])if(n=r.getType(e[a]),a&&e[a]&&"array"!==n&&"string"!==n)c(e[a],t[a]);else{var i="array"===r.getType(e[a])&&"array"===r.getType(t[a]);e[a]=i?v(e[a],t[a]):t[a]}}function d(e,r){var t={};return c(t,e),c(t,r),t}function b(e,r){for(var t=d({},e),n=s.length-1;n>=0;n--){var a=s[n];t[a]&&(t[""]instanceof Object||(t[""]={}),t[""][a]=t[a],delete t[a])}return r&&(t.ignore=y(r.ignore,t.ignore),t.include=y(r.include,t.include),t.copy=y(r.copy,t.copy),t.observe=y(r.observe,t.observe)),t.ignore=y(t.ignore,l.ignore),t.include=y(t.include,l.include),t.copy=y(t.copy,l.copy),t.observe=y(t.observe,l.observe),t.mappedProperties=t.mappedProperties||{},t.copiedProperties=t.copiedProperties||{},t}function y(t,n){return"array"!==r.getType(t)&&(t="undefined"===r.getType(t)?[]:[t]),"array"!==r.getType(n)&&(n="undefined"===r.getType(n)?[]:[n]),e.utils.arrayGetDistinctValues(t.concat(n))}function g(e,r,t){for(var n=0,a=e.length;n<a;n++)if(!0!==t[n]&&e[n]===r)return n;return null}function O(t,n){var a;return n&&(a=n(t)),"undefined"===r.getType(a)&&(a=t),e.utils.unwrapObservable(a)}function h(r,t,n){for(var a=0,i=(r=e.utils.unwrapObservable(r)).length;a<i;a++){var o=r[a];if(O(o,n)===t)return o}throw new Error("When calling ko.update*, the key '"+t+"' was not found!")}function w(r,t){return e.utils.arrayMap(e.utils.unwrapObservable(r),function(e){return t?O(e,t):e})}function m(e,t){if("array"===r.getType(e))for(var n=0;n<e.length;n++)t(n);else for(var a in e)t(a)}function k(e){var t=r.getType(e);return("object"===t||"array"===t)&&null!==e}function T(){var r={},t=function(t){var n;try{n=t}catch(e){n="$$$"}var a=r[n];return void 0===a&&(a=new function(){var r=[],t=[];this.save=function(n,a){var i=e.utils.arrayIndexOf(r,n);i>=0?t[i]=a:(r.push(n),t.push(a))},this.get=function(n){var a=e.utils.arrayIndexOf(r,n);return a>=0?t[a]:void 0}},r[n]=a),a};this.save=function(e,r){t(e).save(e,r)},this.get=function(e){return t(e).get(e)}}r.isMapped=function(r){var t=e.utils.unwrapObservable(r);return t&&t[i]},r.fromJS=function(s){if(0==arguments.length)throw new Error("When calling ko.fromJS, pass the object you want to convert.");try{var f,l;u++||(t=[],n=new T),2==arguments.length&&(arguments[1][i]?l=arguments[1]:f=arguments[1]),3==arguments.length&&(f=arguments[1],l=arguments[2]),l&&(f=d(f,l[i]));var v=function u(s,f,l,v,c,b,y){var O="array"===r.getType(e.utils.unwrapObservable(f));b=b||"";if(r.isMapped(s)){var T=e.utils.unwrapObservable(s)[i];l=d(T,l)}var x={data:f,parent:y||c};var j=function(){return l[v]&&l[v].create instanceof Function};var I=function(r){return function(r,t){var n=e.dependentObservable;e.dependentObservable=function(t,n,i){i=i||{},t&&"object"==typeof t&&(i=t);var u=i.deferEvaluation,s=!1;i.deferEvaluation=!0;var p=new o(t,n,i);return u||(p=function(t){var n=e.dependentObservable;e.dependentObservable=o;var i=e.isWriteableObservable(t);e.dependentObservable=n;var u=o({read:function(){return s||(e.utils.arrayRemoveItem(r,t),s=!0),t.apply(t,arguments)},write:i&&function(e){return t(e)},deferEvaluation:!0});a&&(u._wrapper=!0);return u.__DO=t,u}(p),r.push(p)),p},e.dependentObservable.fn=o.fn,e.computed=e.dependentObservable;var i=t();return e.dependentObservable=n,e.computed=e.dependentObservable,i}(t,function(){return e.utils.unwrapObservable(c)instanceof Array?l[v].create({data:r||x.data,parent:x.parent,skip:p}):l[v].create({data:r||x.data,parent:x.parent})})};var J=function(){return l[v]&&l[v].update instanceof Function};var E=function(r,t){var n={data:t||x.data,parent:x.parent,target:e.utils.unwrapObservable(r)};return e.isWriteableObservable(r)&&(n.observable=r),l[v].update(n)};var P=n.get(f);if(P)return P;v=v||"";if(O){var S=[],_=!1,N=function(e){return e};l[v]&&l[v].key&&(N=l[v].key,_=!0),e.isObservable(s)||((s=e.observableArray([])).mappedRemove=function(e){var r="function"==typeof e?e:function(r){return r===N(e)};return s.remove(function(e){return r(N(e))})},s.mappedRemoveAll=function(r){var t=w(r,N);return s.remove(function(r){return-1!=e.utils.arrayIndexOf(t,N(r))})},s.mappedDestroy=function(e){var r="function"==typeof e?e:function(r){return r===N(e)};return s.destroy(function(e){return r(N(e))})},s.mappedDestroyAll=function(r){var t=w(r,N);return s.destroy(function(r){return-1!=e.utils.arrayIndexOf(t,N(r))})},s.mappedIndexOf=function(r){var t=w(s(),N),n=N(r);return e.utils.arrayIndexOf(t,n)},s.mappedGet=function(e){return s()[s.mappedIndexOf(e)]},s.mappedCreate=function(r){if(-1!==s.mappedIndexOf(r))throw new Error("There already is an object with the key that you specified.");var t=j()?I(r):r;if(J()){var n=E(t,r);e.isWriteableObservable(t)?t(n):t=n}return s.push(t),t});var W=w(e.utils.unwrapObservable(s),N).sort(),D=w(f,N);_&&D.sort();var F,A,M=e.utils.compareArrays(W,D),C={},R=e.utils.unwrapObservable(f),$={},q=!0;for(F=0,A=R.length;F<A;F++){var G=N(R[F]);if(void 0===G||G instanceof Object){q=!1;break}$[G]=R[F]}var V=[],z=0;for(F=0,A=M.length;F<A;F++){var B,G=M[F],H=b+"["+F+"]";switch(G.status){case"added":var K=q?$[G.value]:h(e.utils.unwrapObservable(f),G.value,N);B=u(void 0,K,l,v,s,H,c),j()||(B=e.utils.unwrapObservable(B));var L=g(e.utils.unwrapObservable(f),K,C);B===p?z++:V[L-z]=B,C[L]=!0;break;case"retained":var K=q?$[G.value]:h(e.utils.unwrapObservable(f),G.value,N);B=h(s,G.value,N),u(B,K,l,v,s,H,c);var L=g(e.utils.unwrapObservable(f),K,C);V[L]=B,C[L]=!0;break;case"deleted":B=h(s,G.value,N)}S.push({event:G.status,item:B})}s(V),l[v]&&l[v].arrayChanged&&e.utils.arrayForEach(S,function(e){l[v].arrayChanged(e.event,e.item)})}else if(k(f)){if(!(s=e.utils.unwrapObservable(s))){if(j()){var Q=I();return J()&&(Q=E(Q)),Q}if(J())return E(Q);s={}}if(J()&&(s=E(s)),n.save(f,s),J())return s;m(f,function(r){var t=b.length?b+"."+r:r;if(-1==e.utils.arrayIndexOf(l.ignore,t))if(-1==e.utils.arrayIndexOf(l.copy,t)){if("object"!=typeof f[r]&&"array"!=typeof f[r]&&l.observe.length>0&&-1==e.utils.arrayIndexOf(l.observe,t))return s[r]=f[r],void(l.copiedProperties[t]=!0);var a=n.get(f[r]),i=u(s[r],f[r],l,r,s,t,s),o=a||i;if(l.observe.length>0&&-1==e.utils.arrayIndexOf(l.observe,t))return s[r]=o(),void(l.copiedProperties[t]=!0);e.isWriteableObservable(s[r])?(o=e.utils.unwrapObservable(o),s[r]()!==o&&s[r](o)):(o=void 0===s[r]?o:e.utils.unwrapObservable(o),s[r]=o),l.mappedProperties[t]=!0}else s[r]=f[r]})}else switch(r.getType(f)){case"function":J()?e.isWriteableObservable(f)?(f(E(f)),s=f):s=E(f):s=f;break;default:if(e.isWriteableObservable(s)){if(J()){var U=E(s);return s(U),U}var U=e.utils.unwrapObservable(f);return s(U),U}var X=j()||J();if(s=j()?I():e.observable(e.utils.unwrapObservable(f)),J()&&s(E(s)),X)return s}return s}(l,s,f=b(f));if(l&&(v=l),!--u)for(;t.length;){var c=t.pop();c&&(c(),c.__DO.throttleEvaluation=c.throttleEvaluation)}return v[i]=d(v[i],f),v}catch(e){throw u=0,e}},r.fromJSON=function(t){var n=e.utils.parseJson(t);return arguments[0]=n,r.fromJS.apply(this,arguments)},r.updateFromJS=function(e){throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!")},r.updateFromJSON=function(e){throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!")},r.toJS=function(t,n){if(l||r.resetDefaultOptions(),0==arguments.length)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==r.getType(l.ignore))throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==r.getType(l.include))throw new Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==r.getType(l.copy))throw new Error("ko.mapping.defaultOptions().copy should be an array.");return n=b(n,t[i]),r.visitModel(t,function(r){return e.utils.unwrapObservable(r)},n)},r.toJSON=function(t,n){var a=r.toJS(t,n);return e.utils.stringifyJson(a)},r.defaultOptions=function(){if(!(arguments.length>0))return l;l=arguments[0]},r.resetDefaultOptions=function(){l={include:f.include.slice(0),ignore:f.ignore.slice(0),copy:f.copy.slice(0)}},r.getType=function(e){if(e&&"object"==typeof e){if(e.constructor===Date)return"date";if(e.constructor===Array)return"array"}return typeof e},r.visitModel=function(t,n,a){var o;(a=a||{}).visitedObjects=a.visitedObjects||new T;var u=e.utils.unwrapObservable(t);if(!k(u))return n(t,a.parentName);a=b(a,u[i]),n(t,a.parentName),o="array"===r.getType(u)?[]:{},a.visitedObjects.save(t,o);var s=a.parentName;return m(u,function(t){if(!a.ignore||-1==e.utils.arrayIndexOf(a.ignore,t)){var p=u[t];if(a.parentName=function(e,t,n){var a=e||"";return"array"===r.getType(t)?e&&(a+="["+n+"]"):(e&&(a+="."),a+=n),a}(s,u,t),-1!==e.utils.arrayIndexOf(a.copy,t)||-1!==e.utils.arrayIndexOf(a.include,t)||!u[i]||!u[i].mappedProperties||u[i].mappedProperties[t]||!u[i].copiedProperties||u[i].copiedProperties[t]||"array"===r.getType(u))switch(r.getType(e.utils.unwrapObservable(p))){case"object":case"array":case"undefined":var f=a.visitedObjects.get(p);o[t]="undefined"!==r.getType(f)?f:r.visitModel(p,n,a);break;default:o[t]=n(p,a.parentName)}}}),o}});