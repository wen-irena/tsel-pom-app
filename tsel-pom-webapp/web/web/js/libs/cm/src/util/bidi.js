import{lst}from"./misc.js";export function iterateBidiSections(r,t,L,e){if(!r)return e(t,L,"ltr",0);let l=!1;for(let m=0;m<r.length;++m){let b=r[m];(b.from<L&&b.to>t||t==L&&b.to==t)&&(e(Math.max(b.from,t),Math.min(b.to,L),1==b.level?"rtl":"ltr",m),l=!0)}l||e(t,L,"ltr")};export let bidiOther=null;export function getBidiPartAt(r,t,L){let e;bidiOther=null;for(let l=0;l<r.length;++l){let m=r[l];if(m.from<t&&m.to>t)return l;m.to==t&&(m.from!=m.to&&"before"==L?e=l:bidiOther=l),m.from==t&&(m.from!=m.to&&"before"!=L?e=l:bidiOther=l)}return null!=e?e:bidiOther};let bidiOrdering=function(){let r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";let L=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,e=/[stwN]/,l=/[LRr]/,m=/[Lb1n]/,b=/[1n]/;function n(r,t,L){this.level=r,this.from=t,this.to=L}return function(N,o){let f="ltr"==o?"L":"R";if(0==N.length||"ltr"==o&&!L.test(N))return!1;let i=N.length,s=[];for(let L=0;L<i;++L)s.push((h=N.charCodeAt(L))<=247?r.charAt(h):1424<=h&&h<=1524?"R":1536<=h&&h<=1785?t.charAt(h-1536):1774<=h&&h<=2220?"r":8192<=h&&h<=8203?"w":8204==h?"b":"L");var h;for(let r=0,t=f;r<i;++r){let L=s[r];"m"==L?s[r]=t:t=L}for(let r=0,t=f;r<i;++r){let L=s[r];"1"==L&&"r"==t?s[r]="n":l.test(L)&&(t=L,"r"==L&&(s[r]="R"))}for(let r=1,t=s[0];r<i-1;++r){let L=s[r];"+"==L&&"1"==t&&"1"==s[r+1]?s[r]="1":","!=L||t!=s[r+1]||"1"!=t&&"n"!=t||(s[r]=t),t=L}for(let r=0;r<i;++r){let t=s[r];if(","==t)s[r]="N";else if("%"==t){let t;for(t=r+1;t<i&&"%"==s[t];++t);let L=r&&"!"==s[r-1]||t<i&&"1"==s[t]?"1":"N";for(let e=r;e<t;++e)s[e]=L;r=t-1}}for(let r=0,t=f;r<i;++r){let L=s[r];"L"==t&&"1"==L?s[r]="L":l.test(L)&&(t=L)}for(let r=0;r<i;++r)if(e.test(s[r])){let t;for(t=r+1;t<i&&e.test(s[t]);++t);let L="L"==(r?s[r-1]:f),l=L==("L"==(t<i?s[t]:f))?L?"L":"R":f;for(let L=r;L<t;++L)s[L]=l;r=t-1}let u,c=[];for(let r=0;r<i;)if(m.test(s[r])){let t=r;for(++r;r<i&&m.test(s[r]);++r);c.push(new n(0,t,r))}else{let t=r,L=c.length;for(++r;r<i&&"L"!=s[r];++r);for(let e=t;e<r;)if(b.test(s[e])){t<e&&c.splice(L,0,new n(1,t,e));let l=e;for(++e;e<r&&b.test(s[e]);++e);c.splice(L,0,new n(2,l,e)),t=e}else++e;t<r&&c.splice(L,0,new n(1,t,r))}return"ltr"==o&&(1==c[0].level&&(u=N.match(/^\s+/))&&(c[0].from=u[0].length,c.unshift(new n(0,0,u[0].length))),1==lst(c).level&&(u=N.match(/\s+$/))&&(lst(c).to-=u[0].length,c.push(new n(0,i-u[0].length,i)))),"rtl"==o?c.reverse():c}}();export function getOrder(r,t){let L=r.order;return null==L&&(L=r.order=bidiOrdering(r.text,t)),L};