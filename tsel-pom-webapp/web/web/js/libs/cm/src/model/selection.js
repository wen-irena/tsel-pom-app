import{cmp,copyPos,equalCursorPos,maxPos,minPos}from"../line/pos.js";import{indexOf}from"../util/misc.js";export class Selection{constructor(e,r){this.ranges=e,this.primIndex=r}primary(){return this.ranges[this.primIndex]}equals(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(let r=0;r<this.ranges.length;r++){let t=this.ranges[r],n=e.ranges[r];if(!equalCursorPos(t.anchor,n.anchor)||!equalCursorPos(t.head,n.head))return!1}return!0}deepCopy(){let e=[];for(let r=0;r<this.ranges.length;r++)e[r]=new Range(copyPos(this.ranges[r].anchor),copyPos(this.ranges[r].head));return new Selection(e,this.primIndex)}somethingSelected(){for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1}contains(e,r){r||(r=e);for(let t=0;t<this.ranges.length;t++){let n=this.ranges[t];if(cmp(r,n.from())>=0&&cmp(e,n.to())<=0)return t}return-1}};export class Range{constructor(e,r){this.anchor=e,this.head=r}from(){return minPos(this.anchor,this.head)}to(){return maxPos(this.anchor,this.head)}empty(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};export function normalizeSelection(e,r){let t=e[r];e.sort((e,r)=>cmp(e.from(),r.from())),r=indexOf(e,t);for(let t=1;t<e.length;t++){let n=e[t],s=e[t-1];if(cmp(s.to(),n.from())>=0){let o=minPos(s.from(),n.from()),i=maxPos(s.to(),n.to()),h=s.empty()?n.from()==n.head:s.from()==s.head;t<=r&&--r,e.splice(--t,2,new Range(h?i:o,h?o:i))}}return new Selection(e,r)};export function simpleSelection(e,r){return new Selection([new Range(e,r||e)],0)};