define("impl/logger",[],function(){"use strict";function e(){Object.defineProperty(this,"LEVEL_NONE",{value:0,enumerable:!0}),Object.defineProperty(this,"LEVEL_ERROR",{value:1,enumerable:!0}),Object.defineProperty(this,"LEVEL_WARN",{value:2,enumerable:!0}),Object.defineProperty(this,"LEVEL_INFO",{value:3,enumerable:!0}),Object.defineProperty(this,"LEVEL_LOG",{value:4,enumerable:!0}),Object.defineProperty(this,"_METHOD_ERROR",{value:"error"}),Object.defineProperty(this,"_METHOD_WARN",{value:"warn"}),Object.defineProperty(this,"_METHOD_INFO",{value:"info"}),Object.defineProperty(this,"_METHOD_LOG",{value:"log"}),Object.defineProperty(this,"_defaultOptions",{value:{level:this.LEVEL_ERROR,writer:null}}),Object.defineProperty(this,"_options",{value:this._defaultOptions,writable:!0})}function t(e,r,n,o){var s=e;if(!(s.option("level")<r)){var i=function(e){var t=e,r=null;return t.option("writer")?r=t.option("writer"):"undefined"!=typeof window&&void 0!==window.console&&(r=window.console),r}(s);if(null!=i){if(1==o.length&&o[0]instanceof Function)o=[o[0]()];i[n]&&i[n].apply?i[n].apply(i,o):i[n]&&(i[n]=Function.prototype.bind.call(i[n],i),t(s,r,n,o))}}}return e.prototype.error=function(e){t(this,this.LEVEL_ERROR,this._METHOD_ERROR,arguments)},e.prototype.info=function(e){t(this,this.LEVEL_INFO,this._METHOD_INFO,arguments)},e.prototype.warn=function(e){t(this,this.LEVEL_WARN,this._METHOD_WARN,arguments)},e.prototype.log=function(e){t(this,this.LEVEL_LOG,this._METHOD_LOG,arguments)},e.prototype.option=function(e,t){var r,n={};if(0==arguments.length){for(r in this._options)this._options.hasOwnProperty(r)&&(n[r]=this._options[r]);return n}if("string"==typeof e&&void 0===t)return void 0===this._options[e]?null:this._options[e];if("string"==typeof e)this._options[e]=t;else{var o=e;for(r in o)o.hasOwnProperty(r)&&this.option(r,o[r])}},new e}),define("persistenceUtils",["./impl/logger"],function(e){"use strict";function t(e){var t=e.get("Content-Type");return!(!t||-1===t.indexOf("text/")&&-1===t.indexOf("application/json"))}function r(t,r){e.log("Offline Persistence Toolkit persistenceUtils: requestToJSON()"),r&&r._noClone||(t=t.clone());var o={};return n(t,o,["body","headers","signal"]),o.headers=s(t.headers),a(t,o)}function n(e,t,r){for(var n in e)"function"!=typeof e[n]&&!o(n)&&-1===r.indexOf(n)&&(t[n]=e[n])}function o(e){return 0===e.indexOf("_")}function s(e){var t={};if(e.entries){var r,n,o,s=e.entries();do{(r=s.next()).value&&(n=r.value[0],o=r.value[1],t[n]=o)}while(!r.done)}else e.forEach&&e.forEach(function(e,r){t[r]=e});return i(t),t}function i(t){var r=t.date;r||(e.log("Offline Persistence Toolkit persistenceUtils: Setting HTTP date header since it's null or not exposed"),r=(new Date).toUTCString(),t.date=r)}function a(e,r){return r.body={},e instanceof Request&&function(e){var t=e.get("Content-Type");return t&&-1!==t.indexOf("multipart/")}(e.headers)?u(e,r):e instanceof Request||t(e.headers)?e.text().then(function(e){return r.body.text=e,r}):e instanceof Request||"function"!=typeof e.arrayBuffer?Promise.reject(new Error({message:"payload body type is not supported"})):e.arrayBuffer().then(function(e){return e.byteLength>0&&(r.body.arrayBuffer=e),r})}function u(t,r){if(e.log("Offline Persistence Toolkit persistenceUtils: Copying multipart payload"),"function"==typeof t.formData)return t.formData().then(function(e){var t,n,o,s,i={},a=e.entries();do{(n=(t=a.next()).value)&&(o=n[0],s=n[1],i[o]=s)}while(!t.done);return r.body.formData=i,r});var n=t.headers.get("Content-Type");return t.text().then(function(e){for(var t=p(e,n),o={},s=0;s<t.length;s++)o[t[s].headers.name]=t[s].data;return r.body.formData=o,r})}function l(t,r){e.log("Offline Persistence Toolkit persistenceUtils: responseToJSON()"),r&&r._noClone||(t=t.clone());var o={};return n(t,o,["body","headers"]),o.headers=s(t.headers),r&&r.excludeBody?Promise.resolve(o):a(t,o)}function c(t){e.log("Offline Persistence Toolkit persistenceUtils: requestFromJSON()");var r={};n(t,r,["headers","body","signal"]);var o=function(e,t){var r=!1,n=e.body;if(n.text&&n.text.length>0)t.body=n.text;else if(n.arrayBuffer)t.body=n.arrayBuffer;else if(n.formData){r=!0;var o=new FormData,s=n.formData;Object.keys(s).forEach(function(e){o.append(e,s[e])}),t.body=o}return r}(t,r);return r.headers=f(t,o),function(e,t){return Promise.resolve(new Request(e.url,t))}(t,r)}function f(e,t){var r=new Headers;return Object.keys(e.headers).forEach(function(n){("content-type"!==n||!t&&"content-type"===n)&&r.append(n,e.headers[n])}),r}function h(t){e.log("Offline Persistence Toolkit persistenceUtils: responseFromJSON()");var r={};return n(t,r,["headers","body"]),r.headers=f(t,!1),function(e,t){var r,n=e.body;return n&&n.text?r=new Response(n.text,t):n&&n.arrayBuffer?(t.responseType="blob",r=new Response(n.arrayBuffer,t)):n&&n.blob?(t.responseType="blob",r=new Response(n.blob,t)):r=new Response(null,t),Promise.resolve(r)}(t,r)}function p(t,r){e.log("Offline Persistence Toolkit persistenceUtils: parseMultipartFormData()");var n=r.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new Error("not a valid multipart form data value.");var o,s=function(e){for(var t={},r={},n=e.split("\r\n"),o=0;o<n.length;o++){var s=n[o];if(0!==s.length){var i=s.split(";");if(1===i.length&&0===i[0].indexOf("Content-Type"))t.contentType=i[0].split(":")[1].trim();else for(var a=0;a<i.length;a++)if(-1!==i[a].indexOf("=")){var u=i[a].split("=");r[u[0].trim()]=u[1].substring(1,u[1].length-1)}}}return t.headers=r,t},i=function(e,t){var r=e.split("\r\n");return t&&t.indexOf("image")>=0?a(r[0],t):r[0]},a=function(e,t){var r=null;try{r=atob(e)}catch(e){return null}for(var n=new ArrayBuffer(r.length),o=new Uint8Array(n),s=0;s<r.length;s++)o[s]=r.charCodeAt(s);return new Blob([n],{type:t})},u=n[1]||n[2];if("string"==typeof t)o=t;else{var l=new Uint8Array(t);o=String.fromCharCode.apply(null,l)}for(var c=o.split(new RegExp(u)),f=[],h=1;h<c.length-1;h++){var p={},d=c[h].split("\r\n\r\n"),y=d[0],v=d[1],g=s(y);p.headers=g.headers,p.data=i(v,g.contentType),f.push(p)}return f}return{requestToJSON:r,requestFromJSON:c,responseToJSON:l,responseFromJSON:h,setResponsePayload:function(t,r){return e.log("Offline Persistence Toolkit persistenceUtils: setResponsePayload()"),l(t).then(function(e){var t=e.body;if(t.arrayBuffer){if(!(r instanceof ArrayBuffer))throw new Error({message:"unexpected payload"});t.arrayBuffer=r}else r instanceof Blob?t.blob=r:t.text=JSON.stringify(r);return h(e)})},parseMultipartFormData:p,isCachedResponse:function(e){return e.headers.has("x-oracle-jscpt-cache-expiration-date")},isGeneratedEtagResponse:function(e){return e.headers.has("x-oracle-jscpt-etag-generated")},_isTextPayload:t,buildEndpointKey:function(t){e.log("Offline Persistence Toolkit persistenceUtils: buildEndpointKey() for Request with url: "+t.url);var r={url:t.url,id:Math.random().toString(36).replace(/[^a-z]+/g,"")};return JSON.stringify(r)},_cloneRequest:function(e){return r(e,{_noClone:!0}).then(function(e){return c(e).then(function(e){return e})})},_cloneResponse:function(e,t){return t=t||{},l(e,{_noClone:!0}).then(function(e){return h(e).then(function(e){return null!=t.url&&t.url.length>0&&null==e.headers.get("x-oracle-jscpt-response-url")&&e.headers.set("x-oracle-jscpt-response-url",t.url),e})})}}}),define("impl/PersistenceXMLHttpRequest",["../persistenceUtils","./logger"],function(e,t){"use strict";function r(e){var t=this;Object.defineProperty(this,"_eventListeners",{value:[],writable:!0}),Object.defineProperty(this,"_browserXMLHttpRequest",{value:e}),Object.defineProperty(this,"_method",{value:null,writable:!0}),Object.defineProperty(this,"onabort",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onerror",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onload",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onloadend",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onloadstart",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onprogress",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onreadystatechange",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"ontimeout",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"_password",{value:null,writable:!0}),Object.defineProperty(this,"_readyState",{value:0,writable:!0}),Object.defineProperty(this,"readyState",{enumerable:!0,get:function(){return t._readyState}}),Object.defineProperty(this,"_requestHeaders",{value:{},writable:!0}),Object.defineProperty(this,"_response",{value:"",writable:!0}),Object.defineProperty(this,"response",{enumerable:!0,get:function(){return t._response}}),Object.defineProperty(this,"_responseHeaders",{value:{},writable:!0}),Object.defineProperty(this,"_responseText",{value:"",writable:!0}),Object.defineProperty(this,"responseText",{enumerable:!0,get:function(){return t._responseText}}),Object.defineProperty(this,"responseType",{value:"",enumerable:!0,writable:!0}),Object.defineProperty(this,"_responseURL",{value:"",writable:!0}),Object.defineProperty(this,"responseURL",{enumerable:!0,get:function(){return t._responseURL}}),Object.defineProperty(this,"_responseXML",{value:null,writable:!0}),Object.defineProperty(this,"responseXML",{enumerable:!0,get:function(){return t._responseXML}}),Object.defineProperty(this,"_status",{value:0,writable:!0}),Object.defineProperty(this,"status",{enumerable:!0,get:function(){return t._status}}),Object.defineProperty(this,"_statusText",{value:"",writable:!0}),Object.defineProperty(this,"statusText",{enumerable:!0,get:function(){return t._statusText}}),Object.defineProperty(this,"timeout",{value:0,enumerable:!0}),Object.defineProperty(this,"upload",{value:null,enumerable:!0}),Object.defineProperty(this,"_url",{value:null,writable:!0}),Object.defineProperty(this,"_username",{value:null,writable:!0}),Object.defineProperty(this,"withCredentials",{value:!1,enumerable:!0,writable:!0})}function n(e,t){e._readyState=t,e.dispatchEvent(new a("readystatechange")),e._readyState==r.DONE&&(e.dispatchEvent(new a("load",!1,!1,e)),e.dispatchEvent(new a("loadend",!1,!1,e)))}function o(e,t){var r=function(e){var t=new Headers;return Object.keys(e._requestHeaders).forEach(function(r){t.append(r,e._requestHeaders[r])}),t}(e),n=e.withCredentials?"include":"same-origin",o={method:e._method,headers:r,mode:"cors",cache:"default",credentials:n};return"GET"!==e._method&&"HEAD"!==e._method&&"DELETE"!==e._method&&(o.body=t),o}function s(o,s,i){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Processing Response"),function(e,t){if(e._responseHeaders={},t.entries){var o,s,i,a=t.entries();do{(o=a.next()).value&&(s=o.value[0],i=o.value[1],e._forceMimeType&&"content-type"==s.toLowerCase()?e._responseHeaders[s]=e._forceMimeType:e._responseHeaders[s]=i)}while(!o.done)}else t.forEach&&t.forEach(function(t,r){e._forceMimeType&&"content-type"==r.toLowerCase()?e._responseHeaders[r]=e._forceMimeType:e._responseHeaders[r]=t});n(e,r.HEADERS_RECEIVED)}(o,i.headers);var a=i.headers.get("Content-Type");o._status=i.status,o._statusText=i.statusText,o._responseURL=s.url,!e._isTextPayload(i.headers)&&e.isCachedResponse(i)?(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Calling response.blob()"),i.blob().then(function(e){o._responseType="blob",o._response=e,n(o,r.DONE),"function"==typeof o.onload&&o.onload()},function(e){t.error(e)})):a&&-1!==a.indexOf("image/")?(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Calling response.arrayBuffer()"),i.arrayBuffer().then(function(e){o._responseType="arrayBuffer",o._response=e,n(o,r.DONE),"function"==typeof o.onload&&o.onload()},function(e){t.error("error reading response as arrayBuffer!")})):i.text().then(function(e){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Calling response.text()"),o._responseType="",o._response=e,o._responseText=e,n(o,r.DONE),"function"==typeof o.onload&&o.onload()},function(e){t.error(e)})}function i(e){if(e._readyState!==r.OPENED)throw new Error("INVALID_STATE_ERR")}function a(e,t,r,n){Object.defineProperty(this,"type",{value:e,enumerable:!0}),Object.defineProperty(this,"bubbles",{value:t,enumerable:!0}),Object.defineProperty(this,"cancelable",{value:r,enumerable:!0}),Object.defineProperty(this,"target",{value:n,enumerable:!0})}return Object.defineProperty(r,"UNSENT",{value:0,enumerable:!0}),Object.defineProperty(r,"OPENED",{value:1,enumerable:!0}),Object.defineProperty(r,"HEADERS_RECEIVED",{value:2,enumerable:!0}),Object.defineProperty(r,"LOADING",{value:3,enumerable:!0}),Object.defineProperty(r,"DONE",{value:4,enumerable:!0}),r.prototype.open=function(e,o,s,i,a){if(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: open() for method: "+e+", url: "+o),"boolean"==typeof s&&!s)throw new Error("InvalidAccessError: Failed to execute 'open' on 'XMLHttpRequest': Synchronous requests are disabled on the XHR Adapter");if(this._method=e,this._url=o,function(e){var t=e.toLowerCase();if(0===t.indexOf("http:")||0===t.indexOf("https:"))return!1;if(0===t.indexOf("file:"))return!0;if(URL&&URL.prototype&&null!=(t=new URL(e,window.location.href).origin)&&"null"!=t&&t.length>0)return 0===t.toLowerCase().indexOf("file:");var r=document.createElement("a");return r.href=e,!(!(t=r.protocol)||0!==t.toLowerCase().indexOf("file:"))}(o)){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: open called for a File url");var u=this;this._passthroughXHR=new u._browserXMLHttpRequest,this._passthroughXHR.onreadystatechange=function(){u._passthroughXHR.readyState==r.DONE&&(u._status=u._passthroughXHR.status,u._statusText=u._passthroughXHR.statusText,u._response=u._passthroughXHR.response,u._responseHeaders=u._passthroughXHR.responseHeaders,u._responseType=u._passthroughXHR.responseType,null!=u._responseType&&""!=u._responseType&&"text"!=u._responseType||(u._responseText=u._passthroughXHR.responseText),u._responseURL=u._passthroughXHR.responseURL,null!=u._responseType&&""!=u._responseType&&"document"!=u._responseType||(u._responseXML=u._passthroughXHR.responseXML)),n(u,u._passthroughXHR.readyState)},this._passthroughXHR.open(e,o,s,i,a)}else this._passthroughXHR=null;this._username=i,this._password=a,this._responseText=null,this._responseXML=null,this._requestHeaders={},n(this,r.OPENED)},r.prototype.setRequestHeader=function(e,r){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: setRequestHeader() with header: "+e+" ,value: "+r),i(this);var n=this._requestHeaders[e];this._requestHeaders[e]=n?n+=","+r:r},r.prototype.send=function(e){if(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: send()"),this._passthroughXHR)null!=this.responseType&&(this._passthroughXHR.responseType=this.responseType),this._passthroughXHR.send(e);else{i(this),n(this,r.OPENED);var u=o(this,e),l=new Request(this._url,u),c=this;fetch(l).then(function(e){s(c,l,e)},function(e){t.error(e)}),this.dispatchEvent(new a("loadstart",!1,!1,this))}},r.prototype.abort=function(){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: abort() is not supported by the XHR Adapter")},r.prototype.getResponseHeader=function(e){if(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: getResponseHeader() for header: "+e),this._readyState<r.HEADERS_RECEIVED)return null;for(var n in e=e.toLowerCase(),this._responseHeaders)if(n.toLowerCase()==e.toLowerCase())return this._responseHeaders[n];return null},r.prototype.getAllResponseHeaders=function(){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: getAllResponseHeaders()");var e=this;if(this._readyState<r.HEADERS_RECEIVED)return"";var n="";return this._responseHeaders&&Object.keys(this._responseHeaders).forEach(function(t){n+=t+": "+e._responseHeaders[t]+"\r\n"}),n},r.prototype.overrideMimeType=function(e){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: overrideMimeType() for mimeType: "+e),"string"==typeof e&&(this._forceMimeType=e.toLowerCase())},r.prototype.addEventListener=function(e,r){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: addEventListener() for event type: "+e),this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(r)},r.prototype.removeEventListener=function(e,r){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: removeEventListener() for event type: "+e);var n,o=this._eventListeners[e]||[],s=o.length;for(n=0;n<s;n++)if(o[n]==r)return o.splice(n,1)},r.prototype.dispatchEvent=function(e){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: dispatchEvent() for event type: "+e.type);var r=this,n=e.type;switch((this._eventListeners[n]||[]).forEach(function(t){"function"==typeof t?t.call(r,e):t.handleEvent(e)}),n){case"abort":this.onabort&&this.onabort(e);break;case"error":this.onerror&&this.onerror(e);break;case"load":this.onload&&this.onload(e);break;case"loadend":this.onloadend&&this.onloadend(e);break;case"loadstart":this.onloadstart&&this.onloadstart(e);break;case"progress":this.onprogress&&this.onprogress(e);break;case"readystatechange":this.onreadystatechange&&this.onreadystatechange(e);break;case"timeout":this.ontimeout&&this.ontimeout(e)}return!!e.defaultPrevented},a.prototype.stopPropagation=function(){},a.prototype.preventDefault=function(){this.defaultPrevented=!0},r}),define("persistenceStoreManager",["./impl/logger"],function(e){"use strict";var t=function(){Object.defineProperty(this,"_stores",{value:{},writable:!0}),Object.defineProperty(this,"_factories",{value:{},writable:!0}),Object.defineProperty(this,"_DEFAULT_STORE_FACTORY_NAME",{value:"_defaultFactory",writable:!1}),Object.defineProperty(this,"_storeNameMapping",{value:{},writable:!0})};return t.prototype.registerStoreFactory=function(e,t){if(!t)throw TypeError("A valid factory must be provided.");if(!e)throw TypeError("A valid name must be provided.");var r=this._mapStoreName(e),n=this._factories[r];if(n&&n!==t)throw TypeError("A factory with the same name has already been registered.");this._factories[r]=t},t.prototype.registerDefaultStoreFactory=function(e){this.registerStoreFactory(this._DEFAULT_STORE_FACTORY_NAME,e)},t.prototype.openStore=function(t,r){e.log("Offline Persistence Toolkit PersistenceStoreManager: openStore() for name: "+t);var n=this._mapStoreName(t),o=this._stores[n],s=r&&r.version||"0";if(o&&o[s])return Promise.resolve(o[s]);var i=this._factories[n];if(i||(i=this._factories[this._DEFAULT_STORE_FACTORY_NAME]),!i)return Promise.reject(new Error("no factory is registered to create the store."));var a=this;return e.log("Offline Persistence Toolkit PersistenceStoreManager: Calling createPersistenceStore on factory"),i.createPersistenceStore(n,r).then(function(e){return(o=o||{})[s]=e,a._stores[n]=o,e})},t.prototype.hasStore=function(e,t){var r=this._mapStoreName(e),n=this._stores[r];return!!n&&(!t||!t.version||!!n[t.version])},t.prototype.deleteStore=function(t,r){e.log("Offline Persistence Toolkit PersistenceStoreManager: deleteStore() for name: "+t);var n=this._mapStoreName(t),o=this._stores[n];if(!o)return Promise.resolve(!1);var s=r&&r.version;if(s){var i=o[s];return i?(e.log("Offline Persistence Toolkit PersistenceStoreManager: Calling delete on store"),i.delete().then(function(){return delete o[s],!0})):Promise.resolve(!1)}var a=Object.keys(o).map(function(e){return function(t){return e[t].delete()}}(o),this),u=this;return Promise.all(a).then(function(){return delete u._stores[n],!0})},t.prototype._mapStoreName=function(e,t){var r=this._storeNameMapping[e];return r||(r=e.replace(/(.*):\/\/(.*)/gi,"$1$2"),this._storeNameMapping[e]=r,r)},new t}),define("impl/defaultCacheHandler",["../persistenceUtils","../persistenceStoreManager","./logger"],function(e,t,r){"use strict";function n(){Object.defineProperty(this,"_endpointToOptionsMap",{value:{},writable:!0})}function o(e,n){return r.log("Offline Persistence Toolkit DefaultCacheHandler: Updating store with shredded data"),t.openStore(e).then(function(e){return e.upsertAll(n)})}function s(e){for(var t=e.name,r=e.resourceIdentifier,n=e.keys,o=[],s=(new Date).toUTCString(),i=0;i<n.length;i++){var a={key:n[i],metadata:{lastUpdated:s,resourceIdentifier:r},value:e.data[i]};o.push(a)}var u={};return u[t]=o,u}function i(e){var r=e.name;return t.openStore(r).then(function(t){if(e.keys&&e.keys.length){if(1===e.keys.length)return t.findByKey(e.keys[0]);var r={selector:{$or:e.keys.map(function(e){return{key:e}})}};return t.find(r)}return Promise.resolve([])}).then(function(t){return Array.isArray(t)||(t=[t]),e.data=t,Promise.resolve(e)})}n.prototype.constructRequestResponseCacheData=function(t,n){var o=this,s={};return r.log("Offline Persistence Toolkit DefaultCacheHandler: constructRequestResponseCacheData()"),e.requestToJSON(t).then(function(r){s.requestData=r;var i=o._excludeBody(t);return e.responseToJSON(n,{excludeBody:i})}).then(function(e){return s.responseData=e,{key:o._constructCacheKey(t,n),metadata:o.constructMetadata(t),value:s}})},n.prototype.constructShreddedData=function(e,t){r.log("Offline Persistence Toolkit DefaultCacheHandler: constructShreddedData()");var n=this._getShredder(e);return n?n(t).then(function(e){var t=e.map(s);return Promise.resolve(t)}):Promise.resolve()},n.prototype.shredResponse=function(e,t){r.log("Offline Persistence Toolkit DefaultCacheHandler: shredResponse()");var n=this._getShredder(e);return n?n(t):Promise.resolve()},n.prototype.cacheShreddedData=function(e){return r.log("Offline Persistence Toolkit DefaultCacheHandler: cacheShreddedData()"),function(e){var t=e.map(function(e){var t=Object.keys(e)[0],r=e[t];return r&&r.length?o(t,r):Promise.resolve()});return Promise.all(t)}(e.map(s))},n.prototype._constructCacheKey=function(e,t){var r=e.url+e.method;if(t){var n=t.headers;if(n)if(a=n.get("vary"))if("*"===a)r+=(new Date).getTime();else for(var o=e.headers,s=a.split(","),i=0;i<s.length;i++){var a,u=s[i];r+=u+"="+(a=o?o.get(u):"undefined")}}return r},n.prototype.constructMetadata=function(e){var t=(new Date).getTime();return{url:e.url,method:e.method,created:t,lastupdated:t}},n.prototype.constructResponse=function(t){return r.log("Offline Persistence Toolkit DefaultCacheHandler: constructResponse()"),e.responseFromJSON(t).then(function(t){return e.isCachedResponse(t)||t.headers.set("x-oracle-jscpt-cache-expiration-date",""),Promise.resolve(t)})},n.prototype.constructSearchCriteria=function(e,t){r.log("Offline Persistence Toolkit DefaultCacheHandler: constructSearchCriteria()");var n=!1;t&&void 0!==t.ignoreSearch&&(n=t.ignoreSearch);var o=!1;t&&void 0!==t.ignoreMethod&&(o=t.ignoreMethod);var s,i,u=e.url.indexOf("?");return i=u>=0?e.url.substring(0,u):e.url,s=n?{"metadata.url":{$regex:"^"+a(i)+"(\\?|$)"}}:{"metadata.url":e.url},o||(s["metadata.method"]=e.method),{selector:s,sort:[{"metadata.created":"asc"}]}},n.prototype.registerEndpointOptions=function(e,t){if(!e)throw new Error({message:"a valid endpointKey must be provided."});if(this._endpointToOptionsMap[e])throw new Error({message:"endpointKey can only be registered once."});this._endpointToOptionsMap[e]=t},n.prototype.unregisterEndpointOptions=function(e){if(!e)throw new Error({message:"a valid endpointKey must be provided."});delete this._endpointToOptionsMap[e]},n.prototype._excludeBody=function(e){return null!==this._getShredder(e)},n.prototype._getShredder=function(e){var t=this._getJsonProcessor(e);return t?t.shredder:null},n.prototype._getUnshredder=function(e){var t=this._getJsonProcessor(e);return t?t.unshredder:null},n.prototype._getJsonProcessor=function(e){for(var t=Object.keys(this._endpointToOptionsMap),r=0;r<t.length;r++){var n=t[r];if(e.url===JSON.parse(n).url){var o=this._endpointToOptionsMap[n];return o&&o.jsonProcessor&&o.jsonProcessor.shredder&&o.jsonProcessor.unshredder?o.jsonProcessor:null}}return null},n.prototype.fillResponseBodyWithShreddedData=function(e,t,n){r.log("Offline Persistence Toolkit DefaultCacheHandler: fillResponseBodyWithShreddedData()"),null!=e.url&&e.url.length>0&&null==n.headers.get("x-oracle-jscpt-response-url")&&n.headers.set("x-oracle-jscpt-response-url",e.url);var o=this._getUnshredder(e),s=this._getShredder(e);if(!(o&&s&&n&&t&&t.length))return Promise.resolve(n);var a=t.map(function(e){return i(e)});return Promise.all(a).then(function(e){return o(e,n)})};var a=function(e){return String(e).replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")};return new n}),define("impl/PersistenceSyncManager",["require","../persistenceUtils","../persistenceStoreManager","./defaultCacheHandler","./logger"],function(e,t,r,n,o){"use strict";function s(e,t,r){Object.defineProperty(this,"_eventListeners",{value:[],writable:!0}),Object.defineProperty(this,"_isOnline",{value:e}),Object.defineProperty(this,"_browserFetch",{value:t}),Object.defineProperty(this,"_cache",{value:r})}function i(e){var t=e;return p().then(function(e){return e.find(function(){var e={},t=[],r=[];r.push("metadata.created"),e.sort=r,t.push("metadata.created"),t.push("value"),e.fields=t;var n={},o={$exists:!0};return n["metadata.created"]=o,e.selector=n,e}())}).then(function(e){return l(e)}).then(function(e){return t._readingSyncLog=null,e})}function a(e){return"stop"===(e=e||{}).action}function u(e,t){return{requestId:e,request:t,undo:function(){return function(e){return d().then(function(t){return t.findByKey(e)}).then(function(e){return null!=e&&c(e,!0).then(function(){return!0})})}(e)},redo:function(){return function(e){return d().then(function(t){return t.findByKey(e)}).then(function(e){return null!=e&&c(e,!1).then(function(){return!0})})}(e)}}}function l(e){var r,n,o=[],s=function(e){return e&&0!=e.length?(r=e[0].metadata.created.toString(),n=e[0].value,t.requestFromJSON(n).then(function(t){return o.push(u(r,t)),e.shift(),s(e)})):Promise.resolve(o)};return s(e)}function c(e,t){var n,o,s,i,a,u=[];e instanceof Array||(e=[e]);var l=e.length,c=function(f){if(!(f<l))return Promise.resolve();if(s=e[f].storeName,o=e[f].operation,i=e[f].undoRedoData,"upsert"==o||"remove"==o&&t){for(u=[],a=i.length,n=0;n<a;n++)t?u.push({key:i[n].key,value:i[n].undo}):u.push({key:i[n].key,value:i[n].redo});return r.openStore(s).then(function(e){return 1==u.length&&null==u[0].value&&null!=u[0].key?e.removeByKey(u[0].key).then(function(){return c(++f)}):e.upsertAll(u).then(function(){return c(++f)})})}return"remove"==o?r.openStore(s).then(function(e){return e.removeByKey(i[0].key).then(function(){return c(++f)})}):void 0};return c(0)}function f(e,t,r,n){return function e(t,r){return r.length>0?r[0].listener(t).then(function(t){return null!=t?Promise.resolve(t):r.length>1?e(r.slice(1)):void 0}):Promise.resolve(null)}(r,e._eventListeners.filter(function(e,t){return function(r){return e.toLowerCase()==r.type&&(null!=t&&t.match(r.scope)||null==t||null==r.scope)}}(t,n)))}function h(e){return r.openStore(e,{index:["metadata.created"]})}function p(){return h("syncLog")}function d(){return h("redoUndoLog")}return s.prototype.addEventListener=function(e,t,r){o.log("Offline Persistence Toolkit PersistenceSyncManager: addEventListener() for type: "+e+" and scope: "+r),this._eventListeners.push({type:e.toLowerCase(),listener:t,scope:r})},s.prototype.removeEventListener=function(e,t,r){o.log("Offline Persistence Toolkit PersistenceSyncManager: removeEventListener() for type: "+e+" and scope: "+r),this._eventListeners=this._eventListeners.filter(function(n){return e.toLowerCase()!=n.type||t!=n.listener||r!=n.scope})},s.prototype.getSyncLog=function(){return o.log("Offline Persistence Toolkit PersistenceSyncManager: getSyncLog()"),this._readingSyncLog||(this._readingSyncLog=i(this)),this._readingSyncLog},s.prototype.insertRequest=function(e,r){o.log("Offline Persistence Toolkit PersistenceSyncManager: insertRequest() for Request with url: "+e.url);var s={};return p().then(function(r){return s.store=r,t.requestToJSON(e,{_noClone:!0})}).then(function(t){return s.requestData=t,s.metadata=n.constructMetadata(e),s.requestId=s.metadata.created.toString(),s.store.upsert(s.requestId,s.metadata,s.requestData)}).then(function(){if(null!=r){var e=r.undoRedoDataArray;return null!=e?d().then(function(t){var r=function(n){return n<e.length&&null!=e[n]?t.upsert(s.requestId,s.metadata,e[n]).then(function(){return r(++n)}):Promise.resolve()};return r(0)}):Promise.resolve()}return Promise.resolve()})},s.prototype.removeRequest=function(e){o.log("Offline Persistence Toolkit PersistenceSyncManager: removeRequest() for Request with requestId: "+e);var t=this,r={};return p().then(function(n){return r.store=n,function(e,t){return e.getSyncLog().then(function(e){var r,n=e.length;for(r=0;r<n;r++)if(e[r].requestId===t)return e[r].request})}(t,e)}).then(function(t){return r.request=t,r.store.removeByKey(e)}).then(function(){return d()}).then(function(t){return t.removeByKey(e)}).then(function(){return r.request})},s.prototype.updateRequest=function(e,r){return o.log("Offline Persistence Toolkit PersistenceSyncManager: updateRequest() for Request with requestId: "+e),Promise.all([p(),t.requestToJSON(r)]).then(function(t){var o=t[0],s=t[1],i=n.constructMetadata(r);return o.upsert(e,i,s)})},s.prototype.sync=function(e){o.log("Offline Persistence Toolkit PersistenceSyncManager: sync()"),this._options=e||{};var r=this;return this._syncing?Promise.reject("Cannot start sync while sync is in progress"):(this._syncing=!0,new Promise(function(e,n){r.getSyncLog().then(function(s){if(r._isOnline()){o.log("Offline Persistence Toolkit PersistenceSyncManager: Processing sync, is online");var i,u,l,c=function(s){0==s.length&&(o.log("Offline Persistence Toolkit PersistenceSyncManager: Sync finished, no requests in sync log"),e()),s.length>0&&(o.log("Offline Persistence Toolkit PersistenceSyncManager: Processing sync, # of request in sync log: "+s.length),i=s[0].requestId,u=s[0].request,l=u.clone(),o.log("Offline Persistence Toolkit PersistenceSyncManager: Dispatching beforeSyncRequest event"),f(r,"beforeSyncRequest",{requestId:i,request:l.clone()},u.url).then(function(h){if(a(h))return o.log("Offline Persistence Toolkit PersistenceSyncManager: Sync stopped by beforeSyncRequest event listener"),void e();"skip"!==(h=h||{}).action?("replay"===h.action&&(o.log("Offline Persistence Toolkit PersistenceSyncManager: Replay request from beforeSyncRequest event listener"),u=h.request),l=u.clone(),function(e,t){var r=e,n=r._options.preflightOptionsRequest,s=r._options.preflightOptionsRequestTimeout;if(null!=t.url&&"disabled"!=n&&null!=t.url.match(n)){if(o.log("Offline Persistence Toolkit PersistenceSyncManager: Checking URL based on preflightOptionsRequest"),r._pingedURLs){if(r._pingedURLs.indexOf(t.url)>=0)return Promise.resolve(!0)}else r._pingedURLs=[];return r._preflightOptionsRequestId=(new Date).getTime(),new Promise(function(e){return function(n,o){r._repliedOptionsRequest=!1;var i=new Request(t.url,{method:"OPTIONS"}),a=6e4;null!=s&&(a=s),setTimeout(function(){!r._repliedOptionsRequest&&r._preflightOptionsRequestId==e&&o(!1)},a),r._browserFetch(i).then(function(e){r._repliedOptionsRequest=!0,r._pingedURLs||(r._pingedURLs=[]),r._pingedURLs.push(t.url),n(!0)},function(e){r._repliedOptionsRequest=!0,n(!0)})}}(r._preflightOptionsRequestId))}return Promise.resolve(!0)}(r,u).then(function(){o.log("Offline Persistence Toolkit PersistenceSyncManager: Replaying request with url: "+u.url),r._browserFetch(u).then(function(h){h.status>=400?n({error:h.statusText,requestId:i,request:l.clone(),response:h.clone()}):t._cloneResponse(h,{url:u.url}).then(function(h){o.log("Offline Persistence Toolkit PersistenceSyncManager: Dispatching syncRequest event"),f(r,"syncRequest",{requestId:i,request:l.clone(),response:h.clone()},u.url).then(function(f){a(f)?e():(o.log("Offline Persistence Toolkit PersistenceSyncManager: Removing replayed request"),r.removeRequest(i).then(function(){s.shift(),"GET"==u.method||"HEAD"==u.method?t._cloneResponse(h,{url:u.url}).then(function(e){r._cache().put(u,e).then(function(){
o.log("Offline Persistence Toolkit PersistenceSyncManager: Replayed request/response is cached."),c(s)})}):c(s)},function(e){n({error:e,requestId:i,request:l.clone()})}))})})},function(e){n({error:e,requestId:i,request:l.clone()})})},function(e){if(!1===e){n({error:"Preflight OPTIONS request timed out",requestId:i,request:l.clone(),response:new Response(null,{status:504,statusText:"Preflight OPTIONS request timed out"})})}else n({error:e,requestId:i,request:l.clone()})})):(o.log("Offline Persistence Toolkit PersistenceSyncManager: Removing skipped request"),r.removeRequest(i).then(function(){s.shift(),c(s)},function(e){n({error:e,requestId:i,request:l.clone()})}))}))};s=function(e){if(e&&e.length>0){var t,r,n=[];for(t=0;t<e.length;t++)"GET"!=(r=e[t].request).method&&"HEAD"!=r.method&&n.push(e[t]);for(t=0;t<e.length;t++)("GET"==(r=e[t].request).method||"HEAD"==r.method)&&n.push(e[t]);return n}return e}(s),c(s)}else e()})}).then(function(e){return r._syncing=!1,r._pingedURLs=null,e},function(e){return r._syncing=!1,r._pingedURLs=null,Promise.reject(e)}))},s}),define("impl/OfflineCache",["./defaultCacheHandler","./logger"],function(e,t){"use strict";function r(e,t){if(!e)throw TypeError("A name must be provided to create an OfflineCache!");if(!t)throw TypeError("A persistence store must be provided to create an OfflineCache!");this._name=e,this._store=t}function n(e,t,r){if(r&&r.length)for(var n=0;n<r.length;n++){var o=r[n];if(i(e,t,o))return o.responseData}return null}function o(e,t,r){var n=[];r&&r.length&&(n=r.filter(s(e,t)).map(function(e){return e.responseData}));return n}function s(e,t,r){return function(n){var o;return o=r?n[r]:n,i(e,t,o)}}function i(e,r,n){if(e)return!0;if(!n||!r)return!1;var o=n.requestData.headers,s=n.responseData.headers,i=r.headers,a=s.vary;if(t.log("Offline Persistence Toolkit OfflineCache: Processing HTTP Vary header"),!a)return!0;if("*"===a.trim())return!1;for(var u=a.split(","),l=0;l<u.length;l++){var c=u[l].toLowerCase(),f=i.get(c),h=o[c];if(t.log("Offline Persistence Toolkit OfflineCache: HTTP Vary header name: "+c),t.log("Offline Persistence Toolkit OfflineCache: Request HTTP Vary header value: "+f),t.log("Offline Persistence Toolkit OfflineCache: Cached HTTP Vary header value: "+h),!(!h&&!f||h&&f&&h===f))return!1}return!0}function a(r){if(r){t.log("Offline Persistence Toolkit OfflineCache: Converting cached entry to Response object");var n=[],o=r.bodyAbstract;return o?(n.push(Promise.resolve(JSON.parse(o))),delete r.bodyAbstract):n.push(Promise.resolve()),n.push(e.constructResponse(r)),Promise.all(n)}return Promise.resolve()}function u(e){if(!e||!e.length)return Promise.resolve();var t=e.map(function(e){return a(e)});return Promise.all(t)}return r.prototype.getName=function(){return this._name},r.prototype.add=function(e){t.log("Offline Persistence Toolkit OfflineCache: add()");var r=this;return fetch(e).then(function(t){var n=t.clone();return r.put(e,t).then(function(){Promise.resolve(n)})})},r.prototype.addAll=function(e){t.log("Offline Persistence Toolkit OfflineCache: addAll()");var r=e.map(this.add,this);return Promise.all(r)},r.prototype.match=function(r,o){t.log("Offline Persistence Toolkit OfflineCache: match() for Request with url: "+r.url);var s=e.constructSearchCriteria(r,o),i=o&&o.ignoreVary;return this._store.find(s).then(function(e){return a(n(i,r,e))}).then(function(t){if(t){var n=t[0],o=t[1];return e.fillResponseBodyWithShreddedData(r,n,o)}return Promise.resolve()})},r.prototype.matchAll=function(r,n){t.log("Offline Persistence Toolkit OfflineCache: matchAll() for Request with url: "+r.url);var s=e.constructSearchCriteria(r,n),i=n&&n.ignoreVary;return this._store.find(s).then(function(e){return u(o(i,r,e))}).then(function(t){if(t&&t.length){var n=t.map(function(t){var n=t[0],o=t[1];return e.fillResponseBodyWithShreddedData(r,n,o)});return Promise.all(n)}return Promise.resolve([])})},r.prototype.put=function(r,n){t.log("Offline Persistence Toolkit OfflineCache: put() for Request with url: "+r.url);var o=this,s=[];return s.push(e.constructRequestResponseCacheData(r,n)),s.push(e.shredResponse(r,n)),Promise.all(s).then(function(t){var r=t[0],n=t[1];if(!n)return o._store.upsert(r.key,r.metadata,r.value);var s=[];return r.value.responseData.bodyAbstract=function(e){var t=e.map(function(e){return{name:e.name,keys:e.keys,resourceType:e.resourceType}});return JSON.stringify(t)}(n),s.push(o._store.upsert(r.key,r.metadata,r.value)),s.push(e.cacheShreddedData(n)),Promise.all(s)})},r.prototype.delete=function(e,r){e?t.log("Offline Persistence Toolkit OfflineCache: delete() for Request with url: "+e.url):t.log("Offline Persistence Toolkit OfflineCache: delete()");var n=this;return n.keys(e,r).then(function(e){if(e&&e.length){var t=e.map(n._store.removeByKey,n._store);return Promise.all(t)}return!1}).then(function(e){return!(!e||!e.length)})},r.prototype.keys=function(r,n){r?t.log("Offline Persistence Toolkit OfflineCache: keys() for Request with url: "+r.url):t.log("Offline Persistence Toolkit OfflineCache: keys()");if(r){var o=e.constructSearchCriteria(r,n);o.fields=["key","value"];var i=n&&n.ignoreVary;return this._store.find(o).then(function(e){return e&&e.length?e.filter(s(i,r,"value")).map(function(e){return e.key}):[]})}return this._store.keys()},r.prototype.hasMatch=function(r,o){t.log("Offline Persistence Toolkit OfflineCache: hasMatch() for Request with url: "+r.url);var s=e.constructSearchCriteria(r,o),i=o&&o.ignoreVary;return this._store.find(s).then(function(e){return null!==n(i,r,e)})},r}),define("impl/offlineCacheManager",["../persistenceStoreManager","./OfflineCache","./logger"],function(e,t,r){"use strict";function n(){this._prefix="offlineCaches-",this._caches={},this._cachesArray=[]}return n.prototype.open=function(n){r.log("Offline Persistence Toolkit OfflineCacheManager: open() with name: "+n);var o=this,s=o._caches[n];return s?Promise.resolve(s):e.openStore(o._prefix+n).then(function(e){return s=new t(n,e),o._caches[n]=s,o._cachesArray.push(s),s})},n.prototype.match=function(e,t){r.log("Offline Persistence Toolkit OfflineCacheManager: match() for Request with url: "+e.url);var n=function(r,o){return o===r.length?Promise.resolve():r[o].match(e,t).then(function(e){return e?e.clone():n(r,o+1)})};return n(this._cachesArray,0)},n.prototype.has=function(e){return r.log("Offline Persistence Toolkit OfflineCacheManager: has() for name: "+e),this._caches[e]?Promise.resolve(!0):Promise.resolve(!1)},n.prototype.delete=function(e){r.log("Offline Persistence Toolkit OfflineCacheManager: delete() for name: "+e);var t=this,n=t._caches[e];return n?n.delete().then(function(){return t._cachesArray.splice(t._cachesArray.indexOf(e),1),delete t._caches[e],!0}):Promise.resolve(!1)},n.prototype.keys=function(){r.log("Offline Persistence Toolkit OfflineCacheManager: keys()");for(var e=[],t=0;t<this._cachesArray.length;t++)e.push(this._cachesArray[t].getName());return Promise.resolve(e)},new n}),function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return p.iterable&&(t[Symbol.iterator]=function(){return t}),t}function o(e){this.map={},e instanceof o?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function s(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function i(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var t=new FileReader,r=i(t);return t.readAsArrayBuffer(e),r}function u(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function l(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(p.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(p.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(p.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(p.arrayBuffer&&p.blob&&y(e))this._bodyArrayBuffer=u(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!p.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!v(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=u(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var e=s(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?s(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=s(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,r=i(t);return t.readAsText(e),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this._bodyFormData?Promise.resolve(this._bodyFormData):this.text().then(f)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(e,t){var r=(t=t||{}).body;if(e instanceof c){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new o(e.headers)),this.method=e.method,this.mode=e.mode,!r&&null!=e._bodyInit&&(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new o(t.headers)),this.method=function(e){var t=e.toUpperCase();return g.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function f(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}),t}function h(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new o(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var p={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(p.arrayBuffer)var d=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],y=function(e){return e&&DataView.prototype.isPrototypeOf(e)},v=ArrayBuffer.isView||function(e){return e&&d.indexOf(Object.prototype.toString.call(e))>-1};o.prototype.append=function(e,n){e=t(e),n=r(n);var o=this.map[e];this.map[e]=o?o+","+n:n},o.prototype.delete=function(e){delete this.map[t(e)]},o.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},o.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},o.prototype.set=function(e,n){this.map[t(e)]=r(n)},o.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},o.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),n(e)},o.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),n(e)},o.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),n(e)},p.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];c.prototype.clone=function(){return new c(this,{body:this._bodyInit})},l.call(c.prototype),l.call(h.prototype),h.prototype.clone=function(){return new h(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},h.error=function(){var e=new h(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];h.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new h(null,{status:t,headers:{location:e}})},e.Headers=o,e.Request=c,e.Response=h,e.fetch=function(e,t){return new Promise(function(r,n){var s=new c(e,t),i=new XMLHttpRequest;i.onload=function(){var e={status:i.status,statusText:i.statusText,headers:function(e){var t=new o;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}}),t}(i.getAllResponseHeaders()||"")};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var t="response"in i?i.response:i.responseText;r(new h(t,e))},i.onerror=function(){n(new TypeError("Network request failed"))},i.ontimeout=function(){n(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&p.blob&&(i.responseType="blob"),s.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send(void 0===s._bodyInit?null:s._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),define("impl/fetch",function(){}),define("persistenceManager",["./impl/PersistenceXMLHttpRequest","./impl/PersistenceSyncManager","./impl/offlineCacheManager","./impl/logger","./impl/fetch"],function(e,t,r,n){"use strict";function o(){Object.defineProperty(this,"_registrations",{value:[],writable:!0}),Object.defineProperty(this,"_eventListeners",{value:[],writable:!0}),Object.defineProperty(this,"_forceOffline",{value:!1,writable:!0}),Object.defineProperty(this,"_isOffline",{value:!1,writable:!0}),Object.defineProperty(this,"_cache",{value:null,writable:!0}),Object.defineProperty(this,"_persistenceSyncManager",{value:new t(this.isOnline.bind(this),this.browserFetch.bind(this),this.getCache.bind(this))})}function s(){return"undefined"!=typeof window&&null!=window}function i(e,t,r){var o,s,i,a,u=null,l=e._registrations,c=null!=l?l.length:0;for(o=0;o<c;o++)if(i=l[o],null!=r.request.url.match(i.scope)){for(a=i._eventListeners.length,s=0;s<a;s++)if(i._eventListeners[s].type==t)if("fetch"==t)null===u&&r._setPromiseCallbacks instanceof Function&&(u=new Promise(function(e,t){r._setPromiseCallbacks(e,t)})),n.log("Offline Persistence Toolkit PersistenceManager: Calling fetch event listener"),i._eventListeners[s].listener(r);else if(n.log("Offline Persistence Toolkit PersistenceManager: Calling event listener"),!1===i._eventListeners[s].listener(r))return!1;if(null!=u)return u}return!0}function a(t){var r=t;s()&&!r._browserFetchFunc&&!r._browserXMLHttpRequest&&(n.log("Offline Persistence Toolkit PersistenceManager: Replacing browser APIs"),Object.defineProperty(r,"_browserFetchFunc",{value:window.fetch,writable:!1}),Object.defineProperty(r,"_browserXMLHttpRequest",{value:window.XMLHttpRequest,writable:!1}),window.fetch=function(e){function t(e){Object.defineProperty(this,"isReload",{value:!1,enumerable:!0}),Object.defineProperty(this,"clientId",{value:null,enumerable:!0}),Object.defineProperty(this,"client",{value:null,enumerable:!0}),Object.defineProperty(this,"request",{value:e,enumerable:!0}),Object.defineProperty(this,"_resolveCallback",{value:null,writable:!0}),Object.defineProperty(this,"_rejectCallback",{value:null,writable:!0})}return t.prototype.respondWith=function(e){var t=this;if(e instanceof Promise)e.then(function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e)});else if("function"==typeof e){var r=e();t._resolveCallback(r)}},t.prototype._setPromiseCallbacks=function(e,t){this._resolveCallback=e,this._rejectCallback=t},function(r,n){var o;return o=Request.prototype.isPrototypeOf(r)&&!n?r:new Request(r,n),e.getRegistration(o.url).then(function(r){if(null!=r){var n=new t(o),s=i(e,"fetch",n);if(null!=s&&s instanceof Promise)return s}return e.browserFetch(o)})}}(t),window.XMLHttpRequest=function(){return null!=r._browserFetchRequest?new r._browserXMLHttpRequest:new e(r._browserXMLHttpRequest)})}function u(e,t){Object.defineProperty(this,"scope",{value:e,enumerable:!0}),Object.defineProperty(this,"_persistenceManager",{value:t}),Object.defineProperty(this,"_eventListeners",{value:[],writable:!0})}return o.prototype.init=function(){return a(this),e=this,s()&&!e._addedBrowserEventListeners&&(n.log("Offline Persistence Toolkit PersistenceManager: Adding browser event listeners"),window.addEventListener("offline",function(t){e._isOffline=!0},!1),window.addEventListener("online",function(t){e._isOffline=!1},!1),e._addedBrowserEventListeners=!0),function(e){var t=e;return r.open("systemCache").then(function(e){return t._cache=e,Promise.resolve()})}(this);var e},o.prototype.forceOffline=function(e){n.log("Offline Persistence Toolkit PersistenceManager: forceOffline is called with value: "+e),this._forceOffline=e},o.prototype.getCache=function(){return this._cache},o.prototype.isOnline=function(){var e=navigator.onLine;return navigator.network&&navigator.network.connection&&navigator.network.connection.type==Connection.NONE&&(e=!1,n.log("Offline Persistence Toolkit PersistenceManager: Cordova network info plugin is returning online value: "+e)),e&&!this._isOffline&&!this._forceOffline},o.prototype.register=function(e){var t=new u((e=e||{}).scope,this);return this._registrations.push(t),Promise.resolve(t)},o.prototype.getRegistration=function(e){var t,r,n=this._registrations.length;for(t=0;t<n;t++)if(r=this._registrations[t],e.match(r.scope))return Promise.resolve(r);return Promise.resolve()},o.prototype.getRegistrations=function(){return Promise.resolve(this._registrations.slice())},o.prototype.getSyncManager=function(){return this._persistenceSyncManager},o.prototype.browserFetch=function(e){if(n.log("Offline Persistence Toolkit PersistenceManager: browserFetch() for Request with url: "+e.url),s()){Object.defineProperty(this,"_browserFetchRequest",{value:e,writable:!0});var t=this;return new Promise(function(r,o){n.log("Offline Persistence Toolkit PersistenceManager: Calling browser fetch function for Request with url: "+e.url),t._browserFetchFunc.call(window,e).then(function(e){r(e)},function(e){o(e)}),t._browserFetchRequest=null})}return fetch(e)},u.prototype.addEventListener=function(e,t){this._eventListeners.push({type:e.toLowerCase(),listener:t})},u.prototype.unregister=function(){return Promise.resolve((e=this._persistenceManager,t=this,(n=(r=e)._registrations.indexOf(t))>-1&&(r._registrations.splice(n,1),!0)));var e,t,r,n},new o});