define(["./keyValuePersistenceStore","./logger"],function(e,t){"use strict";var r=function(t){e.call(this,t)};return(r.prototype=new e).Init=function(e){return this._version=e&&e.version||"0",Promise.resolve()},r.prototype._insert=function(e,t,r){var o=this._createRawKey(e),i={metadata:t,value:r},n=JSON.stringify(i);return localStorage.setItem(o,n),Promise.resolve()},r.prototype.removeByKey=function(e){t.log("Offline Persistence Toolkit localPersistenceStore: removeByKey() with key: "+e);var r=this;return this.findByKey(e).then(function(t){if(t){var o=r._createRawKey(e);return localStorage.removeItem(o),Promise.resolve(!0)}return Promise.resolve(!1)})},r.prototype._createRawKey=function(e){return this._name+this._version+e.toString()},r.prototype._extractKey=function(e){var t=this._name+this._version,r=t.length;return 0===e.indexOf(t)?e.slice(r):null},r.prototype.keys=function(){t.log("Offline Persistence Toolkit localPersistenceStore: keys()");for(var e=Object.keys(localStorage),r=[],o=0;o<e.length;o++){var i=this._extractKey(e[o]);i&&r.push(i)}return Promise.resolve(r)},r.prototype.getItem=function(e){t.log("Offline Persistence Toolkit localPersistenceStore: getItem() with key: "+e);var r=this._createRawKey(e),o=localStorage.getItem(r);return o?Promise.resolve(JSON.parse(o)):Promise.resolve()},r});