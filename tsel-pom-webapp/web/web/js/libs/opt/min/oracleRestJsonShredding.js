define(["./persistenceUtils","./impl/logger"],function(e,n){"use strict";return{getShredder:function(e,r){return function(t){n.log("Offline Persistence Toolkit oracleRestJsonShredding: Shredding Response");var s=t.clone(),i=s.headers.get("X-ORACLE-DMS-ECID");return s.text().then(function(t){var s=[],o=[],c="collection";if(null!=t&&t.length>0)try{var l=JSON.parse(t);null!=l.items?(s=l.items.map(function(e){return e[r]}),o=l.items):(s[0]=l[r],o[0]=l,c="single")}catch(e){n.log("Offline Persistence Toolkit oracleRestJsonShredding: Error during shredding: "+e)}return[{name:e,resourceIdentifier:i,keys:s,data:o,resourceType:c}]})}},getUnshredder:function(){return function(r,t){n.log("Offline Persistence Toolkit oracleRestJsonShredding: Unshredding Response");var s=function(e,n){if(!e||1!==e.length)throw new Error({message:"shredded data is not in the correct format."});var r=e[0].data;return r&&1===r.length&&"single"===e[0].resourceType?r[0]:{items:r,count:r.length}}(r);return e.setResponsePayload(t,s).then(function(e){return e.headers.set("x-oracle-jscpt-cache-expiration-date",""),e})}}}});