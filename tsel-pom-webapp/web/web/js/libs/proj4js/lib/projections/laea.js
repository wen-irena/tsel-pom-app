import{HALF_PI,EPSLN,FORTPI}from"../constants/values";import qsfnz from"../common/qsfnz";import adjust_lon from"../common/adjust_lon";export var S_POLE=1;export var N_POLE=2;export var EQUIT=3;export var OBLIQ=4;export function init(){var s,t=Math.abs(this.lat0);if(Math.abs(t-HALF_PI)<EPSLN?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<EPSLN?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),s=Math.sin(this.lat0),this.sinb1=qsfnz(this.e,s)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*s*s)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))};export function forward(s){var t,h,i,a,e,r,o,n,m,L,P=s.x,d=s.y;if(P=adjust_lon(P-this.long0),this.sphere){if(e=Math.sin(d),L=Math.cos(d),i=Math.cos(P),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((h=this.mode===this.EQUIT?1+L*i:1+this.sinph0*e+this.cosph0*L*i)<=EPSLN)return null;t=(h=Math.sqrt(2/h))*L*Math.sin(P),h*=this.mode===this.EQUIT?e:this.cosph0*e-this.sinph0*L*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(d+this.phi0)<EPSLN)return null;h=FORTPI-.5*d,t=(h=2*(this.mode===this.S_POLE?Math.cos(h):Math.sin(h)))*Math.sin(P),h*=i}}else{switch(o=0,n=0,m=0,i=Math.cos(P),a=Math.sin(P),e=Math.sin(d),r=qsfnz(this.e,e),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=r/this.qp,n=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:m=1+this.sinb1*o+this.cosb1*n*i;break;case this.EQUIT:m=1+n*i;break;case this.N_POLE:m=HALF_PI+d,r=this.qp-r;break;case this.S_POLE:m=d-HALF_PI,r=this.qp+r}if(Math.abs(m)<EPSLN)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:m=Math.sqrt(2/m),h=this.mode===this.OBLIQ?this.ymf*m*(this.cosb1*o-this.sinb1*n*i):(m=Math.sqrt(2/(1+n*i)))*o*this.ymf,t=this.xmf*m*n*a;break;case this.N_POLE:case this.S_POLE:r>=0?(t=(m=Math.sqrt(r))*a,h=i*(this.mode===this.S_POLE?m:-m)):t=h=0}}return s.x=this.a*t+this.x0,s.y=this.a*h+this.y0,s};export function inverse(s){s.x-=this.x0,s.y-=this.y0;var t,h,i,a,e,r,o,n=s.x/this.a,m=s.y/this.a;if(this.sphere){var L,P=0,d=0;if((h=.5*(L=Math.sqrt(n*n+m*m)))>1)return null;switch(h=2*Math.asin(h),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(d=Math.sin(h),P=Math.cos(h)),this.mode){case this.EQUIT:h=Math.abs(L)<=EPSLN?0:Math.asin(m*d/L),n*=d,m=P*L;break;case this.OBLIQ:h=Math.abs(L)<=EPSLN?this.phi0:Math.asin(P*this.sinph0+m*d*this.cosph0/L),n*=d*this.cosph0,m=(P-Math.sin(h)*this.sinph0)*L;break;case this.N_POLE:m=-m,h=HALF_PI-h;break;case this.S_POLE:h-=HALF_PI}t=0!==m||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(n,m):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(n/=this.dd,m*=this.dd,(r=Math.sqrt(n*n+m*m))<EPSLN)return s.x=0,s.y=this.phi0,s;a=2*Math.asin(.5*r/this.rq),i=Math.cos(a),n*=a=Math.sin(a),this.mode===this.OBLIQ?(o=i*this.sinb1+m*a*this.cosb1/r,e=this.qp*o,m=r*this.cosb1*i-m*this.sinb1*a):(o=m*a/r,e=this.qp*o,m=r*i)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(m=-m),!(e=n*n+m*m))return s.x=0,s.y=this.phi0,s;o=1-e/this.qp,this.mode===this.S_POLE&&(o=-o)}t=Math.atan2(n,m),h=authlat(Math.asin(o),this.apa)}return s.x=adjust_lon(this.long0+t),s.y=h,s};var P00=.3333333333333333,P01=.17222222222222222,P02=.10257936507936508,P10=.06388888888888888,P11=.0664021164021164,P20=.016415012942191543;function authset(s){var t,h=[];return h[0]=s*P00,t=s*s,h[0]+=t*P01,h[1]=t*P10,t*=s,h[0]+=t*P02,h[1]+=t*P11,h[2]=t*P20,h}function authlat(s,t){var h=s+s;return s+t[0]*Math.sin(h)+t[1]*Math.sin(h+h)+t[2]*Math.sin(h+h+h)}export var names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];export default{init:init,forward:forward,inverse:inverse,names:names,S_POLE:S_POLE,N_POLE:N_POLE,EQUIT:EQUIT,OBLIQ:OBLIQ};