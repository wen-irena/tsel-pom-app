import msfnz from"../common/msfnz";import qsfnz from"../common/qsfnz";import adjust_lon from"../common/adjust_lon";import asinz from"../common/asinz";import{EPSLN}from"../constants/values";export function init(){Math.abs(this.lat1+this.lat2)<EPSLN||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=qsfnz(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>EPSLN?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)};export function forward(s){var t=s.x,i=s.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var h=qsfnz(this.e3,this.sin_phi,this.cos_phi),n=this.a*Math.sqrt(this.c-this.ns0*h)/this.ns0,o=this.ns0*adjust_lon(t-this.long0),a=n*Math.sin(o)+this.x0,r=this.rh-n*Math.cos(o)+this.y0;return s.x=a,s.y=r,s};export function inverse(s){var t,i,h,n,o,a;return s.x-=this.x0,s.y=this.rh-s.y+this.y0,this.ns0>=0?(t=Math.sqrt(s.x*s.x+s.y*s.y),h=1):(t=-Math.sqrt(s.x*s.x+s.y*s.y),h=-1),n=0,0!==t&&(n=Math.atan2(h*s.x,h*s.y)),h=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-h*h)/(2*this.ns0)):(i=(this.c-h*h)/this.ns0,a=this.phi1z(this.e3,i)),o=adjust_lon(n/this.ns0+this.long0),s.x=o,s.y=a,s};export function phi1z(s,t){var i,h,n,o,a,r=asinz(.5*t);if(s<EPSLN)return r;for(var p=s*s,e=1;e<=25;e++)if(i=Math.sin(r),h=Math.cos(r),r+=a=.5*(o=1-(n=s*i)*n)*o/h*(t/(1-p)-i/o+.5/s*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-7)return r;return null};export var names=["Albers_Conic_Equal_Area","Albers","aea"];export default{init:init,forward:forward,inverse:inverse,names:names,phi1z:phi1z};