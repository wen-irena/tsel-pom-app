import pj_enfn from"../common/pj_enfn";import pj_mlfn from"../common/pj_mlfn";import pj_inv_mlfn from"../common/pj_inv_mlfn";import adjust_lon from"../common/adjust_lon";import{EPSLN,HALF_PI}from"../constants/values";import sign from"../common/sign";export function init(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=pj_enfn(this.es),this.ml0=pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))};export function forward(t){var s,h,i,a=t.x,o=t.y,n=adjust_lon(a-this.long0),r=Math.sin(o),e=Math.cos(o);if(this.es){var M=e*n,p=Math.pow(M,2),l=this.ep2*Math.pow(e,2),m=Math.pow(l,2),f=Math.abs(e)>EPSLN?Math.tan(o):0,v=Math.pow(f,2),_=Math.pow(v,2);s=1-this.es*Math.pow(r,2),M/=Math.sqrt(s);var c=pj_mlfn(o,r,e,this.en);h=this.a*(this.k0*M*(1+p/6*(1-v+l+p/20*(5-18*v+_+14*l-58*v*l+p/42*(61+179*_-_*v-479*v)))))+this.x0,i=this.a*(this.k0*(c-this.ml0+r*n*M/2*(1+p/12*(5-v+9*l+4*m+p/30*(61+_-58*v+270*l-330*v*l+p/56*(1385+543*_-_*v-3111*v))))))+this.y0}else{var w=e*Math.sin(n);if(Math.abs(Math.abs(w)-1)<EPSLN)return 93;if(h=.5*this.a*this.k0*Math.log((1+w)/(1-w))+this.x0,i=e*Math.cos(n)/Math.sqrt(1-Math.pow(w,2)),(w=Math.abs(i))>=1){if(w-1>EPSLN)return 93;i=0}else i=Math.acos(i);o<0&&(i=-i),i=this.a*this.k0*(i-this.lat0)+this.y0}return t.x=h,t.y=i,t};export function inverse(t){var s,h,i,a,o=(t.x-this.x0)*(1/this.a),n=(t.y-this.y0)*(1/this.a);if(this.es)if(s=this.ml0+n/this.k0,h=pj_inv_mlfn(s,this.es,this.en),Math.abs(h)<HALF_PI){var r=Math.sin(h),e=Math.cos(h),M=Math.abs(e)>EPSLN?Math.tan(h):0,p=this.ep2*Math.pow(e,2),l=Math.pow(p,2),m=Math.pow(M,2),f=Math.pow(m,2);s=1-this.es*Math.pow(r,2);var v=o*Math.sqrt(s)/this.k0,_=Math.pow(v,2);i=h-(s*=M)*_/(1-this.es)*.5*(1-_/12*(5+3*m-9*p*m+p-4*l-_/30*(61+90*m-252*p*m+45*f+46*p-_/56*(1385+3633*m+4095*f+1574*f*m)))),a=adjust_lon(this.long0+v*(1-_/6*(1+2*m+p-_/20*(5+28*m+24*f+8*p*m+6*p-_/42*(61+662*m+1320*f+720*f*m))))/e)}else i=HALF_PI*sign(n),a=0;else{var c=Math.exp(o/this.k0),w=.5*(c-1/c),x=this.lat0+n/this.k0,j=Math.cos(x);s=Math.sqrt((1-Math.pow(j,2))/(1+Math.pow(w,2))),i=Math.asin(s),n<0&&(i=-i),a=0===w&&0===j?0:adjust_lon(Math.atan2(w,j)+this.long0)}return t.x=a,t.y=i,t};export var names=["Transverse_Mercator","Transverse Mercator","tmerc"];export default{init:init,forward:forward,inverse:inverse,names:names};