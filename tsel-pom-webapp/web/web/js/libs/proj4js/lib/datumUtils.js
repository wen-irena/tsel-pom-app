"use strict";import{PJD_3PARAM,PJD_7PARAM,HALF_PI}from"./constants/values";export function compareDatums(a,t){return a.datum_type===t.datum_type&&(!(a.a!==t.a||Math.abs(a.es-t.es)>5e-11)&&(a.datum_type===PJD_3PARAM?a.datum_params[0]===t.datum_params[0]&&a.datum_params[1]===t.datum_params[1]&&a.datum_params[2]===t.datum_params[2]:a.datum_type!==PJD_7PARAM||a.datum_params[0]===t.datum_params[0]&&a.datum_params[1]===t.datum_params[1]&&a.datum_params[2]===t.datum_params[2]&&a.datum_params[3]===t.datum_params[3]&&a.datum_params[4]===t.datum_params[4]&&a.datum_params[5]===t.datum_params[5]&&a.datum_params[6]===t.datum_params[6]))};export function geodeticToGeocentric(a,t,r){var m,e,s,u,_=a.x,p=a.y,n=a.z?a.z:0;if(p<-HALF_PI&&p>-1.001*HALF_PI)p=-HALF_PI;else if(p>HALF_PI&&p<1.001*HALF_PI)p=HALF_PI;else if(p<-HALF_PI||p>HALF_PI)return null;return _>Math.PI&&(_-=2*Math.PI),e=Math.sin(p),u=Math.cos(p),s=e*e,{x:((m=r/Math.sqrt(1-t*s))+n)*u*Math.cos(_),y:(m+n)*u*Math.sin(_),z:(m*(1-t)+n)*e}};export function geocentricToGeodetic(a,t,r,m){var e,s,u,_,p,n,P,d,o,A,i,M,x,c,y,z=a.x,h=a.y,f=a.z?a.z:0;if(e=Math.sqrt(z*z+h*h),s=Math.sqrt(z*z+h*h+f*f),e/r<1e-12){if(c=0,s/r<1e-12)return HALF_PI,y=-m,{x:a.x,y:a.y,z:a.z}}else c=Math.atan2(h,z);u=f/s,d=(_=e/s)*(1-t)*(p=1/Math.sqrt(1-t*(2-t)*_*_)),o=u*p,x=0;do{x++,n=t*(P=r/Math.sqrt(1-t*o*o))/(P+(y=e*d+f*o-P*(1-t*o*o))),M=(i=u*(p=1/Math.sqrt(1-n*(2-n)*_*_)))*d-(A=_*(1-n)*p)*o,d=A,o=i}while(M*M>1e-24&&x<30);return{x:c,y:Math.atan(i/Math.abs(A)),z:y}};export function geocentricToWgs84(a,t,r){if(t===PJD_3PARAM)return{x:a.x+r[0],y:a.y+r[1],z:a.z+r[2]};if(t===PJD_7PARAM){var m=r[0],e=r[1],s=r[2],u=r[3],_=r[4],p=r[5],n=r[6];return{x:n*(a.x-p*a.y+_*a.z)+m,y:n*(p*a.x+a.y-u*a.z)+e,z:n*(-_*a.x+u*a.y+a.z)+s}}};export function geocentricFromWgs84(a,t,r){if(t===PJD_3PARAM)return{x:a.x-r[0],y:a.y-r[1],z:a.z-r[2]};if(t===PJD_7PARAM){var m=r[0],e=r[1],s=r[2],u=r[3],_=r[4],p=r[5],n=r[6],P=(a.x-m)/n,d=(a.y-e)/n,o=(a.z-s)/n;return{x:P+p*d-_*o,y:-p*P+d+u*o,z:_*P-u*d+o}}};