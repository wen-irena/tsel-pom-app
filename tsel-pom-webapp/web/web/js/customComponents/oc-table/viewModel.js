define(["knockout","jquery","common/exportService","ojs/ojcheckboxset","ojs/ojselectcombobox","ojs/ojrowexpander"],function(o,e,t){function s(o,e,t){localStorage.setItem(encodeURIComponent(o),encodeURIComponent(e))}return function(l){var r=this;r.props,r.id=o.observable(),r.columns=o.observableArray(),r.columnList=o.observableArray(),r.columnDisplayed=o.observableArray(),r.componentOptions=o.observable(),r.showExport=o.observable(!1),r.showPrint=o.observable(!1),r.showColDisp=o.observable(!1),r.showPagination=o.observable(!1),r.pageSize=o.observable(10),r.dataSource,r.props=l.properties,r.tableId=o.pureComputed(function(){return"#myTable_"+r.props.id});var a=r.props.columns,p=r.props.slot;if(p){var n=p.toString();r.showExport(n.includes("export")),r.showPrint(n.includes("print")),r.showColDisp(n.includes("colDisp")),r.showPagination(n.includes("pagination"))}r.columns(a);for(var i,d=[],u=[],c=[],b=JSON.parse((i=r.tableId(),localStorage.getItem(i)?decodeURIComponent(localStorage.getItem(i)):null)),m=0;m<a.length;m++)if(a[m].field&&d.push({label:a[m].headerText,field:a[m].field}),null!==b){if(a[m].field)for(var f=0;f<b.length;++f)a[m].field===b[f].field&&(u.push(a[m].field),c.push(a[m]));else c.push(a[m]);r.props.columns=c}else u.push(a[m].field);r.columnList(d),r.columnDisplayed(u),r.activated=function(o){r.dataSource=r.props.data;var e={component:"ojTable",data:r.props.data,columns:r.props.columns};e.display=r.props.display?r.props.display:"grid",e.rootAttributes=r.props.rootAttributes?r.props.rootAttributes:{style:"width:100%;overflow-x: auto; overflow-y: hidden;"},e.selectionMode=r.props.selectionMode?r.props.selectionMode:{row:"single"},e.scrollPolicyOptions=r.props.scrollPolicyOptions?r.props.scrollPolicyOptions:"auto",e.columnsDefault=r.props.columnsDefault?r.props.columnsDefault:{sortable:"auto"},r.props.editMode&&(e.editMode=r.props.editMode),r.props.beforeCurrentRow&&(e.beforeCurrentRow=r.props.beforeCurrentRow),r.props.rowTemplate&&(e.rowTemplate=r.props.rowTemplate),r.props.pageSize&&r.pageSize(r.props.pageSize),r.props.msgNoData&&(e.translations={msgNoData:r.props.msgNoData}),r.componentOptions(e)},r.printData=function(){printContent("myPrint,page-title")},r.exportxls=function(){t.export(e(r.tableId()).ojTable("option","columns"),r.props.data.Md?r.props.data.Md.Ca.data:r.props.data.Ca.data?r.props.data.Ca.data:[],"xlsx","Data.xlsx")},r.onChangedSelection=function(o,t){var l,a=[];if(t.value.length>0)for(var p=0;p<r.columns().length;p++){var n=r.columns()[p];if(n.field){for(var i=0;i<t.value.length;i++)if(t.value[i]===n.field){a.push(n),s(r.tableId(),JSON.stringify(a));break}}else a.push(n)}else l=r.tableId(),localStorage.removeItem(l),console.log("hide");e(r.tableId()).ojTable({columns:a})},r.onChangedSelectionAll=function(){for(var o=[],t=[],l=0;l<r.columns().length;l++){var a=r.columns()[l];a.field?(o.push(a),t.push(a.field),s(r.tableId(),JSON.stringify(o))):o.push(a)}t.length>0&&r.columnDisplayed(t),e(r.tableId()).ojTable({columns:o})}}});