define(["ojs/ojcore","knockout","jquery","../appController","common/constants","common/configService","common/restService","common/rendererService","common/exportService","ojs/ojdatetimepicker","ojs/ojcheckboxset"],function(e,o,n,t,a,s,r,l,c){this.openres_downloadTemplate=function(){document.getElementById("my_iframe").src=s.portalServiceUrl+"/js/data/open_restriction_template.csv"};const i=this;return new function(){i.serviceUrl=r.orderService,i.openres_allData=o.observableArray(),i.openres_tableWidth=o.observable("100%"),i.openres_display="grid",i.openres_columnsDefault={sortable:"auto"},i.openres_scrollPolicy="loadMoreOnScroll",i.openres_scrollPolicyOptions={fetchSize:10},i.openres_rootAttributes={style:"width:100%;overflow-x: auto; overflow-y: hidden;"},i.openres_selectionMode={row:"single"},i.openres_datasource=new e.PagingTableDataSource(new e.ArrayTableDataSource(i.openres_allData,{idAttribute:"msisdn"})),i.openres_fetchSize=o.observable(),i.openres_disabledOpenRestriction=o.observable(!0),i.openres_columns=[{headerTemplate:"action-template-header",template:"action-template-detail",sortable:!1},{headerText:"MSISDN",field:"msisdn"}],i.openres_fileName=o.observable(),i.openres_onBrowse=function(){document.getElementById("browseFile").click()},onChangeFile=function(){i.openres_fileName(document.getElementById("browseFile").files[0].name)},i.openres_onUpload=function(){var e=document.getElementById("browseFile").files[0];if(void 0!==e)if("application/vnd.ms-excel"===e.type||"text/csv"===e.type){var o=new FileReader;o.readAsText(e),o.onload=function(){var e=o.result;jsondata=function(e){for(var o=e.split("\r\n"),n=[],t=o[0].split(","),a=1;a<o.length;a++){for(var s={},r=o[a].split(","),l=0;l<t.length;l++)s[t[l]]=r[l];n.push(s)}return n}(e),console.log(jsondata),jsondata&&i.openres_allData(jsondata)}}else showErrorMessage("ERROR!","Invalid file type, please upload file with CSV format.");else showErrorMessage("ERROR!","No file uploaded.")},i.openres_checkedData=o.observableArray(),i.openres_onSelectAll=function(e,o){if(n("#cbAll").prop("checked")){let e=i.openres_allData();e.forEach(e=>{e.isChecked=e.msisdn}),i.openres_allData([]),i.openres_allData(e);let o=e.map(e=>e.msisdn);i.openres_checkedData(o)}else{let e=i.openres_allData();e.forEach(e=>{e.isChecked=[]}),i.openres_allData([]),i.openres_allData(e),i.openres_checkedData([])}},i.openres_onSelect=function(e,o){var t=i.openres_allData().findIndex(function(o){return o.msisdn===e.msisdn});if(i.openres_allData()[t].isChecked=!i.openres_allData()[t].isChecked,n(o.currentTarget).is(":checked"))i.openres_checkedData().push(e.msisdn);else{var a=i.openres_checkedData();i.openres_checkedData(a.filter(function(o){return o!==e.msisdn}))}0!==i.openres_checkedData().length?i.openres_disabledOpenRestriction(!1):i.openres_disabledOpenRestriction(!0)},i.openres_onClearAll=function(){i.openres_fileName(""),document.getElementById("browseFile").value="",n("#cbAll").prop("checked",!1),n(".cbRow").prop("checked",!1),openres_checkedData([]),showConfirmationMessage("Success","Clear All Data successfully executed.")},i.openres_onRetry=function(){e.IntlConverterUtils.dateToLocalIso(new Date),a.channel,openres_checkedData(),showConfirmationMessage("Success","Retry successfully executed.")},i.openres_onCancel=function(){showConfirmationMessage("Success","Cancel successfully executed.")},i.openres_onDownloadTemplate=function(){var e=s.portalServiceUrl+"/js/data/open_restriction_template.csv",o=document.createElement("a");o.download=e.substr(e.lastIndexOf("/")+1),o.target="_blank",o.href=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),delete o}}});