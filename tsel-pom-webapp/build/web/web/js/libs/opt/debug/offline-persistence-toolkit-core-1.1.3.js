define("impl/logger",[],function(){"use strict";function e(){Object.defineProperty(this,"LEVEL_NONE",{value:0,enumerable:!0}),Object.defineProperty(this,"LEVEL_ERROR",{value:1,enumerable:!0}),Object.defineProperty(this,"LEVEL_WARN",{value:2,enumerable:!0}),Object.defineProperty(this,"LEVEL_INFO",{value:3,enumerable:!0}),Object.defineProperty(this,"LEVEL_LOG",{value:4,enumerable:!0}),Object.defineProperty(this,"_METHOD_ERROR",{value:"error"}),Object.defineProperty(this,"_METHOD_WARN",{value:"warn"}),Object.defineProperty(this,"_METHOD_INFO",{value:"info"}),Object.defineProperty(this,"_METHOD_LOG",{value:"log"}),Object.defineProperty(this,"_defaultOptions",{value:{level:this.LEVEL_ERROR,writer:null}}),Object.defineProperty(this,"_options",{value:this._defaultOptions,writable:!0})}function t(e,r,n,o){var s=e;if(!(s.option("level")<r)){var i=function(e){var t=e,r=null;t.option("writer")?r=t.option("writer"):"undefined"!=typeof window&&void 0!==window.console&&(r=window.console);return r}(s);if(null!=i){if(1==o.length&&o[0]instanceof Function)o=[o[0]()];i[n]&&i[n].apply?i[n].apply(i,o):i[n]&&(i[n]=Function.prototype.bind.call(i[n],i),t(s,r,n,o))}}}return e.prototype.error=function(e){t(this,this.LEVEL_ERROR,this._METHOD_ERROR,arguments)},e.prototype.info=function(e){t(this,this.LEVEL_INFO,this._METHOD_INFO,arguments)},e.prototype.warn=function(e){t(this,this.LEVEL_WARN,this._METHOD_WARN,arguments)},e.prototype.log=function(e){t(this,this.LEVEL_LOG,this._METHOD_LOG,arguments)},e.prototype.option=function(e,t){var r,n={};if(0==arguments.length){for(r in this._options)this._options.hasOwnProperty(r)&&(n[r]=this._options[r]);return n}if("string"==typeof e&&void 0===t)return void 0===this._options[e]?null:this._options[e];if("string"==typeof e)this._options[e]=t;else{var o=e;for(r in o)o.hasOwnProperty(r)&&this.option(r,o[r])}},new e}),define("persistenceUtils",["./impl/logger"],function(e){"use strict";function t(e){var t=e.get("Content-Type");return!(!t||-1===t.indexOf("text/")&&-1===t.indexOf("application/json"))}function r(t,r){e.log("Offline Persistence Toolkit persistenceUtils: requestToJSON()"),r&&r._noClone||(t=t.clone());var i={};return n(t,i,["body","headers","signal"]),i.headers=o(t.headers),s(t,i)}function n(e,t,r){for(var n in e)"function"!=typeof e[n]&&0!==n.indexOf("_")&&-1===r.indexOf(n)&&(t[n]=e[n])}function o(t){var r={};if(t.entries){var n,o,s,i=t.entries();do{(n=i.next()).value&&(o=n.value[0],s=n.value[1],r[o]=s)}while(!n.done)}else t.forEach&&t.forEach(function(e,t){r[t]=e});return function(t){var r=t.date;r||(e.log("Offline Persistence Toolkit persistenceUtils: Setting HTTP date header since it's null or not exposed"),r=(new Date).toUTCString(),t.date=r)}(r),r}function s(r,n){return n.body={},r instanceof Request&&(o=r.headers,(s=o.get("Content-Type"))&&-1!==s.indexOf("multipart/"))?function(t,r){if(e.log("Offline Persistence Toolkit persistenceUtils: Copying multipart payload"),"function"==typeof t.formData)return t.formData().then(function(e){var t,n,o,s,i={},a=e.entries();do{t=a.next(),(n=t.value)&&(o=n[0],s=n[1],i[o]=s)}while(!t.done);return r.body.formData=i,r});var n=t.headers.get("Content-Type");return t.text().then(function(e){for(var t=c(e,n),o={},s=0;s<t.length;s++)o[t[s].headers.name]=t[s].data;return r.body.formData=o,r})}(r,n):r instanceof Request||t(r.headers)?r.text().then(function(e){return n.body.text=e,n}):r instanceof Request||"function"!=typeof r.arrayBuffer?Promise.reject(new Error({message:"payload body type is not supported"})):r.arrayBuffer().then(function(e){return e.byteLength>0&&(n.body.arrayBuffer=e),n});var o,s}function i(t,r){e.log("Offline Persistence Toolkit persistenceUtils: responseToJSON()"),r&&r._noClone||(t=t.clone());var i={};return n(t,i,["body","headers"]),i.headers=o(t.headers),r&&r.excludeBody?Promise.resolve(i):s(t,i)}function a(t){e.log("Offline Persistence Toolkit persistenceUtils: requestFromJSON()");var r={};n(t,r,["headers","body","signal"]);var o=function(e,t){var r=!1,n=e.body;if(n.text&&n.text.length>0)t.body=n.text;else if(n.arrayBuffer)t.body=n.arrayBuffer;else if(n.formData){r=!0;var o=new FormData,s=n.formData;Object.keys(s).forEach(function(e){o.append(e,s[e])}),t.body=o}return r}(t,r);return r.headers=u(t,o),function(e,t){return Promise.resolve(new Request(e.url,t))}(t,r)}function u(e,t){var r=new Headers;return Object.keys(e.headers).forEach(function(n){("content-type"!==n||!t&&"content-type"===n)&&r.append(n,e.headers[n])}),r}function l(t){e.log("Offline Persistence Toolkit persistenceUtils: responseFromJSON()");var r={};return n(t,r,["headers","body"]),r.headers=u(t,!1),function(e,t){var r,n=e.body;n&&n.text?r=new Response(n.text,t):n&&n.arrayBuffer?(t.responseType="blob",r=new Response(n.arrayBuffer,t)):n&&n.blob?(t.responseType="blob",r=new Response(n.blob,t)):r=new Response(null,t);return Promise.resolve(r)}(t,r)}function c(t,r){e.log("Offline Persistence Toolkit persistenceUtils: parseMultipartFormData()");var n=r.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new Error("not a valid multipart form data value.");var o,s=function(e){for(var t={},r={},n=e.split("\r\n"),o=0;o<n.length;o++){var s=n[o];if(0!==s.length){var i=s.split(";");if(1===i.length&&0===i[0].indexOf("Content-Type"))t.contentType=i[0].split(":")[1].trim();else for(var a=0;a<i.length;a++)if(-1!==i[a].indexOf("=")){var u=i[a].split("=");r[u[0].trim()]=u[1].substring(1,u[1].length-1)}}}return t.headers=r,t},i=function(e,t){var r=e.split("\r\n");return t&&t.indexOf("image")>=0?a(r[0],t):r[0]},a=function(e,t){var r=null;try{r=atob(e)}catch(e){return null}for(var n=new ArrayBuffer(r.length),o=new Uint8Array(n),s=0;s<r.length;s++)o[s]=r.charCodeAt(s);return new Blob([n],{type:t})},u=n[1]||n[2];if("string"==typeof t)o=t;else{var l=new Uint8Array(t);o=String.fromCharCode.apply(null,l)}for(var c=o.split(new RegExp(u)),f=[],h=1;h<c.length-1;h++){var p={},d=c[h].split("\r\n\r\n"),y=d[0],v=d[1],g=s(y);p.headers=g.headers,p.data=i(v,g.contentType),f.push(p)}return f}return{requestToJSON:r,requestFromJSON:a,responseToJSON:i,responseFromJSON:l,setResponsePayload:function(t,r){return e.log("Offline Persistence Toolkit persistenceUtils: setResponsePayload()"),i(t).then(function(e){var t=e.body;if(t.arrayBuffer){if(!(r instanceof ArrayBuffer))throw new Error({message:"unexpected payload"});t.arrayBuffer=r}else r instanceof Blob?t.blob=r:t.text=JSON.stringify(r);return l(e)})},parseMultipartFormData:c,isCachedResponse:function(e){return e.headers.has("x-oracle-jscpt-cache-expiration-date")},isGeneratedEtagResponse:function(e){return e.headers.has("x-oracle-jscpt-etag-generated")},_isTextPayload:t,buildEndpointKey:function(t){e.log("Offline Persistence Toolkit persistenceUtils: buildEndpointKey() for Request with url: "+t.url);var r={url:t.url,id:Math.random().toString(36).replace(/[^a-z]+/g,"")};return JSON.stringify(r)},_cloneRequest:function(e){return r(e,{_noClone:!0}).then(function(e){return a(e).then(function(e){return e})})},_cloneResponse:function(e,t){return t=t||{},i(e,{_noClone:!0}).then(function(e){return l(e).then(function(e){return null!=t.url&&t.url.length>0&&null==e.headers.get("x-oracle-jscpt-response-url")&&e.headers.set("x-oracle-jscpt-response-url",t.url),e})})}}}),define("impl/PersistenceXMLHttpRequest",["../persistenceUtils","./logger"],function(e,t){"use strict";function r(e){var t=this;Object.defineProperty(this,"_eventListeners",{value:[],writable:!0}),Object.defineProperty(this,"_browserXMLHttpRequest",{value:e}),Object.defineProperty(this,"_method",{value:null,writable:!0}),Object.defineProperty(this,"onabort",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onerror",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onload",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onloadend",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onloadstart",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onprogress",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"onreadystatechange",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"ontimeout",{value:null,enumerable:!0,writable:!0}),Object.defineProperty(this,"_password",{value:null,writable:!0}),Object.defineProperty(this,"_readyState",{value:0,writable:!0}),Object.defineProperty(this,"readyState",{enumerable:!0,get:function(){return t._readyState}}),Object.defineProperty(this,"_requestHeaders",{value:{},writable:!0}),Object.defineProperty(this,"_response",{value:"",writable:!0}),Object.defineProperty(this,"response",{enumerable:!0,get:function(){return t._response}}),Object.defineProperty(this,"_responseHeaders",{value:{},writable:!0}),Object.defineProperty(this,"_responseText",{value:"",writable:!0}),Object.defineProperty(this,"responseText",{enumerable:!0,get:function(){return t._responseText}}),Object.defineProperty(this,"responseType",{value:"",enumerable:!0,writable:!0}),Object.defineProperty(this,"_responseURL",{value:"",writable:!0}),Object.defineProperty(this,"responseURL",{enumerable:!0,get:function(){return t._responseURL}}),Object.defineProperty(this,"_responseXML",{value:null,writable:!0}),Object.defineProperty(this,"responseXML",{enumerable:!0,get:function(){return t._responseXML}}),Object.defineProperty(this,"_status",{value:0,writable:!0}),Object.defineProperty(this,"status",{enumerable:!0,get:function(){return t._status}}),Object.defineProperty(this,"_statusText",{value:"",writable:!0}),Object.defineProperty(this,"statusText",{enumerable:!0,get:function(){return t._statusText}}),Object.defineProperty(this,"timeout",{value:0,enumerable:!0}),Object.defineProperty(this,"upload",{value:null,enumerable:!0}),Object.defineProperty(this,"_url",{value:null,writable:!0}),Object.defineProperty(this,"_username",{value:null,writable:!0}),Object.defineProperty(this,"withCredentials",{value:!1,enumerable:!0,writable:!0})}function n(e,t){e._readyState=t,e.dispatchEvent(new s("readystatechange")),e._readyState==r.DONE&&(e.dispatchEvent(new s("load",!1,!1,e)),e.dispatchEvent(new s("loadend",!1,!1,e)))}function o(e){if(e._readyState!==r.OPENED)throw new Error("INVALID_STATE_ERR")}function s(e,t,r,n){Object.defineProperty(this,"type",{value:e,enumerable:!0}),Object.defineProperty(this,"bubbles",{value:t,enumerable:!0}),Object.defineProperty(this,"cancelable",{value:r,enumerable:!0}),Object.defineProperty(this,"target",{value:n,enumerable:!0})}return Object.defineProperty(r,"UNSENT",{value:0,enumerable:!0}),Object.defineProperty(r,"OPENED",{value:1,enumerable:!0}),Object.defineProperty(r,"HEADERS_RECEIVED",{value:2,enumerable:!0}),Object.defineProperty(r,"LOADING",{value:3,enumerable:!0}),Object.defineProperty(r,"DONE",{value:4,enumerable:!0}),r.prototype.open=function(e,o,s,i,a){if(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: open() for method: "+e+", url: "+o),"boolean"==typeof s&&!s)throw new Error("InvalidAccessError: Failed to execute 'open' on 'XMLHttpRequest': Synchronous requests are disabled on the XHR Adapter");if(this._method=e,this._url=o,function(e){var t=e.toLowerCase();if(0===t.indexOf("http:")||0===t.indexOf("https:"))return!1;if(0===t.indexOf("file:"))return!0;if(URL&&URL.prototype&&null!=(t=new URL(e,window.location.href).origin)&&"null"!=t&&t.length>0)return 0===t.toLowerCase().indexOf("file:");var r=document.createElement("a");if(r.href=e,(t=r.protocol)&&0===t.toLowerCase().indexOf("file:"))return!0;return!1}(o)){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: open called for a File url");var u=this;this._passthroughXHR=new u._browserXMLHttpRequest,this._passthroughXHR.onreadystatechange=function(){u._passthroughXHR.readyState==r.DONE&&(u._status=u._passthroughXHR.status,u._statusText=u._passthroughXHR.statusText,u._response=u._passthroughXHR.response,u._responseHeaders=u._passthroughXHR.responseHeaders,u._responseType=u._passthroughXHR.responseType,null!=u._responseType&&""!=u._responseType&&"text"!=u._responseType||(u._responseText=u._passthroughXHR.responseText),u._responseURL=u._passthroughXHR.responseURL,null!=u._responseType&&""!=u._responseType&&"document"!=u._responseType||(u._responseXML=u._passthroughXHR.responseXML)),n(u,u._passthroughXHR.readyState)},this._passthroughXHR.open(e,o,s,i,a)}else this._passthroughXHR=null;this._username=i,this._password=a,this._responseText=null,this._responseXML=null,this._requestHeaders={},n(this,r.OPENED)},r.prototype.setRequestHeader=function(e,r){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: setRequestHeader() with header: "+e+" ,value: "+r),o(this);var n=this._requestHeaders[e];this._requestHeaders[e]=n?n+=","+r:r},r.prototype.send=function(i){if(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: send()"),this._passthroughXHR)null!=this.responseType&&(this._passthroughXHR.responseType=this.responseType),this._passthroughXHR.send(i);else{o(this),n(this,r.OPENED);var a=function(e,t){var r=function(e){var t=new Headers;return Object.keys(e._requestHeaders).forEach(function(r){t.append(r,e._requestHeaders[r])}),t}(e),n=e.withCredentials?"include":"same-origin",o={method:e._method,headers:r,mode:"cors",cache:"default",credentials:n};"GET"!==e._method&&"HEAD"!==e._method&&"DELETE"!==e._method&&(o.body=t);return o}(this,i),u=new Request(this._url,a),l=this;fetch(u).then(function(o){!function(o,s,i){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Processing Response"),function(e,t){if(e._responseHeaders={},t.entries){var o,s,i,a=t.entries();do{(o=a.next()).value&&(s=o.value[0],i=o.value[1],e._forceMimeType&&"content-type"==s.toLowerCase()?e._responseHeaders[s]=e._forceMimeType:e._responseHeaders[s]=i)}while(!o.done)}else t.forEach&&t.forEach(function(t,r){e._forceMimeType&&"content-type"==r.toLowerCase()?e._responseHeaders[r]=e._forceMimeType:e._responseHeaders[r]=t});n(e,r.HEADERS_RECEIVED)}(o,i.headers);var a=i.headers.get("Content-Type");o._status=i.status,o._statusText=i.statusText,o._responseURL=s.url,!e._isTextPayload(i.headers)&&e.isCachedResponse(i)?(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Calling response.blob()"),i.blob().then(function(e){o._responseType="blob",o._response=e,n(o,r.DONE),"function"==typeof o.onload&&o.onload()},function(e){t.error(e)})):a&&-1!==a.indexOf("image/")?(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Calling response.arrayBuffer()"),i.arrayBuffer().then(function(e){o._responseType="arrayBuffer",o._response=e,n(o,r.DONE),"function"==typeof o.onload&&o.onload()},function(e){t.error("error reading response as arrayBuffer!")})):i.text().then(function(e){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: Calling response.text()"),o._responseType="",o._response=e,o._responseText=e,n(o,r.DONE),"function"==typeof o.onload&&o.onload()},function(e){t.error(e)})}(l,u,o)},function(e){t.error(e)}),this.dispatchEvent(new s("loadstart",!1,!1,this))}},r.prototype.abort=function(){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: abort() is not supported by the XHR Adapter")},r.prototype.getResponseHeader=function(e){if(t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: getResponseHeader() for header: "+e),this._readyState<r.HEADERS_RECEIVED)return null;for(var n in e=e.toLowerCase(),this._responseHeaders)if(n.toLowerCase()==e.toLowerCase())return this._responseHeaders[n];return null},r.prototype.getAllResponseHeaders=function(){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: getAllResponseHeaders()");var e=this;if(this._readyState<r.HEADERS_RECEIVED)return"";var n="";return this._responseHeaders&&Object.keys(this._responseHeaders).forEach(function(t){n+=t+": "+e._responseHeaders[t]+"\r\n"}),n},r.prototype.overrideMimeType=function(e){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: overrideMimeType() for mimeType: "+e),"string"==typeof e&&(this._forceMimeType=e.toLowerCase())},r.prototype.addEventListener=function(e,r){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: addEventListener() for event type: "+e),this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(r)},r.prototype.removeEventListener=function(e,r){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: removeEventListener() for event type: "+e);var n,o=this._eventListeners[e]||[],s=o.length;for(n=0;n<s;n++)if(o[n]==r)return o.splice(n,1)},r.prototype.dispatchEvent=function(e){t.log("Offline Persistence Toolkit PersistenceXMLHttpRequest: dispatchEvent() for event type: "+e.type);var r=this,n=e.type;switch((this._eventListeners[n]||[]).forEach(function(t){"function"==typeof t?t.call(r,e):t.handleEvent(e)}),n){case"abort":this.onabort&&this.onabort(e);break;case"error":this.onerror&&this.onerror(e);break;case"load":this.onload&&this.onload(e);break;case"loadend":this.onloadend&&this.onloadend(e);break;case"loadstart":this.onloadstart&&this.onloadstart(e);break;case"progress":this.onprogress&&this.onprogress(e);break;case"readystatechange":this.onreadystatechange&&this.onreadystatechange(e);break;case"timeout":this.ontimeout&&this.ontimeout(e)}return!!e.defaultPrevented},s.prototype.stopPropagation=function(){},s.prototype.preventDefault=function(){this.defaultPrevented=!0},r}),define("persistenceStoreManager",["./impl/logger"],function(e){"use strict";var t=function(){Object.defineProperty(this,"_stores",{value:{},writable:!0}),Object.defineProperty(this,"_factories",{value:{},writable:!0}),Object.defineProperty(this,"_DEFAULT_STORE_FACTORY_NAME",{value:"_defaultFactory",writable:!1}),Object.defineProperty(this,"_storeNameMapping",{value:{},writable:!0})};return t.prototype.registerStoreFactory=function(e,t){if(!t)throw TypeError("A valid factory must be provided.");if(!e)throw TypeError("A valid name must be provided.");var r=this._mapStoreName(e),n=this._factories[r];if(n&&n!==t)throw TypeError("A factory with the same name has already been registered.");this._factories[r]=t},t.prototype.registerDefaultStoreFactory=function(e){this.registerStoreFactory(this._DEFAULT_STORE_FACTORY_NAME,e)},t.prototype.openStore=function(t,r){e.log("Offline Persistence Toolkit PersistenceStoreManager: openStore() for name: "+t);var n=this._mapStoreName(t),o=this._stores[n],s=r&&r.version||"0";if(o&&o[s])return Promise.resolve(o[s]);var i=this._factories[n];if(i||(i=this._factories[this._DEFAULT_STORE_FACTORY_NAME]),!i)return Promise.reject(new Error("no factory is registered to create the store."));var a=this;return e.log("Offline Persistence Toolkit PersistenceStoreManager: Calling createPersistenceStore on factory"),i.createPersistenceStore(n,r).then(function(e){return(o=o||{})[s]=e,a._stores[n]=o,e})},t.prototype.hasStore=function(e,t){var r=this._mapStoreName(e),n=this._stores[r];return!!n&&(!t||!t.version||!!n[t.version])},t.prototype.deleteStore=function(t,r){e.log("Offline Persistence Toolkit PersistenceStoreManager: deleteStore() for name: "+t);var n,o=this._mapStoreName(t),s=this._stores[o];if(s){var i=r&&r.version;if(i){var a=s[i];return a?(e.log("Offline Persistence Toolkit PersistenceStoreManager: Calling delete on store"),a.delete().then(function(){return delete s[i],!0})):Promise.resolve(!1)}var u=Object.keys(s).map((n=s,function(e){return n[e].delete()}),this),l=this;return Promise.all(u).then(function(){return delete l._stores[o],!0})}return Promise.resolve(!1)},t.prototype._mapStoreName=function(e,t){var r=this._storeNameMapping[e];return r||(r=e.replace(/(.*):\/\/(.*)/gi,"$1$2"),this._storeNameMapping[e]=r,r)},new t}),define("impl/defaultCacheHandler",["../persistenceUtils","../persistenceStoreManager","./logger"],function(e,t,r){"use strict";function n(){Object.defineProperty(this,"_endpointToOptionsMap",{value:{},writable:!0})}function o(e){for(var t=e.name,r=e.resourceIdentifier,n=e.keys,o=[],s=(new Date).toUTCString(),i=0;i<n.length;i++){var a={key:n[i],metadata:{lastUpdated:s,resourceIdentifier:r},value:e.data[i]};o.push(a)}var u={};return u[t]=o,u}n.prototype.constructRequestResponseCacheData=function(t,n){var o=this,s={};return r.log("Offline Persistence Toolkit DefaultCacheHandler: constructRequestResponseCacheData()"),e.requestToJSON(t).then(function(r){s.requestData=r;var i=o._excludeBody(t);return e.responseToJSON(n,{excludeBody:i})}).then(function(e){return s.responseData=e,{key:o._constructCacheKey(t,n),metadata:o.constructMetadata(t),value:s}})},n.prototype.constructShreddedData=function(e,t){r.log("Offline Persistence Toolkit DefaultCacheHandler: constructShreddedData()");var n=this._getShredder(e);return n?n(t).then(function(e){var t=e.map(o);return Promise.resolve(t)}):Promise.resolve()},n.prototype.shredResponse=function(e,t){r.log("Offline Persistence Toolkit DefaultCacheHandler: shredResponse()");var n=this._getShredder(e);return n?n(t):Promise.resolve()},n.prototype.cacheShreddedData=function(e){return r.log("Offline Persistence Toolkit DefaultCacheHandler: cacheShreddedData()"),function(e){var n=e.map(function(e){var n=Object.keys(e)[0],o=e[n];return o&&o.length?function(e,n){return r.log("Offline Persistence Toolkit DefaultCacheHandler: Updating store with shredded data"),t.openStore(e).then(function(e){return e.upsertAll(n)})}(n,o):Promise.resolve()});return Promise.all(n)}(e.map(o))},n.prototype._constructCacheKey=function(e,t){var r=e.url+e.method;if(t){var n=t.headers;if(n)if(a=n.get("vary"))if("*"===a)r+=(new Date).getTime();else for(var o=e.headers,s=a.split(","),i=0;i<s.length;i++){var a,u=s[i];r+=u+"="+(a=o?o.get(u):"undefined")}}return r},n.prototype.constructMetadata=function(e){var t=(new Date).getTime();return{url:e.url,method:e.method,created:t,lastupdated:t}},n.prototype.constructResponse=function(t){return r.log("Offline Persistence Toolkit DefaultCacheHandler: constructResponse()"),e.responseFromJSON(t).then(function(t){return e.isCachedResponse(t)||t.headers.set("x-oracle-jscpt-cache-expiration-date",""),Promise.resolve(t)})},n.prototype.constructSearchCriteria=function(e,t){r.log("Offline Persistence Toolkit DefaultCacheHandler: constructSearchCriteria()");var n=!1;t&&void 0!==t.ignoreSearch&&(n=t.ignoreSearch);var o,i,a=!1;t&&void 0!==t.ignoreMethod&&(a=t.ignoreMethod);var u=e.url.indexOf("?");return i=u>=0?e.url.substring(0,u):e.url,o=n?{"metadata.url":{$regex:"^"+s(i)+"(\\?|$)"}}:{"metadata.url":e.url},a||(o["metadata.method"]=e.method),{selector:o,sort:[{"metadata.created":"asc"}]}},n.prototype.registerEndpointOptions=function(e,t){if(!e)throw new Error({message:"a valid endpointKey must be provided."});if(this._endpointToOptionsMap[e])throw new Error({message:"endpointKey can only be registered once."});this._endpointToOptionsMap[e]=t},n.prototype.unregisterEndpointOptions=function(e){if(!e)throw new Error({message:"a valid endpointKey must be provided."});delete this._endpointToOptionsMap[e]},n.prototype._excludeBody=function(e){return null!==this._getShredder(e)},n.prototype._getShredder=function(e){var t=this._getJsonProcessor(e);return t?t.shredder:null},n.prototype._getUnshredder=function(e){var t=this._getJsonProcessor(e);return t?t.unshredder:null},n.prototype._getJsonProcessor=function(e){for(var t=Object.keys(this._endpointToOptionsMap),r=0;r<t.length;r++){var n=t[r];if(e.url===JSON.parse(n).url){var o=this._endpointToOptionsMap[n];return o&&o.jsonProcessor&&o.jsonProcessor.shredder&&o.jsonProcessor.unshredder?o.jsonProcessor:null}}return null},n.prototype.fillResponseBodyWithShreddedData=function(e,n,o){r.log("Offline Persistence Toolkit DefaultCacheHandler: fillResponseBodyWithShreddedData()"),null!=e.url&&e.url.length>0&&null==o.headers.get("x-oracle-jscpt-response-url")&&o.headers.set("x-oracle-jscpt-response-url",e.url);var s=this._getUnshredder(e),i=this._getShredder(e);if(!(s&&i&&o&&n&&n.length))return Promise.resolve(o);var a=n.map(function(e){return n=(r=e).name,t.openStore(n).then(function(e){if(r.keys&&r.keys.length){if(1===r.keys.length)return e.findByKey(r.keys[0]);var t=r.keys.map(function(e){return{key:e}}),n={selector:{$or:t}};return e.find(n)}return Promise.resolve([])}).then(function(e){return Array.isArray(e)||(e=[e]),r.data=e,Promise.resolve(r)});var r,n});return Promise.all(a).then(function(e){return s(e,o)})};var s=function(e){return String(e).replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")};return new n}),define("impl/PersistenceSyncManager",["require","../persistenceUtils","../persistenceStoreManager","./defaultCacheHandler","./logger"],function(require,e,t,r,n){"use strict";function o(e,t,r){Object.defineProperty(this,"_eventListeners",{value:[],writable:!0}),Object.defineProperty(this,"_isOnline",{value:e}),Object.defineProperty(this,"_browserFetch",{value:t}),Object.defineProperty(this,"_cache",{value:r})}function s(e){return"stop"===(e=e||{}).action}function i(e,r){var n,o,s,i,a,u=[];e instanceof Array||(e=[e]);var l=e.length,c=function(f){if(!(f<l))return Promise.resolve();if(s=e[f].storeName,o=e[f].operation,i=e[f].undoRedoData,"upsert"==o||"remove"==o&&r){for(u=[],a=i.length,n=0;n<a;n++)r?u.push({key:i[n].key,value:i[n].undo}):u.push({key:i[n].key,value:i[n].redo});return t.openStore(s).then(function(e){return 1==u.length&&null==u[0].value&&null!=u[0].key?e.removeByKey(u[0].key).then(function(){return c(++f)}):e.upsertAll(u).then(function(){return c(++f)})})}return"remove"==o?t.openStore(s).then(function(e){return e.removeByKey(i[0].key).then(function(){return c(++f)})}):void 0};return c(0)}function a(e,t,r,n){return function e(t,r){if(r.length>0)return r[0].listener(t).then(function(t){return null!=t?Promise.resolve(t):r.length>1?e(r.slice(1)):void 0});return Promise.resolve(null)}(r,e._eventListeners.filter(function(e,t){return function(r){return e.toLowerCase()==r.type&&(null!=t&&t.match(r.scope)||null==t||null==r.scope)}}(t,n)))}function u(e){return t.openStore(e,{index:["metadata.created"]})}function l(){return u("syncLog")}function c(){return u("redoUndoLog")}return o.prototype.addEventListener=function(e,t,r){n.log("Offline Persistence Toolkit PersistenceSyncManager: addEventListener() for type: "+e+" and scope: "+r),this._eventListeners.push({type:e.toLowerCase(),listener:t,scope:r})},o.prototype.removeEventListener=function(e,t,r){n.log("Offline Persistence Toolkit PersistenceSyncManager: removeEventListener() for type: "+e+" and scope: "+r),this._eventListeners=this._eventListeners.filter(function(n){return e.toLowerCase()!=n.type||t!=n.listener||r!=n.scope})},o.prototype.getSyncLog=function(){var t;return n.log("Offline Persistence Toolkit PersistenceSyncManager: getSyncLog()"),this._readingSyncLog||(this._readingSyncLog=(t=this,l().then(function(e){return e.find(function(){var e={},t=[],r=[];r.push("metadata.created"),e.sort=r,t.push("metadata.created"),t.push("value"),e.fields=t;var n={},o={$exists:!0};return n["metadata.created"]=o,e.selector=n,e}())}).then(function(t){return function(t){var r,n,o=[],s=function(t){return t&&0!=t.length?(r=t[0].metadata.created.toString(),n=t[0].value,e.requestFromJSON(n).then(function(e){return o.push(function(e,t){return{requestId:e,request:t,undo:function(){return function(e){return c().then(function(t){return t.findByKey(e)}).then(function(e){return null!=e&&i(e,!0).then(function(){return!0})})}(e)},redo:function(){return function(e){return c().then(function(t){return t.findByKey(e)}).then(function(e){return null!=e&&i(e,!1).then(function(){return!0})})}(e)}}}(r,e)),t.shift(),s(t)})):Promise.resolve(o)};return s(t)}(t)}).then(function(e){return t._readingSyncLog=null,e}))),this._readingSyncLog},o.prototype.insertRequest=function(t,o){n.log("Offline Persistence Toolkit PersistenceSyncManager: insertRequest() for Request with url: "+t.url);var s={};return l().then(function(r){return s.store=r,e.requestToJSON(t,{_noClone:!0})}).then(function(e){return s.requestData=e,s.metadata=r.constructMetadata(t),s.requestId=s.metadata.created.toString(),s.store.upsert(s.requestId,s.metadata,s.requestData)}).then(function(){if(null!=o){var e=o.undoRedoDataArray;return null!=e?c().then(function(t){var r=function(n){return n<e.length&&null!=e[n]?t.upsert(s.requestId,s.metadata,e[n]).then(function(){return r(++n)}):Promise.resolve()};return r(0)}):Promise.resolve()}return Promise.resolve()})},o.prototype.removeRequest=function(e){n.log("Offline Persistence Toolkit PersistenceSyncManager: removeRequest() for Request with requestId: "+e);var t=this,r={};return l().then(function(n){return r.store=n,function(e,t){return e.getSyncLog().then(function(e){var r,n=e.length;for(r=0;r<n;r++)if(e[r].requestId===t)return e[r].request})}(t,e)}).then(function(t){return r.request=t,r.store.removeByKey(e)}).then(function(){return c()}).then(function(t){return t.removeByKey(e)}).then(function(){return r.request})},o.prototype.updateRequest=function(t,o){return n.log("Offline Persistence Toolkit PersistenceSyncManager: updateRequest() for Request with requestId: "+t),Promise.all([l(),e.requestToJSON(o)]).then(function(e){var n=e[0],s=e[1],i=r.constructMetadata(o);return n.upsert(t,i,s)})},o.prototype.sync=function(t){n.log("Offline Persistence Toolkit PersistenceSyncManager: sync()"),this._options=t||{};var r=this;return this._syncing?Promise.reject("Cannot start sync while sync is in progress"):(this._syncing=!0,new Promise(function(t,o){r.getSyncLog().then(function(i){if(r._isOnline()){var u,l,c;n.log("Offline Persistence Toolkit PersistenceSyncManager: Processing sync, is online");var f=function(i){0==i.length&&(n.log("Offline Persistence Toolkit PersistenceSyncManager: Sync finished, no requests in sync log"),t()),i.length>0&&(n.log("Offline Persistence Toolkit PersistenceSyncManager: Processing sync, # of request in sync log: "+i.length),u=i[0].requestId,l=i[0].request,c=l.clone(),n.log("Offline Persistence Toolkit PersistenceSyncManager: Dispatching beforeSyncRequest event"),a(r,"beforeSyncRequest",{requestId:u,request:c.clone()},l.url).then(function(h){if(s(h))return n.log("Offline Persistence Toolkit PersistenceSyncManager: Sync stopped by beforeSyncRequest event listener"),void t();"skip"!==(h=h||{}).action?("replay"===h.action&&(n.log("Offline Persistence Toolkit PersistenceSyncManager: Replay request from beforeSyncRequest event listener"),l=h.request),c=l.clone(),function(e,t){var r=e,o=r._options.preflightOptionsRequest,s=r._options.preflightOptionsRequestTimeout;if(null!=t.url&&"disabled"!=o&&null!=t.url.match(o)){if(n.log("Offline Persistence Toolkit PersistenceSyncManager: Checking URL based on preflightOptionsRequest"),r._pingedURLs){if(r._pingedURLs.indexOf(t.url)>=0)return Promise.resolve(!0)}else r._pingedURLs=[];return r._preflightOptionsRequestId=(new Date).getTime(),new Promise((i=r._preflightOptionsRequestId,function(e,n){r._repliedOptionsRequest=!1;var o=new Request(t.url,{method:"OPTIONS"}),a=6e4;null!=s&&(a=s),setTimeout(function(){r._repliedOptionsRequest||r._preflightOptionsRequestId!=i||n(!1)},a),r._browserFetch(o).then(function(n){r._repliedOptionsRequest=!0,r._pingedURLs||(r._pingedURLs=[]),r._pingedURLs.push(t.url),e(!0)},function(t){r._repliedOptionsRequest=!0,e(!0)})}))}var i;return Promise.resolve(!0)}(r,l).then(function(){n.log("Offline Persistence Toolkit PersistenceSyncManager: Replaying request with url: "+l.url),r._browserFetch(l).then(function(h){h.status>=400?o({error:h.statusText,requestId:u,request:c.clone(),response:h.clone()}):e._cloneResponse(h,{url:l.url}).then(function(h){n.log("Offline Persistence Toolkit PersistenceSyncManager: Dispatching syncRequest event"),a(r,"syncRequest",{requestId:u,request:c.clone(),response:h.clone()},l.url).then(function(a){s(a)?t():(n.log("Offline Persistence Toolkit PersistenceSyncManager: Removing replayed request"),r.removeRequest(u).then(function(){i.shift(),"GET"==l.method||"HEAD"==l.method?e._cloneResponse(h,{url:l.url}).then(function(e){r._cache().put(l,e).then(function(){n.log("Offline Persistence Toolkit PersistenceSyncManager: Replayed request/response is cached."),f(i)})}):f(i)},function(e){o({error:e,requestId:u,request:c.clone()
})}))})})},function(e){o({error:e,requestId:u,request:c.clone()})})},function(e){if(!1===e){o({error:"Preflight OPTIONS request timed out",requestId:u,request:c.clone(),response:new Response(null,{status:504,statusText:"Preflight OPTIONS request timed out"})})}else o({error:e,requestId:u,request:c.clone()})})):(n.log("Offline Persistence Toolkit PersistenceSyncManager: Removing skipped request"),r.removeRequest(u).then(function(){i.shift(),f(i)},function(e){o({error:e,requestId:u,request:c.clone()})}))}))};i=function(e){if(e&&e.length>0){var t,r,n=[];for(t=0;t<e.length;t++)"GET"!=(r=e[t].request).method&&"HEAD"!=r.method&&n.push(e[t]);for(t=0;t<e.length;t++)"GET"!=(r=e[t].request).method&&"HEAD"!=r.method||n.push(e[t]);return n}return e}(i),f(i)}else t()})}).then(function(e){return r._syncing=!1,r._pingedURLs=null,e},function(e){return r._syncing=!1,r._pingedURLs=null,Promise.reject(e)}))},o}),define("impl/OfflineCache",["./defaultCacheHandler","./logger"],function(e,t){"use strict";function r(e,t){if(!e)throw TypeError("A name must be provided to create an OfflineCache!");if(!t)throw TypeError("A persistence store must be provided to create an OfflineCache!");this._name=e,this._store=t}function n(e,t,r){if(r&&r.length)for(var n=0;n<r.length;n++){var o=r[n];if(s(e,t,o))return o.responseData}return null}function o(e,t,r){return function(n){var o;return o=r?n[r]:n,s(e,t,o)}}function s(e,r,n){if(e)return!0;if(!n||!r)return!1;var o=n.requestData.headers,s=n.responseData.headers,i=r.headers,a=s.vary;if(t.log("Offline Persistence Toolkit OfflineCache: Processing HTTP Vary header"),!a)return!0;if("*"===a.trim())return!1;for(var u=a.split(","),l=0;l<u.length;l++){var c=u[l].toLowerCase(),f=i.get(c),h=o[c];if(t.log("Offline Persistence Toolkit OfflineCache: HTTP Vary header name: "+c),t.log("Offline Persistence Toolkit OfflineCache: Request HTTP Vary header value: "+f),t.log("Offline Persistence Toolkit OfflineCache: Cached HTTP Vary header value: "+h),!(!h&&!f||h&&f&&h===f))return!1}return!0}function i(r){if(r){t.log("Offline Persistence Toolkit OfflineCache: Converting cached entry to Response object");var n=[],o=r.bodyAbstract;return o?(n.push(Promise.resolve(JSON.parse(o))),delete r.bodyAbstract):n.push(Promise.resolve()),n.push(e.constructResponse(r)),Promise.all(n)}return Promise.resolve()}return r.prototype.getName=function(){return this._name},r.prototype.add=function(e){t.log("Offline Persistence Toolkit OfflineCache: add()");var r=this;return fetch(e).then(function(t){var n=t.clone();return r.put(e,t).then(function(){Promise.resolve(n)})})},r.prototype.addAll=function(e){t.log("Offline Persistence Toolkit OfflineCache: addAll()");var r=e.map(this.add,this);return Promise.all(r)},r.prototype.match=function(r,o){t.log("Offline Persistence Toolkit OfflineCache: match() for Request with url: "+r.url);var s=e.constructSearchCriteria(r,o),a=o&&o.ignoreVary;return this._store.find(s).then(function(e){return i(n(a,r,e))}).then(function(t){if(t){var n=t[0],o=t[1];return e.fillResponseBodyWithShreddedData(r,n,o)}return Promise.resolve()})},r.prototype.matchAll=function(r,n){t.log("Offline Persistence Toolkit OfflineCache: matchAll() for Request with url: "+r.url);var s=e.constructSearchCriteria(r,n),a=n&&n.ignoreVary;return this._store.find(s).then(function(e){return function(e){if(e&&e.length){var t=e.map(function(e){return i(e)});return Promise.all(t)}return Promise.resolve()}(function(e,t,r){var n=[];if(r&&r.length){var s=r.filter(o(e,t));n=s.map(function(e){return e.responseData})}return n}(a,r,e))}).then(function(t){if(t&&t.length){var n=t.map(function(t){var n=t[0],o=t[1];return e.fillResponseBodyWithShreddedData(r,n,o)});return Promise.all(n)}return Promise.resolve([])})},r.prototype.put=function(r,n){t.log("Offline Persistence Toolkit OfflineCache: put() for Request with url: "+r.url);var o=this,s=[];return s.push(e.constructRequestResponseCacheData(r,n)),s.push(e.shredResponse(r,n)),Promise.all(s).then(function(t){var r=t[0],n=t[1];if(n){var s=[];return r.value.responseData.bodyAbstract=function(e){var t=e.map(function(e){return{name:e.name,keys:e.keys,resourceType:e.resourceType}});return JSON.stringify(t)}(n),s.push(o._store.upsert(r.key,r.metadata,r.value)),s.push(e.cacheShreddedData(n)),Promise.all(s)}return o._store.upsert(r.key,r.metadata,r.value)})},r.prototype.delete=function(e,r){e?t.log("Offline Persistence Toolkit OfflineCache: delete() for Request with url: "+e.url):t.log("Offline Persistence Toolkit OfflineCache: delete()");var n=this;return n.keys(e,r).then(function(e){if(e&&e.length){var t=e.map(n._store.removeByKey,n._store);return Promise.all(t)}return!1}).then(function(e){return!(!e||!e.length)})},r.prototype.keys=function(r,n){r?t.log("Offline Persistence Toolkit OfflineCache: keys() for Request with url: "+r.url):t.log("Offline Persistence Toolkit OfflineCache: keys()");if(r){var s=e.constructSearchCriteria(r,n);s.fields=["key","value"];var i=n&&n.ignoreVary;return this._store.find(s).then(function(e){return e&&e.length?e.filter(o(i,r,"value")).map(function(e){return e.key}):[]})}return this._store.keys()},r.prototype.hasMatch=function(r,o){t.log("Offline Persistence Toolkit OfflineCache: hasMatch() for Request with url: "+r.url);var s=e.constructSearchCriteria(r,o),i=o&&o.ignoreVary;return this._store.find(s).then(function(e){return null!==n(i,r,e)})},r}),define("impl/offlineCacheManager",["../persistenceStoreManager","./OfflineCache","./logger"],function(e,t,r){"use strict";function n(){this._prefix="offlineCaches-",this._caches={},this._cachesArray=[]}return n.prototype.open=function(n){r.log("Offline Persistence Toolkit OfflineCacheManager: open() with name: "+n);var o=this,s=o._caches[n];return s?Promise.resolve(s):e.openStore(o._prefix+n).then(function(e){return s=new t(n,e),o._caches[n]=s,o._cachesArray.push(s),s})},n.prototype.match=function(e,t){r.log("Offline Persistence Toolkit OfflineCacheManager: match() for Request with url: "+e.url);var n=function(r,o){return o===r.length?Promise.resolve():r[o].match(e,t).then(function(e){return e?e.clone():n(r,o+1)})};return n(this._cachesArray,0)},n.prototype.has=function(e){return r.log("Offline Persistence Toolkit OfflineCacheManager: has() for name: "+e),this._caches[e]?Promise.resolve(!0):Promise.resolve(!1)},n.prototype.delete=function(e){r.log("Offline Persistence Toolkit OfflineCacheManager: delete() for name: "+e);var t=this,n=t._caches[e];return n?n.delete().then(function(){return t._cachesArray.splice(t._cachesArray.indexOf(e),1),delete t._caches[e],!0}):Promise.resolve(!1)},n.prototype.keys=function(){r.log("Offline Persistence Toolkit OfflineCacheManager: keys()");for(var e=[],t=0;t<this._cachesArray.length;t++)e.push(this._cachesArray[t].getName());return Promise.resolve(e)},new n}),function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(e){return e&&DataView.prototype.isPrototypeOf(e)},o=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};c.prototype.append=function(e,t){e=a(e),t=u(t);var r=this.map[e];this.map[e]=r?r+","+t:t},c.prototype.delete=function(e){delete this.map[a(e)]},c.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},c.prototype.set=function(e,t){this.map[a(e)]=u(t)},c.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},c.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),l(e)},c.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),l(e)},c.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),l(e)},t.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var s=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},y.call(v.prototype),y.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var i=[301,302,303,307,308];b.redirect=function(e,t){if(-1===i.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},e.Headers=c,e.Request=v,e.Response=b,e.fetch=function(e,r){return new Promise(function(n,o){var s=new v(e,r),i=new XMLHttpRequest;i.onload=function(){var e,t,r={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",t=new c,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}}),t)};r.url="responseURL"in i?i.responseURL:r.headers.get("X-Request-URL");var o="response"in i?i.response:i.responseText;n(new b(o,r))},i.onerror=function(){o(new TypeError("Network request failed"))},i.ontimeout=function(){o(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&t.blob&&(i.responseType="blob"),s.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send(void 0===s._bodyInit?null:s._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(r[Symbol.iterator]=function(){return r}),r}function c(e){this.map={},e instanceof c?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function f(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=h(t);return t.readAsArrayBuffer(e),r}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&n(e))this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!o(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e,t,r,n=f(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=h(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this._bodyFormData?Promise.resolve(this._bodyFormData):this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}function v(e,t){var r,n,o=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),s.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function g(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}}),t}function b(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this),define("impl/fetch",function(){}),define("persistenceManager",["./impl/PersistenceXMLHttpRequest","./impl/PersistenceSyncManager","./impl/offlineCacheManager","./impl/logger","./impl/fetch"],function(e,t,r,n){"use strict";function o(){Object.defineProperty(this,"_registrations",{value:[],writable:!0}),Object.defineProperty(this,"_eventListeners",{value:[],writable:!0}),Object.defineProperty(this,"_forceOffline",{value:!1,writable:!0}),Object.defineProperty(this,"_isOffline",{value:!1,writable:!0}),Object.defineProperty(this,"_cache",{value:null,writable:!0}),Object.defineProperty(this,"_persistenceSyncManager",{value:new t(this.isOnline.bind(this),this.browserFetch.bind(this),this.getCache.bind(this))})}function s(){return"undefined"!=typeof window&&null!=window}function i(e,t){Object.defineProperty(this,"scope",{value:e,enumerable:!0}),Object.defineProperty(this,"_persistenceManager",{value:t}),Object.defineProperty(this,"_eventListeners",{value:[],writable:!0})}return o.prototype.init=function(){var t,o;return o=t=this,!s()||o._browserFetchFunc||o._browserXMLHttpRequest||(n.log("Offline Persistence Toolkit PersistenceManager: Replacing browser APIs"),Object.defineProperty(o,"_browserFetchFunc",{value:window.fetch,writable:!1}),Object.defineProperty(o,"_browserXMLHttpRequest",{value:window.XMLHttpRequest,writable:!1}),window.fetch=function(e){function t(e){Object.defineProperty(this,"isReload",{value:!1,enumerable:!0}),Object.defineProperty(this,"clientId",{value:null,enumerable:!0}),Object.defineProperty(this,"client",{value:null,enumerable:!0}),Object.defineProperty(this,"request",{value:e,enumerable:!0}),Object.defineProperty(this,"_resolveCallback",{value:null,writable:!0}),Object.defineProperty(this,"_rejectCallback",{value:null,writable:!0})}return t.prototype.respondWith=function(e){var t=this;if(e instanceof Promise)e.then(function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e)});else if("function"==typeof e){var r=e();t._resolveCallback(r)}},t.prototype._setPromiseCallbacks=function(e,t){this._resolveCallback=e,this._rejectCallback=t},function(r,o){var s;return s=Request.prototype.isPrototypeOf(r)&&!o?r:new Request(r,o),e.getRegistration(s.url).then(function(r){if(null!=r){var o=new t(s),i=function(e,t,r){var o,s,i,a,u=null,l=e._registrations,c=null!=l?l.length:0;for(o=0;o<c;o++)if(i=l[o],null!=r.request.url.match(i.scope)){for(a=i._eventListeners.length,s=0;s<a;s++)if(i._eventListeners[s].type==t)if("fetch"==t)null===u&&r._setPromiseCallbacks instanceof Function&&(u=new Promise(function(e,t){r._setPromiseCallbacks(e,t)})),n.log("Offline Persistence Toolkit PersistenceManager: Calling fetch event listener"),i._eventListeners[s].listener(r);else if(n.log("Offline Persistence Toolkit PersistenceManager: Calling event listener"),!1===i._eventListeners[s].listener(r))return!1;if(null!=u)return u}return!0}(e,"fetch",o);if(null!=i&&i instanceof Promise)return i}return e.browserFetch(s)})}}(t),window.XMLHttpRequest=function(){return null!=o._browserFetchRequest?new o._browserXMLHttpRequest:new e(o._browserXMLHttpRequest)}),function(e){var t=e;s()&&!t._addedBrowserEventListeners&&(n.log("Offline Persistence Toolkit PersistenceManager: Adding browser event listeners"),window.addEventListener("offline",function(e){t._isOffline=!0},!1),window.addEventListener("online",function(e){t._isOffline=!1},!1),t._addedBrowserEventListeners=!0)}(this),function(e){var t=e;return r.open("systemCache").then(function(e){return t._cache=e,Promise.resolve()})}(this)},o.prototype.forceOffline=function(e){n.log("Offline Persistence Toolkit PersistenceManager: forceOffline is called with value: "+e),this._forceOffline=e},o.prototype.getCache=function(){return this._cache},o.prototype.isOnline=function(){var e=navigator.onLine;return navigator.network&&navigator.network.connection&&navigator.network.connection.type==Connection.NONE&&(e=!1,n.log("Offline Persistence Toolkit PersistenceManager: Cordova network info plugin is returning online value: "+e)),e&&!this._isOffline&&!this._forceOffline},o.prototype.register=function(e){var t=new i((e=e||{}).scope,this);return this._registrations.push(t),Promise.resolve(t)},o.prototype.getRegistration=function(e){var t,r,n=this._registrations.length;for(t=0;t<n;t++)if(r=this._registrations[t],e.match(r.scope))return Promise.resolve(r);return Promise.resolve()},o.prototype.getRegistrations=function(){return Promise.resolve(this._registrations.slice())},o.prototype.getSyncManager=function(){return this._persistenceSyncManager},o.prototype.browserFetch=function(e){if(n.log("Offline Persistence Toolkit PersistenceManager: browserFetch() for Request with url: "+e.url),s()){Object.defineProperty(this,"_browserFetchRequest",{value:e,writable:!0});var t=this;return new Promise(function(r,o){n.log("Offline Persistence Toolkit PersistenceManager: Calling browser fetch function for Request with url: "+e.url),t._browserFetchFunc.call(window,e).then(function(e){r(e)},function(e){o(e)}),t._browserFetchRequest=null})}return fetch(e)},i.prototype.addEventListener=function(e,t){this._eventListeners.push({type:e.toLowerCase(),listener:t})},i.prototype.unregister=function(){return Promise.resolve((e=this._persistenceManager,t=this,(n=(r=e)._registrations.indexOf(t))>-1&&(r._registrations.splice(n,1),!0)));var e,t,r,n},new o});