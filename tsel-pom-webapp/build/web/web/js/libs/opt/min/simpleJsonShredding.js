define(["./persistenceUtils","./impl/logger"],function(e,r){"use strict";return{getShredder:function(e,n){return function(t){r.log("Offline Persistence Toolkit simpleJsonShredding: Shredding Response");var i=t.clone(),s=i.headers.get("Etag");return i.text().then(function(t){var i=[],o=[],c="collection";if(t&&t.length>0)try{var d=JSON.parse(t);Array.isArray(d)?(i=d.map(function(e){return e[n]}),o=d):(i[0]=d[n],o[0]=d,c="single")}catch(e){r.log("Offline Persistence Toolkit simpleRestJsonShredding: Error during shredding: "+e)}return[{name:e,resourceIdentifier:s,keys:i,data:o,resourceType:c}]})}},getUnshredder:function(){return function(n,t){return r.log("Offline Persistence Toolkit simpleJsonShredding: Unshredding Response"),Promise.resolve().then(function(){var r=function(e){if(!e||1!==e.length)throw new Error({message:"shredded data is not in the correct format."});var r=e[0].data;return r&&1===r.length&&"single"===e[0].resourceType?r[0]:r}(n);return e.setResponsePayload(t,r)}).then(function(e){return e.headers.set("x-oracle-jscpt-cache-expiration-date",""),Promise.resolve(e)})}}}});