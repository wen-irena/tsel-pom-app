define(["./impl/logger"],function(e){"use strict";var t=function(){Object.defineProperty(this,"_stores",{value:{},writable:!0}),Object.defineProperty(this,"_factories",{value:{},writable:!0}),Object.defineProperty(this,"_DEFAULT_STORE_FACTORY_NAME",{value:"_defaultFactory",writable:!1}),Object.defineProperty(this,"_storeNameMapping",{value:{},writable:!0})};return t.prototype.registerStoreFactory=function(e,t){if(!t)throw TypeError("A valid factory must be provided.");if(!e)throw TypeError("A valid name must be provided.");var r=this._mapStoreName(e),o=this._factories[r];if(o&&o!==t)throw TypeError("A factory with the same name has already been registered.");this._factories[r]=t},t.prototype.registerDefaultStoreFactory=function(e){this.registerStoreFactory(this._DEFAULT_STORE_FACTORY_NAME,e)},t.prototype.openStore=function(t,r){e.log("Offline Persistence Toolkit PersistenceStoreManager: openStore() for name: "+t);var o=this._mapStoreName(t),i=this._stores[o],s=r&&r.version||"0";if(i&&i[s])return Promise.resolve(i[s]);var n=this._factories[o];if(n||(n=this._factories[this._DEFAULT_STORE_FACTORY_NAME]),!n)return Promise.reject(new Error("no factory is registered to create the store."));var a=this;return e.log("Offline Persistence Toolkit PersistenceStoreManager: Calling createPersistenceStore on factory"),n.createPersistenceStore(o,r).then(function(e){return(i=i||{})[s]=e,a._stores[o]=i,e})},t.prototype.hasStore=function(e,t){var r=this._mapStoreName(e),o=this._stores[r];return!(!o||t&&t.version&&!o[t.version])},t.prototype.deleteStore=function(t,r){e.log("Offline Persistence Toolkit PersistenceStoreManager: deleteStore() for name: "+t);var o=this._mapStoreName(t),i=this._stores[o];if(i){var s=r&&r.version;if(s){var n=i[s];return n?(e.log("Offline Persistence Toolkit PersistenceStoreManager: Calling delete on store"),n.delete().then(function(){return delete i[s],!0})):Promise.resolve(!1)}var a=Object.keys(i).map(function(e){return function(t){return e[t].delete()}}(i),this),c=this;return Promise.all(a).then(function(){return delete c._stores[o],!0})}return Promise.resolve(!1)},t.prototype._mapStoreName=function(e,t){var r=this._storeNameMapping[e];return r||(r=e.replace(/(.*):\/\/(.*)/gi,"$1$2"),this._storeNameMapping[e]=r,r)},new t});