import Native from"./Native.js";import CustomElementInternals from"../CustomElementInternals.js";import CEState from"../CustomElementState.js";import*as Utilities from"../Utilities.js";import PatchParentNode from"./Interface/ParentNode.js";import PatchChildNode from"./Interface/ChildNode.js";export default function(t){function e(e,i){Object.defineProperty(e,"innerHTML",{enumerable:i.enumerable,configurable:!0,get:i.get,set:function(e){let n=void 0;if(Utilities.isConnected(this)&&(n=[],Utilities.walkDeepDescendantElements(this,t=>{t!==this&&n.push(t)})),i.set.call(this,e),n)for(let e=0;e<n.length;e++){const i=n[e];i.__CE_state===CEState.custom&&t.disconnectedCallback(i)}return this.ownerDocument.__CE_hasRegistry?t.patchAndUpgradeTree(this):t.patchTree(this),e}})}function i(e,i){Utilities.setPropertyUnchecked(e,"insertAdjacentElement",function(e,n){const l=Utilities.isConnected(n),a=i.call(this,e,n);return l&&t.disconnectTree(n),Utilities.isConnected(a)&&t.connectTree(n),a})}Native.Element_attachShadow&&Utilities.setPropertyUnchecked(Element.prototype,"attachShadow",function(t){const e=Native.Element_attachShadow.call(this,t);return this.__CE_shadowRoot=e,e}),Native.Element_innerHTML&&Native.Element_innerHTML.get?e(Element.prototype,Native.Element_innerHTML):Native.HTMLElement_innerHTML&&Native.HTMLElement_innerHTML.get?e(HTMLElement.prototype,Native.HTMLElement_innerHTML):t.addPatch(function(t){e(t,{enumerable:!0,configurable:!0,get:function(){return Native.Node_cloneNode.call(this,!0).innerHTML},set:function(t){const e="template"===this.localName,i=e?this.content:this,n=Native.Document_createElement.call(document,this.localName);for(n.innerHTML=t;i.childNodes.length>0;)Native.Node_removeChild.call(i,i.childNodes[0]);const l=e?n.content:n;for(;l.childNodes.length>0;)Native.Node_appendChild.call(i,l.childNodes[0])}})}),Utilities.setPropertyUnchecked(Element.prototype,"setAttribute",function(e,i){if(this.__CE_state!==CEState.custom)return Native.Element_setAttribute.call(this,e,i);const n=Native.Element_getAttribute.call(this,e);Native.Element_setAttribute.call(this,e,i),i=Native.Element_getAttribute.call(this,e),t.attributeChangedCallback(this,e,n,i,null)}),Utilities.setPropertyUnchecked(Element.prototype,"setAttributeNS",function(e,i,n){if(this.__CE_state!==CEState.custom)return Native.Element_setAttributeNS.call(this,e,i,n);const l=Native.Element_getAttributeNS.call(this,e,i);Native.Element_setAttributeNS.call(this,e,i,n),n=Native.Element_getAttributeNS.call(this,e,i),t.attributeChangedCallback(this,i,l,n,e)}),Utilities.setPropertyUnchecked(Element.prototype,"removeAttribute",function(e){if(this.__CE_state!==CEState.custom)return Native.Element_removeAttribute.call(this,e);const i=Native.Element_getAttribute.call(this,e);Native.Element_removeAttribute.call(this,e),null!==i&&t.attributeChangedCallback(this,e,i,null,null)}),Utilities.setPropertyUnchecked(Element.prototype,"removeAttributeNS",function(e,i){if(this.__CE_state!==CEState.custom)return Native.Element_removeAttributeNS.call(this,e,i);const n=Native.Element_getAttributeNS.call(this,e,i);Native.Element_removeAttributeNS.call(this,e,i);const l=Native.Element_getAttributeNS.call(this,e,i);n!==l&&t.attributeChangedCallback(this,i,n,l,e)}),Native.HTMLElement_insertAdjacentElement?i(HTMLElement.prototype,Native.HTMLElement_insertAdjacentElement):Native.Element_insertAdjacentElement?i(Element.prototype,Native.Element_insertAdjacentElement):console.warn("Custom Elements: `Element#insertAdjacentElement` was not patched."),PatchParentNode(t,Element.prototype,{prepend:Native.Element_prepend,append:Native.Element_append}),PatchChildNode(t,Element.prototype,{before:Native.Element_before,after:Native.Element_after,replaceWith:Native.Element_replaceWith,remove:Native.Element_remove})};