import sinh from"../common/sinh";import hypot from"../common/hypot";import asinhy from"../common/asinhy";import gatg from"../common/gatg";import clens from"../common/clens";import clens_cmplx from"../common/clens_cmplx";import adjust_lon from"../common/adjust_lon";export function init(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),s=t/(2-t),i=s;this.cgb[0]=s*(2+s*(-2/3+s*(s*(116/45+s*(26/45+s*(-2854/675)))-2))),this.cbg[0]=s*(s*(2/3+s*(4/3+s*(-82/45+s*(32/45+s*(4642/4725)))))-2),i*=s,this.cgb[1]=i*(7/3+s*(s*(-227/45+s*(2704/315+s*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+s*(-16/15+s*(-13/9+s*(904/315+s*(-1522/945))))),i*=s,this.cgb[2]=i*(56/15+s*(-136/35+s*(-1262/105+s*(73814/2835)))),this.cbg[2]=i*(-26/15+s*(34/21+s*(1.6+s*(-12686/2835)))),i*=s,this.cgb[3]=i*(4279/630+s*(-332/35+s*(-399572/14175))),this.cbg[3]=i*(1237/630+s*(s*(-24832/14175)-2.4)),i*=s,this.cgb[4]=i*(4174/315+s*(-144838/6237)),this.cbg[4]=i*(-734/315+s*(109598/31185)),i*=s,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(s,2),this.Qn=this.k0/(1+s)*(1+i*(.25+i*(1/64+i/256))),this.utg[0]=s*(s*(2/3+s*(-37/96+s*(1/360+s*(81/512+s*(-96199/604800)))))-.5),this.gtu[0]=s*(.5+s*(-2/3+s*(5/16+s*(41/180+s*(-127/288+s*(7891/37800)))))),this.utg[1]=i*(-1/48+s*(-1/15+s*(437/1440+s*(-46/105+s*(1118711/3870720))))),this.gtu[1]=i*(13/48+s*(s*(557/1440+s*(281/630+s*(-1983433/1935360)))-.6)),i*=s,this.utg[2]=i*(-17/480+s*(37/840+s*(209/4480+s*(-5569/90720)))),this.gtu[2]=i*(61/240+s*(-103/140+s*(15061/26880+s*(167603/181440)))),i*=s,this.utg[3]=i*(-4397/161280+s*(11/504+s*(830251/7257600))),this.gtu[3]=i*(49561/161280+s*(-179/168+s*(6601661/7257600))),i*=s,this.utg[4]=i*(-4583/161280+s*(108847/3991680)),this.gtu[4]=i*(34729/80640+s*(-3418889/1995840)),i*=s,this.utg[5]=-.03233083094085698*i,this.gtu[5]=.6650675310896665*i;var h=gatg(this.cbg,this.lat0);this.Zb=-this.Qn*(h+clens(this.gtu,2*h))};export function forward(t){var s=adjust_lon(t.x-this.long0),i=t.y;i=gatg(this.cbg,i);var h=Math.sin(i),a=Math.cos(i),n=Math.sin(s),o=Math.cos(s);i=Math.atan2(h,o*a),s=Math.atan2(n*a,hypot(h,a*o)),s=asinhy(Math.tan(s));var r,g,c=clens_cmplx(this.gtu,2*i,2*s);return i+=c[0],s+=c[1],Math.abs(s)<=2.623395162778?(r=this.a*(this.Qn*s)+this.x0,g=this.a*(this.Qn*i+this.Zb)+this.y0):(r=1/0,g=1/0),t.x=r,t.y=g,t};export function inverse(t){var s,i,h=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(a=(a-this.Zb)/this.Qn,h/=this.Qn,Math.abs(h)<=2.623395162778){var n=clens_cmplx(this.utg,2*a,2*h);a+=n[0],h+=n[1],h=Math.atan(sinh(h));var o=Math.sin(a),r=Math.cos(a),g=Math.sin(h),c=Math.cos(h);a=Math.atan2(o*c,hypot(g,c*r)),h=Math.atan2(g,c*r),s=adjust_lon(h+this.long0),i=gatg(this.cgb,a)}else s=1/0,i=1/0;return t.x=s,t.y=i,t};export var names=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"];export default{init:init,forward:forward,inverse:inverse,names:names};