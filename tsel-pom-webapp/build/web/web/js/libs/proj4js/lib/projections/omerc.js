import tsfnz from"../common/tsfnz";import adjust_lon from"../common/adjust_lon";import phi2z from"../common/phi2z";import{EPSLN,HALF_PI,FORTPI}from"../constants/values";export function init(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),h=Math.cos(this.lat0),s=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(h,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-s*s);var a,i,l=tsfnz(this.e,this.lat0,t),o=this.bl/h*Math.sqrt((1-this.es)/(1-s*s));if(o*o<1&&(o=1),isNaN(this.longc)){var n=tsfnz(this.e,this.lat1,Math.sin(this.lat1)),M=tsfnz(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(o+Math.sqrt(o*o-1))*Math.pow(l,this.bl):this.el=(o-Math.sqrt(o*o-1))*Math.pow(l,this.bl);var r=Math.pow(n,this.bl),e=Math.pow(M,this.bl);i=.5*((a=this.el/r)-1/a);var m=(this.el*this.el-e*r)/(this.el*this.el+e*r),b=(e-r)/(e+r),c=adjust_lon(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(m*Math.tan(.5*this.bl*c)/b)/this.bl,this.long0=adjust_lon(this.long0);var p=adjust_lon(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*p)/i),this.alpha=Math.asin(o*Math.sin(this.gamma0))}else a=this.lat0>=0?o+Math.sqrt(o*o-1):o-Math.sqrt(o*o-1),this.el=a*Math.pow(l,this.bl),i=.5*(a-1/a),this.gamma0=Math.asin(Math.sin(this.alpha)/o),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha))};export function forward(t){var h,s,a,i=t.x,l=t.y,o=adjust_lon(i-this.long0);if(Math.abs(Math.abs(l)-HALF_PI)<=EPSLN)a=l>0?-1:1,s=this.al/this.bl*Math.log(Math.tan(FORTPI+a*this.gamma0*.5)),h=-1*a*HALF_PI*this.al/this.bl;else{var n=tsfnz(this.e,l,Math.sin(l)),M=this.el/Math.pow(n,this.bl),r=.5*(M-1/M),e=.5*(M+1/M),m=Math.sin(this.bl*o),b=(r*Math.sin(this.gamma0)-m*Math.cos(this.gamma0))/e;s=Math.abs(Math.abs(b)-1)<=EPSLN?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-b)/(1+b))/this.bl,h=Math.abs(Math.cos(this.bl*o))<=EPSLN?this.al*this.bl*o:this.al*Math.atan2(r*Math.cos(this.gamma0)+m*Math.sin(this.gamma0),Math.cos(this.bl*o))/this.bl}return this.no_rot?(t.x=this.x0+h,t.y=this.y0+s):(h-=this.uc,t.x=this.x0+s*Math.cos(this.alpha)+h*Math.sin(this.alpha),t.y=this.y0+h*Math.cos(this.alpha)-s*Math.sin(this.alpha)),t};export function inverse(t){var h,s;this.no_rot?(s=t.y-this.y0,h=t.x-this.x0):(s=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),h=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),h+=this.uc);var a=Math.exp(-1*this.bl*s/this.al),i=.5*(a-1/a),l=.5*(a+1/a),o=Math.sin(this.bl*h/this.al),n=(o*Math.cos(this.gamma0)+i*Math.sin(this.gamma0))/l,M=Math.pow(this.el/Math.sqrt((1+n)/(1-n)),1/this.bl);return Math.abs(n-1)<EPSLN?(t.x=this.long0,t.y=HALF_PI):Math.abs(n+1)<EPSLN?(t.x=this.long0,t.y=-1*HALF_PI):(t.y=phi2z(this.e,M),t.x=adjust_lon(this.long0-Math.atan2(i*Math.cos(this.gamma0)-o*Math.sin(this.gamma0),Math.cos(this.bl*h/this.al))/this.bl)),t};export var names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"];export default{init:init,forward:forward,inverse:inverse,names:names};