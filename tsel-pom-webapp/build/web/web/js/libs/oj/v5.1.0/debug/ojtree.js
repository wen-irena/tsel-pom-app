"use strict";define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojdnd"],function(e,t){function i(){}e.TreeDndContext=function(e){this.Init(e)},e.Object.createSubclass(e.TreeDndContext,e.Object,"oj.TreeDndContext"),e.TreeDndContext.prototype.Init=function(t){e.TreeDndContext.superclass.Init.call(this),this.component=t,this.options=t.options,this._reset()},e.TreeDndContext.prototype.isDragEnabled=function(){var e=this._dnd;return e.reorder||e.dragFromEnabled},e.TreeDndContext.prototype.isDropEnabled=function(){var e=this._dnd;return e.reorder||e.dropToEnabled},e.TreeDndContext.prototype.handleDnDOptionChange=function(t){var i=this._dnd,a=e.TreeDndContext,n=i.reorder,s=i.dragFromEnabled;this._dndCleanAll(),this.initDnDOpts(),n==(i=this._dnd).reorder&&s==i.dragFromEnabled||i.reorder||i.dragFromEnabled||this.component._getContainerList().find("li").removeClass(a._OJ_DRAGGABLE).removeClass(a._OJ_DRAG).removeClass(a._OJ_VALID_DROP).removeAttr("draggable"),this.initDnD()},e.TreeDndContext.prototype.initDnDOpts=function(){var i,a,n,s=this.options.dnd,r=this._dnd,o=e.TreeDndContext,d=!0;r.reorder=!1,"object"==typeof s?("string"==typeof(i=s[o._DND_REORDER])&&("enable"===i?(r.reorder=!0,d=!1):"disable"==i&&(d=!1)),d&&(this.options.dnd.reorder="disable"),"object"==typeof(i=s[o._DND_DRAG])&&"object"==typeof(n=i[o._DND_NODE])&&("function"==typeof(a=n[o._DND_DRAGSTART_CB])&&(r.dragStartCallback=a,r.dragFromEnabled=!0),"function"==typeof(a=n[o._DND_DRAGDRAG_CB])&&(r.dragDragCallback=a,r.dragFromEnabled=!0),"function"==typeof(a=n[o._DND_DRAGEND_CB])&&(r.dragEndCallback=a,r.dragFromEnabled=!0),a=n[o._DND_DATATYPES],t.isArray(a)?(r.dragDataTypes=a.slice(),r.dragFromEnabled=!0):"string"==typeof a&&(r.dragDataTypes=[a],r.dragFromEnabled=!0)),"object"==typeof(i=s[o._DND_DROP])&&"object"==typeof(n=i[o._DND_NODE])&&("function"==typeof(a=n[o._DND_DROPDRAGENTER_CB])&&(r.dropDragEnterCallback=a,r.dropToEnabled=!0),"function"==typeof(a=n[o._DND_DROPDRAGOVER_CB])&&(r.dropDragOverCallback=a,r.dropToEnabled=!0),"function"==typeof(a=n[o._DND_DROPDRAGLEAVE_CB])&&(r.dropDragLeaveCallback=a,r.dropToEnabled=!0),"function"==typeof(a=n[o._DND_DROPDROP_CB])&&(r.dropDropCallback=a,r.dropToEnabled=!0),a=n[o._DND_DATATYPES],t.isArray(a)?(r.dropDataTypes=a.slice(),r.dropToEnabled=!0):"string"==typeof a&&(r.dropDataTypes=[a],r.dropToEnabled=!0)),r.reorder||(r.dragDataTypes||r.dragStartCallback||(r.dragFromEnabled=!1,r.dragStartCallback=r.dragDragCallback=r.dragEndCallback=r.dragDataTypes=null),r.dropDropCallback||(r.dropToEnabled=!1,r.dropDragEnterCallback=r.dropDragOverCallback=r.dropDragLeaveCallback=r.dropDropCallback=r.dropDataTypes=null)),r.pureReorder=r.reorder&&!r.dragFromEnabled):this.options.dnd={reorder:"disable"}},e.TreeDndContext.prototype.initDnD=function(){var i=this._dnd,a=i.vars,n=e.TreeDndContext;if(i.dragFromEnabled||i.dropToEnabled||i.reorder){e.TreeDndContext._dragMarker?(a.m=e.TreeDndContext._dragMarker,a.ml=e.TreeDndContext._dragMarkerLine):(a.m=t("<div class='oj-tree-drop-marker'><span class='oj-tree-drop-ptr oj-component-icon'>&#160;</span></div>").css("pointer-events","none").hide().appendTo("body"),a.ml=t("<div />").addClass(n._OJT_DROP_MARKER_LINE).css("pointer-events","none").hide().appendTo("body"),e.TreeDndContext._dragMarker=a.m,e.TreeDndContext._dragMarkerLine=a.ml),i.ml_width=a.ml.width();var s=this.component.element[0],r=t(s).children("ul:eq(0)");(i.reorder||i.dragFromEnabled)&&(i.fnDragStart=this._dragStart.bind(this),i.fnDragEnd=this._dragEnd.bind(this),t(s).on("dragstart",i.fnDragStart),t(s).on("dragend",i.fnDragEnd),r.length&&r.find("li").addClass(n._OJ_DRAGGABLE).addClass(n._OJ_DRAG).addClass(n._OJ_VALID_DROP).attr("draggable","true")),(i.reorder||i.dropToEnabled)&&(i.fnDrag=this._drag.bind(this),i.fnDragEnter=this._dragEnter.bind(this),i.fnDragOver=this._dragOver.bind(this),i.fnDragLeave=this._dragLeave.bind(this),i.fnDragDrop=this._dragDrop.bind(this),t(s).on("drag",i.fnDrag),t(s).on("dragenter",i.fnDragEnter),t(s).on("dragover",i.fnDragOver),t(s).on("dragleave",i.fnDragLeave),t(s).on("drop",i.fnDragDrop))}},e.TreeDndContext.prototype._closedown=function(){this._dndCleanAll()},e.TreeDndContext.prototype._dragStart=function(a){var n,s,r,o,d,l=t(a.target).closest("li"),h=a.originalEvent.dataTransfer;e.TreeDndContext;if((s=(n=this._dnd).vars).o=null,s.r=null,n.nodeLastEnter=null,n.nodeLastLeft=null,n.nodeDraggedId=null,n.dragStarted=!1,!n.reorder&&!n.dragFromEnabled||l.hasClass(i._OJ_DISABLED)||this.component._isTreeDisabled())a.preventDefault();else{if(!this.component._canTypedNodeMove(l,"move"))return!1;if(o=this.component.isSelected(l)?this.component._getNode(null,!0):o=l,(n.dragFromEnabled||n.pureReorder)&&this._setDataTypes(h,o),this._setDragImage(h,o),n.dragStartCallback){if(r=this._getDraggedItemArray(o),d=n.dragStartCallback(a,{item:r}),a.isDefaultPrevented()||"boolean"==typeof d&&!d)return d;if(!n.dragDataTypes&&!this._checkAddedDataTypes(h)&&!n.reorder)return a.preventDefault(),!1}"uninitialized"===h.effectAllowed&&(n.pureReorder?h.effectAllowed="move":h.effectAllowed=e.DomUtils.isMetaKeyPressed(a)?"copy":"move"),this._dndStartDrag(o,l,a)}},e.TreeDndContext.prototype._drag=function(e){var t=this._dnd;t.dragDragCallback&&t.dragDragCallback(e)},e.TreeDndContext.prototype._dragEnter=function(a){this.component._$container_ul[0].firstChild||this._addInternalNode();var n,s=t(a.target),r=this.component._getNode(s),o=this._dnd,d=o.vars,l=r&&r.length>0&&r.hasClass("oj-tree-node"),h=a.originalEvent.dataTransfer,c=e.TreeDndContext,_=!1,u=!1;if(l&&r.hasClass(i._OJ_TEMPNODE)&&(o.bInternalNode=!0),!l||"UL"!=a.target.tagName||"group"!=a.target.getAttribute("role"))if(o.foreign=!o.dragStarted,!o.foreign&&!o.reorder||o.foreign&&this._isDtType(h,c._DND_INTERNAL_DT_REORDER))this._dndClean();else if(!o.foreign||(_=this._isDtType(h,c._DND_INTERNAL_DT),o.dropToEnabled)){if(d.r=!1,o.nodeLastEnter&&this._clearDropClasses(o.nodeLastEnter),s.hasClass("oj-tree")&&(r=o.nodeLastEnter),!r||!r.length||r.attr("id")!=o.nodeDraggedId)return _&&l&&(o.nodeLastEnter=null,d.o=2),o.foreign&&!_&&(d.o=1),d.r=r,o.nodeLastEnter=r,this._dndPlacement(a,r),this._dndEnter(r)?(d.r.removeClass(c._OJ_INVALID_DROP).addClass(c._OJ_VALID_DROP).addClass(c._OJ_ACTIVE_DROP),o.dropDragEnterCallback&&(n=o.dropDragEnterCallback(a,{item:o.bInternalNode?null:r,position:o.bInternalNode?"first":o.place,reference:o.bInternalNode?null:d.r})),void 0===n?this._isDtAcceptDataTypes(h)?(a.preventDefault(),a.stopPropagation()):u=o.foreign||!o.reorder:!1===n||a.isDefaultPrevented()?(a.preventDefault(),a.stopPropagation()):!o.foreign&&o.reorder||(u=o.foreign||!o.reorder),u&&this._dndClean(),n):(this._clearDropClasses(d.r),d.r=null,void this._dndHideMarker());this._dndHideMarker()}else this._dndClean()},e.TreeDndContext.prototype._dragOver=function(e){var t,i,a=this._dnd,n=a.vars,s=e.originalEvent.dataTransfer,r=!1;if(n.r&&n.r.length)if((t=n.r).hasClass("oj-tree-node"))if(t.attr("id")!=a.nodeDraggedId){if(this._dndPlacement(e,t),this._dndPrepare())return a.dropDragOverCallback&&(i=a.dropDragOverCallback(e,{item:a.bInternalNode?null:t,reference:a.bInternalNode?null:n.r,position:a.bInternalNode?"first":n.last_pos})),void 0===i?this._isDtAcceptDataTypes(s)?(e.preventDefault(),e.stopPropagation()):r=a.foreign||!a.reorder:!1===i||e.isDefaultPrevented()?(e.preventDefault(),e.stopPropagation()):!a.foreign&&a.reorder||(r=a.foreign||!a.reorder),r&&this._dndClean(),i;this._dndHideMarker()}else this._dndHideMarker();else this._dndHideMarker();else this._dndHideMarker()},e.TreeDndContext.prototype._dragDrop=function(e){var t,i=this._dnd,a=i.vars,n=(e.originalEvent.dataTransfer,"boolean"==typeof a.o&&a.o,!1);return a.r&&(i.dropDropCallback?t=i.dropDropCallback(e,{reference:i.bInternalNode?null:a.r,position:i.bInternalNode?"first":a.last_pos,reorder:!i.foreign&&i.reorder}):!i.foreign&&i.reorder||(n=!0),n||t&&!e.isDefaultPrevented()||this._dndFinishReorder(e)),i.foreign&&this._dndClean(),n||(e.preventDefault(),e.stopPropagation()),i.nodeLastLeft=null,t},e.TreeDndContext.prototype._dragEnd=function(e){var t=this._dnd,i=t.vars;t.dragEndCallback&&t.dragEndCallback(e,{reorder:t.reorder&&!1===i.o}),this._dndStopDrag(),this._dndClean()},e.TreeDndContext.prototype._addInternalNode=function(){this._internalNode||(this._internalNode=t("<li class='"+i._OJ_TEMPNODE+" oj-tree-node oj-tree-leaf oj-valid-drop' id='"+i._OJ_TEMPNODE+"'><ins class='oj-tree-icon'></ins><a href='#'><ins class='oj-tree-icon'></ins><span class='oj-tree-title'></span></a></li>")),this.component._$container_ul.append(this._internalNode)},e.TreeDndContext.prototype._dragLeave=function(i){var a=this._dnd,n=a.vars,s=t(i.target),r=s.closest("li"),o=r&&r.length>0&&r.hasClass("oj-tree-node"),d=(r.attr("id"),i.originalEvent.dataTransfer);e.TreeDndContext;a.dropDragLeaveCallback&&a.dropDragLeaveCallback(i,{item:a.bInternalNode?null:r}),s.hasClass("oj-tree")||!o||"none"==d.dropEffect?this._dndLeave(i):a.nodeLastLeft=r,n.r&&this._clearDropClasses(n.r)},e.TreeDndContext.prototype._dndEnter=function(t){var a,n=this._dnd,s=n.vars;e.TreeDndContext;n.prepared=!1,a=this._dndPrepare();var r=n.openTimeoutMs;r&&(n.openTimer_Id&&clearTimeout(n.openTimerId),s.r&&s.r.length&&s.r.hasClass(i._OJ_COLLAPSED)&&(n.openTimerId=setTimeout(this._dndOpen.bind(this),r)));var o=typeof a;return a="boolean"==o&&a||"string"==o},e.TreeDndContext.prototype._dndOpen=function(){var e=this._dnd,t=e.vars;e.openTimerId=!1,this.component._expand(t.r,this._dndPrepare.bind(this),!0)},e.TreeDndContext.prototype._dndFinishReorder=function(t){var i=this._dnd,a=i.vars;i.dragStarted&&i.reorder&&"object"==typeof a.o&&a.o.length>0&&(this.component._moveNode(a.o,a.r,a.last_pos,e.DomUtils.isMetaKeyPressed(t)),a.o=!1)},e.TreeDndContext.prototype._dndFinishSelection=function(e){e.hasClass(i._OJ_SELECTED)&&(e.removeClass(i._OJ_SELECTED),this.component._select(e,!0));var a,n=this.component.getChildren(e),s=n&&n.length?n.length:0;for(a=0;a<s;a++)this._dndFinishSelection(t(n[a]))},e.TreeDndContext.prototype._dndPlacement=function(e,t){var a=this._dnd;t&&(t.hasClass(i._OJ_TEMPNODE)?a.place="after":(e=e.originalEvent,a.off=t.offset(),a.place=e.pageY-(a.off.top||0),a.place=a.place>=this.component._getNodeHeight()?"after":a.place<0?"before":"inside","after"===a.place&&t.hasClass(i._OJ_EXPANDED)&&(a.place="first")))},e.TreeDndContext.prototype._dndLeave=function(e){var t=this._dnd,i=t.vars;t.after=!1,t.before=!1,t.inside=!1,t.lastNodeEnter=null,this._dndHideMarker(),i.r&&i.r[0]===e.target.parentNode&&t.openTimerId&&(clearTimeout(t.openTimerId),t.openTimerId=!1)},e.TreeDndContext.prototype._dndClean=function(){this._dndHideMarker();var e=this._dnd,t=e.vars;t.o=!1,t.r=!1,e.openTimerId&&clearTimeout(e.openTimerId),e.nodeDraggedId=null,e.foreign=!1,e.nodeLastEnter=null,e.nodeLastLeft=null,e.after=!1,e.before=!1,e.inside=!1,e.off=!1,e.prepared=!1,e.openTimerId=!1,e.foreign=!1,e.bInternalNode=!1},e.TreeDndContext.prototype._dndCleanAll=function(){var e,i=this._dnd;(e=t(this.component._getContainer()[0])).off("dragstart",i.fnDragStart),e.off("dragend",i.fnDragEnd),e.off("drag",i.fnDrag),e.off("dragenter",i.fnDragEnter),e.off("dragover",i.fnDragOver),e.off("dragleave",i.fnDragLeave),e.off("drop",i.fnDragDrop),this._dndClean(),this._reset()},e.TreeDndContext.prototype._dndPrepare=function(){var e=this._dnd,t=e.vars,i=this.component,a=!1;if(!t.r||!t.r.length)return!1;if("number"!=typeof t.o||1!==t.o&&2!==t.o){if(!t.o)return!1}else a=!0;return e.off=t.r.offset(),this.component._isRtl&&(e.off.right=e.off.left+t.r.width()-t.r.find(">a").width()-30),e.targ_ml_width=t.r.find("a").width(),a?(e.before="before"==e.place,e.after="after"==e.place,e.inside="inside"==e.place):(i._prepare_move(t.o,t.r,"before"),e.before=i._checkMove(),i._prepare_move(t.o,t.r,"after"),e.after=i._checkMove(),this.component._is_loaded(t.r)?(i._prepare_move(t.o,t.r,"inside"),e.inside=i._checkMove()):e.inside=!1),e.prepared=!0,this._dndShowMarker()},e.TreeDndContext.prototype._dndShowMarker=function(){var t,i,a,n,s,r=this._dnd,o=e.TreeDndContext,d=r.vars,l=this.component._isRtl,h=this.component._getNodeHeight(),c=!1;if(!r.prepared)return this._dndHideMarker(),c;if(("after"==r.place&&r.after||"inside"==r.place&&r.inside||"before"==r.place&&r.before||"first"==r.place)&&(c=r.place),"first"===c){var _=d.r.find("li:eq(0)");r.off=_.offset()}switch(s=l?r.off.right-18:r.off.left+5,t=!this.component.isLeaf(d.r),i=l?s+r.targ_ml_width+18:s,a=l?i-r.ml_width:s+8,n=r.off.top-3,c){case"before":case"first":this._moveMarkerUI(d.m,{left:i,top:n-7}),d.ml&&this._moveMarkerUI(d.ml,{left:a,top:n});break;case"after":n+=h,this._moveMarkerUI(d.m,{left:i,top:n-2}),d.ml&&this._moveMarkerUI(d.ml,{left:a,top:n+6});break;case"inside":this._moveMarkerUI(d.m,{left:i+(l?t?-4:0:4),top:r.off.top+h/2-8}),d.ml&&d.ml.hide();break;default:this._dndHideMarker()}return c?d.r.removeClass(o._OJ_INVALID_DROP).addClass(o._OJ_VALID_DROP):d.r.removeClass(o._OJ_VALID_DROP).removeClass(o._OJ_VALID_DROP),d.last_pos=c,c},e.TreeDndContext.prototype._dndHideMarker=function(){var t=this._dnd.vars;e.TreeDndContext;t&&(t.m&&t.m.hide(),t.ml&&t.ml.hide(),t.r&&this._clearDropClasses(t.r))},e.TreeDndContext.prototype._moveMarkerUI=function(e,t){this._dnd.vars;t.left=t.left+"px",t.top=t.top+"px",e.css(t).show()},e.TreeDndContext.prototype._dndStartDrag=function(t,i,a){var n,s=this._dnd,r=s.vars,o=e.TreeDndContext;r.o=t,r.o.addClass(o._OJ_DRAG),s.nodeDraggedId=i.attr("id");try{a.currentTarget.unselectable="on",a.currentTarget.onselectstart=function(){return!1},a.currentTarget.style&&(a.currentTarget.style.MozUserSelect="none")}catch(e){}this.component._isTheme()&&r.m&&r.m.addClass("oj-tree-"+this.component._getTheme()),n=this.component._getContainer(),s.cof=n.offset(),s.cw=parseInt(n.width(),10),s.ch=parseInt(n.height(),10),s.dragStarted=!0},e.TreeDndContext.prototype._dndStopDrag=function(){var t=this._dnd,i=t.vars,a=e.TreeDndContext;i.r&&this._clearDropClasses(i.r),"number"!=typeof i.o&&i.o&&i.o.removeClass(a._OJ_DRAG),this._dragImg&&(document.body.removeChild(this._dragImg),this._dragImg=null),t.dragStarted=!1},e.TreeDndContext.prototype._setDataTypes=function(t,i){var a,n,s,r=this._dnd,o=e.TreeDndContext;if((a=this.component.__getJson(i))&&(n=JSON.stringify(a)),r.dragDataTypes)for(s=0;s<r.dragDataTypes.length;s++)t.setData(r.dragDataTypes[s],n);t.setData(o._DND_INTERNAL_DT,"0"),r.pureReorder&&t.setData(o._DND_INTERNAL_DT_REORDER,"0")},e.TreeDndContext.prototype._setDragImage=function(e,i){var a,n,s,r,o,d=i.length;if(1!==d){for(a=t("<div></div>"),n=t("<ul style='padding:0px;margin:0;'></ul>"),a.append(n),o=0;o<d;o++)(r=i[o].cloneNode(!0)).style.marginLeft=0,r.style.paddingLeft=0,n.append(r);s=a[0],document.body.appendChild(s),s.style.position="absolute",s.style.top="-"+2*a.height()+"px",s.style.right="0",this._dragImg=s,e.setDragImage(s,0,0)}else this._dragImg=null},e.TreeDndContext.prototype._isDtType=function(e,t){var i,a=e.types,n=a.length;for(i=0;i<n;i++)if(t==a[i])return!0;return!1},e.TreeDndContext.prototype._isDtAcceptDataTypes=function(e){var t,i=this._dnd.dropDataTypes,a=!1;if(i){for(a=!(i.length>0),t=0;t<i.length;t++)if(this._isDtType(e,i[t])){a=!0;break}}else a=!0;return a},e.TreeDndContext.prototype._checkAddedDataTypes=function(t){var i,a,n=t.types,s=n&&n.length?n.length:0,r=e.TreeDndContext,o=!1;for(a=0;a<s;a++)if((i=n[a])!=r._DND_INTERNAL_DT&&i!=r._DND_INTERNAL_DT_REORDER){o=!0;break}return o},e.TreeDndContext.prototype._clearDropClasses=function(t){var i=e.TreeDndContext;t&&t.removeClass(i._OJ_VALID_DROP).removeClass(i._OJ_INVALID_DROP).removeClass(i._OJ_ACTIVE_DROP)},e.TreeDndContext.prototype._getDraggedItemArray=function(e){var t=[];return e&&e.each(function(){t.push(this)}),t},e.TreeDndContext.prototype._reset=function(){var e={};this._dnd=e,e.reorder=!1,e.pureReorder=!1,e.foreign=!1,e.dragStarted=!1,e.nodeDraggedId=null,e.nodeLastEnter=null,e.fnDragStart=null,e.fnDragEnd=null,e.fnDrag=null,e.fnDragEnter=null,e.fnDragOver=null,e.fnDragLeave=null,e.fnDragDrop=null,e.dragFromEnabled=!1,e.dropToEnabled=!1,e.dragStartCallback=null,e.dragDragCallback=null,e.dragDragEndCallback=null,e.dropDragEnterCallback=null,e.dropDragOverCallback=null,e.dropDragLeaveCallback=null,e.dragDropCallback=null,e.dropDataTypes=null,e.after=!1,e.inside=!1,e.before=!1,e.off=!1,e.prepared=!1,e.openTimerId=!1,e.cof=!1,e.cw=!1,e.ch=!1,e.ml_width=100,e.targ_ml_width=100,e.openTimeoutMs=500,e.vars={},e.vars.o=!1,e.vars.r=!1,e.vars.m=!1,e.vars.ml=!1},e.TreeDndContext.prototype._trace=function(e){this.component._trace(e)},e.TreeDndContext._OJ_DRAGGABLE="oj-draggable",e.TreeDndContext._OJ_DRAG="oj-drag",e.TreeDndContext._OJ_ACTIVE_DROP="oj-active-drop",e.TreeDndContext._OJ_VALID_DROP="oj-valid-drop",e.TreeDndContext._OJ_INVALID_DROP="oj-invalid-drop",e.TreeDndContext._OJ_DROP="oj-drop",e.TreeDndContext._OJT_DROP_MARKER="oj-tree-drop-marker",e.TreeDndContext._OJT_DROP_MARKER_LINE="oj-tree-drop-marker-line",e.TreeDndContext._DND_REORDER="reorder",e.TreeDndContext._DND_DRAG="drag",e.TreeDndContext._DND_DROP="drop",e.TreeDndContext._DND_NODE="node",e.TreeDndContext._DND_DATATYPES="dataTypes",e.TreeDndContext._DND_DRAGSTART_CB="dragStart",e.TreeDndContext._DND_DRAGDRAG_CB="drag",e.TreeDndContext._DND_DRAGEND_CB="dragEnd",e.TreeDndContext._DND_DROPDRAGENTER_CB="dragEnter",e.TreeDndContext._DND_DROPDRAGOVER_CB="dragOver",e.TreeDndContext._DND_DROPDRAGLEAVE_CB="dragLeave",e.TreeDndContext._DND_DROPDROP_CB="drop",e.TreeDndContext._DND_INTERNAL_DT="_ojtree",e.TreeDndContext._DND_INTERNAL_DT_REORDER="_ojtreereorder",i._OJ_EXPANDED="oj-expanded",i._OJ_COLLAPSED="oj-collapsed",i._OJ_HOVER="oj-hover",i._OJ_SELECTED="oj-selected",i._OJ_DISABLED="oj-disabled",i._OJ_DEFAULT="oj-default",i._OJ_TEMPNODE="oj-treenode-temp",function(){var a,n,s,r="oj-tree-leaf",o="oj-tree-icon",d="oj-tree-node-icon",l="oj-tree-loading",h="oj-tree-icon oj-tree-disclosure-icon oj-component-icon oj-clickable-icon-nocontext oj-default",c="oj-tree-children",_={cut:"ojtreecut",copy:"ojtreecopy",paste:"ojtreepaste","paste-after":"ojtreepasteafter","paste-before":"ojtreepastebefore",remove:"ojtreeremove",rename:"ojtreerename"},u={cut:"labelCut",copy:"labelCopy",paste:"labelPaste","paste-after":"labelPasteAfter","paste-before":"labelPasteBefore",remove:"labelRemove",rename:"labelRename"},p=["id","title","class","role","draggable","style"];t(function(){/msie/.test(navigator.userAgent.toLowerCase())?(n=t('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),s=t('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),a=n.width()-s.width(),n.add(s).remove()):(n=t("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:0}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200}),a=100-n.width(),n.parent().remove())});var f=[];function g(i){var a="";e.DomUtils.isMetaKeyPressed(i)?a+="ctrl+":i.shiftKey&&(a+="shift+");var n=i.which;switch(n){case 32:a+="space";break;case 37:a+="left";break;case 38:a+="up";break;case 39:a+="right";break;case 40:a+="down";break;case 46:a+="del";break;case 33:a+="pgup";break;case 34:a+="pgdn";break;case 35:a+="end";break;case 36:a+="home";break;case 56:a="*";break;case 113:case 121:a+="f"+("1"-(112-n))}if(0===a.length||"shift+"==a||"ctrl+"==a)return!0;var s=null;return t.each(f,function(e,t){if(t._this._data.ui.focused)return t._this._data.ui.touchEvent=!1,"shift+f10"==a?(t._this._data.menu.activeNode=t._this._data.ui.hovered,t._this._data.menu.activeNode||(t._this._data.menu.activeNode=t._this._data.ui.lastSelected)):t._handler[a]&&(i.preventDefault(),s=t._handler[a].call(t._this,i)),!1}),null!=s?s:void 0}function m(e,i){var a=!1,n=!0;if(e.str)return e.title&&(a=t("style[id='"+e.title+"-stylesheet']")[0]),a?n=!1:((a=document.createElement("style")).setAttribute("type","text/css"),e.title&&a.setAttribute("id",e.title+"-stylesheet")),a.styleSheet?n?(document.getElementsByTagName("head")[0].appendChild(a),a.styleSheet.cssText=e.str):a.styleSheet.cssText=a.styleSheet.cssText+" "+e.str:(a.appendChild(document.createTextNode(e.str)),document.getElementsByTagName("head")[0].appendChild(a)),a.sheet||a.styleSheet}var v=-1;e.__registerWidget("oj.ojTree",t.oj.baseComponent,{widgetEventPrefix:"oj",defaultElement:"<div>",options:{dnd:{reorder:"disable"},expandParents:!1,initExpanded:null,initLoaded:[],selection:[],selectionMode:"single",selectedParentCollapse:!1,selectedParentExpand:!0,selectPrevOnDelete:!1,data:null,emptyText:null,icons:!0,types:null,before:null,collapse:null,create:null,collapseAll:null,cut:null,dehover:null,remove:null,destroy:null,expand:null,expandAll:null,hover:null,loaded:null,move:null,paste:null,refresh:null,rename:null},collapse:function(e,a){var n=(a=a||!1)?0:this._animDuration;if(!(e=this._getNode(e)).length||-1===e||!e.hasClass(i._OJ_EXPANDED)||this._data.core.locked||e.hasClass(i._OJ_DISABLED))return!1;var s=this._emitEvent({obj:e,func:"collapse"},"before");("boolean"!=typeof s||s)&&(e.removeClass(i._OJ_EXPANDED).addClass(i._OJ_COLLAPSED).attr("aria-expanded","false"),t(e.children()[0]).removeClass(i._OJ_SELECTED).addClass("oj-default"),this._busyStack.push({op:"c",id:e.attr("id")}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+e.attr("id")+"' is animating."),!a&&n?this._slide(e,!0):this._transitionEnd(t(e.children("UL")[0]),e))},_slide:function(e,i){var a,n,s;a=t(e.children("ul")),this._isSafari?a[0].addEventListener("webkitTransitionEnd",this._proxyTransitionEndHandler):a[0].addEventListener("transitionend",this._proxyTransitionEndHandler),i?(n=a[0].offsetHeight,s=0):(n=0,s=this._getElemHeight(a[0])),a.css("max-height",n+"px"),this._overflow=a.css("overflow"),a.css("overflow","hidden"),i||(a[0].style.display="block"),setTimeout(function(){a.addClass("oj-tree-transition"),a.css("max-height",s+"px")},20)},_getElemHeight:function(e){var i,a,n,s,r=t("<div style='position: absolute'>");return i=e.parentNode,a=e.nextSibling,i.removeChild(e),s=e.style.display,e.style.display="block",r.append(e),this._$container[0].appendChild(r[0]),n=e.offsetHeight||e.scrollHeight,e.style.display=s,this._$container[0].removeChild(r[0]),r[0].removeChild(e),a?i.insertBefore(e,a):i.appendChild(e),n+10},_transitionEndHandler:function(e){var i=t(e.target),a=i.closest("li");this._isSafari?i[0].removeEventListener("webkitTransitionEnd",this._proxyTransitionEndHandler):i[0].removeEventListener("transitionend",this._proxyTransitionEndHandler),i.removeClass("oj-tree-transition"),this._transitionEnd(i,a)},_transitionEnd:function(e,t){var a;t.hasClass(i._OJ_COLLAPSED)?(a="c",e[0].style.display="none",e.css("max-height",""),this._emitEvent({obj:t},"collapse"),this.after_close(t)):(a="e",e[0].style.display="block",e.css("max-height",""),this._emitEvent({obj:t},"expand")),this._overflow&&(e.css("overflow",this._overflow),this._overflow=null),this._removeFromBusyStack(a,t.attr("id")),this._resolveIfBusyStackEmpty()},collapseAll:function(e,t){var a=e||-1,n=this;if(!this._data.core.locked&&((e=e?this._getNode(e):this._$container)&&-1!==a&&(a=e),e&&-1!==a||(e=this._$container_ul),!e.hasClass(i._OJ_DISABLED))){var s;-1!==a&&this.isExpanded(e)&&(s=e[0]);var r=e.find("li.oj-expanded");r.length&&r.each(function(){n.collapse(this,!t)}),s&&(this.collapse(s,!t),r.splice(0,0,s)),r.length&&this._emitEvent({obj:r,targ:a},"collapseAll")}},expand:function(e,t){this._expand(e,!1,t)},expanded:function(e,i){var a,n,s=this;if(e&&"array"===t.type(e))return this._data.core.locked?null:(n=e.length,t.each(e,function(e,t){s._expand(t,!1,i)}),null);n=(e=this._$container_ul.find("li.oj-expanded")).length,a=[];for(var r=0;r<n;r++)a.push(e[r]);return t(a)},expandAll:function(e,t){this._expandAll(e,t)},toggleExpand:function(e,t){if((e=this._getNode(e))&&e.length&&-1!==e&&!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked)return e.hasClass(i._OJ_COLLAPSED)?this.expand(e,t):e.hasClass(i._OJ_EXPANDED)?this.collapse(e,t):void 0},deselect:function(e){var t=this.options.selection.slice(0);this._deselect(e),this._fireOptionChangeEvent("selection",t,null,null)},deselectAll:function(e){if(!this._data.core.locked){var t=this.options.selection.slice(0);this._deselectAll(e),this._fireOptionChangeEvent("selection",t,null,null)}},select:function(e){this._select(e,!0)},toggleSelect:function(e){return!!(e=this._getNode(e)).length&&(!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked&&(this._isSelected(e)?this.deselect(e):this._select(e,!0),!0))},isCollapsed:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(i._OJ_COLLAPSED)},isExpanded:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(i._OJ_EXPANDED)},isLeaf:function(e){return this._isLeaf(e)},isSelected:function(e){return this._isSelected(e)},create:function(e,i,a){var n,s,r;if(!(s=t.isArray(a))||1==a.length)return n=this._createNode(e,i,s?a[0]:a),this._getDndContext()._dndFinishSelection(n),n;if(s=[],"before"!=i)for(r=a.length-1;r>=0;r--)n=this._createNode(e,i,a[r]),s.unshift(n[0]),this._getDndContext()._dndFinishSelection(n);else for(r=0;r<a.length;r++)n=this._createNode(e,i,a[r]),s.push(n[0]),this._getDndContext()._dndFinishSelection(n);return t(s)},remove:function(e){if(!(e=this._getNode(e)).length||e.hasClass(i._OJ_DISABLED)||this._data.core.locked)return!1;var a=this._emitEvent({obj:e,func:"remove"},"before");if("boolean"==typeof a&&!a)return!1;this.__rollback();var n=this._getParent(e),s=t([]),o=this,d=this._getPrev(e);return e.each(function(){s=s.add(o._getPrev(this))}),e=e.detach(),-1!==n&&0===n.find("> ul > li").length&&n.removeClass("oj-expanded oj-collapsed").addClass(r).removeAttr("aria-expanded"),this._cleanNode(n),this._emitEvent({obj:e,prev:d,parent:n},"remove"),e},getText:function(e){return!!(e=this._getNode(e)).length&&(e=(e=e.children("a:eq(0)")).find("span:eq(0)"))[0].textContent},rename:function(e,t){t=this._escapeHtml(t),this._renameNode(e,t)},hover:function(e){this._hover(e)},dehover:function(){this._dehover()},getPath:function(e,t){var i=[],a=this;return!(-1===(e=this._getNode(e))||!e||!e.length)&&(e.parentsUntil(".oj-tree","li").each(function(){i.push(t?this.id:a.getText(this))}),i.reverse(),i.push(t?e.attr("id"):this.getText(e)),i)},getRoot:function(){return this._$container.children("ul:eq(0)")},refresh:function(e){this._super(),this._data.core.locked||this._refresh(e||-1)},move:function(e,t,i,a){this._moveNode(e,t,i,a)},getType:function(e){return this._getType(e)},setType:function(e,t){return this._setType(e,t)},getNodeBySubId:function(e){return e?this._processSubId(e):this.element?this.element[0]:null},getSubIdByNode:function(e){return this._getSubIdFromNodeElem(e)},getContextByNode:function(e){var t;return e=null==e||void 0==e?0:e,(t=-1!=(e=this._getNode(e))&&e.length>0)||-1==e?{subId:t?"oj-tree-node":"oj-tree",item:t?e[0]:null,node:!!t&&e,leaf:!!t&&this._isLeaf(e)}:null},getParent:function(e){var t=this._getParent(e);return t&&t.length>0?t:null},getPrevSibling:function(e){var t=this._getPrev(e,!0);return t&&t.length>0?t:null},getNextSibling:function(e){var t=this._getNext(e,!0);return t&&t.length>0?t:null},getChildren:function(e){e=e||-1;var t=this._getChildren(e);return(t=t&&t.length?t.not("."+i._OJ_TEMPNODE):t)&&t.length>0?t:null},scrollIntoView:function(e,t,i){var a,n;if(e?(a=e.node,a=this._getNode(a)):a=-1,-1==a&&(a=this._$container.find("> ul > li:first-child")),a&&a.length)return n="top"==t,(i=!!i)&&(this._$container_ul.focus(),this.hover(a)),a[0].scrollIntoView(n),this},_ComponentCreate:function(){if(this._super(),this._index=this._newIndex(),this._elemId=this.element.attr("id"),void 0===this._elemId&&(this._elemId="oj-tree-"+this._getIndex(),this.element.attr("id",this._elemId)),this._$container=this.element,this._$container_ul=null,this._data={},this._tds=null,this._isRtl="rtl"===this._GetReadingDirection(),this._isTouch=e.DomUtils.isTouchSupported(),this._initTree(),this._animDuration=this._getAnimDuration(),this._animDuration){var t=e.AgentUtils.getAgentInfo();this._isSafari=t.browser===e.AgentUtils.BROWSER.SAFARI,this._proxyTransitionEndHandler=this._transitionEndHandler.bind(this)}this._busyStack=[],this._start()},_destroy:function(){this._resolveBusyContext(),this._clearTree(),this._data.html.markup_ul&&(this._unTransformElemIds(this._data.html.markup_ul),this._$container.append(this._data.html.markup_ul),this._data.html.markup_div.remove(),this._data.html.markup_div=!1,this._data.html.useExistingMarkup=!1),this._data.ds.type=0,this._super()},_setOption:function(e,i,a){var n;if("selection"===e)i="string"==typeof i?[i]:i&&i.length?i:[],this._data.core.suppressSelectEvent=!0,this._handleSelectionOptionChange(i),this._data.core.suppressSelectEvent=!1,i=this._getSelected();else if("selectionMode"===e)"none"===i?n=0:"single"===i?n=1:"multiple"===i?n=-1:(n=0,i="none"),n!=this._data.core.selectMode&&(this._data.core.selectMode=n);else if("icons"===e)"boolean"==t.type(i)&&i!=this._data.themes.icons&&(this._data.themes.icons=i,i?this._showIcons():this._hideIcons());else if("contextMenu"===e)this._clearMenu(),i&&(this._initMenuOpts(),this._initMenu(i));else if("disabled"===e)this._handleDisabledChanged(i);else{if("data"===e)return this._super(e,i,a),this._initDSOpts(),this._initDataSource(),this._initExpandedOpts(),void this._loadNodes();if("dnd"===e)return this._super(e,i,a),void this._getDndContext().handleDnDOptionChange(i);"emptyText"==e&&(i=this._escapeHtml(i))}this._super(e,i,a)},_CompareOptionValues:function(e,t,i){return"selection"===e?this._compareSelectionValues(t,i):this._superApply(arguments)},_compareSelectionValues:function(e,i){var a,n,s,r,o,d=!1,l=!1;if((r=e&&e.length?e.length:0)!==(o=i&&i.length?i.length:0))d=!0;else if(0==r&&0===o)d=!1;else for(a=0;a<r;a++){for(s=t(e[a]).attr("id"),l=!1,n=0;n<o;n++)if(s==t(i[n]).attr("id")){l=!0;break}if(!l){d=!0;break}}return!d},_addBusyState:function(t){if(!this._animationResolve){var i=e.Context.getContext(this.element[0]).getBusyContext();this._animationResolve=i.addBusyState({description:t})}},_resolveBusyContext:function(){this._animationResolve&&(this._animationResolve(),this._animationResolve=null)},_isOnBusyStack:function(e,t){var i,a=this._busyStack,n=a.length,s=-1;for(i=0;i<n;i++)if(a[i].id===t&&a[i].op===e){s=i;break}return s},_removeFromBusyStack:function(e,t){var i=this._isOnBusyStack(e,t);return i>=0&&this._busyStack.splice(i,1),i},_resolveIfBusyStackEmpty:function(){0===this._busyStack.length&&this._resolveBusyContext()},_clearTree:function(){this._TreeDndContext&&(this._TreeDndContext._closedown(),this._TreeDndContext=null);var e=this._getIndex();this._$container.unbind(".oj-tree").undelegate(".oj-tree").removeData("oj-tree-instance-id").find("[class^='oj-tree']").addBack().attr("class",function(){return this.className.replace(/oj-tree[^ ]*|$/gi,"")});var i,a=this._$container.attr("class");0===(a=a.trim()).length&&this._$container.removeAttr("class"),i=this._$container_ul,t.each(f,function(e){if(f[e]._selector===i)return t(i).off("keydown"),f[e]=null,f.splice(e,1),!1}),t(document).unbind(".oj-tree-"+e).undelegate(".oj-tree-"+e),this._$container_ul.remove(),this._$container_ul=null},_getNode:function(e,i){if(void 0===e||null===e)return i?this._data.ui.selected:this._data.ui.lastSelected;var a=t(e,this._getContainer());return a.is(".oj-tree")||-1===e?-1:!!(a=a.closest("li",this._getContainer())).length&&a},_getPrev:function(e,t){if(-1===(e=this._getNode(e)))return this._$container.find("> ul > li:last-child");if(!e.length)return!1;if(t)return e.prevAll("li").length>0&&e.prevAll("li:eq(0)");if(e.prev("li").length){for(e=e.prev("li").eq(0);e.hasClass(i._OJ_EXPANDED);)e=e.children("ul:eq(0)").children("li:last");return e}var a=e.parentsUntil(".oj-tree","li:eq(0)");return!!a.length&&a},_getNext:function(e,t){
return-1===(e=this._getNode(e))?this._$container.find("> ul > li:first-child"):!!e.length&&(t?e.nextAll("li").length>0&&e.nextAll("li:eq(0)"):e.hasClass(i._OJ_EXPANDED)?e.find("li:eq(0)"):e.nextAll("li").length>0?e.nextAll("li:eq(0)"):e.parentsUntil(".oj-tree","li").next("li").eq(0))},_getParent:function(e){if(-1==(e=this._getNode(e))||!e.length)return!1;var t=e.parentsUntil(".oj-tree","li:eq(0)");return t.length?t:-1},_getChildren:function(e){return-1===(e=this._getNode(e))?this._$container.children("ul:eq(0)").children("li"):!!e.length&&e.children("ul:eq(0)").children("li")},_isLeaf:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(r)},_getNodeElem:function(e){var i=this._$container_ul.find(e),a=!1;return i&&i.length&&i.length>0&&t(i).is("li")&&(a=i),a},_isSelected:function(e){var t=this._getNode(e),i=!1;return t&&t.length&&this._data.ui.selected&&(i=this._data.ui.selected.index(t)>=0),i},_reference:function(t,i){var a=t.parents("div").eq(0),n=e.Components.__GetWidgetConstructor(a);return n&&i&&n("getCI",i),this},getCI:function(e){e.ot=this},_applyDefaults:function(e,i){void 0!=e&&void 0!=i&&t.each(i,function(t,i){void 0==e[t]&&(e[t]=i)})},_handleDisabledChanged:function(e){var t;void 0!==e&&((t=this._$container_ul.hasClass(i._OJ_DISABLED))||(t=!1),t!=e&&(e?(this._$container_ul.addClass(i._OJ_DISABLED),this._$container_ul.prop("disabled",!0)):(this._$container_ul.removeClass(i._OJ_DISABLED),this._$container_ul.prop("disabled",!1)),this._treeDisable(e)))},_treeDisable:function(e){(e=e||!1)?(this._data.core.locked=!0,this._data.ui.opacity=this._$container.children("ul").css("opacity"),this._$container_ul.addClass(i._OJ_DISABLED).css("opacity","0.9")):(this._data.core.locked=!1,this._$container_ul.removeClass(i._OJ_DISABLED).css("opacity",this._data.ui.opacity))},_isTreeDisabled:function(){return this._data.core.locked},_handleSelectionOptionChange:function(e){var i,a,n,s,r=e.slice(0),o=[],d=this;t.grep(r,function(e,t){return!!(i=d._getNodeElem(e))&&(o.push(i),r[t]=i[0],!0)});var l=this._getSelected();t.each(l,function(e,i){for(s=o.length,a=t(i).attr("id"),n=!1,e=0;e<s;e++)if(a==o[e].attr("id")){n=!0;break}n||d._deselect(i)}),this._setSelected(o,null)},_prepare_move:function(e,t,i,a,n){var s={};if(t=-1!==t&&t?this._getNode(t):-1,this._reference(e,s),s.rt=this,s.o=s.ot._getNode(e),s.r=t,s.p=void 0===i||!1===i?"last":i,n||!this._data.core.prepMoveBlk.o||this._data.core.prepMoveBlk.o[0]!==s.o[0]||this._data.core.prepMoveBlk.r[0]!==s.r[0]||this._data.core.prepMoveBlk.p!==s.p){if(-1!==s.r&&s.r){if(!/^(before|after)$/.test(s.p)&&!this._is_loaded(s.r))return this._load_node(s.r,function(){this._prepare_move(e,t,i,a,!0)});switch(s.p){case"before":s.cp=s.r.index(),s.cr=s.rt._getParent(s.r);break;case"after":s.cp=s.r.index()+1,s.cr=s.rt._getParent(s.r);break;case"inside":case"first":s.cp=0,s.cr=s.r;break;case"last":s.cp=s.r.find(" > ul > li").length,s.cr=s.r;break;default:s.cp=s.p,s.cr=s.r}}else switch(s.cr=-1,s.p){case"first":case"before":case"inside":s.cp=0;break;case"after":case"last":s.cp=s.rt._$container.find(" > ul > li").length;break;default:s.cp=s.p}s.np=-1==s.cr?s.rt._getContainer():s.cr,s.op=s.ot._getParent(s.o),s.cop=s.o.index(),-1===s.op&&(s.op=s.ot?s.ot._$container:this._$container),!/^(before|after)$/.test(s.p)&&s.op&&s.np&&s.op[0]===s.np[0]&&s.o.index()<s.cp&&s.cp++,s.or=s.np.find(" > ul > li:nth-child("+(s.cp+1)+")"),this._data.core.prepMoveBlk=s,a&&a.call(this,this._data.core.prepMoveBlk,"prepare_move")}else a&&a.call(this,this._data.core.prepMoveBlk)},_checkMove:function(){var e,t=this._data.core.prepMoveBlk,i=!0;if(e=-1===t.r?this._$container:t.r,!t||!t.o||t.or[0]===t.o[0])return!1;if(!t.r)return!1;if(!t.cy){if(t.op&&t.np&&t.op[0]===t.np[0]&&t.cp-1===t.o.index())return!1;t.o.each(function(){if(-1!==e.parentsUntil(".oj-tree","li").addBack().index(this))return i=!1,!1})}return i},_renameNode:function(e,t){var i;if(e=this._getNode(e),this.__rollback(),i=this.getText(e),e&&e.length){var a=this._emitEvent({obj:e,func:"rename",title:t,prevTitle:i},"before");if("boolean"==typeof a&&!a)return}e&&e.length&&this._set_text.apply(this,Array.prototype.slice.call(arguments))&&this._emitEvent({obj:e,title:t,prevTitle:i},"rename")},_moveNode:function(e,a,n,s,o,d){if(!o){e=this._getNode(e);var l=this._emitEvent({obj:e,func:"move"},"before");if("boolean"==typeof l&&!l)return!1}if(!(e.hasClass&&e.hasClass(i._OJ_DISABLED)||this._data.core.locked)){if(!o)return this._prepare_move(e,a,n,function(e){e.ot===e.rt||e.cy||e.ot.deselect(e.o),this._moveNode(e,!1,!1,s,!0,d)});if(s&&(this._data.core.prepMoveBlk.cy=!0),!d&&!this._checkMove())return!1;this.__rollback();var h=!1;s?(h=e.o.clone(!0)).find("*[id]").addBack().each(function(){this.id&&(this.id="copy_"+this.id)}):h=e.o,e.or.length?e.or.before(h):(e.np.children("ul").length||t("<ul />").appendTo(e.np),e.np.children("ul:eq(0)").append(h));try{e.ot._cleanNode(e.op),e.rt._cleanNode(e.np),e.op.find("> ul > li").length||e.op.removeClass("oj-expanded oj-collapsed").removeAttr("aria-expanded").addClass(r).children("ul").remove()}catch(e){}s&&(this._data.core.prepMoveBlk.cy=!0,this._data.core.prepMoveBlk.oc=h);var c=t.extend(!0,{},this._data.core.prepMoveBlk);return c.obj=e.o,this._emitEvent(c,"move"),this._data.core.prepMoveBlk}},_getMoveBlk:function(){return this._data.crrm.prepMoveBlk},_getType:function(e){var t=null;return this.options.types&&(t=this._getNode(e)),!(!t||!t.length)&&(t.attr(this.options.types.attr)||"default")},_setType:function(e,t){var i,a,n=this.options.types,s=!1;return e=this._getNode(e),n&&e&&-1!=e&&e.length&&t&&(i=n.attr,a=n.types,i&&a&&a[t]&&(e.attr(i,t),e.addClass("oj-tree-type"),s=!0)),s},_canTypedNodeMove:function(e,t){var i,a,n=!0;return(i=this.options.types)&&(i=i.types)&&(i[a=this._getType(e)]&&void 0!==i[a][t]||i.default&&void 0!==i.default[t])&&!1===this._check(t,e)&&(n=!1),n},_check:function(e,i,a){i=this._getNode(i);var n=!1,s=this._getType(i),r=this._getOptions().types,o=!1;if(-1===i){if(!r[e])return;n=r[e]}else{if(!1===s)return;(o=!!this._data.types.defaults.useData&&i.data("oj-tree"))&&o.types&&void 0!==o.types[e]?n=o.types[e]:r.types[s]&&void 0!==r.types[s][e]?n=r.types[s][e]:r.types.default&&void 0!==r.types.default[e]&&(n=r.types.default[e])}return t.isFunction(n)&&(n=n.call(this,i)),n},_cleanNode:function(a){var n,s,l,c=this._getDndContext(),_=e.TreeDndContext;c.isDragEnabled()&&(n=_._OJ_DRAGGABLE,s="draggable",l=!0),c.isDropEnabled()&&(n+=" "+_._OJ_VALID_DROP),(a=(a=a&&-1!=a?t(a):this._$container_ul).is("li")?a.find("li").addBack():a.find("li")).removeClass("oj-tree-last").addClass("oj-tree-node").addClass(n).attr(s,l).filter("li:last-child").addClass("oj-tree-last").end().filter(":has(li)").not(".oj-expanded").removeClass(r).addClass(i._OJ_COLLAPSED).attr("aria-expanded","false"),a.not(".oj-expanded, .oj-collapsed").addClass(r).children("ul").remove();var u,p,f=!!this.options.types&&this.options.types.attr;a.find("li");t.each(a,function(e,i){p=t(this),(u=p.find("> ins")).length>1&&(u=t(u[0])),p.hasClass(r)?(u.removeClass(h),u.addClass(o)):(u.addClass(h),u.removeClass(d)),f&&p.attr(f)&&p.addClass("oj-tree-type")})},_createNode:function(e,a,n,s,r){if(e=e||-1,-1!==(e=this._getNode(e))&&!e.length)return null;var o,d;this.options;if(a=void 0===a?"last":a,!r&&!this._is_loaded(e))return this._load_node(e,function(){this._createNode(e,a,n,s,!0)}),null;if(this.__rollback(),!(n=this._parseJson(n)))return null;switch(n=n.children(),o=t(n[0]),-1===e&&(e=this._$container,"before"===a&&(a="first"),"after"===a&&(a="last")),a){case"before":e.before(o),d=this._getParent(e);break;case"after":e.after(o),d=this._getParent(e);break;case"inside":case"first":e.children("ul").length||e.append("<ul />"),e.children("ul").prepend(o),d=e;break;case"last":e.children("ul").length||e.append("<ul />"),e.children("ul").append(o),d=e;break;default:e.children("ul").length||e.append("<ul />"),a||(a=0),(d=e.children("ul").children("li").eq(a)).length?d.before(o):e.children("ul").append(o),d=e}return-1!==d&&d.get(0)!==this._$container.get(0)||(d=-1),this._cleanNode(d),this._emitEvent({obj:o,parent:d},"create"),s&&s.call(this,o),this._$container_ul[0].childNodes.length>1&&this._$container_ul.find("."+i._OJ_TEMPNODE).remove(),o},_expand:function(e,a,n){if(!(e=this._getNode(e))||!e.length)return!1;if(n=n||!1,!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked){if(!e.hasClass(i._OJ_COLLAPSED))return a&&a.call(),!1;var s=this._emitEvent({obj:e,func:"expand"},"before");if("boolean"!=typeof s||s){var r=n?0:this._animDuration,o=this;this._is_loaded(e)?(this.options.expandParents&&e.parentsUntil(".oj-tree",".oj-collapsed").each(function(){o._expand(this,!1,!0)}),e.removeClass(i._OJ_COLLAPSED).addClass(i._OJ_EXPANDED).attr("aria-expanded","true").children("a").removeClass(l),t(e.children()[0]).removeClass(i._OJ_SELECTED).addClass("oj-default"),this._busyStack.push({op:"e",id:e.attr("id")}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+e.attr("id")+"' is animating."),!n&&r?this._slide(e,!1):this._transitionEnd(t(e.children("UL")[0]),e),a&&a.call()):(e.children("a").addClass(l),this._load_node(e,function(){o._expand(e,a,n)},a))}}},_expandAll:function(e,t,i){var a=e||-1;(e=e?this._getNode(e):-1)&&-1!==e?a=e:e=this._$container_ul,i?e=e.find("li.oj-collapsed"):(i=e,e=e.is(".oj-collapsed")?e.find("li.oj-collapsed").addBack():e.find("li.oj-collapsed"));var n=this;e.each(function(){var e=this;n._is_loaded(this)?n._expand(this,!1,!t):n.expand(this,function(){n._expandAll(e,t,i)},!t)}),0===i.find("li.oj-collapsed").length&&this._emitEvent({obj:e,targ:a},"expandAll")},_select:function(t,a,n){var s=this._data.core,r=this._data.ui,o=s.selectMode;if(0==o)return!1;if(-1==(t=this._getNode(t))||!t||!t.length)return!1;if(t.hasClass(i._OJ_DISABLED)||s.locked)return!1;n&&"touchend"==n.type||(r.touchEvent=!1);var d=this._isSelected(t);if(!d){var l=this._emitEvent({obj:t,func:"select"},"before");if("boolean"==typeof l&&!l)return!1}var h=this.options.selection.slice(0),c=this.options,_=r.defaults.selectMultipleModifier,u=r.defaults.selectRangeModifier,p=r.defaults.disableSelectingChildren,f="on"==_||!1!==_&&n&&e.DomUtils.isMetaKeyPressed(n),g=!1!==u&&n&&n[u+"Key"]&&r.lastSelected&&this._data.ui.lastSelected[0]!==t[0]&&r.lastSelected.parent()[0]===t.parent()[0],m=!0,v=this;if(a){if(p&&f&&(t.parentsUntil(".oj-tree","li").children("a.oj-selected").length||t.children("ul").find("a.oj-selected:eq(0)").length))return!1;switch(m=!1,!0){case g:r.lastSelected.addClass("oj-tree-last-selected"),t=t[t.index()<r.lastSelected.index()?"nextUntil":"prevUntil"](".oj-tree-last-selected").addBack(),-1==o||t.length<o?(r.lastSelected.removeClass("oj-tree-last-selected"),r.selected.each(function(){this!==r.lastSelected[0]&&v._deselect(this)}),d=!1,m=!0):m=!1;break;case r.touchEvent&&-1==o:r.touchEvent=!1,this.toggleSelect(t),m=!1;break;case d&&!f:if(!n)break;this._deselectAll(),r.spacebar||(d=!1),m=!0;break;case!d&&!f:n?r.selected&&1==r.selected.length?this._deselect(r.selected):this._deselectAll(r.selected):1===o?this._deselect(r.selected):o>1&&this._deselectAll(),m=!0;break;case d&&f:this.deselect(t);break;case!d&&f:(-1==o||r.selected.length+1<=o)&&(m=!0)}}var D=!1;return m&&!d&&(g||(r.lastSelected=t),t.children("a").addClass(i._OJ_SELECTED),t.attr("aria-selected","true"),D=!0,c.selectedParentExpand&&t.parents(".oj-collapsed").each(function(){v._expand(this,!1,!0)}),r.selected=r.selected.add(t),this._fix_scroll(t.eq(0)),s.suppressSelectEvent||this._fireOptionChangeEvent("selection",h,null,n)),D},_deselect:function(e){if(!(e=this._getNode(e)).length)return!1;e.hasClass(i._OJ_DISABLED)||this._data.core.locked||this._isSelected(e)&&(e.children("a").removeClass(i._OJ_SELECTED),e.removeAttr("aria-selected"),this._data.ui.selected=this._data.ui.selected.not(e),this._data.ui.lastSelected&&this._data.ui.lastSelected.length&&this._data.ui.lastSelected.get(0)===e.get(0)&&(this._data.ui.lastSelected=this._data.ui.selected.eq(0)))},_deselectAll:function(e){if(!this._data.core.locked){var i=e?t(e).find("a.oj-selected").parent():this._$container.find("a.oj-selected").parent();if(i.not(".oj-disabled"),0!==i.length){var a=this;t.each(i,function(){a._deselect(this)})}}},_setSelected:function(e,i){if(this._data.core.locked)return null;if(e&&e.length>0){var a=this;t.each(e,function(e,t){t&&a._select(t,!0,i)})}},_handleNodeTapClick:function(e){if(e.preventDefault(),e.currentTarget.blur(),!t(e.currentTarget).hasClass(l)){if(this._setFocus(),!this._data.ui.focused){var i=this._getNode(e.currentTarget);i.length>0&&-1!=i&&(this._data.ui.lastHovered=i),this._$container_ul.focus()}this._select(e.currentTarget,!0,e)}this._data.ui.touchEvent=!1},_disclosureHover:function(e,a){if(!(e=t(e)).hasClass(i._OJ_DISABLED)&&!this._data.core.locked){var n=e.parent(),s=n.hasClass(i._OJ_EXPANDED),r=n.hasClass(i._OJ_COLLAPSED);(s||r)&&(a?(e.addClass(i._OJ_HOVER),e.removeClass("oj-default"),e.removeClass(i._OJ_SELECTED)):(e.removeClass(i._OJ_HOVER),e.addClass("oj-default")))}},_hover:function(e){if(!this._data.menu.activeNode&&(e=this._getNode(e)).length&&!e.hasClass(i._OJ_DISABLED)&&!this._data.core.locked&&!e.hasClass(i._OJ_HOVER)){var t=this._emitEvent({obj:e,func:"hover"},"before");("boolean"!=typeof t||t)&&(e.hasClass(i._OJ_HOVER)||this._dehover(),this._data.ui.hovered=e.children("a").addClass(i._OJ_HOVER).parent(),this._$container_ul.attr("aria-activedescendant",this._data.ui.hovered.attr("id")),this._fix_scroll(e),this._emitEvent({obj:e},"hover"))}},_dehover:function(){if(!this._data.menu.activeNode){var e,t=this._data.ui.hovered;t&&t.length&&(t.hasClass(i._OJ_DISABLED)||this._data.core.locked||((e=t.find("a.oj-hover")).length||(e=this._$container_ul.find("a.oj-hover")).length)&&(e=e.removeClass(i._OJ_HOVER).parent(),this._$container_ul.removeAttr("aria-activedescendant"),this._data.ui.hovered=null,void 0!=t.attr("id")&&this._emitEvent({obj:t},"dehover")))}},_refresh:function(e){this._refresh_core(e)},_refresh_core:function(e){var t=e||-1,i=this;this._save_opened(),this._saveSelected(),e||(e=-1),(e=this._getNode(e))?t=e:e=-1,-1!==e?e.children("UL").remove():(this._$container_ul.empty(),this._processExistingMarkup()),this._load_node(e,function(){i._emitEvent({obj:t},"refresh"),i._reload_nodes(),i._rehover()})},_refresh_ui:function(e){this._saveSelected(),this._refresh_core(e)},after_close:function(e){this._emitEvent({obj:e},"after_close",!0)},_reopen:function(){var e=this;this._data.core.toExpand.length&&t.each(this._data.core.toExpand,function(t,i){e._expand(i,!1,!0)}),this._emitEvent({},"reopen",!0)},_rehover:function(){var e,t=this._data.ui.lastHovered;t&&(e=t.attr("id"))&&(t=this._getNode("#"+e)),this._data.ui.hovered=this._data.ui.lastHovered=t},_getSelected:function(e){var i,a,n,s;for(a=[],s=(i=e?t(e).find("a.oj-selected").parent():this._data.ui.selected).length,n=0;n<s;n++)a.push(i[n]);return a},_set_text:function(e,t){return!!(e=this._getNode(e)).length&&(e=(e=e.children("a:eq(0)")).find("span:eq(0)"),this._emitEvent({obj:e,name:t},"set_text",!0),e[0].textContent=t)},_loadNodes:function(){0!==this._data.ds.type&&-1!==this._data.ds.type?this._load_node(-1,function(){this._loaded(),this._reload_nodes()}):(this._applyEmptyText(),this._loaded())},_load_node:function(e,t,i){this._emitEvent({obj:e},"load_node",!0)},_is_loaded:function(e){return!0},_load_node_DS:function(e,t,i){var a=this;this._load_node_tree(e,function(){a._emitEvent({obj:a._getNode(e)},"load_node",!0),t.call(this)},i)},_is_loaded_DS:function(e){return-1===(e=this._getNode(e))||!e||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_refresh_DS:function(e){return(e=this._getNode(e))&&-1!==e&&e.removeData(c),this._refresh_ui(e)},_load_node_J:function(e,t,i){var a=this;this._loadNodeJson(e,function(){a._emitEvent({obj:a._getNode(e)},"load_node",!0),t.call(this)},i)},_is_loaded_J:function(e){var i=this.options.data;return-1==(e=this._getNode(e))||!e||!i.ajax&&!this._data.ds.progressiveRender&&!t.isFunction(i.data)||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_load_node_H:function(e,t,i){var a=this;this._loadNodeHtml(e,function(){a._emitEvent({obj:a._getNode(e)},"load_node",!0),t.call(this)},i)},_is_loaded_H:function(e){var i=this.options.data,a=null,n=null;return i&&(a=i.data||null,n=i.ajax||null),-1==(e=this._getNode(e))||!e||!n&&!t.isFunction(a)||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_reselect:function(){var e=this,i=this._data.ui.toSelect;(i=t.map(t.makeArray(i),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}))&&i.length&&(this.options.selection.length=0,this._data.ui.selected.length=t()),t.each(i,function(t,i){i&&"#"!==i&&e.select(i)}),this._data.ui.selected=this._data.ui.selected.filter(function(){return this.parentNode})},_saveSelected:function(){var e=this._data.ui;e.toSelect=[],e.selected.each(function(){this.id&&e.toSelect.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))})},rollback:function(e){e&&(t.isArray(e)||(e=[e]))},get_rollback:function(){return this._emitEvent(null,"get_rollback",!0),{i:this._getIndex(),h:this._$container.children("ul").clone(!0),d:this.data}},_load_node_tree:function(e,t,i){var a=e&&-1!=e?e[0].id:e||-1,n=this._JsonDSToJson(a,e);if(n.success){var s,r=!e||-1===e,o=this.options.data;if(o.data&&!o.ajax||o.data&&o.ajax&&r)r&&((s=this._parseJson(n.js,e))?(this._$container_ul.empty().append(s.children()),this._cleanNode()):this._data.ds.correctState&&this._$container_ul.empty()),t&&t.call(this);else if(!o.data&&o.ajax||o.data&&o.ajax&&!r)if(s=this._parseJson(n.js,e)){if(r){var d=this._$container_ul;d.empty().append(s.children()),d.attr("role","tree").attr("aria-labelledby",this._elemId).attr("tabindex","0").css("outline","none"),-1===this._data.core.selectMode&&d.attr("aria-multiselectable",!0)}else e.append(s).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading");this._cleanNode(e),t&&t.call(this)}else r?this._data.ds.correctState&&(this._$container_ul.empty(),t&&t.call(this)):(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),o.correct_state&&(this._correct_state(e),t&&t.call(this)))}},_JsonDSToJson:function(e,t){var i,a=[],n=this._tds,s={},r={success:!1,js:null};return-1==e&&(e=null,s.start=0),(i=n.getChildCount(e))>0?(s.count=i,n.fetchChildren(e,s,{success:function(e){for(var i,s=e.getCount(),o=0;o<s;o++){t={},(i=e.getData(o))&&(t.attr=i),t.title=e.m_nodes[o].title,i.metadata&&(t.metadata=e.m_nodes[o].metadata);var d=t.attr.id;if(n.getChildCount(d)>0){var l=this._JsonDSToJson(d,t);t.children=l.js}a.push(t)}r.success=!0,r.js=a}.bind(this),error:function(e){r.success=!1}})):r.success=!0,r},_refresh_json:function(e){if(e=this._getNode(e),!this._data.core.locked){var a=!e||-1!==e||!e.length;if(a||!e.hasClass(i._OJ_DISABLED)){var n=this.options.data.json;return!a&&this._data.ds.progressiveUnload&&(t.isFunction(n.data)||n.ajax)&&e.removeData(c),this._refresh_ui(e)}}},_loadNodeJson:function(e,i,a){var n,s=this._getOptions().data,r=function(){},o=function(){},d=s&&s.data||null,h=s&&s.ajax||null;if(!s||d||h||(d=s),(e=this._getNode(e))&&-1!==e&&(this._data.ds.progressiveRender||this._data.ds.progressiveUnload)&&!e.is(".oj-expanded, .oj-tree-leaf")&&0===e.children("ul").children("li").length&&e.data(c))return(n=this._parseJson(e.data(c),e))&&(e.append(n),this._data.ds.progressiveUnload||e.removeData(c)),this._cleanNode(e),void(i&&i.call(this));if(e&&-1!==e){if(e.data("oj-tree-is-loading"))return;e.data("oj-tree-is-loading",!0)}switch(!0){case!d&&!h:throw"ojTree - neither data nor ajax settings supplied.";case t.isFunction(d):d.call(this,e,function(t){(t=this._parseJson(t,e))?(-1!==e&&e?(e.append(t).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading")):this._$container_ul.empty().append(t.children()),this._cleanNode(e),i&&i.call(this)):(-1!==e&&e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),this._data.ds.correctState&&this._correct_state(e)):this._data.ds.correctState&&this._$container_ul.empty(),a&&a.call(this))}.bind(this));break;case!!d&&!h||!!d&&!!h&&(!e||-1===e):e&&-1!=e||((n=this._parseJson(d,e))?(this._$container_ul.empty().append(n.children()),this._cleanNode()):this._data.ds.correctState&&this._$container_ul.empty()),i&&i.call(this);break;case!d&&!!h||!!d&&!!h&&e&&-1!==e:r=function(t,i,n){var s=this.ctx;s._noteLoadFailureId(this.id,!0),s._removeFromBusyStack("j",-1===e?-1:e.attr("id")),s._resolveIfBusyStackEmpty();var r=s._getOptions().data.ajax.error;r&&r.call(s,i,n,t),-1!=e&&e.length?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),"success"===i&&s._data.ds.correctState&&s._correct_state(e)):("error"==i||"success"===i&&s._data.ds.correctState)&&(s._$container_ul.empty(),s._applyEmptyText()),a&&a.call(s)},o=function(t,a,n){var s=this.ctx;s._noteLoadFailureId(this.id,!1),s._removeFromBusyStack("j",this.id);var o=s._getOptions().data.ajax.success;if(o&&(t=o.call(s,t,a,n)||t),"string"==typeof t){var d=t.replace(/^[\s\n]+$/,"");try{d=JSON.parse(d)}catch(e){d=null}if(!d)return r.call(this,n,"Bad JSON","")}if(t=s._parseJson(t,e)){if(-1!==e&&e)e.append(t).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading");else{var h=s._$container_ul;h.empty().append(t.children()),h.attr("role","tree").attr("aria-labelledby",s._elemId).attr("tabindex","0").css("outline","none"),-1===s._data.core.selectMode&&h.attr("aria-multiselectable",!0)}s._cleanNode(e),i&&i.call(s)}else-1!==e&&e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),s._data.ds.correctState&&(s._correct_state(e),i&&i.call(s))):s._data.ds.correctState&&(s._$container_ul.empty(),i&&i.call(s))};var _=-1===e?-1:e.attr("id");this._busyStack.push({op:"j",id:_}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+_+"' is lazyloading.");var u={ctx:this,id:_};s.ajax.context=u,s.ajax.error=r,s.ajax.success=o,s.dataType||(s.ajax.dataType="json"),u.type=s.ajax.dataType,t.isFunction(s.ajax.url)&&(s.ajax.url=s.ajax.url.call(this,e),u.url=s.ajax.url),t.isFunction(s.ajax.data)&&(s.ajax.data=s.ajax.data.call(this,e)),t.ajax(s.ajax)}},_parseJson:function(e,a,n){var s,r,o,l,_,u,p=!1;if(!e)return p;if(this._data.ds.progressiveUnload&&a&&-1!==a&&a.data(c,p),"string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}if(t.isArray(e)){if(p=t("<ul>"),!e.length)return!1;for(r=0,o=e.length;r<o;r++)(s=this._parseJson(e[r],a,!0)).length&&(p=p.append(s));p=p.children()}else{"string"==typeof e&&(e={data:e}),u="string"==typeof e.title?e.title:" ",p=t("<li role='treeitem' />"),e.attr&&(this._data.types.defType&&!e.attr.type&&(e.attr.type="oj-tree-deftype",p.addClass("oj-tree-type")),p.attr(e.attr)),e.metadata&&p.data(e.metadata),e.children&&0===e.children.length&&p.addClass(i._OJ_COLLAPSED),e.state&&"s"===e.state&&p.addClass(i._OJ_SELECTED),e.data||(e.data={dummy:0});var f,g=!1;s=t("<a/>"),t.each(e.data,function(i,a){t.isFunction(a)&&(a=a.call(this,e)),"object"==typeof a&&("attr"==i?s.attr(a):"style"==i&&s.css(a),"language"==i&&s.addClass(a)),g||((f=t("<span class='oj-tree-title'>"))[0].textContent=u,s.prepend("<ins class='oj-tree-icon "+d+" oj-component-icon'>&#160;</ins>",f),g=!0),!a.icon&&e.icon&&(a.icon=e.icon),a.icon&&(-1===a.icon.indexOf("/")?s.children("ins").addClass(a.icon):s.children("ins").css("background","url('"+a.icon+"') center center no-repeat"))}),p.append(s),p.prepend("<ins class='"+h+"'>&#160;</ins>"),e.children&&(this._data.ds.progressiveRender&&"expanded"!==e.state?p.addClass(i._OJ_COLLAPSED).attr("aria-expanded","false").data(c,e.children):(this._data.ds.progressiveUnload&&p.data(c,e.children),t.isArray(e.children)&&e.children.length&&(s=this._parseJson(e.children,a,!0)).length&&((_=t("<ul role='group' />")).append(s),p.append(_))))}return n||((l=t("<ul />")).append(p),p=l),p},__getJson:function(e,i,a,n){var s,r,o,d,l,h,c,_,u,p=[],f=this.options,g=this;return(e=this._getNode(e))&&-1!==e||(e=this._$container.find("> ul > li")),i=t.isArray(i)?i:["id","class"],!n&&f.types&&i.push(f.types.attr),a=t.isArray(a)?a:[],e.each(function(){d=t(this),s={},u=g._noteUserAttrs(d),(i.length||u&&u.length)&&(s.attr={}),u&&t.each(u,function(e,t){d.attr(t).length>0&&(s.attr[t]=d.attr(t))}),t.each(i,function(e,t){(r=d.attr(t))&&r.length&&r.replace(/oj-tree[^ ]*/gi,"").length&&(r=(" "+r).replace(/ oj-tree[^ ]*/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(s.attr[t]=r)}),g._getDndContext().isDragEnabled()&&g._isSelected(d)&&(s.state="s"),function(e){var t=!0;for(var i in e)if(e.hasOwnProperty(i)){t=!1;break}return t}(o=d.data())||(s.metadata=o),l=d.children("a"),r=null,l.each(function(){h=t(this),a.length||h.children("ins").get(0).style.backgroundImage.length||h.children("ins").get(0).className&&h.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").length?(_=g.getText(h),t.each(a,function(e,t){(c=(" "+(h.attr(t)||"")).replace(/ oj-tree[^ ]*/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(r||(r={attr:{}}),r.attr[t]=c)}),h.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").replace(/^\s+$/gi,"").length&&(c=h.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(r||(r={}),r.icon=c),h.children("ins").get(0).style.backgroundImage.length&&(c=h.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")).length&&(r||(r={}),r.icon=c)):_=g.getText(h),null!=r&&(s.data||(s.data=[]),l.length>1?s.data.push(r):s.data=r),s.title=_}),(d=d.find("> ul > li")).length&&(s.children=g.__getJson(d,i,a,!0)),p.push(s)}),p},_noteUserAttrs:function(e){var t,i,a,n;if((t=e[0].attributes)&&t.length){a=[],n=p.length;for(var s=0;s<t.length;s++)if(i=t[s]){i=i.name;for(var r=0;r<n&&(p[r]!=i&&0!=i.indexOf("aria-"));r++);r>=n&&a.push(i)}}return a&&a.length>0?a:null},_correct_state:function(e){if(!(e=this._getNode(e))||-1===e)return!1;e.removeClass("oj-collapsed oj-expanded").removeAttr("aria-expanded").addClass(r).children("ul").remove(),e.find("ins:first-child").removeClass(h).addClass(o),this._emitEvent({obj:e},"correct_state",!0)},_loaded:function(){this._emitEvent(null,"loaded")},_loadNodeHtml:function(e,i,a){var n,s=this._getOptions().data,r=function(){},c=function(){},_=s&&s.data||null,u=s&&s.ajax||null;if((e=this._getNode(e))&&-1!==e){if(e.data("oj-tree-is-loading"))return;e.data("oj-tree-is-loading",!0)}switch(!0){case!_&&!u&&s&&"string"==typeof s:this._loadHtmlString(s,e,i,a);break;case t.isFunction(_):_.call(this,e,function(t){this._loadHtmlString(t,e,i,a)}.bind(this));break;case!_&&!u:e&&-1!=e||(this._$container_ul.empty().append(this._data.html.cloneMarkup).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon' >&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li").children("ins:first-child").addClass(h),this._insertHtmlTextSpan(this._$container_ul),this._data.types.defType&&this._addDefType(this._$container_ul),this._cleanNode(),this._$container_ul.find("ul").attr("role","group"),this._$container_ul.find("li").attr("role","treeitem")),i&&i.call(this);break;case!!_&&!u||!!_&&!!u&&(!e||-1===e):e&&-1!=e||((n=t(_)).is("ul")||(n=t("<ul />").append(n)),this._$container_ul.empty().append(n.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),this._insertHtmlTextSpan(this._$container_ul),this._data.types.defType&&this._addDefType(this._$container_ul),this._cleanNode(),this._$container_ul.find("ul").attr("role","group"),this._$container_ul.find("li").attr("role","treeitem")),i&&i.call(this);break;case!_&&!!u||!!_&&!!u&&e&&-1!==e:e=this._getNode(e),r=function(t,i,n){var s=this.ctx;s._noteLoadFailureId(this.id,!0),s._removeFromBusyStack("j",-1===e?-1:e.attr("id")),s._resolveIfBusyStackEmpty();var r=s._getOptions().data.ajax.error;r&&r.call(s,t,i,n),-1!=e&&e.length?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),"success"===i&&s._data.ds.correctState&&s._correct_state(e)):"success"===i&&s._data.ds.correctState&&(s._$container_ul.empty(),s._applyEmptyText()),a&&a.call(s)},c=function(a,n,s){var c,_=this.ctx;_._noteLoadFailureId(this.id,!1),_._removeFromBusyStack("j",-1===e?-1:e.attr("id"));var u=_._getOptions().data.ajax.success;if(u&&(a=u.call(_,a,n,s)||a),""===a||a&&a.toString&&""===a.toString().replace(/^[\s\n]+$/,""))return r.call(_,s,n,"");if(a){(a=t(a)).is("ul")||(a=t("<ul />").append(a)),-1!=e&&e?(e.children("a.oj-tree-loading").removeClass(l),_._removeEmptyUL(e),e.append(a).children("ul").find("li, a").filter(function(){return!_.firstChild||!_.firstChild.tagName||"INS"!==_.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),e.removeData("oj-tree-is-loading"),e.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),c=e):(_._$container_ul.empty().append(a.children()).find("li, a").filter(function(){return!_.firstChild||!_.firstChild.tagName||"INS"!==_.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),_._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),c=_._$container_ul),_._handleHtmlParentNoChildren(c),_._insertHtmlTextSpan(c);var p=c.children("UL");p.length>=1&&(p=p.first().find("span.oj-tree-title"),t.each(p,function(){this.textContent=_._escapeHtml(this.textContent)})),_._data.types.defType&&c&&_._addDefType(this._$container_ul),_._cleanNode(e),i&&i.call(_)}else e&&-1!==e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),_._data.ds.correctState&&(_._correct_state(e),i&&i.call(_))):_._data.ds.correctState&&(_._$container_ul.empty(),i&&i.call(_)),_._$container_ul.find("ul").attr("role","group"),_._$container_ul.find("li").attr("role","treeitem")};var p=-1===e?-1:e.attr("id");this._busyStack.push({op:"j",id:p}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+p+"' is lazyloading.");var f={ctx:this,id:p};s.ajax.context=f,s.ajax.error=r,s.ajax.success=c,s.ajax.dataType||(s.ajax.dataType="html"),f.type=s.ajax.dataType,t.isFunction(s.ajax.url)&&(s.ajax.url=s.ajax.url.call(this,e),f.url=s.ajax.url),t.isFunction(s.ajax.data)&&(s.ajax.data=s.ajax.data.call(this,e)),t.ajax(s.ajax)}},_handleHtmlParentNoChildren:function(e){var a=e.find(e.is("ul")?"li ul":"ul").filter(function(){return!this.firstChild||0==this.childNodes.length||1==this.childNodes.length&&3==this.firstChild.nodeType});t.each(a,function(){t(this).closest("li").addClass(i._OJ_COLLAPSED)})},_removeEmptyUL:function(e){var t=e.find("ul").filter(function(){return!this.firstChild||0==this.childNodes.length||1==this.childNodes.length&&3==this.firstChild.nodeType});t.length>0&&t.remove()},_loadHtmlString:function(e,i,a,n){var s;if(e&&""!==e&&e.toString&&""!==e.toString().replace(/^[\s\n]+$/,"")){(e=t(e)).is("ul")||(e=t("<ul />").append(e)),-1!=i&&i?(i.children("a.oj-tree-loading").removeClass(l),i.append(e).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName
}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass("oj-tree-node-icon").addClass("oj-tree-icon"),i.removeData("oj-tree-is-loading"),s=i,this._addDefType(this.obj)):(this._$container_ul.empty().append(e.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon oj-tree-disclosure-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),s=this._$container_ul,this._addDefType(this._$container_ul)),s&&this._insertHtmlTextSpan(s);var r=s.children("UL");if(r.length>=1){r=r.first().find("span.oj-tree-title");var c=this;t.each(r,function(){this.textContent=c._escapeHtml(this.textContent)})}this._cleanNode(i),a&&a.call(this)}else i&&-1!==i?(i.children("a.oj-tree-loading").removeClass(l),i.removeData("oj-tree-is-loading"),this._data.ds.correctState&&(this._correct_state(i),a&&a.call(this))):this._data.ds.correctState&&(this._$container_ul.empty(),a&&a.call(this))},_insertHtmlTextSpan:function(e){t.each(e.find("li a"),function(e,t){var i=t.innerHTML;i=i.replace("ins>","ins><span class='oj-tree-title'>"),i+="</span>",t.innerHTML=i})},_addDefType:function(e){var i,a;this._data.types.defType&&(i=this.options.types,a=i?i.attr:this._data.types.defaults.attr,t.each(e.find("li"),function(e,i){(i=t(i)).attr(a)||i.attr(a,"oj-tree-deftype").addClass("oj-tree-type")}))},_save_opened:function(){var e=this;this._data.core.toExpand=[],this._$container_ul.find("li.oj-expanded").each(function(){this.id&&e._data.core.toExpand.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"))})},_reload_nodes:function(e){var i,a=this,n=!0,s=[],r=[];e||(this._data.core.reopen=!1,this._data.core.refreshing=!0),this._isOptExpandAll()&&(this._data.core.toExpand=[],this._$container_ul.find("li.oj-collapsed").each(function(){i="#"+t(this).attr("id"),a.isExpanded(i)||a._isLoadFailureId(i)||a._data.core.toExpand.push(i)})),this._data.core.toExpand=t.map(t.makeArray(this._data.core.toExpand),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this._data.core.toLoad=t.map(t.makeArray(this._data.core.toLoad),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:")}),this._data.core.toExpand.length&&(this._data.core.toLoad=this._data.core.toLoad.concat(this._data.core.toExpand),this._data.core.toLoad=this._data.core.toLoad.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])),this._data.core.toLoad.length&&(t.each(this._data.core.toLoad,function(e,t){if("#"==t)return!0;a._$container.find(t).length?a.isExpanded(t)||s.push(t):r.push(t)}),s.length&&(this._data.core.toLoad=r,t.each(s,function(e,t){a._is_loaded(t)||(a._load_node(t,function(){a._reload_nodes(!0)},function(){a._reload_nodes(!0)}),n=!1)}))),this._data.core.toExpand.length&&t.each(this._data.core.toExpand,function(e,t){a.isExpanded(t)||a._expand(t,!1,!0)}),n&&(this._data.core.reopen&&clearTimeout(this._data.core.reopen),this._data.core.reopen=setTimeout(function(){a._emitEvent({},"reload_nodes",!0),a._resolveIfBusyStackEmpty()},50),this._data.core.refreshing=!1,this._reopen())},setTheme:function(e,i){if(!e)return!1;i||(i=this._data.themes._themes+e+"/style.css"),-1==t.inArray(i,this._data.themes.themes_loaded)&&(m({url:i}),this._data.themes.themes_loaded.push(i)),this._data.themes.theme!=e&&(this._$container.removeClass("oj-tree-"+this._data.themes.theme),this._data.themes.theme=e),this._$container.addClass("oj-tree-"+e),this._data.themes.dots?this._showDots():this._hideDots(),this._data.themes.icons?this._showIcons():this._hideIcons()},_isTheme:function(){return null!=this._data.themes},_getTheme:function(){return this._data.themes.theme},isIcons:function(){return this._data.themes.icons},_showIcons:function(){this._data.themes.icons=!0,this._$container.children("ul").removeClass("oj-tree-no-icons")},_hideIcons:function(){this._data.themes.icons=!1,this._$container.children("ul").addClass("oj-tree-no-icons")},toggleIcons:function(){},_enableKeys:function(){this._data.keys.enabled=!0},_initTree:function(){this._initData(),this._initCoreOpts(),this._initUIOpts(),this._initDSOpts(!0),this._initTypeOpts(),this._getDndContext().initDnDOpts(),this._initMenuOpts(),this._initCore(),this._initUI(),this._initThemes(),this._initDataSource(),this._initTypes(),this._getDndContext().initDnD(),this._initKeys(),this._initMenu()},_emitEvent:function(e,i,a){if(i&&"string"===t.type(i)&&(!0!==this._data.core.locked||"unlock"===i||"isLocked"===i||"lock"===i)){var n,s=Array.prototype.slice.call(arguments),r=this._$container,o="before"===i,d=!a;d||(i="_tree"+i);var l={};if(l.item=e?e.obj:void 0,l.inst=r,o?(n=e.func,l.func=n,l.args=s,"rename"===n&&(l.title=e.title,l.prevTitle=e.prevTitle)):d&&("move"==i?(l.position=e.p,l.reference=e.r,l.data=e):"rename"==i?(l.title=e.title,l.prevTitle=e.prevTitle):"remove"==i?(l.parent=e.parent,l.prev=e.prev):"delete"==i?(l.prev=e.prev,l.parent=e.parent):"expandAll"===i||"collapseAll"===i||"deselectAll"===i?l.targ=e.targ:"loaded"===i?l.item=-1:"paste"==i&&(l.position=e.p,l.reference=e.r)),d){var h=this._trigger(i,new t.Event("oj"+i),l);if(o)return void 0!==h&&(h=!!h),h}else this._$container.trigger(i,l)}},_fireOptionChangeEvent:function(e,t,i,a){"selection"===e&&(null==i&&(i=this._getSelected()),this._compareSelectionValues(t,i)||this.option(e,i,{_context:{originalEvent:a,internalSet:!0},changed:!0}))},__rollback:function(){return this.get_rollback()},_start:function(){var e;this._isRtl&&this._$container.addClass("oj-tree-rtl").css("direction","rtl"),this._$container.html("<ul role='tree' tabindex='0' class='oj-tree-list' style='outline:none'"+(-1===this._data.core.selectMode?" aria-multiselectable='true'":"")+" aria-labelledby='"+this._elemId+"'><li class='oj-tree-last oj-tree-leaf'><ins class='oj-tree-icon'>&#160;</ins><a class='oj-tree-loading' href='#'><ins class='oj-tree-icon'>&#160;</ins>"+this._getString("stateLoading")+"</a></li></ul>"),this._$container_ul=this._$container.children("ul:eq(0)"),this._$container.data("oj-tree-instance-id",this._getIndex()),this._data.core.li_height=this._$container_ul.find("li.oj-collapsed, li.oj-tree-leaf").eq(0).height()||18,this._isTouch&&this._$container.delegate(".oj-tree-list ins.oj-tree-disclosure-icon","touchend.ojtree",function(e){e.preventDefault();var i=t(e.target);this.toggleExpand(i)}.bind(this)),this._$container.delegate(".oj-tree-list ins.oj-tree-disclosure-icon","click.ojtree",function(e){var i=t(e.target);this.toggleExpand(i)}.bind(this)).delegate(".oj-tree-list ins.oj-tree-disclosure-icon","mousedown",function(e){this._data.ui.disclosureClick=!0,t(e.target).removeClass("oj-default").removeClass(i._OJ_HOVER).addClass(i._OJ_SELECTED)}.bind(this)).delegate(".oj-tree-list ins.oj-tree-disclosure-icon","mouseup",function(e){t(e.target).removeClass(i._OJ_SELECTED).addClass("oj-default")}.bind(this)).bind("mousedown.ojtree",function(e){this._setFocus(),e.shiftKey&&(this._getDndContext()&&this._getDndContext().isDragEnabled()||e.preventDefault())}.bind(this)).bind("dblclick.ojtree",function(e){var t;if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){t=window.getSelection();try{t.removeAllRanges(),t.collapse(document.getElementsByTagName("body")[0],0)}catch(e){}}}),this._$container_ul.focus(function(e){return this._data.ui.disclosureClick?(this._data.ui.disclosureClick=!1,!1):(this._data.ui.focused=!0,this._data.ui.hovered?t=this._data.ui.hovered:this._data.ui.lastHovered?(this._data.ui.hovered=this._data.ui.lastHovered,t=this._data.ui.hovered):this._data.ui.lastSelected&&this._data.ui.lastSelected.length>0?(this._data.ui.hovered=this._data.ui.lastSelected,t=this._data.ui.hovered):t=this._$container_ul.find("li:first"),t&&(this.hover(t),this._data.ui.lastHovered=null,this._$container_ul.find("a.oj-selected").removeClass("oj-tree-inactive")),!1);var t}.bind(this)).blur(function(e){this._data.ui.focused=!1,this._data.ui.lastHovered=this._data.ui.hovered,this._data.ui.lastHovered&&this.dehover(this._data.ui.hovered),this._$container_ul.find("a.oj-selected").addClass("oj-tree-inactive")}.bind(this)),this._emitEvent({},"init",!0),this._loadNodes(),this._data.menu.usermenu&&this._applyMenu(),e={_handler:this._keyHandler,_selector:this._$container_ul,_this:this},f.push(e),t(e._selector).keydown(g),this._enableKeys()},_initCore:function(){this._data.core.locked=!1,this._$container.addClass("oj-tree oj-tree-"+this._getIndex()),this._$container.css("outline","none"),this._$container.css("MozUserSelect","none"),this._$container.css("WebkitTouchCallout","none"),this._$container.css("WebkitUserSelect","none"),this._$container.css("-ms-user-select","none"),this._$container.css("WebkitTapHighlightColor","rgba(0,0,0,0)")},_initUI:function(){this._data.ui.selected=t(),this._data.ui.lastSelected=!1,this._data.ui.hovered=null;var e=this.options.selection;e&&"array"===t.type(e)&&e.length>0&&(this._data.ui.toSelect=e,this.options.selection=[]),this._isTouch&&this._$container.delegate(".oj-tree-list a","touchend.ojtree",t.proxy(function(e){this._data.ui.touchEvent=!0,this._handleNodeTapClick(e),t(e.currentTarget).hasClass(l)||this.dehover()},this)),this._$container.delegate(".oj-tree-list a","click.ojtree",function(e){this._data.ui.touchEvent=!1,this._handleNodeTapClick(e)}.bind(this)).delegate(".oj-tree-list a","mouseenter.ojtree",function(e){t(e.currentTarget).hasClass(l)||this.hover(e.target)}.bind(this)).delegate(".oj-tree-list a","mouseleave.ojtree",function(e){t(e.currentTarget).hasClass(l)||this.dehover(e.target)}.bind(this)).delegate(".oj-tree-list .oj-tree-disclosure-icon","mouseenter.ojtree",function(e){t(e.currentTarget).hasClass(l)||this._disclosureHover(e.target,!0)}.bind(this)).delegate(".oj-tree-list .oj-tree-disclosure-icon","mouseleave.ojtree",function(e){t(e.currentTarget).hasClass(l)||this._disclosureHover(e.target,!1)}.bind(this)).bind("_treereopen",function(){this._reselect()}.bind(this)).bind("_treeget_rollback",function(){this.dehover(),this._saveSelected()}.bind(this)).bind("ojcollapse",function(e,i){var a=this._getNode(i.item),n=a&&a.length?a.children("ul").find("a.oj-selected"):t(),s=this;!1!==this.options.selectedParentCollapse&&n.length&&n.each(function(){"selectParent"===s.options.selectedParentCollapse?(s.deselect(this),s.select(a)):"deselect"===s.options.selectedParentCollapse&&s.deselect(this)})}.bind(this)).bind("ojremove",function(e,t){var i,a=this.options.selectPrevOnDelete,n=this._getNode(t.item),s=n&&n.length?n.find("a.oj-selected"):[],r=this;s.each(function(){r.deselect(this),r._data.ui.lastHovered&&(i=r._getNode(this))&&r._data.ui.lastHovered.attr("id")==i.attr("id")&&(r._data.ui.lastHovered=null)}),a&&s.length&&t.prev&&t.prev.each(function(){if(this.parentNode)return r.select(this),!1})}.bind(this)).bind("ojmove",function(e,t){var a,n=t.data,s=n.cy;s&&n.oc&&(n.oc.find("a.oj-selected").removeClass(i._OJ_SELECTED),n.oc.removeAttr("aria-selected")),n.ot===n.rt||s||(a=n.ot._data.ui).lastHovered&&(n.o.attr("id")==a.lastHovered.attr("id")&&(a.lastHovered=null),a.lastSelected&&n.o.attr("id")==a.lastSelected.attr("id")&&(a.lastSelected=null))}.bind(this))},_initDataSource:function(){this._initTreeData(),this._initJsonData(),this._initHtmlData()},_initTreeData:function(){1===this._data.ds.type&&(this._tds=this.options.data||null,this._load_node=this._load_node_DS,this._is_loaded=this._is_loaded_DS,this._refresh=this._refresh_DS)},_initJsonData:function(){3===this._data.ds.type&&(this._data.ds.progressiveUnload&&this._$container.bind("_treeafter_close",function(e,t){t.item.children("ul").remove()}),this._load_node=this._load_node_J,this._is_loaded=this._is_loaded_J,this._refresh=this._refresh_json)},_initHtmlData:function(){4===this._data.ds.type&&(this._processExistingMarkup(),this._load_node=this._load_node_H,this._is_loaded=this._is_loaded_H,this._refresh=this._refresh_ui)},_processExistingMarkup:function(){this._data.html.useExistingMarkup&&(this._data.html.markup_ul||(this._data.html.markup_ul=this._$container.find(" > ul"),this._data.html.markup=this._data.html.markup_ul.find(" > li"),this._data.html.cloneMarkup=this._data.html.markup.clone(!0),this._data.html.cloneMarkup.find("li").addBack().contents().filter(function(){return 3==this.nodeType}).remove(),this._transformElemIds(this._data.html.markup_ul),this._data.html.markup_div=t("<div id='oj-tree-existing-markup-"+this._getIndex()+"' style='display:none'>").append(this._data.html.markup_ul),this._$container.after(this._data.html.markup_div)))},_transformElemIds:function(e){var i=t(e).find("li"),a=this._getIndex();i.each(function(e,t){t.setAttribute("id",a+"_"+t.getAttribute("id"))})},_unTransformElemIds:function(e){var i,a,n=t(e).find("li");this._getIndex();n.each(function(e,t){i=t.getAttribute("id"),a=i.indexOf("_"),i=i.substr(a+1),t.setAttribute("id",i)})},_initThemes:function(){!1===this._data.themes._themes&&(this._data.themes._themes="themes/"),this._$container.bind("_treeinit",t.proxy(function(){var e=this.options;this._data.themes.dots=e.dots,this._data.themes.icons=e.icons,this.setTheme(this._data.themes.theme,this._data.themes.url)},this)).bind("ojloaded",t.proxy(function(){this._data.themes.dots?this._showDots():this._hideDots(),this._data.themes.icons?this._showIcons():this._hideIcons()},this))},_initTypes:function(){var e=this.options.types;e&&this._$container.bind("_treeinit",t.proxy(function(){var i=t.extend(!0,{},e.types),a=e.attr||this._data.types.defaults.attr,n="",s=this;t.each(i,function(e,i){t.each(i,function(e,t){/^(maxDepth|maxChildren|icon|validChildren)$/.test(e)||s._data.types.attachTo.push(e)});var r=typeof i.icon;if("undefined"===r){if("boolean"!==(r=typeof i.image)||i.image){if(!i.image&&!i.position)return!0}else i.image="ojt$none";i.icon={},i.image&&(i.icon.image=i.image,delete i.image),void 0!==i.position&&(i.icon.position=i.position,delete i.position)}(i.icon.image||i.icon.position)&&("default"==e?(s._data.types.defType=!0,n+=".oj-tree-"+s._getIndex()+" .oj-tree-list li.oj-tree-type a > .oj-tree-node-icon { ",n+=s._addTypeCss(i,n),n+="} ",n+=".oj-tree-"+s._getIndex()+" .oj-tree-list li["+a+'="oj-tree-deftype"].oj-tree-type > a ins.oj-tree-node-icon { '):i.icon.image&&(n+=".oj-tree-"+s._getIndex()+" .oj-tree-list li["+a+'="'+e+'"].oj-tree-type > a > ins.oj-tree-node-icon { '),n+=s._addTypeCss(i,n),n+="} ")}),""!==n&&m({str:n,title:"oj-tree-types"})},this)).bind("ojbefore",function(e,i){var a=i.func,n=i.item,s=!!this._data.types.defaults.useData&&this._getNode(n),r=!(!s||-1===s||!s.length)&&s.data("oj-tree");if(r&&r.types&&!1===r[a])return e.stopImmediatePropagation(),!1;if(-1!==t.inArray(a,this._data.types.attachTo)){if(!i.item||!i.item.tagName&&!i.item.jquery)return;if(!this._canTypedNodeMove(n,a))return e.stopImmediatePropagation(),!1}}.bind(this))},_addTypeCss:function(e){var t="";return"ojt$none"!==e.icon.image?t+=" background-image:url("+e.icon.image+"); ":t+=" background-image:none; ",e.icon.position?t+=" background-position:"+e.icon.position+"; ":t+=" background-position:0 0; ",t},_getDndContext:function(){return this._TreeDndContext||(this._TreeDndContext=new e.TreeDndContext(this)),this._TreeDndContext},_initKeys:function(){},_initMenu:function(e){var i;if(e||this.options.contextMenu||(i=this._$container.attr("contextmenu"))&&(this.options.contextMenu="#"+i),i=e||this.options.contextMenu){var a=t(i);if(a){a.css("display","none");var n=this._data.menu;n.$container=a,n.usermenu=!0}this._data.menu.usermenu&&e&&this._applyMenu()}},_handleContextMenuSelect:function(e,t){if(!t.inst&&this._data.menu.treeDivId==this._elemId){var i=t?t.item.attr("id"):void 0;"ojtreecopy"===i?this._crrm_copy(this._data.menu.node):"ojtreecut"===i?this._crrm_cut(this._data.menu.node):"ojtreepaste"===i||"ojtreepastebefore"===i||"ojtreepasteafter"===i?this._crrm_paste(this._data.menu.node,i):"ojtreeremove"===i?this._isSelected(this._data.menu.node)?this._crrm_remove():this._crrm_remove(this._data.menu.node):"ojtreerename"===i?this._crrm_rename(this._data.menu.node):"ojtreecreate"===i&&this._crrm_create(this._data.menu.node)}},_NotifyContextMenuGesture:function(e,a,n){var s,r="keyboard"===n;if("contextmenu"==a.type||r||"touch"==n)if(this._data.menu.node=r?this._data.ui.hovered||this._data.menu.activeNode:t(a.target),this._data.menu.activeNode=null,this._data.menu.node){if(!r){var o=t(a.originalEvent.target);if(o.is("LI")||o.hasClass("oj-tree")||o.is("UL"))return}r?this._data.menu.node:this._data.menu.node.closest("li"),this._data.menu.treeDivId=this._data.menu.node.closest("div").attr("id");var d={launcher:this._$container_ul};if(r&&(s=this._data.menu.node.find(".oj-tree-title")[0],d.position={of:s}),this._data.menu.usermenu&&(this._data.menu.$elemPaste||this._data.menu.$elemPasteBefore||this._data.menu.$elemPasteAfter)){var l,h,c=!this._data.crrm.ct_nodes&&!this._data.crrm.cp_nodes,_=[this._data.menu.$elemPaste,this._data.menu.$elemPasteBefore,this._data.menu.$elemPasteAfter],u=!1;for(h=0;h<_.length;h++)(l=_[h])&&!!l.hasClass(i._OJ_DISABLED)!=c&&(c?l.addClass(i._OJ_DISABLED):l.removeClass(i._OJ_DISABLED),u=!0);u&&this._data.menu.$container.ojMenu("refresh")}this._OpenContextMenu(a,n,d)}else a.preventDefault()},_initCoreOpts:function(){var e=this.options.selectionMode;"none"===(e=void 0==e?"single":e)?e=0:"single"===e?e=1:"multiple"===e&&(e=-1),this._data.core.selectMode=e,this._data.themes.icons=this.options.icons,this._initExpandedOpts(),this._data.core.toLoad=this.options.initLoaded},_initUIOpts:function(){},_initDSOpts:function(i){var a,n,s=this.options.data;if(this._data.ds.type=0,this._data.html.useExistingMarkup=!1,this._data.html.cloneMarkup=!1,this._loadFailureIds={},s)if("string"===(n=t.type(s)))this._isHtml(s)?this._data.ds.type=4:(this._data.ds.type=3,this._initJsonOpts());else if("array"===n)this._data.ds.type=3;else if("object"===n){try{s instanceof e.JsonTreeDataSource&&(this._data.ds.type=1)}catch(e){this._data.ds.type=-1}if(1!==this._data.ds.type)try{s instanceof e.CollectionTreeDataSource&&(this._data.ds.type=2)}catch(e){this._data.ds.type=-1}1===this._data.ds.type||2===this._data.ds.type?this._initTreeDSOpts():(s.data||s.ajax)&&((a=s.dataType)?"json"===a?(this._data.ds.type=3,this._initJsonOpts()):"html"===a&&(this._data.ds.type=4,this._initHtmlOpts()):(s.dataType="json",this._data.ds.type=3,this._initJsonOpts()))}i&&0==this._data.ds.type&&this._$container.find("ul").length>0&&(this._data.ds.type=4,this._data.html.useExistingMarkup=!0)},_initTreeDSOpts:function(){},_initJsonOpts:function(){},_initHtmlOpts:function(){},_initMenuOpts:function(){},_initTypeOpts:function(){var e=this.options.types;"object"==typeof e&&this._applyDefaults(e,{attr:this._data.types.defaults.attr})},_initExpandedOpts:function(){this._data.core.toExpand=this._varCopy(this.options,"initExpanded"),null==this._data.core.toExpand&&(this._data.core.toExpand=[])},_initData:function(){var e=this._data;e.core={initLoaded:[],selectMode:1,load_open:!1,li_height:0,toExpand:!1,toLoad:!1,prepMoveBlk:{},suppressSelectEvent:!1,strings:{}},e.ui={selected:t(),lastSelected:!1,hovered:null,lastHovered:null,disclosureClick:!1,toSelect:null,opacity:1,spacebar:!1,focused:!1,animDurDiv:null,touchEvent:!1},e.ui.defaults={selectMultipleModifier:"ctrl",selectRangeModifier:"shift",disableSelectingChildren:!1},e.crrm={},e.crrm.cp_nodes=!1,e.crrm.ct_nodes=!1,e.crrm.defaults={inputWidthLimit:200,move:{alwaysCopy:!1,openOnMove:!0,defaultPosition:"last",checkMove:function(e){return!0}}},e.crrm.prepMoveBlk={},e.ds={},e.ds.progressiveRender=!1,e.ds.progressiveUnload=!1,e.ds.correctState=!0,e.ds.type=0,e.json={},e.json.defaults={data:!1,ajax:!1},e.html={},e.html.defaults={data:!1,ajax:!1},e.html.useExistingMarkup=!1,e.html.markup_ul=!1,e.html.markup_div=!1,e.html.markup=!1,e.html.cloneMarkup=!1,e.themes={},e.themes.icons=!0,e.themes.dots=!1,e.themes.theme="default",e.themes.url=!1,e.themes.themes_loaded=[],e.themes._themes=!1,e.types={},e.types.attachTo=[],e.types.defType=!1,e.types.defaults={maxChildren:-1,maxDepth:-1,validChildren:"all",useData:!1,attr:"type",types:{default:{maxChildren:-1,maxDepth:-1,validChildren:"all"}}},e.menu={},e.menu.usermenu=!1,e.menu.$container=!1,e.menu.$elemPaste=!1,e.menu.$elemPasteAfter=!1,e.menu.$elemPasteBefore=!1,e.menu.node=!1,e.menu.activeNode=!1,e.keys={},e.keys.enabled=!0,e.keys.bound=[]},_fix_scroll:function(e){var t,i=this._$container[0];if(i.scrollHeight>i.offsetHeight){if(!(e=this._getNode(e))||-1===e||!e.length||!e.is(":visible"))return;(t=e.offset().top-this._$container.offset().top)<0&&(i.scrollTop=i.scrollTop+t-1),t+this._data.core.li_height+(i.scrollWidth>i.offsetWidth?a:0)>i.offsetHeight&&(i.scrollTop=i.scrollTop+(t-i.offsetHeight+this._data.core.li_height+1+(i.scrollWidth>i.offsetWidth?a:0)))}},_setFocus:function(){},_unsetFocus:function(){},_newIndex:function(){return++v},_getIndex:function(){return this._index},_getOptions:function(){return t.extend(!0,{},this.options)},_getContainer:function(){return this._$container},_getContainerList:function(){return this._$container_ul},_keyHandler:{up:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getPrev(e)),!1},"ctrl+up":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getPrev(e)),!1},"shift+up":function(e){var t=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.select(this._getPrev(t),-1!==this._data.ui.selectMode),!1},down:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getNext(e)),!1},"ctrl+down":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getNext(e)),!1},"shift+down":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.select(this._getNext(e),-1!==this._data.ui.selectMode),!1},left:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(i._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},"ctrl+left":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(i._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},"shift+left":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(i._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},right:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(i._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},"ctrl+right":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(i._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},"shift+right":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(i._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},space:function(){return this._data.ui.hovered&&(this._data.ui.spacebar=!0,this._data.ui.hovered.children("a:eq(0)").click(),this._data.ui.spacebar=!1),!1},home:function(){return this.hover(this._$container_ul.find("li:first")),!1},end:function(){var e=this._$container_ul.find("li.oj-tree-last:visible");return e&&e.length&&this.hover(e[e.length-1]),!1},"*":function(){this._$container_ul.find("a");return this._expandAll(-1,!1),!1},"ctrl+space":function(e){if(this._data.ui.hovered){var i=t.Event("click");i.ctrlKey=!0,this._data.ui.hovered.children("a:eq(0)").trigger(i)}return!1},"shift+space":function(e){if(this._data.ui.hovered){var i=t.Event("click");i.shiftKey=!0,this._data.ui.hovered.children("a:eq(0)").trigger(i)}return!1},"shift+home":function(e){var i,a=this._data.ui.hovered;if(a){var n=!0,s=this,r=this._$container_ul.find("li:visible");this._data.core.suppressSelectEvent=!0,i=this.options.selection.slice(0),a=a[0],t.each(r,function(e,t){return t==a&&(n=!1),s._select(t,!0),n}),this._data.core.suppressSelectEvent=!1,this._fireOptionChangeEvent("selection",i,null,e)}return!1},"shift+pgdn":function(e){var i,a=this._data.ui.lastSelected||this._data.ui.hovered;if(a){var n=!1,s=this,r=this._$container_ul.find("li:visible");this._data.core.suppressSelectEvent=!0,i=this.options.selection.slice(0),a=a[0],t.each(r,function(e,t){return n||(n=t==a),n&&!s._isSelected(t)&&s._select(t,!0),!0}),this._data.core.suppressSelectEvent=!1,this._fireOptionChangeEvent("selection",i,null,e)}return!1},f2:function(){return this._crrm_rename(this._data.ui.hovered||this._data.ui.lastSelected),!1},del:function(){return this.remove(this._data.ui.hovered||this._getNode(null)),!1}},_applyMenu:function(){if(this._data.menu.usermenu){var e=this._data.menu.$container,i=this;e.on("ojselect",this._handleContextMenuSelect.bind(this));var a=!1;e.find("[data-oj-command]").each(function(){var e;0===t(this).children("a").length&&(e=t(this).attr("data-oj-command").split("oj-tree-"),t(this).replaceWith(i._buildContextMenuItem(e[e.length-1])),t(this).hasClass("oj-menu-divider")&&t(this).removeClass("oj-menu-divider").addClass("oj-menu-item"),a=!0)}),a&&e.ojMenu("refresh"),this._data.menu.$elemPaste=e.find("#ojtreepaste"),this._data.menu.$elemPasteAfter=e.find("#ojtreepasteafter"),this._data.menu.$elemPasteBefore=e.find("#ojtreepastebefore")}},_clearMenu:function(){var e=this._data.menu;e.usermenu&&(e.usermenu=!1,e.$container.off("ojselect"),e.$container=null)},_buildContextMenuItem:function(e){return t(this._buildContextMenuListItem(e))},_buildContextMenuListItem:function(e){return"<li id="+_[e]+">"+this._buildContextMenuLabel(e)+"</li>"},_buildContextMenuLabel:function(e){var t=u[e];return'<a href="#">'+this._getString(t)+"</a>"},_isLoadFailureId:function(e){return e="#"===(e=-1===e?"-1":e).charAt(0)?e.substr(1):e,!!this._loadFailureIds[e]},_noteLoadFailureId:function(e,t){e=-1===e?"-1":e,t?this._loadFailureIds[e]=!0:this._loadFailureIds.hasOwnProperty(e)&&delete this._loadFailureIds[e]},_crrm_cut:function(e){if(e=e.closest("li"),this._isSelected(e)&&(e=null),!(e=this._getNode(e,!0))||!e.length)return!1;this._data.crrm.cp_nodes=!1,this._data.crrm.ct_nodes=e,this._emitEvent({obj:e},"cut")},_crrm_copy:function(e){if(e=e.closest("li"),this._isSelected(e)&&(e=null),!(e=this._getNode(e,!0))||!e.length)return!1;this._data.crrm.ct_nodes=!1,this._data.crrm.cp_nodes=e,this._emitEvent({obj:e},"copy")},_crrm_paste:function(e,t){if(!(e=this._getNode(e))||!e.length)return!1;var i=this._data.crrm.ct_nodes?this._data.crrm.ct_nodes:this._data.crrm.cp_nodes;if(!this._data.crrm.ct_nodes&&!this._data.crrm.cp_nodes)return!1;var a="inside";"ojtreepasteafter"===t?a="after":"ojtreepastebefore"===t&&(a="before"),this._data.crrm.ct_nodes&&(this._crrm_move_node(this._data.crrm.ct_nodes,e,a,!1,!1,!0),this._data.crrm.ct_nodes=!1),this._data.crrm.cp_nodes&&this._crrm_move_node(this._data.crrm.cp_nodes,e,a,!0,!1,!0),this._emitEvent({obj:i,p:a,r:e},"paste")},_crrm_move_node:function(e,t,i,a,n,s){var r=this._data.crrm.defaults.move;if(!n)return void 0===i&&(i=r.defaultPosition),"inside"!==i||r.defaultPosition.match(/^(before|after)$/)||(i=r.defaultPosition),this._moveNode(e,t,i,a,!1,s);(!0===r.alwaysCopy||"multitree"===r.alwaysCopy&&e.rt._getIndex()!==e.ot._getIndex())&&(a=!0),this._moveNode(e,t,i,a,!0,s)},_crrm_remove:function(e){e=this._getNode(e,!0),this.__rollback(),e=this.remove(e)},_crrm_rename:function(e){this._emitEvent;e=this._getNode(e),this.__rollback(),this._crrm_showInput(e,function(e,t,i){})},_crrm_showInput:function(e,i){e=this._getNode(e);var a=this._isRtl,n=this._data.crrm.defaults.inputWidthLimit,s=e.children("ins").width(),r=e.find("> a:visible > ins").width()*e.find("> a:visible > ins").length,o=this.getText(e),d=t("<div />",{css:{position:"absolute",top:"-200px",left:a?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=e.css("position","relative").append(t("<input />",{value:o,class:"oj-tree-rename-input",css:{padding:"0",border:"1px solid silver",position:"absolute",left:a?"auto":s+r+4+"px",right:a?s+r+4+"px":"auto",top:"0px",height:this._data.core.li_height-2+"px",lineHeight:this._data.core.li_height-2+"px",width:"150px"},blur:t.proxy(function(){var t=e.children(".oj-tree-rename-input"),a=t.val();""===(a=this._escapeHtml(a))&&(a=o),d.remove(),t.remove(),this._set_text(e,o),a!=o&&this._renameNode(e,a),i.call(this,e,a,o),e.css("position","")},this),keyup:function(e){var t=e.keyCode||e.which;if(27==t)return this.value=o,void this.blur();13!=t?l.width(Math.min(d.text("pW"+this.value).width(),n)):this.blur()},keypress:function(e){if(13==(e.keyCode||e.which))return!1}})).children(".oj-tree-rename-input");this._set_text(e,""),d.css({fontFamily:l.css("fontFamily")||"",fontSize:l.css("fontSize")||"",fontWeight:l.css("fontWeight")||"",fontStyle:l.css("fontStyle")||"",fontStretch:l.css("fontStretch")||"",fontVariant:l.css("fontVariant")||"",letterSpacing:l.css("letterSpacing")||"",wordSpacing:l.css("wordSpacing")||""}),l.width(Math.min(d.text("pW"+l[0].value).width(),n))[0].select()},_crrm_create:function(e,a,n,s,r){var o=this;return(e=this._getNode(e))||(e=-1),this.__rollback(),this._createNode(e,a,n,function(e){var a=this._getParent(e),n=t(e).index();s&&s.call(this,e),a.length&&a.hasClass(i._OJ_COLLAPSED)&&this.expand(a,!1,!0),r?o._emitEvent({obj:e,name:this.getText(e),parent:a,position:n}):this._crrm_showInput(e,function(e,t,i){o._emitEvent({obj:e,name:t,parent:a,position:n})})})},_isHtml:function(e){var t=!1;return e&&e.length>=3&&(t="<"===(e=e.trim()).charAt(0)),t},_applyEmptyText:function(){var e=this.options.emptyText;if("string"!=typeof e&&(e=this._getString("labelNoData")),e&&e.length>0){var i=this._$container_ul,a=t("<li class='oj-tree-empty'></li>");a[0].textContent=e,i.empty().append(a)}},_processSubId:function(e){var t,i,a,n,s,r,o,d=null;if(e&&(t=e.subId),!t)return null;if(3===(a=t.split("[")).length&&(a[0]=a[0].trim(),"oj-tree-node"===a[0]&&(a[1]=a[1].trim(),s=a[1].charAt(0),(r=a[1].indexOf(s,1))>=0&&(n=a[1].substring(1,r).trim(),a[2]=a[2].trim(),s=a[2].charAt(0),(r=a[2].indexOf(s,1))>=0)))){d=a[2].substring(1,r).trim();try{i=this._getNode(n)}catch(e){i=null}if(d&&i&&-1!==i)switch(d){case"icon":this._data.themes.icons&&(o=i.find(" > a > ins:eq(0)"));break;case"link":o=i.find(" > a:eq(0)");break;case"disclosure":this._isLeaf(i)||(o=i.find(" > ins:eq(0)"));break;case"title":o=i.find(" > a > span")}}return o&&o.length?o[0]:null},_getSubIdFromNodeElem:function(e){var i,a,n=e?this._getNode(e):null,s=null;return n&&-1!=n&&n.length&&n.hasClass("oj-tree-node")&&e.tagName&&e.parentNode&&(i=e.tagName,a=e.parentNode.tagName,"SPAN"===i?s="title":"A"===i?s="link":"INS"===i&&(e=t(e),"LI"===a&&e.hasClass("oj-tree-disclosure-icon")?s="disclosure":"A"===a&&e.hasClass(d)&&(s="icon"))),s?{subId:"oj-tree-node['#"+n.attr("id")+"']['"+s+"']"}:null},_hideDots:function(){this._data.themes.dots=!1,this._$container.children("ul").addClass("oj-tree-no-dots")},_showDots:function(){this._data.themes.dots=!0,this._$container.children("ul").removeClass("oj-tree-no-dots")},_isOptExpandAll:function(){var e=this.options.initExpanded;return e&&"all"==e||t.isArray(e)&&e.length&&"all"==e[0]},_getString:function(e){var t,i=this._data.core.strings;return(t=i[e])||(t=this.getTranslatedString(e),t=this._escapeHtml(t),i[e]=t),t},_escapeHtml:function(e){var i=document.createElement("div");return t(i).text(e),i.textContent},_getNodeHeight:function(){return this._data.core.li_height},_getAnimDuration:function(){var e,i,a,n=0
;return window.getComputedStyle&&((i=this._data.ui.animDurDiv)||(i=t("<div id='ojtree-comp-animduration'><span class='oj-tree-transition'>dummy</span></div>"),this._data.ui.animDurDiv=i,t("body").append(i)),a=i[0].childNodes[0],e=(e=window.getComputedStyle(a)).transitionDuration?e.transitionDuration:e["-webkit-transition-duration"]?e["-webkit-transition-duration"]:0,i.detach(),"string"==typeof e&&e.length>1&&("s"==e.charAt(e.length-1).toLowerCase()?(e=e.substring(0,e.length-1),e=parseFloat(e),isNaN(e)||(n=1e3*e)):e.length>2&&"ms"==e.substring(e.length-2).toLowerCase()&&(e.substring(0,e.length-2),e=parseFloat(e),isNaN(e)||(n=e)))),n},_varCopy:function(e,i){var a={};return a[i]=e[i],t.extend(!0,{},a)[i]},_trace:function(e,t){}})}()});