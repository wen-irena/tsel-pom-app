define(["ojs/ojcore","knockout","jquery","../appController","common/rendererService","common/restService","ojs/ojdatetimepicker","ojs/ojinputtext","ojs/ojbutton","ojs/ojlabel"],function(e,a,t,l,r,d){const o=this;return function(){if(o.fallout_orderId=a.observable(),o.fallout_orderIdIsValid=a.observable(),o.fallout_actId=a.observable(),o.fallout_actIdIsValid=a.observable(),o.passedParam=e.Router.rootInstance.retrieve(),o.fallout_searchfoId=a.observable(o.passedParam?o.passedParam.foId:""),o.fallout_orderId=a.observable(o.passedParam?o.passedParam.orderId:""),o.fallout_actId=a.observable(o.passedParam?o.passedParam.actId:""),o.dialogFlag=a.observable(o.passedParam&&o.passedParam.Action?o.passedParam.Action:"N"),o.selectedOrderId=a.observable(o.passedParam&&o.passedParam.orderId?o.passedParam.orderId:""),o.selectedOrderIdValid=a.observable(!1),o.selectedOrderType=a.observable(),o.selectedIntegrationId=a.observable(),o.selectedMsisdn=a.observable(),o.selectedOrderStatus=a.observable(),o.selectedSubmittedDate=a.observable(),o.selectedCreatedDate=a.observable(),o.selectedCompletionDate=a.observable(),o.actionId=a.observable(o.passedParam&&o.passedParam.actId?o.passedParam.actId:""),o.actionIdValid=a.observable(!1),o.FromfalloutDate=a.observable(),o.toFalloutDate=a.observable(),o.falloutDetailFlag=a.observable("N"===o.dialogFlag()?"Y":"N"),o.selectOrderIdMsg=a.observableArray(),o.msgs=a.observableArray(),o.selectedOrderId()&&o.msgs.push({summary:"summary",detail:"detail",severity:"error"}),o.selectOrderIdMsg(o.msgs()),o.fallout_falloutStatusLOV=a.observableArray(),o.fallout_searchStatus=a.observableArray(),o.fallout_falloutStatus=function(){getRestData(d.getLOV,["lovName"],["LOV_FALLOUT_STATUS"],function(e){if(e){let a=e.filter(e=>e.enable).map(e=>({label:e.lookupValue4,value:e.lookupValue4}));o.fallout_falloutStatusLOV(a)}})},o.fallout_falloutStatus(),localStorage.getItem("formValue")){var t=JSON.parse(localStorage.getItem("formValue"));o.fallout_searchfoId(t.fallout_searchfoId),o.FromfalloutDate(t.FromfalloutDate),o.toFalloutDate(t.toFalloutDate),o.fallout_falloutStatusLOV(t.fallout_falloutStatusLOV),o.selectedOrderId(t.selectedOrderId)}o.viewFalloutDetails=function(e,a){var t={fallout_searchfoId:o.fallout_searchfoId(),FromfalloutDate:o.FromfalloutDate(),toFalloutDate:o.toFalloutDate(),fallout_falloutStatusLOV:o.fallout_falloutStatusLOV(),selectedOrderId:o.selectedOrderId()};localStorage.setItem("formValue",JSON.stringify(t));const r={orderId:o.selectedOrderId(),actId:o.actionId(),foId:e.foId,Action:o.dialogFlag(),flag:o.falloutDetailFlag()};l.redirect("falloutdetails",r)},o.fallout_backtask=function(e,a){l.redirect("tasks",o.passedParam)},o.fallout_backorder=function(e,a){l.redirect("orders",o.passedParam)},o.fallout_inputName=a.observable(),o.fallout_inputValue=a.observable(),o.validators=a.computed(function(){return[{type:"regExp",options:{pattern:"[a-zA-Z0-9]",messageDetail:"You must enter at least 3 letters or numbers"}}]}),o.showMessages=function(){var e=document.getElementById("ordIdInptTxt"),t=document.getElementById("actIdInptTxt");(""===o.selectedOrderId()&&e||o.selectedOrderId()&&e)&&(o.selectedOrderIdValid=a.observable("invalidShown"),e.showMessages()),(""===o.actionId()&&t||o.actionId()&&t)&&(o.actionIdValid=a.observable("invalidShown"),t.showMessages())},o.createCollection=function(a,t,l){var r=e.Model.extend({idAttribute:t});return o.objectEnclosure=l,this.collection=new e.Collection(null,{url:a,model:r,fetchSize:-1,parse:function(e){return o.objectEnclosure?e.hasOwnProperty(o.objectEnclosure)?e[o.objectEnclosure]:void 0:e}}),this.collection},o.actionViewDetail=function(e){},o.fallout_dateTimeRenderer=function(e){return r.dateTimeRenderer(e)},o.fallout_dateTimeRenderer2=function(e){return e?r.dateTimeRendererX(e):"-"},o.fallout_columns=[{headerText:"Fallout Id",field:"foId"},{headerText:"Classification",field:"classification"},{headerText:"Status",field:"status"},{headerText:"Fallout Date",field:"foDate",renderer:o.fallout_dateTimeRenderer},{headerText:"Fallout Code",field:"foCode"},{headerText:"Fallout Message",field:"foMsg"},{headerText:"Fallout Description",field:"foDesc"},{headerText:"Src System",field:"srcSystem"},{headerText:"Order Id",field:"orderId"},{headerText:"Audit",template:"fallout-audit-template"}],o.fallout_allData=a.observableArray(),o.fallout_tableWidth=a.observable("100%"),o.fallout_display="grid",o.fallout_columnsDefault={sortable:"auto"},o.fallout_scrollPolicy="loadMoreOnScroll",o.fallout_scrollPolicyOptions={fetchSize:10},o.fallout_rootAttributes={style:"width:100%;overflow-x: auto; overflow-y: hidden;"},o.fallout_selectionMode={row:"single"},o.fallout_datasource=new e.PagingTableDataSource(new e.ArrayTableDataSource(o.fallout_allData,{idAttribute:"foId"})),o.fallout_selectedRow=a.observable(),o.fallout_onSelectRow=function(e,a){var t=a.currentRow.rowIndex;o.fallout_datasource.at(t).then(function(e){o.fallout_selectedRow(e.data)})},o.serviceUrl=a.observable(d.orderDialogService),o.orders_columns=[{headerText:"Order Id",field:"orderId"},{headerText:"Order Type",field:"orderType"},{headerText:"Integration Id",field:"integrationId"},{headerText:"MSISDN",field:"msisdn"},{headerText:"Order Status",field:"orderStatus"},{headerText:"Submitted Date",field:"submittedDate",renderer:o.orders_dateTimeRenderer},{headerText:"Created Date",field:"createdDate",renderer:o.orders_dateTimeRenderer},{headerText:"Updated Date",field:"updatedDate",renderer:o.orders_dateTimeRenderer},{headerText:"Completion Date",field:"completionDate",renderer:o.orders_dateTimeRenderer},{headerText:"Created By",field:"createdBy"},{headerText:"Updated By",field:"updatedBy"},{headerText:"Service Type",field:"serviceType"}],o.dialog_query_params=[{paramName:"orderId",paramLabel:"Order ID",value:o.selectedOrderId,visible:!0,type:"="},{paramName:"orderType",paramLabel:"Order Type",value:o.selectedOrderType,visible:!0,type:"="},{paramName:"integrationId",paramLabel:"Integration ID",value:o.selectedIntegrationId,visible:!0,type:"="},{paramName:"msisdn",paramLabel:"MSISDN",value:o.selectedMsisdn,visible:!0,type:"="},{paramName:"orderStatus",paramLabel:"Order Status",value:o.selectedOrderStatus,visible:!0,type:"="},{paramName:"submittedDate",paramLabel:"Submitted Date",value:o.selectedSubmittedDate,visible:!0,type:"="},{paramName:"createdDate",paramLabel:"Created Date",value:o.selectedCreatedDate,visible:!0,type:"="},{paramName:"completionDate",paramLabel:"Completion Date",value:o.selectedCompletionDate,visible:!0,type:"="}],o.dialog_output_listener=function(e){o.selectedOrderId(e.detail.value.orderId),o.selectedOrderType(e.detail.value.orderType),o.selectedIntegrationId(e.detail.value.integrationId),o.selectedMsisdn(e.detail.value.msisdn),o.selectedOrderStatus(e.detail.value.orderStatus),o.selectedSubmittedDate(e.detail.value.submittedDate),o.selectedCreatedDate(e.detail.value.createdDate),o.selectedCompletionDate(e.detail.value.completionDate)},o.serviceUrlAction=a.observable(d.actionService),o.action_columns=[{headerText:"Action Id",field:"actId"},{headerText:"Order Id",field:"orderId"},{headerText:"Sequence",field:"sequence"},{headerText:"Operation",field:"operation"},{headerText:"Status",field:"status"},{headerText:"Task",field:"task"},{headerText:"Service",field:"service"},{headerText:"Act Type",field:"actType"},{headerText:"Sub Act Type",field:"subActType"},{headerText:"Destination",field:"destination"},{headerText:"Logical",field:"logical"},{headerText:"Start Time",field:"StartTime"},{headerText:"End Time",field:"endTime;",renderer:o.action_dateRenderer},{headerText:"Created Date",field:"createdDate",renderer:o.action_dateRenderer},{headerText:"Updated Date",field:"updatedDate"},{headerText:"Created By",field:"createdBy"},{headerText:"Updated By",field:"updatedBy"}],o.dialog_query_params2=[{paramName:"orderId",paramLabel:"Order Id",value:o.selectedOrderId,visible:!1,type:"="},{paramName:"actId",paramLabel:"Act Id",value:o.actionId,visible:!0,type:"="}],o.dialog_output_listener2=function(e){o.selectedOrderId(e.detail.value.orderId),o.actionId(e.detail.value.actId)},o.fallout_search=function(e){var a=o.fallout_collection().filter(function(a){return 0===e.length||e.length>0&&a.attributes.ItemId.toLowerCase().indexOf(e.toString().toLowerCase())>-1});o.fallout_collection().reset(a),o.fallout_allData(o.fallout_collection().toJSON())},o.fallout_fetchSize=a.observable(-1),o.fallout_paramorderId=a.observable(o.passedParam?o.passedParam.orderId:""),o.fallout_fetchSize.subscribe(function(e){}),o.fallout_onSearch=function(){localStorage.removeItem("formValue"),o.showMessages(),o.fallout_refreshData()},o.fallout_onReset=function(){o.fallout_searchfoId(void 0),o.FromfalloutDate(void 0),o.toFalloutDate(void 0),o.fallout_searchStatus(""),o.selectedOrderId(""),o.fallout_fetchSize(-1),o.fallout_refreshData()},o.fallout_refreshData=function(){var e=[],a=[];o.fallout_fetchSize&&o.fallout_fetchSize()&&(e.push("size"),a.push(o.fallout_fetchSize())),o.passedParam&&(e.push("orderId"),a.push(o.passedParam.OrderId)),""!==o.selectedOrderId()&&(e.push("orderId"),a.push(o.selectedOrderId())),o.fallout_searchStatus&&o.fallout_searchStatus().length>0&&(e.push("falloutStatus"),a.push(o.fallout_searchStatus())),null!==o.fallout_searchfoId()&&(e.push("foId"),a.push(o.fallout_searchfoId())),o.FromfalloutDate()&&o.FromfalloutDate&&(e.push("fromFoDate"),a.push(o.FromfalloutDate())),o.toFalloutDate()&&o.toFalloutDate&&(e.push("toFoDate"),a.push(o.toFalloutDate())),getRestData(d.falloutService,e,a,function(e,a){"ERROR"!==e&&o.fallout_allData(e.content)})},o.fallout_refreshData()}});