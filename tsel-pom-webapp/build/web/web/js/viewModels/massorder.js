define(["ojs/ojcore","knockout","jquery","../appController","common/constants","common/configService","common/restService","common/rendererService","common/exportService","common/userInfo","ojs/ojdatetimepicker","ojs/ojcheckboxset"],function(e,r,a,s,o,d,t,l,n,c){this.massorder_downloadTemplate=function(){var e=d.portalServiceUrl+"/js/data/mass_order_template.csv",r=document.createElement("a");r.download=e.substr(e.lastIndexOf("/")+1),r.target="_blank",r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),delete r};const i=this;return function(){i.currentValue=r.observableArray(),i.serviceUrl=t.orderService,i.massorder_allData=r.observableArray(),i.massorder_tableWidth=r.observable("100%"),i.massorder_display="grid",i.massorder_columnsDefault={sortable:"auto"},i.massorder_scrollPolicy="loadMoreOnScroll",i.massorder_scrollPolicyOptions={fetchSize:10},i.massorder_rootAttributes={style:"width:100%;overflow-x: auto; overflow-y: hidden;"},i.massorder_selectionMode={row:"multiple"},i.massorder_datasource=new e.PagingTableDataSource(new e.ArrayTableDataSource(i.massorder_allData,{idAttribute:"orderId"})),i.agreement=r.observableArray(),i.currentData=r.observableArray(),i.massorder_fetchSize=r.observable(),i.massorder_columns=[{headerTemplate:"action-template-header",template:"action-template-detail",sortable:!1},{headerText:"Order Id",field:"orderId"}],i.massorder_fileName=r.observable(),i.massorder_disabledRetry=r.observable(!0),i.massorder_disabledCancel=r.observable(!0),i.massorder_disabledForceComplete=r.observable(!0),i.massorder_onBrowse=function(){document.getElementById("browseFile").click()},onChangeFile=function(){i.massorder_fileName(document.getElementById("browseFile").files[0].name)},i.massorder_onUpload=function(){var e=document.getElementById("browseFile").files[0];if(void 0!==e)if("application/vnd.ms-excel"===e.type||"text/csv"===e.type){var r=new FileReader;r.readAsText(e),r.onload=function(){var e=r.result;jsondata=function(e){for(var r=e.split("\r\n"),a=[],s=r[0].split(","),o=1;o<r.length;o++){for(var d={},t=r[o].split(","),l=0;l<s.length;l++)d[s[l]]=t[l];a.push(d)}return a}(e),jsondata&&i.massorder_allData(jsondata)}}else showErrorMessage("ERROR!","Invalid file type, please upload file with CSV format.");else showErrorMessage("ERROR!","No file uploaded.")},i.massorder_checkedData=r.observableArray(),i.massorder_onSelectAll=function(e,r){if(a("#cbAll").prop("checked")){let e=i.massorder_allData();e.forEach(e=>{e.isChecked=e.orderId}),i.massorder_allData([]),i.massorder_allData(e);let r=e.map(e=>e.orderId);i.massorder_checkedData(r)}else{let e=i.massorder_allData();e.forEach(e=>{e.isChecked=[]}),i.massorder_allData([]),i.massorder_allData(e),i.massorder_checkedData([])}0!==i.massorder_checkedData().length?(i.massorder_disabledRetry(!1),i.massorder_disabledCancel(!1),i.massorder_disabledForceComplete(!1)):(i.massorder_disabledRetry(!0),i.massorder_disabledCancel(!0),i.massorder_disabledForceComplete(!0))},i.massorder_onSelect=function(e,r){var s=i.massorder_allData().findIndex(function(r){return r.orderId===e.orderId});if(i.massorder_allData()[s].isChecked=!i.massorder_allData()[s].isChecked,a(r.currentTarget).is(":checked"))i.massorder_checkedData().push(e.orderId);else{var o=i.massorder_checkedData();i.massorder_checkedData(o.filter(function(r){return r!==e.orderId}))}0!==i.massorder_checkedData().length?(i.massorder_disabledRetry(!1),i.massorder_disabledCancel(!1),i.massorder_disabledForceComplete(!1)):(i.massorder_disabledRetry(!0),i.massorder_disabledCancel(!0),i.massorder_disabledForceComplete(!0))},i.massorder_onClearAll=function(){i.massorder_fileName(""),document.getElementById("browseFile").value="",a("#cbAll").prop("checked",!1),a(".cbRow").prop("checked",!1),massorder_checkedData([]),i.massorder_allData([]),showConfirmationMessage("Success","Clear All Data successfully executed."),0!==i.massorder_checkedData().length?(i.massorder_disabledRetry(!1),i.massorder_disabledCancel(!1),i.massorder_disabledForceComplete(!1)):(i.massorder_disabledRetry(!0),i.massorder_disabledCancel(!0),i.massorder_disabledForceComplete(!0))},this.massorder_onRetry=function(r,a){var s={OrderRecoveryRetryMassRequest:{MessageHeader:{ConversationID:e.IntlConverterUtils.dateToLocalIso(new Date),Channel:o.channel},DataArea:{OrderIDList:{OrderID:massorder_checkedData()},UpdatedBy:c.userLogin(),Comment:a}}};postRestData(t.orderRecoveryMassRetryService,s,"",function(e,r){if("ERROR"!==e){let r=e.OrderRecoveryRetryMassResponse.MessageHeader;showConfirmationMessage(r.ResponseMessage,"ConversationId="+r.ConversationId+", Channel= "+r.Channel+", ResponseCode="+r.ResponseCode+", ResponseDetail="+r.ResponseDetail)}})},i.massorder_onCancel=function(r,a){var s={OrderRecoveryCancelMassRequest:{MessageHeader:{ConversationID:e.IntlConverterUtils.dateToLocalIso(new Date),Channel:o.channel},DataArea:{OrderIDList:{OrderID:massorder_checkedData()},UpdatedBy:c.userLogin(),Comment:a}}};postRestData(t.orderRecoveryMassCancelService,s,"",function(e,r){if("ERROR"!==e){let r=e.OrderRecoveryCancelMassResponse.MessageHeader;showConfirmationMessage(r.ResponseMessage,"ConversationId="+r.ConversationId+", Channel= "+r.Channel+", ResponseCode="+r.ResponseCode+", ResponseDetail="+r.ResponseDetail)}})},i.massorder_onDownloadTemplate=function(){showConfirmationMessage("Success","Download successfully executed.")}}});