define(["ojs/ojcore","knockout","jquery","../appController","common/constants","common/configService","common/restService","common/rendererService","common/userInfo","serviceUtils","ojs/ojdatetimepicker","ojs/ojvalidation-datetime","ojs/ojlistview"],function(e,o,t,c,a,s,i,n,r){return function(){var t=this;t.cacheMonitoring_data=[{status:"NEW",color:"color-blue",icon1:"success",icon2:"wait",icon3:"wait",message:["EPC dumped to Database."]},{status:"PREPARE",color:"color-blue",icon1:"success",icon2:"wait",icon3:"wait",message:["EPC dumped to Database."]},{status:"IN PROGRESS",color:"color-yellow",icon1:"success",icon2:"success",icon3:"wait",message:["EPC dumped to Database.","Scheduler called Pro Cache.","Cache process is running."]},{status:"COMPLETED",color:"color-green",icon1:"success",icon2:"success",icon3:"success",message:["EPC dumped to Database.","Scheduler called Pro Cache.","Cache process is completed."]},{status:"FAILED",color:"color-red",icon1:"success",icon2:"success",icon3:"error",message:["EPC dumped to Database.","Scheduler called Pro Cache.","Cache process is failed."]}],t.cacheMonitoring_status=o.observable(),t.cacheMonitoring_textColor=o.observable(),t.cacheMonitoring_details=o.observableArray(),t.cacheMonitoring_iconDatabase=o.observable(),t.cacheMonitoring_iconScheduler=o.observable(),t.cacheMonitoring_iconCache=o.observable(),t.cacheMonitoring_isReadOnly=r.isRoleReadOnly(),t.cacheMonitoring_detailsDatasource=new e.ArrayTableDataSource(t.cacheMonitoring_details,{idAttribute:"id"}),t.cacheMonitoring_refreshData=function(){getRestData(i.getEpcProStatus,null,null,function(e,o){if("ERROR"!==e){t.cacheMonitoring_status(e[0].statusRV);let o=t.cacheMonitoring_data.filter(e=>e.status===t.cacheMonitoring_status()).map(e=>e.color);t.cacheMonitoring_textColor(o?o[0]:"");let c=t.cacheMonitoring_data.filter(e=>e.status===t.cacheMonitoring_status()).map(e=>e.message),a=[];if(c){let e=1;c[0].forEach(o=>{a.push({id:e,msg:o}),e++})}t.cacheMonitoring_details(a);let s=t.cacheMonitoring_data.filter(e=>e.status===t.cacheMonitoring_status()).map(e=>e.icon1),i=t.cacheMonitoring_data.filter(e=>e.status===t.cacheMonitoring_status()).map(e=>e.icon2),n=t.cacheMonitoring_data.filter(e=>e.status===t.cacheMonitoring_status()).map(e=>e.icon3);t.cacheMonitoring_iconDatabase(s?s[0]:""),t.cacheMonitoring_iconScheduler(i?i[0]:""),t.cacheMonitoring_iconCache(n?n[0]:"")}})},t.cacheMonitoring_retry=function(){getRestData(i.getEpcProStatus,null,null,function(e,o){"ERROR"!==e&&("FAILED"===e[0].statusRV?postRestData(i.updateCache,null,null,function(e,o){"ERROR"!==e&&(showInfoMessage("INFORMATION","Manual cache submitted. Click refresh in a few minutes to reload the status."),setTimeout(function(){t.cacheMonitoring_refreshData()},3e3))}):showErrorMessage("ERROR!","Invalid status, please click refresh button."))})},t.cacheMonitoring_detailsRenderer=function(e){return{insert:e.data.msg}},t.cacheMonitoring_refreshData()}});