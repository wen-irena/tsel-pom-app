define(["ojs/ojcore","knockout","jquery","../appController","common/constants","common/configService","common/restService","common/rendererService","common/userInfo","libs/cm/lib/codemirror","libs/cm/mode/htmlmixed/htmlmixed","libs/cm/mode/xml/xml","libs/cm/addon/hint/show-hint","libs/cm/addon/hint/html-hint","libs/cm/addon/mode/loadmode","libs/cm/addon/selection/active-line","libs/cm/addon/edit/matchbrackets","libs/cm/addon/display/autorefresh","libs/vkbeautify/vkbeautify.0.99.00.beta","ojs/ojlabel","ojs/ojinputtext","ojs/ojdatetimepicker","ojs/ojdialog","ojs/ojcollapsible","ojs/ojswitcher"],function(e,r,a,o,t,s,d,n,l,i){var p;this.passedParam=e.Router.rootInstance.retrieve(),this.workorders_dateTimeConverter2=n.dateTimeConverter2,this.workorders_dateTimeRenderer2=function(e){return n.dateTimeRendererX(e)},this.workorders_viewFallout=function(e,r){const a={orderId:e.orderId,actId:e.actId,Action:"Y"};o.redirect("fallout",a)},this.workorders_retry=function(r,a){let o=e.Router.rootInstance.retrieve();var s={OrderRecoveryRetryRequest:{MessageHeader:{ConversationID:e.IntlConverterUtils.dateToLocalIso(new Date),Channel:t.channel},DataArea:{OrderID:o.orderId,UpdatedBy:l.userLogin(),Comment:a}}};postRestData(d.orderRecoveryRetryService,s,"",function(e,r){if("ERROR"!==e){let r=e.OrderRecoveryRetryResponse.MessageHeader;showConfirmationMessage(r.ResponseMessage,"ConversationId="+r.ConversationId+", Channel= "+r.Channel+", ResponseCode="+r.ResponseCode+", ResponseDetail="+r.ResponseDetail)}})},this.workorders_cancel=function(r,a){let o=e.Router.rootInstance.retrieve();var s={OrderRecoveryCancelRequest:{MessageHeader:{ConversationID:e.IntlConverterUtils.dateToLocalIso(new Date),Channel:t.channel},DataArea:{orderID:o.orderId,UpdatedBy:l.userLogin(),Comment:a}}};postRestData(d.orderRecoveryCancelService,s,"",function(e,r){if("ERROR"!==e){let r=e.OrderRecoveryCancelResponse.MessageHeader;showConfirmationMessage(r.ResponseMessage,"ConversationId="+r.ConversationId+", Channel= "+r.Channel+", ResponseCode="+r.ResponseCode+", ResponseDetail="+r.ResponseDetail)}})},this.workorders_forceComplete=function(r,a){var o={OrderRecoveryForceCompleteRequest:{MessageHeader:{ConversationID:e.IntlConverterUtils.dateToLocalIso(new Date),Channel:t.channel},DataArea:{orderID:r.orderId,UpdatedBy:l.userLogin(),Comment:a}}};postRestData(d.orderRecoveryForceCompleteService,o,"",function(e,r){if("ERROR"!==e){let r=e.OrderRecoveryForceCompleteResponse.MessageHeader;showConfirmationMessage(r.ResponseMessage,"ConversationId="+r.ConversationId+", Channel= "+r.Channel+", ResponseCode="+r.ResponseCode+", ResponseDetail="+r.ResponseDetail)}})},this.workorders_rollbackTask=function(r,a){var o={OrderRecoveryRollbackRequest:{MessageHeader:{ConversationID:e.IntlConverterUtils.dateToLocalIso(new Date),Channel:t.channel},DataArea:{ActionID:r.actId,UpdatedBy:l.userLogin(),Comment:a}}};postRestData(d.orderRecoveryRollbackService,o,"",function(e,r){if("ERROR"!==e){let r=e.OrderRecoveryRollbackResponse.MessageHeader;showConfirmationMessage(r.ResponseMessage,"ConversationId="+r.ConversationId+", Channel= "+r.Channel+", ResponseCode="+r.ResponseCode+", ResponseDetail="+r.ResponseDetail)}})},this.workorders_onSaveRetry=function(r,a){let o=p.getValue();var s={OrderRecoveryUpdateRequest:{MessageHeader:{ConversationID:e.IntlConverterUtils.dateToLocalIso(new Date),Channel:t.channel},DataArea:{OrderId:passedParam.orderId,Payload:o,PayloadType:"RC",UpdatedBy:l.userLogin()}}};postRestData(d.orderRecoveryUpdateService,s,"",function(e,r){if("ERROR"!==e){let r=e.OrderRecoveryUpdateResponse.MessageHeader;showConfirmationMessage(r.ResponseMessage,"ConversationId="+r.ConversationId+", Channel= "+r.Channel+", ResponseCode="+r.ResponseCode+", ResponseDetail="+r.ResponseDetail)}})};const c=this;return function(){passedParam=e.Router.rootInstance.retrieve(),c.workorders_backOrder=function(){let r=e.Router.rootInstance.retrieve();o.redirect("orders",r)},c.workorders_retryPayload=function(){var e=[],r=[];c.data_orderId()&&(e.push("eventId"),r.push(c.data_orderId())),c.workorders_eventType&&(e.push("eventType"),r.push(c.workorders_eventType)),getRestData(d.payloadService,e,r,function(e,r){"ERROR"!==e&&(a(".CodeMirror-wrap").remove(),a("#retryWithPayloadEditor").val(vkbeautify.xml(e.content[0]?e.content[0].payload:"")),p=i.fromTextArea(document.getElementById("retryWithPayloadEditor"),{mode:"text/xml",theme:"default",lineNumbers:!0,lineWrapping:!0,readOnly:!1,autoRefresh:!0}))}),a("#payloadDialog").ojDialog("open")},c.workorders_paramOrderId=r.observable(passedParam?passedParam.orderId:""),c.workorders_searchOrderId=r.observable(passedParam?passedParam.orderId:""),c.workorders_dateTimeRenderer=function(e){return n.dateTimeRenderer(e)},c.workorders_columns=[{headerTemplate:"action-header-template",template:"action-template",sortable:!1},{headerText:"Sequence",field:"sequence"},{headerText:"Status",template:"task-status-template",field:"status"},{headerText:"Task",template:"task-template",field:"actType",style:"max-width:400px"},{headerText:"Start-End Time",template:"task-timestamp-template",field:"startTime"},{headerText:"Fallout",template:"task-fallout-template",field:"foId"},{headerText:"Audit",template:"task-audit-template",field:"createdDate"}],c.workorders_dateTimeConverter=n.dateTimeConverter2,c.workorders_startDate=r.observable(),c.workorders_endDate=r.observable(),c.workorders_searchWorkOrderId=r.observable(),c.workorders_fetchSize=r.observable("-1"),c.workorders_allData=r.observableArray(),c.workorders_tableWidth=r.observable("100%"),c.workorders_display="grid",c.workorders_columnsDefault={sortable:"disable"},c.workorders_scrollPolicy="loadMoreOnScroll",c.workorders_scrollPolicyOptions={fetchSize:10},c.workorders_rootAttributes={style:"width:100%;overflow-x: auto; overflow-y: hidden;"},c.workorders_selectionMode={row:"single"},c.workorders_datasource=new e.PagingTableDataSource(new e.ArrayTableDataSource(c.workorders_allData,{idAttribute:"actId",implicitSort:[{attribute:"sequence",direction:"ascending"}]})),c.workorders_selectedRow=r.observable(),c.workorders_statusLOV=r.observableArray(),c.workorders_status=r.observableArray(),c.workorders_taskStatus=function(){getRestData(d.getLOV,["lovName"],["LOV_TASK_STATUS"],function(e){if(e){let r=e.filter(e=>e.enable).map(e=>({label:e.lookupValue2,value:e.lookupValue2}));c.workorders_statusLOV(r)}})},c.workorders_taskStatus(),c.workorders_eventTypeLOV=r.observableArray(),c.workorders_eventType=r.observableArray(),c.workorders_eventType=function(){getRestData(d.getLOV,["lovName"],["LOV_EVENT_TYPE"],function(e){if(e){let r=e.filter(e=>e.enable).map(e=>({label:e.lookupValue4,value:e.lookupValue4}));c.workorders_eventTypeLOV(r)}})},c.workorders_eventType(),c.workorders_eventTypeChange=function(){var e=[],r=[];c.data_orderId()&&(e.push("eventId"),r.push(c.data_orderId())),c.workorders_eventType&&(e.push("eventType"),r.push(c.workorders_eventType)),getRestData(d.payloadService,e,r,function(e,r){"ERROR"!==e&&(a(".CodeMirror-wrap").remove(),a("#retryWithPayloadEditor").val(vkbeautify.xml(e.content[0]?e.content[0].payload:"")),p=i.fromTextArea(document.getElementById("retryWithPayloadEditor"),{mode:"text/xml",theme:"default",lineNumbers:!0,lineWrapping:!0,readOnly:!1,autoRefresh:!0}))})},this.selectedItemOrders=r.observable("ori"),this.valueChangedHandler=function(e){var r=e.detail.value,o=e.detail.previousValue;a("#demo-container").addClass("demo-edge-"+r).removeClass("demo-edge-"+o)},c.offerList_columns=[{headerText:"#",field:"seq"},{headerText:"CID",field:"cid"},{headerText:"Name Text",field:"nameText"},{headerText:"Ap Version",field:"apVersionId"},{headerText:"Status",field:"status"}],c.offerList_allData=r.observableArray(),c.offerList_tableWidth=r.observable("100%"),c.offerList_display="grid",c.offerList_columnsDefault={sortable:"auto"},c.offerList_scrollPolicy="loadMoreOnScroll",c.offerList_scrollPolicyOptions={fetchSize:10},c.offerList_rootAttributes={style:"width:100%;overflow-x: auto; overflow-y: hidden;"},c.offerList_selectionMode={row:"single"},c.offerList_datasource=new e.PagingTableDataSource(new e.ArrayTableDataSource(c.offerList_allData,{idAttribute:"seq"})),c.offerList_fetchSize=r.observable("-1"),c.workorders_orderStatus=r.observable(),c.workorders_disabledValue=r.observable(!0),c.workorders_isReadOnlyRetry=r.observable(l.isRoleReadOnly()),c.workorders_isReadOnlyCancel=r.observable(l.isRoleReadOnly()),c.workorders_isReadOnlyForceComplete=r.observable(l.isRoleReadOnly()),c.workorders_isReadOnlyRetryWithPayload=r.observable(l.isRoleReadOnly()),c.workorders_isReadOnlyUpdatePayload=r.observable(l.isRoleReadOnly()),c.workorders_isReadOnly=l.isRoleReadOnly(),c.compareValues=function(e,r="asc"){return function(a,o){if(!a.hasOwnProperty(e)||!o.hasOwnProperty(e))return 0;const t="string"==typeof a[e]?a[e].toUpperCase():a[e],s="string"==typeof o[e]?o[e].toUpperCase():o[e];let d=0;return t>s?d=1:t<s&&(d=-1),"desc"===r?-1*d:d}},c.workorders_refreshData=function(){var e=[],o=[];c.workorders_fetchSize&&c.workorders_fetchSize()&&(e.push("size"),o.push(c.workorders_fetchSize())),passedParam&&(e.push("orderId"),o.push(passedParam.orderId)),c.workorders_status()&&(e.push("status"),o.push(c.workorders_status())),getRestData(d.workorderService,e,o,function(e,r){if("ERROR"!==e){let r=e.content.sort(c.compareValues("sequence","asc"));c.workorders_allData(r),a("#myTable_workordersTable").ojTable("refresh")}});var t=[],s=[];t.push("orderId"),s.push(passedParam.orderId),c.data_orderId=r.observable(),c.data_orderType=r.observable(),c.data_orderStatus=r.observable(),c.data_msisdn=r.observable(),c.data_salesChannel=r.observable(),c.data_integrationId=r.observable(),c.data_submittedDate=r.observable(),c.data_completionDate=r.observable(),c.data_serviceType=r.observable(),c.data_extOrderId=r.observable(),c.data_operationCode=r.observable(),c.data_fileName=r.observable(),c.data_reason=r.observable(),c.data_payloadOri=r.observable(),c.data_payloadUpdated=r.observable(),c.payloadUpdatedExpanded=r.observable(),c.payloadOriExpanded=r.observable(),getRestData(d.orderService,t,s,function(e,r){if("ERROR"!==e){var a=e.content,o=a[0];c.workorders_orderStatus(a[0].orderStatus),c.data_orderId(o.orderId?o.orderId:"N/A"),c.data_orderType(o.orderType?o.orderType:"N/A"),c.data_orderStatus(o.orderStatus?o.orderStatus:"N/A"),c.data_msisdn(o.msisdn?o.msisdn:"N/A"),c.data_salesChannel(o.salesChannel?o.salesChannel:"N/A"),c.data_integrationId(o.integrationId?o.integrationId:"N/A"),c.data_submittedDate(o.submittedDate?workorders_dateTimeRenderer2(o.submittedDate):"N/A"),c.data_completionDate(o.completionDate?workorders_dateTimeRenderer2(o.completionDate):"N/A"),c.data_serviceType(o.serviceType?o.serviceType:"N/A"),c.data_extOrderId(o.extOrderId?o.extOrderId:"N/A"),c.data_operationCode(o.operationCode?o.operationCode:"N/A"),c.data_fileName(o.fileName?o.fileName:"N/A"),c.data_reason(o.reason?o.reason:"N/A"),c.data_payloadOri(o.payloadOri?o.payloadOri:"N/A"),c.data_payloadUpdated(o.payloadUpdated?o.payloadUpdated:"N/A"),"Failed"===c.workorders_orderStatus()?c.workorders_disabledValue(!1):c.workorders_disabledValue(!0)}})},c.workorders_viewPayloadori=function(){var e=[],r=[];e.push("orderId"),r.push(passedParam.orderId),getRestData(d.orderService,e,r,function(e,r){if("ERROR"!==e){var o=e.content[0];c.data_payloadOri(o.payloadOri?o.payloadOri:"N/A"),c.data_payloadUpdated(o.payloadUpdated?o.payloadUpdated:"N/A"),a(".CodeMirror-wrap").remove(),a("#tasks_payloadOriginal").val(vkbeautify.xml(o.payloadOri?o.payloadOri:"-")),i.fromTextArea(document.getElementById("tasks_payloadOriginal"),{mode:"text/xml",theme:"default",lineNumbers:!0,lineWrapping:!0,readOnly:!0,autoRefresh:!0}),a("#tasks_payloadUpdated").val(vkbeautify.xml(o.payloadUpdated?o.payloadUpdated:"-")),i.fromTextArea(document.getElementById("tasks_payloadUpdated"),{mode:"text/xml",theme:"default",lineNumbers:!0,lineWrapping:!0,readOnly:!0,autoRefresh:!0})}}),a("#tasksPayloadoriDialog").ojDialog("open")},c.workorders_onSearch=function(){c.workorders_refreshData()},c.workorders_onReset=function(){c.workorders_searchWorkOrderId(void 0),c.workorders_startDate(void 0),c.workorders_endDate(void 0),c.workorders_fetchSize(-1),c.workorders_refreshData()},c.workorders_fetchSize.subscribe(function(e){e&&c.workorders_refreshData()}),c.workorders_refreshData()}});