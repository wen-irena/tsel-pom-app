define(["ojs/ojcore","knockout","jquery","../appController","common/constants","common/configService","common/restService","common/rendererService","serviceUtils","ojs/ojdatetimepicker","ojs/ojvalidation-datetime","ojs/ojanimation"],function(e,r,o,i,t,n,a,s){return function(){var i=this,t=new Date,n=new Date;n.setHours(0,0,0,0),new Date(t.getFullYear(),t.getMonth()+1,0),i.stackValue=r.observable("off");var l=new Date;l.setHours(23,59,59,997),i.serviceMonitoring_currentDate=r.observable(e.IntlConverterUtils.dateToLocalIso(l)),i.serviceMonitoring_startDate=r.observable(e.IntlConverterUtils.dateToLocalIso(n)),i.serviceMonitoring_endDate=r.observable(e.IntlConverterUtils.dateToLocalIso(t)),i.serviceMonitoring_endDateTime=r.observable(),i.serviceMonitoring_dateConverter=s.dateConverter,i.serviceMonitoring_dateTimeConverter=s.dateTimeConverter3,i.serviceMonitoring_lastRefreshDaily=r.observable(),i.serviceMonitoring_lastRefreshHourly=r.observable(),i.serviceMonitoring_lastRefreshOrderType=r.observable(),i.serviceMonitoring_lastRefreshSalesChannel=r.observable(),i.serviceMonitoring_lastRefreshHourlyP90=r.observable(),i.serviceMonitoring_endDateHourly=r.observable(),i.serviceMonitoring_endDateOrderType=r.observable(),i.serviceMonitoring_endDateSalesChannel=r.observable(),i.serviceMonitoring_endDateHourlyP90=r.observable(),i.serviceMonitoring_loadDetailValue=r.observableArray([]),i.serviceMonitoring_selectedPercentile=r.observable(),i.serviceMonitoring_selectedFilter=r.observable("all"),i.hourlyExpanded=!0,i.hourlyButtonIcons=r.observable("oj-panel-expand-icon"),i.hourlyButtonLabel=r.observable("collapse"),i.serviceMonitoring_loadDataLabelValue=r.observableArray([]),i.serviceMonitoring_dataLabelPositionValue=r.observable("none"),i.serviceMonitoring_loadDataLabelValue.subscribe(function(e){e&&("yes"===e.toString()?i.serviceMonitoring_dataLabelPositionValue("outsideBarEdge"):i.serviceMonitoring_dataLabelPositionValue("none"))}),i.serviceMonitoring_dateRenderer=function(r){if(r){var o=new Date(r);return i.serviceMonitoring_dateConverter.format(e.IntlConverterUtils.dateToLocalIso(o))}return"-"},i.serviceMonitoring_dateTimeRenderer=function(r){if(r){var o=new Date(r);return i.serviceMonitoring_dateTimeConverter.format(e.IntlConverterUtils.dateToLocalIso(o))}return"-"},i.selectedItemsValue=r.observable();var c=e.Validation.converterFactory(e.ConverterFactory.CONVERTER_TYPE_DATETIME);i.dayMonth=c.createConverter({day:"numeric",month:"numeric"}),i.year=c.createConverter({year:"numeric"}),i.dayMonthYear=c.createConverter({year:"2-digit",month:"numeric",day:"numeric"}),i.hourConverter=c.createConverter({pattern:"HH:mm"});var d=e.Validation.converterFactory("number");i.y2Converter=d.createConverter({style:"percent"}),i.y2Converter2=d.createConverter({style:"percent",pattern:"#,##0.00%"}),i.yConverter=d.createConverter({pattern:"#,##0"}),i.yConverterP90=d.createConverter({pattern:"#,##0.00"}),i.orientationValue=r.observable("vertical"),i.xAxisOptions2=r.observable({tickLabel:{converter:[r.toJS(i.hourConverter)]}}),i.shortDateConverter=e.Validation.converterFactory(e.ConverterFactory.CONVERTER_TYPE_DATETIME).createConverter({pattern:"dd/MM/yy"}),i.mixedSeriesValue=r.observableArray(),i.mixedGroupsValue=r.observableArray(),i.mixedSeriesValueHourly=r.observableArray(),i.mixedGroupsValueHourly=r.observableArray(),i.mixedSeriesValueHourlyP90=r.observableArray(),i.mixedGroupsValueHourlyP90=r.observableArray(),i.dashboardHourly_startDate=r.observable(),i.dashboardHourly_endDate=r.observable(),i.serviceMonitoring_percentageRenderer=function(e){return s.percentageRenderer(e)},i.dashboardSelectedDate=r.observable(),i.serviceMonitoring_selectedDate=r.observable(),i.serviceMonitoring_selectionListener=function(e){if(e.detail.selectionData.length>0){let r=e.detail.selectionData[0].groupData[0].split("T")[0],t=e.detail.selectionData[0].groupData[0];i.dashboardSelectedDate(t.split("T")[0]),i.serviceMonitoring_selectedDate(t),o("#serviceMonitoring_detail").removeClass("oj-sm-hide oj-md-hide oj-lg-hide oj-xl-hide"),i.dashboardHourly_startDate(r),i.dashboardHourly_endDate(r),i.serviceMonitoring_endDateHourly(i.serviceMonitoring_endDateTime()),i.serviceMonitoring_refreshHourly(),i.serviceMonitoring_expandItem("hourly"),i.serviceMonitoring_lastRefreshHourly(i.serviceMonitoring_lastRefreshDaily()),"all"===i.serviceMonitoring_loadDetailValue().toString()?(i.serviceMonitoring_lastRefreshOrderType(i.serviceMonitoring_lastRefreshDaily()),i.serviceMonitoring_lastRefreshSalesChannel(i.serviceMonitoring_lastRefreshDaily()),i.serviceMonitoring_lastRefreshHourlyP90(i.serviceMonitoring_lastRefreshDaily()),i.serviceMonitoring_endDateHourlyP90(i.serviceMonitoring_endDateTime()),i.serviceMonitoring_refreshHourlyP90(),i.serviceMonitoring_expandItem("hourlyP90"),i.serviceMonitoring_endDateOrderType(i.serviceMonitoring_endDateTime()),i.serviceMonitoring_refreshOrderType(),i.serviceMonitoring_expandItem("orderType"),i.serviceMonitoring_endDateSalesChannel(i.serviceMonitoring_endDateTime()),i.serviceMonitoring_refreshSalesChannel(),i.serviceMonitoring_expandItem("salesChannel")):(i.serviceMonitoring_lastRefreshOrderType(void 0),i.serviceMonitoring_lastRefreshSalesChannel(void 0),i.serviceMonitoring_lastRefreshHourlyP90(void 0),i.serviceMonitoring_allData([]),i.dashboardTopSales_allData([]),i.mixedSeriesValueHourlyP90([]),i.mixedGroupsValueHourlyP90([]),i.serviceMonitoring_collapseItem("orderType"),i.serviceMonitoring_collapseItem("salesChannel"),i.serviceMonitoring_collapseItem("hourlyP90"))}},i.mixedSeriesValueHourly=r.observableArray(),i.mixedGroupsValueHourly=r.observableArray(["test1","test2"]),i.serviceMonitoring_columns=[{headerText:"Order Type",field:"orderType"},{headerText:"<= 5 Min",field:"totalOrderLe5min"},{headerText:"> 5 Min",field:"totalOrderGt5min"},{headerText:"SR",field:"sr",renderer:i.serviceMonitoring_percentageRenderer,style:"text-align:right"}],i.serviceMonitoring_allData=r.observableArray(),i.serviceMonitoring_tableWidth=r.observable("100%"),i.serviceMonitoring_display="grid",i.serviceMonitoring_columnsDefault={sortable:"auto"},i.serviceMonitoring_scrollPolicy="loadMoreOnScroll",i.serviceMonitoring_scrollPolicyOptions={fetchSize:10},i.serviceMonitoring_rootAttributes={style:"width:100%; height:220px; overflow-x: scroll; overflow-y: scroll;"},i.serviceMonitoring_selectionMode={row:"single"},i.serviceMonitoring_datasource=new e.PagingTableDataSource(new e.ArrayTableDataSource(i.serviceMonitoring_allData,{idAttribute:"orderType"})),i.serviceMonitoring_fetchSize=r.observable(),i.serviceMonitoring_selectedRow=r.observable(),i.dashboardTopSales_columns=[{headerText:"Sales Channel",field:"salesChannel"},{headerText:"<= 5 Min",field:"totalOrderLe5min"},{headerText:"> 5 Min",field:"totalOrderGt5min"},{headerText:"SR",field:"sr",renderer:i.serviceMonitoring_percentageRenderer,style:"text-align:right"}],i.dashboardTopSales_allData=r.observableArray(),i.dashboardTopSales_datasource=new e.PagingTableDataSource(new e.ArrayTableDataSource(i.dashboardTopSales_allData,{idAttribute:"salesChannel"})),i.styleDefaults=r.pureComputed(function(){return{barGapRatio:.35,markerDisplayed:"on"}}),i.serviceMonitoring_refreshHourly=function(){let e=[],r=[];i.serviceMonitoring_selectedDate&&i.serviceMonitoring_selectedDate()&&(e.push("startDate"),r.push(i.serviceMonitoring_selectedDate())),i.serviceMonitoring_endDateHourly&&i.serviceMonitoring_endDateHourly()&&(e.push("endDate"),r.push(i.serviceMonitoring_endDateHourly())),i.serviceMonitoring_selectedFilter&&i.serviceMonitoring_selectedFilter()&&(e.push("filterBy"),r.push(i.serviceMonitoring_selectedFilter())),getRestData(a.getHourlyOrderPerformance,e,r,function(e,r){if("ERROR"!==e){var o=[],t=[],n=[],a=[];e.content.forEach(function(e){o.push(e.totalOrderCompleted),t.push(e.le5minPercentage),a.push(e.submittedDate),n.push(e.successRate)});var s=[{name:"Completed",items:o,type:"bar",color:"#237bb1",assignedToY2:"off"},{name:"<= 5 Minutes",items:t,type:"line",color:"#68c182",assignedToY2:"on",markerShape:"circle"},{name:"SR",items:n,type:"line",color:"#8561c8",assignedToY2:"on",markerShape:"square"}];i.mixedSeriesValueHourly(s),i.mixedGroupsValueHourly(a)}else i.mixedSeriesValueHourly([]),i.mixedGroupsValueHourly([])})},i.serviceMonitoring_refreshOrderType=function(){let e=[],r=[];i.serviceMonitoring_selectedDate&&i.serviceMonitoring_selectedDate()&&(e.push("startDate"),r.push(i.serviceMonitoring_selectedDate())),i.serviceMonitoring_endDateHourly&&i.serviceMonitoring_endDateHourly()&&(e.push("endDate"),r.push(i.serviceMonitoring_endDateOrderType())),i.serviceMonitoring_selectedFilter&&i.serviceMonitoring_selectedFilter()&&(e.push("filterBy"),r.push(i.serviceMonitoring_selectedFilter())),getRestData(a.getOrderCountByOrderType,e,r,function(e,r){"ERROR"!==e?i.serviceMonitoring_allData(e.content):i.serviceMonitoring_allData([])})},i.serviceMonitoring_refreshSalesChannel=function(){let e=[],r=[];i.serviceMonitoring_selectedDate&&i.serviceMonitoring_selectedDate()&&(e.push("startDate"),r.push(i.serviceMonitoring_selectedDate())),i.serviceMonitoring_endDateSalesChannel&&i.serviceMonitoring_endDateSalesChannel()&&(e.push("endDate"),r.push(i.serviceMonitoring_endDateSalesChannel())),i.serviceMonitoring_selectedFilter&&i.serviceMonitoring_selectedFilter()&&(e.push("filterBy"),r.push(i.serviceMonitoring_selectedFilter())),getRestData(a.getOrderCountBySalesChannel,e,r,function(e,r){"ERROR"!==e?i.dashboardTopSales_allData(e.content):i.dashboardTopSales_allData([])})},i.serviceMonitoring_refreshHourlyP90=function(){let e=[],r=[];i.serviceMonitoring_selectedDate&&i.serviceMonitoring_selectedDate()&&(e.push("startDate"),r.push(i.serviceMonitoring_selectedDate())),i.serviceMonitoring_endDateHourlyP90&&i.serviceMonitoring_endDateHourlyP90()&&(e.push("endDate"),r.push(i.serviceMonitoring_endDateHourlyP90())),i.serviceMonitoring_selectedPercentile&&i.serviceMonitoring_selectedPercentile()&&(e.push("percentile"),r.push(i.serviceMonitoring_selectedPercentile())),i.serviceMonitoring_selectedFilter&&i.serviceMonitoring_selectedFilter()&&(e.push("filterBy"),r.push(i.serviceMonitoring_selectedFilter())),getRestData(a.getHourlyPercentileCount,e,r,function(e,r){if("ERROR"!==e){var o=[],t=[];e.content.forEach(function(e){o.push(e.percentileCount),t.push(e.submittedDate)});var n=[{name:"Percentile",items:o,type:"line",color:"#68c182",markerShape:"circle"}];i.mixedSeriesValueHourlyP90(n),i.mixedGroupsValueHourlyP90(t)}else i.mixedSeriesValueHourlyP90([]),i.mixedGroupsValueHourlyP90([])})},i.serviceMonitoring_onExpandAndCollapse=function(e){var r=o("#hourly-content"),i=o("#hourly-panel"),t=o("#hourly-icon");"orderType"===e.target.id?(r=o("#orderType-content"),i=o("#orderType-panel"),t=o("#orderType-icon")):"salesChannel"===e.target.id?(r=o("#salesChannel-content"),i=o("#salesChannel-panel"),t=o("#salesChannel-icon")):"hourlyP90"===e.target.id&&(r=o("#hourlyP90-content"),i=o("#hourlyP90-panel"),t=o("#hourlyP90-icon")),"0px"!==r.css("max-height")?(r.css("max-height","0px"),i.css("height","auto"),t.removeClass("oj-panel-collapse-icon").addClass("oj-panel-expand-icon")):(r.css("max-height","430px"),i.css("height","430px"),t.removeClass("oj-panel-expand-icon").addClass("oj-panel-collapse-icon"))},i.serviceMonitoring_dailyLabel=function(e){if(e&&0!==e.value)return"Completed"===e.series||"Cancelled"===e.series||"Failed"===e.series?i.yConverter.format(e.value):"<= 5 Minutes"===e.series?i.y2Converter2.format(e.value):e.value},i.serviceMonitoring_refreshData=function(r){var o=[];if(!0===r)o.push(s.dateLASConverter.format(i.serviceMonitoring_startDate())+"T00:00:00.000"),o.push(i.serviceMonitoring_endDate()),i.serviceMonitoring_endDateTime(i.serviceMonitoring_endDate()),i.serviceMonitoring_lastRefreshDaily(i.serviceMonitoring_endDate());else if(i.serviceMonitoring_startDate&&i.serviceMonitoring_startDate()&&o.push(i.serviceMonitoring_startDate()+"T00:00:00.000"),i.serviceMonitoring_endDate&&i.serviceMonitoring_endDate()){let r=new Date,t=e.IntlConverterUtils.dateToLocalIso(r);i.serviceMonitoring_endDate().split("T")[0]===t.split("T")[0]?(i.serviceMonitoring_endDate(t),o.push(i.serviceMonitoring_endDate())):(o.push(i.serviceMonitoring_endDate()+"T23:59:59.997"),i.serviceMonitoring_endDateTime(i.serviceMonitoring_endDate()+"T23:59:59.997"))}i.serviceMonitoring_selectedFilter&&i.serviceMonitoring_selectedFilter()&&o.push(i.serviceMonitoring_selectedFilter()),getRestData(a.getDailyOrderPerformanceChart,["startDate","endDate","filterBy"],o,function(e,r){if("ERROR"!==e){var o=[],t=[],n=[],a=[],s=[];e.content.forEach(function(e){o.push(e.totalOrderCompleted),t.push(e.totalOrderCancelled),n.push(e.totalOrderFailed),a.push(e.le5minPercentage),s.push(e.submittedDate)});var l=[{name:"Completed",items:o,type:"bar",color:"#237bb1",assignedToY2:"off"},{name:"Cancelled",items:t,type:"bar",color:"#fad55c",assignedToY2:"off"},{name:"Failed",items:n,type:"bar",color:"#ed6647",assignedToY2:"off"},{name:"<= 5 Minutes",items:a,type:"line",color:"#68c182",assignedToY2:"on",markerShape:"circle"}];i.mixedSeriesValue(l),i.mixedGroupsValue(s)}else i.mixedSeriesValue([]),i.mixedGroupsValue([])}),i.serviceMonitoring_resetDetails()},i.serviceMonitoring_onSearch=function(){let r=new Date,o=s.backenddateTimeConverter.format(e.IntlConverterUtils.dateToLocalIso(r));i.serviceMonitoring_lastRefreshDaily(o);let t=new Date(i.serviceMonitoring_startDate());(new Date(i.serviceMonitoring_endDate())-t)/864e5>30?(showErrorMessage("","Cannot display data for more than 30 days"),i.mixedSeriesValue([]),i.mixedGroupsValue([])):i.serviceMonitoring_refreshData()},i.serviceMonitoring_onRefreshDaily=function(){let r=new Date,o=s.backenddateTimeConverter.format(e.IntlConverterUtils.dateToLocalIso(r));i.serviceMonitoring_lastRefreshDaily(o)},i.serviceMonitoring_onRefreshHourly=function(){let r=new Date,o=s.backenddateTimeConverter.format(e.IntlConverterUtils.dateToLocalIso(r));i.serviceMonitoring_lastRefreshHourly(o),i.serviceMonitoring_endDateHourly(o),i.serviceMonitoring_refreshHourly(),i.serviceMonitoring_expandItem("hourly")},i.serviceMonitoring_onRefreshOrderType=function(){let r=new Date,o=s.backenddateTimeConverter.format(e.IntlConverterUtils.dateToLocalIso(r));i.serviceMonitoring_lastRefreshOrderType(o),i.serviceMonitoring_endDateOrderType(o),i.serviceMonitoring_refreshOrderType(),i.serviceMonitoring_expandItem("orderType")},i.serviceMonitoring_onRefreshSalesChannel=function(){let r=new Date,o=s.backenddateTimeConverter.format(e.IntlConverterUtils.dateToLocalIso(r));i.serviceMonitoring_lastRefreshSalesChannel(o),i.serviceMonitoring_endDateSalesChannel(o),i.serviceMonitoring_refreshSalesChannel(),i.serviceMonitoring_expandItem("salesChannel")},i.serviceMonitoring_onRefreshHourlyP90=function(){let r=new Date,o=s.backenddateTimeConverter.format(e.IntlConverterUtils.dateToLocalIso(r));i.serviceMonitoring_lastRefreshHourlyP90(o),i.serviceMonitoring_endDateHourlyP90(o),i.serviceMonitoring_refreshHourlyP90(),i.serviceMonitoring_expandItem("hourlyP90")},i.serviceMonitoring_resetDetails=function(){i.serviceMonitoring_lastRefreshHourly(void 0),i.serviceMonitoring_lastRefreshOrderType(void 0),i.serviceMonitoring_lastRefreshSalesChannel(void 0),i.serviceMonitoring_lastRefreshHourlyP90(void 0),i.mixedSeriesValueHourly([]),i.mixedGroupsValueHourly([]),i.mixedSeriesValueHourlyP90([]),i.mixedGroupsValueHourlyP90([]),i.serviceMonitoring_allData([]),i.dashboardTopSales_allData([])},i.serviceMonitoring_collapseItem=function(e){"orderType"!==e&&"salesChannel"!==e&&"hourlyP90"!==e&&"hourly"!==e||"0px"!==o("#"+e+"-content").css("max-height")&&(o("#"+e+"-content").css("max-height","0px"),o("#"+e+"-panel").css("height","auto"),o("#"+e+"-icon").removeClass("oj-panel-collapse-icon").addClass("oj-panel-expand-icon"))},i.serviceMonitoring_expandItem=function(e){"orderType"!==e&&"salesChannel"!==e&&"hourlyP90"!==e&&"hourly"!==e||"0px"===o("#"+e+"-content").css("max-height")&&(o("#"+e+"-content").css("max-height","430px"),o("#"+e+"-panel").css("height","430px"),o("#"+e+"-icon").removeClass("oj-panel-expand-icon").addClass("oj-panel-collapse-icon"))},i.serviceMonitoring_refreshData(!0)}});